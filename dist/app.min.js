function _objectWithoutProperties(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function extending(){var e=Array.prototype.pop.call(arguments);return Array.prototype.slice.call(arguments).forEach(function(t){e.prototype=$.extend(Object.create(t.prototype),e.prototype,Object.getOwnPropertyNames(e.prototype).reduce(function(t,n){return t[n]=e.prototype[n],t},{}))}),e.prototype.constructor=e,e}function extendingJQuery(e){return e.prototype=$.extend(Object.create(jQuery.prototype),e.prototype),e.prototype.constructor=e,e.prototype.pushStack=function(e){var t=jQuery.merge(this.get(0)==e?new this.constructor:$(),e);return t.prevObject=this,t.context=this.context,t},e}function classEscalation(e,t){return t=isFunction(t)?t():t,Object.keys(t).forEach(function(n){Object.defineProperty(e.prototype,n,{value:t[n],configurable:!0})})}function isDirectInstance(e,t){return e.constructor===t}function tmpl(e,t,n,i){function a(e){return String(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function r(e,t){var n={},i={},r=l[(/<([\w:]+)/.exec(e)||["",""])[1].toLowerCase()]||l._default,s=r[0];for($.each(t,function(e,t){"string"==$.type(t)?i[e]=a(t):t instanceof jQuery?t.length&&(n[e]=t,t.is("tr")?i[e]='<tbody id="JQ_tmpl_'+e+'"></tbody>':t.is("span")?i[e]='<span id="JQ_tmpl_'+e+'"></span>':t.is("option")?i[e]='<optgroup id="JQ_tmpl_'+e+'"></optgroup>':i[e]='<div id="JQ_tmpl_'+e+'"></div>'):i[e]=null==t?"":t}),e=$(e?r[1]+e.format(i)+r[2]:""),$.each(n,function(t,n){e.find("#JQ_tmpl_"+t).append(n),n.is("tr")?n.parent("tbody").removeAttr("id"):n.unwrap()});s--;)e=e.children();return e}t=t||{},n=n instanceof Element?$(n):n;var s,o=$("#tmpl-"+e),l={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},c=$();return l.tbody=l.tfoot=l.colgroup=l.caption=l.thead,l.th=l.td,o.length?(s=o.html().replace(/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gim,"").replace(/\\s{2,}|\t|\n|\r/gim,"").trim(),c=Array.isArray(t)?$.makeSet(t.map(function(e){return r(s,e)})):r(s,t),null==n?c:("prepend"===i?n.prepend(c):n.append(c),c)):(console.group("tmpl_error"),console.log("error in "+e),console.log("items",t),console.log("addTo",n),console.log("inputs",{template_type:e,items:t,addTo:n,direction:i}),console.groupEnd(),$())}function parseUri(e,t){var n={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=n.parser[n.strictMode?"strict":"loose"].exec(e),a={},r=14;for(t&&$.extend(n,t);r--;)a[n.key[r]]=i[r]||"";return a[n.q.name]={},a[n.key[12]].replace(n.q.parser,function(e,t,i){t&&(a[n.q.name][t]=i)}),Object.defineProperties(a,{wo_path:{get:function(){return a[n.key[1]]+"://"+a[n.key[6]]}},wo_query:{get:function(){return a[n.key[1]]+"://"+a[n.key[6]]+a[n.key[9]]}}}),a}function storeStat(e,t,n){window.__stats=window.__stats?window.__stats:[],window.__stats.push({entity_id:e,entity_type:t,event_type:n})}function gatherUTMTags(e){var t=parseUri(e||window.location),n={};for(var i in t.queryKey)0===i.indexOf("utm_")&&(n[i]=t.queryKey[i]);return n}function getUnitsText(e,t){return(e=Math.abs(e)).toString().indexOf(".")>-1?t.GEN:e%10==1&&e%100!=11?t.NOM:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?t.GEN:t.PLU}function getGenderText(e,t){if("string"==typeof t)return t;switch(e){default:case OneUser.GENDER.MALE:return t.MAS;case OneUser.GENDER.FEMALE:return t.FEM;case OneUser.GENDER.NEUTRAL:return t.NEU}}function formatDates(e,t,n){function i(e,t,n,i,a){var r,s=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],o={d:t,D:t,t:n,T:n,M:i+1,MM:i+1>9?i+1:"0"+(i+1),MMM:__LOCALES.ru_RU.DATE.MONTH_SHORT_NAMES[i].toLocaleLowerCase(),MMMM:__LOCALES.ru_RU.DATE.MONTH_NAMES[i].toLocaleLowerCase(),MMMMs:s[i],Y:a,YY:a.substr(2,2),YYYY:a};return"string"==typeof e?r=e.format(o).capitalize():Array.isArray(e)?r=e.map(function(e){return e.format(o).capitalize()}):e instanceof jQuery?(r=$(),e.each(function(e,t){var n=$(t).clone();n.text(t.innerText.format(o).capitalize()),r=r.add(n)})):(r={},$.each(e,function(e,t){r[e]=t.format(o).capitalize()})),r}var a,r,s,o,l,c,_=!1,d=[],u=e.length-1,p={},h=[];return t||(t={date:"{D} {MMMMs} {YYYY}",time:"{T}"}),"string"==typeof t?_=t.contains(/\{T\}|\{t\}/)&&void 0!==e[0].start_time:(_=void 0!==e[0].start_time,$.each(t,function(){_=_||this.contains(/\{T\}|\{t\}/)})),n?(_&&(l=e[0].end_time?displayTimeRange(e[0].start_time,e[0].end_time):displayTimeRange(e[0].start_time)),e.forEach(function(e,t){a=moment.unix(e.event_date),s=a.year(),o=a.month(),p[s]||(p[s]={}),p[s][o]||(p[s][o]=[]),r?o!==r.month()||-1!==r.diff(a,"days")?(p[r.year()][r.month()].push(d.join("-")),d[0]=a.format("D")):d[1]=a.format("D"):d[0]=a.format("D"),t===u?p[s][o].push(d.join("-")):r=a}),$.each(p,function(e,n){$.each(n,function(n,a){h.push(i(t,a.join(", "),_?l:"",n,e))})})):(e.forEach(function(e,t){a=moment.unix(e.event_date),s=a.year(),o=a.month(),l=e.end_time?displayTimeRange(e.start_time,e.end_time):displayTimeRange(e.start_time),p[s]||(p[s]={}),p[s][o]||(p[s][o]=[]),r?o!==r.month()||-1!==r.diff(a,"days")||c!==l?(p[r.year()][r.month()].push({date:d.join("-"),time:c}),d=[a.format("D")]):d[1]=a.format("D"):d=[a.format("D")],t===u?p[s][o].push({date:d.join("-"),time:l}):(r=a,c=l)}),$.each(p,function(e,n){$.each(n,function(n,a){var r,s=[],o=[];$.each(a,function(e,t){r?t.time!=r?(s.push({date:o.join(", "),time:r}),o=[t.date]):o.push(t.date):o=[t.date],e===a.length-1?s.push({date:o.join(", "),time:t.time}):r=t.time}),$.each(s,function(a,r){h.push(i(t,r.date,_?r.time:"",n,e))})})})),h}function trimSeconds(e){return 3==(e=e.split(":")).length&&(e=e.splice(0,2)),e.join(":")}function displayDateRange(e,t){var n=moment.unix(e),i=moment.unix(t),a=moment();return n.isSame(i,"year")?n.isSame(i,"month")?n.isSame(i,"day")?n.format(n.isSame(a,"year")?"D MMMM":"D MMMM YYYY"):n.format("D")+"-"+i.format(n.isSame(a,"year")?"D MMMM":"D MMMM YYYY"):n.format("D MMMM")+" - "+i.format(n.isSame(a,"year")?"D MMMM":"D MMMM YYYY"):n.format("MMMM YYYY")+" - "+i.format("MMMM YYYY")}function displayTimeRange(e,t){return t?t!=e||"00:00:00"!=e&&"00:00"!=e?trimSeconds(e)+" - "+trimSeconds(t):"Весь день":trimSeconds(e)}function formatCurrency(e,t,n,i,a){e=+e||0,t=t||" ",n=n||".";var r=(""+e).split(".")[1],s=e<0?"-":"",o=parseInt(Math.abs(e),10)+"",l=o.length>3?o.length%3:0;return""+(i?i+t:"")+s+(l?o.substr(0,l)+t:"")+o.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+t)+(r?n+r:"")+(a?t+a:"")}function formatTicketNumber(e){return(""+e).replace(/(\d{3})/g,"$1 ").trim()}function unixTimestampToISO(e,t){return moment.unix(e).format(t||__C.DATE_FORMAT)}function getContrastColor(e,t){function n(e){return"#"===e.charAt(0)?e.substring(1,7):e}t=t||128;var i,a,r;return i=parseInt(n(e).substring(0,2),16),a=parseInt(n(e).substring(2,4),16),r=parseInt(n(e).substring(4,6),16),(299*i+587*a+114*r)/1e3>t?"#000":"#fff"}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function randomString(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return new Array(e||32).fill("").map(function(){return t.charAt(Math.floor(Math.random()*t.length))}).join("")}function isFormValid(e){var t=!0,n=(e=e instanceof Element?$(e):e).find("input, textarea, select"),i=n,a={};return e[0].checkValidity()||(n.each(function(e,t){t.name&&(a[t.name]=a[t.name]?a[t.name].add(t):$(t))}),$.each(a,function(e,n){n.length>1&&(n.filter(function(e,t){return!$(t).is(":disabled")&&(t.checked&&"on"!==t.value||"radio"!==t.type)&&(t.checked&&"on"!==t.value||"on"===t.value||"checkbox"!==t.type)}).length||(handleErrorField(n),scrollTo(n,400,function(){showNotifier({text:n.data("error_message")||"Заполнены не все обязательные поля",status:!1})}),t=!1),i=i.not(n))}),i.each(function(e,n){(n.required&&(""===n.value.trim()||!n.checkValidity())||""!==n.value.trim()&&!n.checkValidity())&&(handleErrorField(n),t&&(scrollTo(n,400,function(){showNotifier({text:$(n).data("error_message")||"Заполнены не все обязательные поля",status:!1})}),t=!1))})),t}function getFilenameFromURL(e){return e?e.split("\\").pop().split("/").pop():""}function mergeObjects(e,t,n){var i,a,r,s,o,l,c,_=arguments.length;try{i=Object.create(arguments[0].constructor.prototype)}catch(e){i={}}for("boolean"==typeof arguments[_-1]&&"boolean"==typeof arguments[_-2]?(a=arguments[_-2],r=arguments[_-1],_-=2):"boolean"==typeof arguments[_-1]?(a=arguments[_-1],r=!1,_--):(a=!1,r=!1),s=0;s<_;s++)for(o in arguments[s])if(!r&&arguments[s].hasOwnProperty(o)||r){if(l=arguments[s][o],c=i[o],void 0===l||l===i)continue;a&&"object"===(void 0===l?"undefined":_typeof(l))&&"object"===(void 0===c?"undefined":_typeof(c))?i[o]=mergeObjects(a,c,l):isVoid(l)&&!isVoid(i[o])||(i[o]=l)}return i}function toPlainObject(e){var t={};return Object.props(e).map(function(n){var i=e[n];isSimpleType(i)?t[n]=i:isVoid(i)||"object"!==(void 0===i?"undefined":_typeof(i))?i instanceof Array&&(t[n]=_toPlainArray(i)):t[n]=toPlainObject(i)}),t}function _toPlainArray(e){return Array.prototype.filter.call(e,function(e){if("function"==typeof e)return!1}).map(function(e){return isSimpleType(e)?e:e instanceof Array?_toPlainArray(e):isVoid(e)||"object"!==(void 0===e?"undefined":_typeof(e))?void 0:toPlainObject(e)})}function isSimpleType(e){return"number"==typeof e||"string"==typeof e||isVoid(e)}function escapeHtml(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},n=/[&<>"'\/]/g;return e?(""+e).replace(n,function(e){return t[e]}):e}function isPercentageString(e){return 0===/^[1-9]\d*%$|^0%$/.search(e)}function isBase64(e){return e.contains(";base64,")}function isFunction(e){return e&&"function"==typeof e}function isKeyPressed(e,t){return e.keyCode===t}function isVoid(e){return null===e||void 0===e}function empty(e){return isVoid(e)||"object"===(void 0===e?"undefined":_typeof(e))&&$.isEmptyObject(e)||e instanceof Array&&0===e.length}function range(e,t,n){var i=[];for(t=t||0,n=n||1;t!==e;t+=n)i.push(t);return i}function getByValue(e,t,n){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return n[i];return null}function localeFromNamespace(e,t,n){return getByValue(e,t,n)||""}function initSelect2(e,t){var n={placeholder:"Выберите",allowClear:!0,containerCssClass:"form_select2",dropdownCssClass:"form_select2_drop"};return e.hasClass("-Handled_ToSelect2")&&e.select2("destroy"),t&&$.extend(!0,n,t),e.select2(n).addClass("-Handled_ToSelect2"),e}function initWysiwyg(e,t){var n=e.is(".Wysiwyg")?e:e.find(".Wysiwyg");return emojify.setConfig({img_dir:"https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/"}),n.not(".-Handled_Wysiwyg").each(function(e,n){$(n).trumbowyg(empty(t)?{}:t).on("tbwchange",function(){emojify.run()})}).addClass("-Handled_Wysiwyg"),emojify.run(),e}function outerAjax(e,t,n){return(t=t||{}).fields instanceof Fields&&(t.fields=t.fields.toString()),$.ajax({url:e,data:t,method:"GET",contentType:n||"application/x-www-form-urlencoded; charset=UTF-8"}).then(function(e,t,n){return e})}function bindLimitInputSize(e){(e=e||$("body")).find(".LimitSize").not(".-Handled_LimitSize").each(function(e,t){var n=$(t),i=n.closest(".form_unit"),a=n.data("maxlength"),r=n.siblings(".form_prompt");r.length?r.text(n.val().length+"/"+a):(n.after($("<p>").addClass("form_prompt").text(n.val().length+"/"+a)),r=n.siblings(".form_prompt")),n.on("input",function(){var e=n.val().length;if(n.is("textarea")){var t=n.val().match(/\n/g);e=t?e+t.length:e}e>a?i.addClass("-status_error"):i.hasClass("-status_error")&&i.removeClass("-status_error"),r.text(e+"/"+a)})}).addClass("-Handled_LimitSize")}function trimAvatarsCollection(e){(e=e||$("body")).find(".AvatarsCollection").each(function(){var e=$(this),t=e.hasClass("-shifted"),n=e.hasClass("-subscribed"),i=e.find(".avatar"),a=i.outerWidth(),r=i.length;(n||t)&&r<e.data("max_amount")?e.width(1===r?a*r:a*r-6*(r-1)):e.width(1===r?0:a*(r-1)-6*(r-2)),e.addClass("-trimmed")})}function bindHelpLink(e){return((e=e||$("body")).is(".HelpLink")?e:e.find(".HelpLink")).not(".-Handled_HelpLink").each(function(e,t){var n=$(t);n.on("click.openHelpAppInspector",function(){var e=n.data("inspector");if(__APP.IS_WIDGET)return __APP.POST_MESSAGE.openNewTab("https://evendate.io/help?p="+n.data("article_id"));e instanceof HelpAppInspector||(e=new HelpAppInspector(n.data("article_id")),n.data("inspector",e)),e.show()})}).addClass("-Handled_HelpLink"),e}function bindDatePickers(e){(e=e||$("body")).find(".DatePicker").not(".-Handled_DatePicker").each(function(e,t){new DatePicker(t,$(t).data()).init()}).addClass("-Handled_DatePicker")}function bindTabs(e,t){e=e||$("body"),t="boolean"!=typeof t||t,e.find(".Tabs").not(".-Handled_Tabs").each(function(e,n){var i,a,r,s,o=$(n),l=o.data("tabs_id"),c=!!o.data("focus_on_change"),_=new MutationObserver(function(e){var t=$(e[e.length-1].target),n=t.closest(".TabsBody");(n=t.hasClass("TabsBody")?n.add(t):n).each(function(e,t){var n=$(t);n.hasClass(__C.CLASSES.ACTIVE)&&(o.addClass("-in_progress"),n.parent().height(n.outerHeight()))})});l?(i=o.find('.TabsBodyWrapper[data-tabs_id="'+l+'"]'),r=o.find('.HeaderTabs[data-tabs_id="'+l+'"]')):(i=o.find(".TabsBodyWrapper:first"),r=o.find(".HeaderTabs:first")),a=i.children(".TabsBody"),s=r.children(".Tab"),Object.defineProperties(o,{currentTabsIndex:{get:function(){return s.index(s.filter("."+__C.CLASSES.ACTIVE))}},tabsCount:{get:function(){return s.length}}}),o.setToTab=function(e){var t=s.eq(e),n=a.eq(e);t.length&&!t.hasClass(__C.CLASSES.ACTIVE)&&(s.removeClass(__C.CLASSES.ACTIVE),a.removeClass(__C.CLASSES.ACTIVE),t.addClass(__C.CLASSES.ACTIVE),n.addClass(__C.CLASSES.ACTIVE),o.trigger("tabs:change"),c&&scrollTo(n,400))},o.nextTab=function(){o.setToTab(o.currentTabsIndex+1)},o.prevTab=function(){o.setToTab(o.currentTabsIndex-1)},o.connectMutationObserver=function(){a.each(function(e,t){_.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"]})})},o.disconnectMutationObserver=function(){_.disconnect(),i.height("auto")},s.filter("."+__C.CLASSES.ACTIVE).length||s.eq(0).addClass(__C.CLASSES.ACTIVE),a.removeClass(__C.CLASSES.ACTIVE).eq(o.currentTabsIndex).addClass(__C.CLASSES.ACTIVE),i.on("transitionend",function(){o.removeClass("-in_progress"),o.trigger("progress_end")}),t&&(i.height(a.filter("."+__C.CLASSES.ACTIVE).outerHeight()),o.connectMutationObserver()),s.on("click",function(){o.setToTab(s.index(this))}),o.data("instance",o)}).addClass("-Handled_Tabs")}function bindSelect2(e){var t=(e=e||$("body")).is(".ToSelect2")?e:e.find(".ToSelect2");return t.not(".-Handled_ToSelect2").each(function(e,t){initSelect2($(t))}).addClass("-Handled_ToSelect2"),t}function bindRippleEffect(e){var t=(e=e||$("body")).is(".RippleEffect")?e:e.find(".RippleEffect");return t.not(".-Handled_RippleEffect").on("click.RippleEffect",rippleEffectHandler).addClass("-Handled_RippleEffect"),t}function bindDropdown(e){var t=(e=e||$("body")).is(".DropdownButton")?e:e.find(".DropdownButton");return t.not(".-Handled_DropdownButton").each(function(){var e,t=$(this),n=t.resolveInstance(),i=t.data(),a=$(".DropdownBox").filter(function(e,t){return $(t).data("dropdown_id")===i.dropdown});if(n.initiate)return n.initiate();a.data($.extend({},a.data(),i)),a.closeDropbox=function(){$("body").off("mousedown.CloseDropdown"),$(document).off("keyup.CloseDropdown"),a.removeClass("-show"),t.addClass("-dropdown_active")},empty(i.ddWidth)||("self"===i.ddWidth?a.width(t.outerWidth()):(isFinite(i.ddWidth)||isPercentageString(i.ddWidth))&&a.width(i.ddWidth)),empty(i.ddPosX)&&empty(i.ddPosY)||(e=t.position(),empty(i.ddPosX)||a.css("left","self.center"===i.ddPosX?e.left+t.outerWidth()/2-a.outerWidth()/2:"center"===i.ddPosX?a.parent().outerWidth()/2-a.outerWidth()/2:isFinite(i.ddPosX)?i.ddPosX:void 0),empty(i.ddPosY)||a.css("top","self.center"===i.ddPosY?e.top+t.outerHeight()/2-a.outerHeight()/2:"center"===i.ddPosY?a.parent().outerHeight()/2-a.outerHeight()/2:isFinite(i.ddPosY)?e.top+t.outerHeight()+i.ddPosY:void 0)),a.find(".CloseDropdown").on("click.CloseDropdown",a.closeDropbox),t.on("click.OpenDropdown",function(){a.addClass("-show"),t.addClass("-dropdown_active"),$("body").on("mousedown.CloseDropdown",function(e){$(e.target).closest(a).length||a.closeDropbox()}),$(document).on("keyup.CloseDropdown",function(e){isKeyPressed(e,__C.KEY_CODES.ESC)&&a.closeDropbox()})}),t.data("dropdown_box",a)}).addClass("-Handled_DropdownButton"),t}function bindFileLoadButton(e){(e=e||$("body")).find(".FileLoadButton").not(".-Handled_FileLoadButton").click(function(e){$(this).children("input").get(0).click()}).addClass("-Handled_FileLoadButton")}function bindCollapsing(e){(e=e||$("body")).find(".CollapsingWrapper").not(".-Handled_Collapsing").each(function(){function t(){var e=r.parents(".Tabs").resolveInstance();e.length&&e.disconnectMutationObserver(),r.addClass("-in_progress"),a.hasClass(__C.CLASSES.ACTIVE)?r.height(i):r.height(c.outerHeight()),r.toggleClass("-opened"),a.toggleClass(__C.CLASSES.ACTIVE),e.length&&e.connectMutationObserver()}function n(){a.$trigger.each(function(){var e=$(this);e.is(":checkbox")&&e.prop("checked",!e.prop("checked"))})}var i,a=$(this),r=a,s=r.closest(".Collapsing"),o=a.data("collapsing_id"),l=new MutationObserver(function(e){var t=$(e[e.length-1].target),n=t.parents(".CollapsingContent");(n=t.hasClass("CollapsingContent")?n.add(t):n).each(function(e,t){var n=$(t),i=n.parent();i.hasClass("-opened")&&i.addClass("-in_progress").height(n.outerHeight())})}),c=r.children(".CollapsingContent");s=s.length?s:e,a.$trigger=s.find(o?'.CollapsingTrigger[data-collapsing_id="'+o+'"]':".CollapsingTrigger:first"),r.hasClass("-fading")?(i=a.data("defaultHeight")<c.height()?a.data("defaultHeight"):c.height(),!a.hasClass(__C.CLASSES.ACTIVE)&&r.height()<i&&r.height(i)):i=a.data("defaultHeight")?a.data("defaultHeight"):0,a.toggleCollapsing=function(){n(),t()},a.openCollapsing=function(){a.hasClass(__C.CLASSES.ACTIVE)||a.toggleCollapsing()},a.closeCollapsing=function(){a.hasClass(__C.CLASSES.ACTIVE)&&a.toggleCollapsing()},a.bindTrigger=function(e){var n=e.is(":checkbox")||e.is(":radio")?"change":"click";e?(e.on(n+".toggleCollapsing",t),a.$trigger=a.$trigger.add(e)):a.$trigger.on(n+".toggleCollapsing",t),a.$trigger.addClass("-Handled_CollapsingTrigger")},a.bindTrigger(a.$trigger),r.on("transitionend",function(){r.removeClass("-in_progress")}),i&&r.on("click.OpenCollapsing",function(){a.openCollapsing()}),l.observe(r.get(0),{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"]}),a.data("instance",a)}).addClass("Handled_Collapsing")}function bindControlSwitch(e){(e=e||$("body")).find(".Switch").not(".-Handled_Switch").each(function(t,n){var i=$(n);i.switching=e.find('.Switching[data-switch_id="'+i.data("switch_id")+'"]'),i.on("change.Switch",function(){i.switching.each(function(e,t){var n=$(t);n.is("fieldset")?n.prop("disabled",!n.prop("disabled")):n.toggleStatus("disabled")})})}).addClass("-Handled_Switch")}function bindCallModal(e){return(e=e||$("body")).find("."+__C.CLASSES.HOOKS.CALL_MODAL).not("."+__C.CLASSES.HOOKS.HANDLED+__C.CLASSES.HOOKS.CALL_MODAL).each(function(){$(this).on("click.CallModal",function(){var e=$(this),t=e.data(),n=t.modal_title,i=t.modal,a=t.modal_type;if(!i){switch(a){case __C.MODAL_TYPES.FAVORS:i=new FavoredModal(t.modal_event_id,n);break;case __C.MODAL_TYPES.SUBSCRIBERS:i=new SubscribersModal(t.modal_organization_id,n);break;case __C.MODAL_TYPES.EDITORS:i=new EditorsModal(t.modal_organization_id,n,t.modal_specific_role);break;case __C.MODAL_TYPES.MAP:i=new MapModal(t.modal_map_location,n);break;case __C.MODAL_TYPES.MEDIA:var r=t.modal_media_type,s=t.modal_media_url;if(!s)if(e.is("img"))s=e.attr("src"),r="image";else if(e.is("video"))r="video";else{var o=e.css("background-image");"none"!==o&&(s=-1!=o.indexOf('"')?o.slice(o.indexOf('"')+1,o.indexOf('"',o.indexOf('"')+1)):o.slice(o.indexOf("(")+1,o.indexOf(")")),r="image")}i=new MediaModal(parseUri(decodeURIComponent(s)).wo_query,r);break;case __C.MODAL_TYPES.CROPPER:i=new CropperModal(t.source_img,t);break;case __C.MODAL_TYPES.FRIENDS_LIST:i=new FriendsListModal(t.modal_entity);break;case __C.MODAL_TYPES.SUBSCRIBERS_LIST:i=new SubscriptionsListModal(t.modal_entity);break;case __C.MODAL_TYPES.TICKET:i=new TicketsModal(t.tickets||t.ticket_uuid);break;case __C.MODAL_TYPES.ADD_STAFF:i=new AddStaffModal(t.modal_org_id,t.modal_role);break;default:i=new StdModal(n,t.modal_content,t.modal_style)}e.data("modal",i)}i.show()})}).addClass(__C.CLASSES.HOOKS.HANDLED+__C.CLASSES.HOOKS.CALL_MODAL)}function bindPageLinks(e){return((e=e||$("body")).is(".Link")?e:e.find(".Link")).not(".-Handled_Link").on("click.pageRender",pageLinkClickHandler).addClass("-Handled_Link")}function handleErrorField(e){var t;return e instanceof jQuery?e.is(".form_unit")?(e.closest(".form_unit").hasClass("-status_error")||(t=e.find("input, select, textarea"),e.addClass("-status_error").off("input.ClearError change.ClearError").one("input.ClearError change.ClearError",function(){e.off("input.ClearError change.ClearError").removeClass("-status_error"),t.off("blur.ClearError")}),t.off("blur.ClearError").one("blur.ClearError",function(){""!==$(this).val().trim()&&e.trigger("input.ClearError")})),e):e.closest(".form_unit").length?handleErrorField(e.closest(".form_unit")):e:handleErrorField($(e))}function toDataUrl(e,t){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.send()}function showNotifier(e){$.notify({message:e.text,pos:e.pos?e.pos:"top-right",status:e.status?"success":"danger"})}function isNotDesktop(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function scrollTo(e,t,n){var i;if(e instanceof jQuery){if(!e.length)return null;i=e.offset().top-150}else i=e instanceof Element?$(e).offset().top-150:e-150;return $(document.scrollingElement).stop().animate({scrollTop:Math.ceil(i)},{duration:t||400,easing:"swing",complete:isFunction(n)?n:function(){}}),i}function isScrollRemain(e){return e=e||200,$(window).height()+$(window).scrollTop()+ +e>=$(document).height()}function setDefaultValue(e,t){return void 0===e||"object"===(void 0===e?"undefined":_typeof(e))&&$.isEmptyObject(e)?t:e}function objectToQueryString(e){return Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function searchToObject(){var e,t,n=window.location.search.substring(1).split("&"),i={};for(t in n)if(n.hasOwnProperty(t)){if(""===n[t])continue;e=n[t].split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return i}function hashToObject(){var e,t,n=window.location.hash.substring(1).split("&"),i={};for(t in n)if(n.hasOwnProperty(t)){if(""===n[t])continue;e=n[t].split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return i}function pageLinkClickHandler(e){var t=$(e.currentTarget),n=e.which||e.nativeEvent.which;t.hasClass(__C.CLASSES.DISABLED)&&e.preventDefault(),1===n&&(e.preventDefault(),__APP.changeState(t.attr("href")))}function rippleEffectHandler(e){var t,n,i,a,r=$(e.currentTarget),s=$();0===r.children(".Ripple").length&&r.prepend('<span class="ripple Ripple"></span>'),(s=r.children(".Ripple")).removeClass("animate"),s.height()||s.width()||(n=Math.max(r.outerWidth(),r.outerHeight()),s.css({height:n,width:n})),i=e.pageX-r.offset().left-s.width()/2,a=e.pageY-r.offset().top-s.height()/2,s.css({top:a+"px",left:i+"px"}).addClass("animate"),empty(t=s.data("timeout"))||clearTimeout(t),t=setTimeout(function(){s.removeClass("animate")},650),s.data("timeout",t)}function getBrowserLang(){return navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage}function AvatarBlocks(e){var t=e.entity,n=e.entities,i=void 0===n?new UsersCollection:n,a=e.isLink,r=void 0!==a&&a,s=e.className,o=e.avatarClasses,l=void 0===o?[]:o,c=_objectWithoutProperties(e,["entity","entities","isLink","className","avatarClasses"]),_=new HtmlClassesArray(s);return(i instanceof Array?i:[i]).map(function(e){return React.createElement(AvatarBlock,_extends({key:e.id,entity:e,entityType:t,isLink:r,className:_,avatarClasses:l},c))})}function AvatarBlock(e){var t=e.entity,n=e.entityType,i=e.avatarClasses,a=e.className,r=e.isLink,s=_objectWithoutProperties(e,["entity","entityType","avatarClasses","className","isLink"]),o=void 0,l=void 0;n&&n===__C.ENTITIES.USER||t instanceof OneUser||t.first_name?(o=t.full_name||[t.first_name,t.last_name].join(" "),l="/user/"+t.id):(o=t.short_name||t.name,l="/organization/"+t.id);var c=React.createElement(Avatar,{entity:t,className:new HtmlClassesArray(i)}),_=React.createElement("span",{className:"avatar_name"},o),d=new HtmlClassesArray(["avatar_block","User"+t.id,"link"].concat(_toConsumableArray(new HtmlClassesArray(a))));return r?React.createElement(PageLink,_extends({className:d,href:l},s),c,_):React.createElement("div",_extends({className:d},s),c,_)}function Avatars(e){var t=e.entities,n=e.className,i=_objectWithoutProperties(e,["entities","className"]),a=new HtmlClassesArray(n);return(t instanceof Array?t:[t]).map(function(e){return React.createElement(Avatar,_extends({key:e.id,entity:e,className:a},i))})}function Avatar(e){var t=e.entity,n=e.className,i=e.badgeClass,a=_objectWithoutProperties(e,["entity","className","badgeClass"]),r=new HtmlClassesArray(n),s=void 0,o=void 0;return t instanceof OneUser||t.avatar_url?(s=t.avatar_url,o=t.full_name||[t.first_name,t.last_name].join(" ")):(s=t.img_small_url||t.img_url,o=t.short_name||t.name),React.createElement("div",_extends({className:"avatar "+r,title:o},a),React.createElement("img",{src:s||"/app/img/brand_logo.png",onError:function(e){return e.target.src="/app/img/brand_logo.png"}}),i&&React.createElement("span",{className:"avatar_badge"},React.createElement("i",{className:"fa fa-"+i})))}function Button(e){var t=e.children,n=e.className,i=_objectWithoutProperties(e,["children","className"]);return React.createElement("button",_extends({className:__C.CLASSES.COMPONENT.BUTTON+" "+new HtmlClassesArray(n),type:"button"},i),React.createElement("span",{className:"Text"},t))}function RippleButton(e){var t=e.children,n=e.className,i=e.onClick,a=_objectWithoutProperties(e,["children","className","onClick"]);return React.createElement("button",_extends({className:__C.CLASSES.COMPONENT.BUTTON+" "+new HtmlClassesArray(n),type:"button",onClick:function(e){rippleEffectHandler(e),isFunction(i)&&i(e)}},a),React.createElement("span",{className:"Text"},t))}function Action(e){var t=e.children,n=e.className,i=_objectWithoutProperties(e,["children","className"]);return React.createElement("button",_extends({className:__C.CLASSES.COMPONENT.ACTION+" "+new HtmlClassesArray(n),type:"button"},i),React.createElement("span",{className:"Text"},t))}function componentsContainer(e,t){var n=t.entity_name,i=t.entities_name,a=t.CollectionClass,r=void 0===a?null:a,s=t.noEntities,o=void 0===s?function(){return React.createElement(Cap,null,i18n(__S.NO_ELEMENTS))}:s,l=t.dynamicProps,c=void 0===l?function(e){return{}}:l,_=t.renderEntities,d=void 0===_?null:_,u=function(t){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={length:t.props[i].length,is_loading:!1},t}return _inherits(a,React.Component),_createClass(a,[{key:"fetch",value:function(){var e=this;if(!isVoid(r)&&this.props[i]instanceof r){var t;return this.setLoadingState(),(t=this.props[i]).fetch.apply(t,arguments).then(function(t){return e.unsetLoadingState().update(),t}).catch(function(){e.unsetLoadingState()})}return Promise.resolve()}},{key:"update",value:function(){return this.props[i].length!==this.state.length&&this.setState({length:this.props[i].length}),this}},{key:"setLoadingState",value:function(){return this.setState({is_loading:!0}),this}},{key:"unsetLoadingState",value:function(){return this.setState({is_loading:!1}),this}},{key:"render",value:function(){var t=this.props,a=t[i],r=_objectWithoutProperties(t,[i]);return a.length||this.state.is_loading?React.createElement(React.Fragment,null,isFunction(d)?d.call(this,a):a.map(function(t){return React.createElement(e,_extends({key:t[t.ID_PROP_NAME]},_extends(_defineProperty({},n,t),r,c(t))))}),this.state.is_loading&&React.createElement(LoaderBlock,null)):o()}}]),a}();return u.displayName="collectionOf("+(e.displayName||e.name||"Component")+")",u}function EventBlock(e){var t=this,n=e.event,i=e.date,a=e.hasDivider,r=void 0!==a&&a,s=e.coverWidth,o=void 0===s?550:s,l=n.id,c=new HtmlClassesArray(__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.SIZES.SMALL),_=i.format(__C.DATE_FORMAT),d=n.dates.reduce(function(e,t){return moment.unix(t.event_date).format(__C.DATE_FORMAT)===_?[].concat(_toConsumableArray(e),[displayTimeRange(t.start_time,t.end_time)]):e},[]).join("; ");return React.createElement(React.Fragment,null,r&&React.createElement("hr",{title:i.calendar().capitalize()}),React.createElement("div",{className:"event_block","data-event-id":l,"data-event_date":_},React.createElement(PageLink,{href:"/event/"+l,className:"event_block_img img_holder link"},React.createElement("img",{src:n.image_horizontal_url+"?width="+o,title:n.title,width:o})),React.createElement("div",{className:"event_block_info"},React.createElement("header",{className:"event_block_title"},React.createElement(PageLink,{href:"/event/"+l,className:"link"},n.title)),React.createElement("div",{className:"event_block_service"},React.createElement("p",null,React.createElement("small",null,d)),React.createElement("div",{className:"event_block_action_buttons"},React.createElement(AvatarCollectionContextProvider,{isSubscribed:n.is_favorite},React.createElement("div",{className:"event_block_add_avatar_wrapper"},React.createElement(AvatarCollection,{users:n.favored,maxCount:3,className:c,counterClasses:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CASTABLE],overallAvatarsCount:n.favored_users_count,onClick:function(){t.favored_modal||(t.favored_modal=new FavoredModal(n.id)),t.favored_modal.show()}})),React.createElement("div",{className:"event_block_action_buttons_wrapper"},React.createElement(ReactAddToFavoriteButton,{event:n,className:new HtmlClassesArray(["event_block_main_action_button",__C.CLASSES.SIZES.LOW,__C.CLASSES.UNIVERSAL_STATES.ROUNDED])}))))))))}function PageLink(e){var t=e.href,n=e.children,i=_objectWithoutProperties(e,["href","children"]);return React.createElement(ReactRouterDOM.Link,_extends({to:t},i),n)}function SocialLinks(e){var t=e.links,n=void 0===t?{}:t,i=e.className,a=_objectWithoutProperties(e,["links","className"]),r={VK:"vk",GOOGLE:"google-plus",FACEBOOK:"facebook-official"};return React.createElement("div",{className:"social_link_wrapper"},Object.keys(OneUser.ACCOUNTS).map(function(e){var t="social_link -color_"+OneUser.ACCOUNTS[e]+" -valign_center "+new HtmlClassesArray(i),s="fa_icon fa-"+r[e];return n.hasOwnProperty(OneUser.ACCOUNTS[e])?React.createElement("a",_extends({key:e,className:t,href:n[OneUser.ACCOUNTS[e]],target:"_blank"},a),React.createElement("i",{className:s})):React.createElement("span",_extends({key:e,className:t},a),React.createElement("i",{className:s}))}))}function UserActivity(e){var t=e.user,n=e.activity,i=e.avatarClasses,a=new HtmlClassesArray("activity_block"),r=new HtmlClassesArray(i),s=t.full_name||t.first_name+" "+t.last_name,o=moment.unix(n.created_at).calendar(null,__LOCALE.DATE.CALENDAR_DATE_TIME),l=void 0,c=void 0,_=void 0;switch(a.push("-type_"+n.type_code),r.push(__C.CLASSES.SIZES.X50,__C.CLASSES.UNIVERSAL_STATES.ROUNDED),!0){case n instanceof OneOrganizationActivity:a.push("-entity_organization"),l=n.organization.img_small_url||n.organization.img_url,c="/organization/"+n.organization.id,_=n.organization.short_name;break;case n instanceof OneEventActivity:a.push("-entity_event"),l=n.event.image_horizontal_small_url||n.event.image_horizontal_url,c="/event/"+n.event.id,_=n.event.title}return React.createElement("div",{className:a},React.createElement(Avatar,{entity:t,className:r,badgeClass:UserActivity.AVATAR_BADGE_ICON[n.type_code]}),React.createElement("div",{className:"activity_block_content"},React.createElement("p",{className:"activity_block_top"},React.createElement(PageLink,{className:"activity_block_creator link",href:"/user/"+t.id},s)," "+i18n(UserActivity.ACTION_TEXT[n.type_code],1,{},{gender:t.gender})),React.createElement("p",{className:"activity_block_middle"},React.createElement(PageLink,{className:"link",href:c},_)),React.createElement("p",{className:"activity_block_bottom"},o)),React.createElement(PageLink,{className:"activity_block_image img_holder link",href:c},React.createElement("img",{src:l,height:"48",onClick:function(e){return e.target.src="/app/img/brand_logo.png"}})))}function UserTombstones(e){var t=e.users,n=void 0===t?new UsersCollection:t,i=e.isLink,a=void 0!==i&&i,r=e.avatarClasses,s=void 0===r?[]:r,o=e.className,l=e.size,c=void 0===l?"70x70":l,_=_objectWithoutProperties(e,["users","isLink","avatarClasses","className","size"]),d=new HtmlClassesArray(o),u=new HtmlClassesArray([].concat(_toConsumableArray(s),["-rounded","-size_"+c]));return(n instanceof Array?n:[n]).map(function(e,t){var i=e.full_name||[e.first_name,e.last_name].join(" ");return a?React.createElement(PageLink,_extends({key:e.id,className:"user_tombstone link "+d,href:"/user/"+e.id},_),React.createElement(Avatars,{entities:n,className:u}),React.createElement("p",{className:"user_tombstone_title"},i)):React.createElement("div",_extends({key:e.id,className:"user_tombstone "+d},_),React.createElement(Avatars,{entities:n,className:u}),React.createElement("p",{className:"user_tombstone_title"},i))})}function asyncPage(e,t){var n=e.constructPage,i=void 0===n?function(e){return{}}:n,a=e.fetchData,r=void 0===a?function(e){return Promise.resolve()}:a,s=e.pageTitle,o=void 0===s?function(e){return null}:s,l=e.headerTabs,c=void 0!==l&&l,_=e.is_admin_page,d=void 0!==_&&_,u=e.is_auth_required,p=void 0!==u&&u,h=e.state_name,f=void 0===h?"":h,m=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return __APP.HISTORY=e.history,__APP.CURRENT_REACT_PAGE=t,t.pageProps=_extends({},e.match.params,i.call(t,e.match.params)),t.origin_page=null,t.state={is_data_fetching:!(p&&__APP.USER.isLoggedOut()),fetched_data:null},t}return _inherits(n,React.Component),_createClass(n,[{key:"componentWillMount",value:function(){var e=this;if(__APP.SERVER.abortAllConnections(),__APP.SIDEBAR.activateNavItem(window.location.pathname),!p||!__APP.USER.isLoggedOut()){isFunction(c)?(__APP.TOP_BAR.renderHeaderTabs(c.call({props:this.pageProps})),__APP.TOP_BAR.showTabs()):__APP.TOP_BAR.is_tabs_rendered&&__APP.TOP_BAR.hideTabs();var t=$("body");t.removeClass(function(e,t){return(t.match(/(^|\s)-state_\S+/g)||[]).join(" ")}),d?t.addClass("-state_admin"):t.removeClass("-state_admin"),f&&t.addClass("-state_"+f),r.call({props:this.pageProps},this.pageProps).then(function(t){return __APP.changeTitle(isFunction(o)?o.call(e.pageProps,e.pageProps):o),e.setState({is_data_fetching:!1,fetched_data:t}),t})}}},{key:"componentWillUpdate",value:function(){__APP.SERVER.abortAllConnections()}},{key:"render",value:function(){var e=this,n=this.state,i=n.is_data_fetching,a=n.fetched_data;return p&&__APP.USER.isLoggedOut()?(cookies.removeItem("auth_command"),cookies.removeItem("auth_entity_id"),new AuthModal(location.href,{note:"Для получения доступа, вам необходимо авторизоваться"}).show(),null):i?React.createElement(OverlayLoader,null):React.createElement(t,_extends({},_extends({match:this.props.match,fetched_data:a},this.pageProps),{ref:function(t){return e.origin_page=t}}))}}]),n}();return m.displayName="asyncPage("+(t.displayName||t.name||"Page")+")",hoistNonReactStatics(m,t),m.OriginPage=t,m}function contentWrap(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return React.createElement("div",{className:"page_wrapper Content -fadeable"},e)}function Cap(e){var t=e.className,n=e.children,i=_objectWithoutProperties(e,["className","children"]);return React.createElement("div",_extends({className:"cap "+new HtmlClassesArray(t)},i),React.createElement("span",{className:"cap_message"},n))}function OverlayCap(e){var t=e.className,n=e.children,i=_objectWithoutProperties(e,["className","children"]);return React.createElement("div",_extends({className:"overlay_cap -unselectable -centering OverlayCap "+new HtmlClassesArray(t)},i),React.createElement("div",{className:"overlay_cap_wrapper CapWrapper"},n))}function LoaderBlock(e){var t=e.className,n=_objectWithoutProperties(e,["className"]);return React.createElement("div",_extends({className:"loader_block "+new HtmlClassesArray(t)},n),React.createElement("div",{className:"loader"},React.createElement("div",{className:"loader_dot"}),React.createElement("div",{className:"loader_dot"})))}function OverlayLoader(e){var t=e.className,n=_objectWithoutProperties(e,["className"]);return React.createElement(LoaderBlock,_extends({className:new HtmlClassesArray(t)+" -loader_overlay"},n))}function checkRedirect(e,t,n){var i=window.location.pathname;return e&&n^i.contains(e)?__APP.changeState(t,!0,!0):__APP.USER.isLoggedOut()&&i.contains("/admin")?__APP.changeState("/",!0,!0):!i.contains("/statistics")||__APP.changeState(i.replace("statistics","admin"),!0,!0)}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_values2,_values3,_values4,_values5,_values6,_UserActivity$AVATAR_,_UserActivity$ACTION_,_labels,_colors,_icons,_labels2,_colors2,_icons2,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},__C={API_TOKENS:{DADATA:"7f2a3dad57bdaefebcb6e26ef7600b62b9658467"},CLASSES:{MATERIAL:"material",FLOATING_MATERIAL:"material -floating_material",IMG_HOLDER:"img_holder",COMPONENT:{LINK:"link",ACTION:"action",BUTTON:"button"},TEXT_COLORS:{ACCENT:"-text_color_accent",FRANKLIN:"-text_color_franklin",MUTED_80:"-text_color_primary_80",MUTED_50:"-text_color_primary_50"},TEXT_WEIGHT:{BOLD:"-font_weight_bold",BOLDER:"-font_weight_bolder",LIGHTER:"-font_weight_lighter"},COLORS:{ACCENT:"-color_accent",FRANKLIN:"-color_franklin",BUBBLEGUM:"-color_bubblegum",PRIMARY:"-color_primary",DEFAULT:"-color_default",NEUTRAL:"-color_neutral",NEUTRAL_ACCENT:"-color_neutral_accent",MUTED:"-color_muted",MARGINAL:"-color_marginal",MARGINAL_ACCENT:"-color_marginal_accent",MARGINAL_PRIMARY:"-color_marginal_primary",MARGINAL_FRANKLIN:"-color_marginal_franklin",MARGINAL_BUBBLEGUM:"-color_marginal_bubble_gum",YANDEX:"-color_yandex"},ALIGN:{LEFT:"-align_left",CENTER:"-align_center",RIGHT:"-align_right"},UNIVERSAL_STATES:{CLICKABLE:"-clickable",EMPTY:"-empty",SLIGHTLY_ROUNDED:"-slightly_rounded",ROUNDED:"-rounded",SHADOWED:"-shadowed",BORDERED:"-bordered",UPPERCASE:"-transform_uppercase",NO_UPPERCASE:"-no_uppercase",LINE_THROUGH:"-line_through"},STATUS:{SUCCESS:"-status_success",WARNING:"-status_warning",PENDING:"-status_pending",ERROR:"-status_error",DISABLED:"-status_disabled"},SIZES:{X30:"-size_30x30",X40:"-size_40x40",X50:"-size_50x50",X55:"-size_55x55",HUGE:"-size_huge",BIG:"-size_big",LOW:"-size_low",WIDE:"-size_wide",SMALL:"-size_small"},MODAL_STATES:{FIXED:"-fixed",NO_PADDING:"-no_padding",SIZE:{WIDE:"-size_wide",NARROW:"-size_narrow",TINY:"-size_tiny",RESPONSIVE:"-size_responsive"}},HOOKS:{HANDLED:"-Handled_",RIPPLE:"RippleEffect",ADD_STAFF:"AddStaff",ADD_TO_FAVORITES:"AddToFavorites",TEXT:"Text",LINK:"Link",CALL_MODAL:"CallModal",CLOSE_MODAL:"CloseModal",DROPDOWN_BUTTON:"DropdownButton",ADD_AVATAR:{ANCESTOR:"AddAvatarWrapper",COLLECTION:"AvatarsCollection",QUANTITY:"FavoredCount",STATES:{CAST:"-cast",CASTABLE:"-castable",SHIFT:"-shift",SHIFTED:"-shifted"}}},ACTIVE:"-active",DISABLED:"-disabled",HIDDEN:"-hidden",SHOW:"-show",ICONS:{STAR:"fa-star",STAR_O:"fa-star-o",BELL:"fa-bell",BELL_O:"fa-bell-o",TIMES:"fa-times",TIMES_CIRCLE:"fa-times-circle",ENVELOPE:"fa-envelope",PLUS:"fa-plus",MINUS:"fa-minus",CHECK:"fa-check",PENCIL:"fa-pencil",EYE:"fa-eye",EYE_CLOSE:"fa-eye-slash",TICKET:"fa-ticket",DOWNLOAD:"fa-download",USER_PLUS:"fa-user-plus"},ICON_CLASS:"fa_icon"},SOCICON_CLASSES:{vk:"fa-vk",google:"fa-google-plus",facebook:"fa-facebook-official"},DATE_FORMAT:"YYYY-MM-DD",TIME_FORMAT:"HH:mm",MODAL_TYPES:{FAVORS:"favors",SUBSCRIBERS:"subscribers",EDITORS:"editors",MAP:"map",MEDIA:"media",CROPPER:"cropper",FRIENDS_LIST:"friends_list",SUBSCRIBERS_LIST:"subscribers_list",TICKET:"tickets",ADD_STAFF:"add_staff"},COLORS:{PRIMARY:"#2e3b50",MUTED:"#3e4d66",MUTED_80:"#657184",MUTED_50:"#9fa6b3",MUTED_30:"#c5c9d1",TEXT:"#4a4a4a",ACCENT:"#f82969",ACCENT_ALT:"#ff5f9e",FRANKLIN:"#28be84",FRANKLIN_ALT:"#23d792"},STATS:{EVENT_VIEW:"view",EVENT_VIEW_DETAIL:"view_detail",EVENT_OPEN_SITE:"open_site",EVENT_OPEN_MAP:"open_map",ORGANIZATION_OPEN_SITE:"open_site",EVENT_ENTITY:"event",ORGANIZATION_ENTITY:"organization"},SOCIAL_NETWORKS:{VK:"vk",TWITTER:"twitter",GOOGLE:"google",FACEBOOK:"facebook"},SHARE_LINK:{VK:"https://vk.com/share.php?url={url}&title={title}&image={image_url}&noparse=false",TWITTER:"https://twitter.com/intent/tweet?url={url}&text={title}&via=evendate&hashtags=evendate",GOOGLE:"https://plus.google.com/share?url={url}&hl=ru",FACEBOOK:"https://www.facebook.com/dialog/share?app_id=1692270867652630&display=popup&title={title}&href={url}&redirect_uri={url}image[0][url]={image_url}&image[0][user_generated]=true"},ENTITIES:{USER:"user",EVENT:"event",ORGANIZATION:"organization",ACTIVITY:"activity"},DEFERRED_STATES:{PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"},KEY_CODES:{ENTER:13,ESC:27},MOMENTJS_CALENDAR:{DAY:"D",MONTH:"MMMM",YEAR:"YYYY",DATE_AND_MONTH:"D MMMM",HOURS_AND_MINUTES:"HH:mm"}};Function.getStaticMethods=function(e){return Object.getOwnPropertyNames(e).reduce(function(t,n){return"function"==typeof e[n]&&n!==n.capitalize()?t.concat(_defineProperty({},n,e[n])):t},[])},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.contains=function(e){return-1!==this.search(e)},String.prototype.format=function(e){return this.replace(/\{(\w+)\}/g,function(t,n){return null!=e[n]?e[n]:""})},String.prototype.toCamelCase=function(e){return this.split(e||" ").map(function(e){return e.capitalize()}).join("")},String.prototype.toUnderscore=function(){return(this.charAt(0).toLowerCase()+this.slice(1)).replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})},String.prototype.replaceSeparator=function(e,t){return this.replace(e,t)},String.prototype.appendAjaxData=function(e){return e.fields&&e.fields instanceof Array&&(e.fields=e.fields.join(",")),this+JSON.stringify(e)},Object.props=function(e){return Object.keys(e).filter(function(t){return"function"!=typeof e[t]})},Object.getProps=function(e){var t={};return $.each(e,function(e,n){"function"!=typeof n&&(t[e]=n)}),t},Object.getMethods=function(e){var t={};return $.each(e,function(e,n){"function"==typeof n&&(t[e]=n)}),t},Object.methods=function(e){var t=[];return Object.keys(e).forEach(function(n){"function"==typeof e[n]&&t.push(n)}),t},"function"!=typeof Object.values&&(Object.values=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e.propertyIsEnumerable(n)&&t.push(e[n]);return t}),Object.toHtmlDataSet=function(){var e=[],t=this;return Object.props(t).forEach(function(n){e.push((0!=n.indexOf("data-")?"data-"+n:n)+'="'+t[n]+'"')}),e.join(" ")},Object.toHtmlAttributes=function(){var e=[],t=this;return Object.props(t).forEach(function(n){e.push(n+'="'+t[n]+'"')}),e.join(" ")},Array.newFrom=function(e,t){var n,i,a=e.slice(0);if(arguments.length>1)for(i=1;i<arguments.length;i++)switch(void 0===(n=arguments[i])?"undefined":_typeof(n)){case"number":case"string":case"boolean":$.merge(a,[n]);break;case"object":n instanceof Array?$.merge(a,n):$.merge(a,Object.keys(n).map(function(e){return n[e]}));break;default:console.error("")}return a},Array.toSpaceSeparatedString=function(){return this.join(" ")},HtmlClassesArray=extending(Array,function(){function e(t){return arguments.length>1?this.push.apply(this,arguments):t instanceof Array?this.push.apply(this,t):"string"==typeof t&&this.push.apply(this,t.split(" ")),this.__proto__=e.prototype,this.__proto__.name="HtmlClassesArray",this}return Object.defineProperty(e.prototype,"toString",{value:function(){return this.unique().join(" ")}}),e}()),window.PropTypes&&function(e){var t=function(e,t,n,i){if(t[n].constructor&&"Moment"!==t[n].constructor.name){var a="Invalid prop '"+n+"' supplied to '"+i+"'. Validation failed.";if(e)return new Error(a);console.warn(a)}};e.moment=t.bind(null,!1),e.moment.isRequired=t.bind(null,!0)}(PropTypes),classEscalation(Array,function(){var e={clean:function(e){for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this},merge:function(e){var t=Array.prototype.slice.call(arguments),n={},i=[],a=0,r=0;for(t.unshift(this),a=0;a<t.length;a++)for(r=0;r<t[a].length;r++)!0!==n[t[a][r]]&&(i[i.length]=t[a][r],n[t[a][r]]=!0);return i},contains:function(e){return-1!==this.indexOf(e)}};return[].includes||(e.includes=function(e){"use strict";var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var i,a=parseInt(arguments[1])||0;for(a>=0?i=a:(i=n+a)<0&&(i=0);i<n;){var r=t[i];if(e===r||e!==e&&r!==r)return!0;i++}return!1}),[].unique||(e.unique=function(){return Array.from(new Set(this))}),e}),Math.roundTo=function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n},function(e){function t(t){var n,i,a=e(t.elem),r={separator:" ",group_length:3,suffix:"",prefix:""};if(t.elem.nodeType&&t.elem.parentNode){n=e.extend(!0,{},r,a.data()),(i=Math.floor(t.now).toString()).length>n.group_length&&(i=(i=function(e){var t=e.length-1,n=e[t].split("").reverse().join("");return e[t]=parseInt(n,10).toString().split("").reverse().join(""),e}(function(e,t){for(var n,i,a,r=e.split("").reverse(),s=[],o=0,l=Math.ceil(e.length/t);o<l;o++){for(n="",a=0;a<t&&(i=o*t+a)!==e.length;a++)n+=r[i];s.push(n)}return s}(i,n.group_length)).join(n.separator)).split("").reverse().join("")),a.prop("number",t.now).text(n.prefix+i+n.suffix)}}e.Tween&&e.Tween.propHooks?e.Tween.propHooks.number={set:t}:e.fx.step.number=t}(window.jQuery),$.fn.extend({toggleStatus:function(e){var t=this;return t.is(".form_unit")?e.split(" ").forEach(function(e){var n=t.find("input, select, textarea, button");"disabled"===e&&(t.hasClass("-status_disabled")?n.removeAttr("disabled"):n.attr("disabled",!0)),t.toggleClass("-status_"+e)}):t.is("input, textarea, select, button")?t.closest(".form_unit").toggleStatus(e):t.length&&t.find(".form_unit").toggleStatus(e),this},serializeForm:function(e){var t=/^(?:input|select|textarea|keygen)/i,n=/^(?:submit|button|image|reset|file)$/i,i=/^(?:checkbox|radio)$/i,a=/\r?\n/g,r=this.find("input,select,textarea,keygen,button");switch(e){case"array":var s,o=[],l={};return(s=r.filter(function(){return this.name&&!$(this).is(":disabled")&&"checkbox"===this.type})).each(function(){l[this.name]?l[this.name]=l[this.name].add(this):l[this.name]=$(this)}),$.each(l,function(e,t){var n;1===t.length?n="on"===t.val()?t.prop("checked"):t.val():(n=[],t.filter(":checked").each(function(){n.push("on"===this.value?this.checked:this.value)})),o.push({name:e,value:n})}),r.not(s).filter(function(){var e=this.type;return this.name&&!$(this).is(":disabled")&&t.test(this.nodeName)&&!n.test(e)&&(this.checked&&"on"!=this.value||"radio"!=e)&&(this.checked&&"on"!=this.value||"on"==this.value||"checkbox"!=e)}).each(function(e,t){var n=$(this).val(),i="";switch(this.type){case"radio":case"checkbox":i="on"==n?this.checked?1:0:n;break;default:if(null===n)break;i=n.replace(a,"\r\n")}null!=n&&o.push({name:t.name,value:i})}),o;case"object":default:var c={};return r.filter(function(){return this.name&&!$(this).is(":disabled")&&t.test(this.nodeName)&&!n.test(this.type)&&!i.test(this.type)}).each(function(e,t){var n=$(t),i=t.name,s=n.val();if(r.filter(function(e,t){var n=$(t);return n.is(":enabled")&&n.is('[name="'+i+'"]')}).length>1)c[i]=void 0===c[i]?[]:c[i],c[i].push(s?s.replace(a,"\r\n"):s);else if("hidden"===n.attr("type")&&0===s.indexOf("data.")){for(var o=s.split("."),l=n.data(o[1]),_=2;o[_];)l=l[o[_]],_++;c[i]=l}else c[i]=s||0===s?s.replace(a,"\r\n"):null}),r.filter(function(){return this.name&&!$(this).is(":disabled")&&i.test(this.type)&&(this.checked&&"on"!==this.value||"on"===this.value&&"checkbox"===this.type)}).each(function(e,t){var n=t.name,i=t.value;switch(t.type){case"radio":c[n]=i;break;case"checkbox":r.filter("[name='"+n+"']").length>1&&"on"!==i?(c[n]=void 0===c[n]?[]:c[n],c[n].push(i)):c[n]="on"!==i?i:!!t.checked}}),c}},animateNumber:function(e){for(var t=[e],n=1,i=arguments.length;n<i;n++)t.push(arguments[n]);return this.data(e),this.animate.apply(this,t)},tablesort:function(e){e=setDefaultValue(e,{});var t,n=this.get(0),i=null;return Tablesort&&"function"==typeof Tablesort?(i=new Tablesort(n,e),(t=new MutationObserver(function(){i.refresh()})).observe(n,{attributes:!0,childList:!0}),this.data({tablesort_instance:i,mutation_observer_instance:t})):console.error("Tablesort is not defined"),i},resolveInstance:function(){var e=this.data("instance");return e||this},outerHTML:function(){var e="";return this.each(function(t,n){e+=n.outerHTML}),e}}),jQuery.makeSet=function(e){return $($.map(e,function(e){return e.get()}))},function(e,t,n){var i={},a={},r=function(t){return"string"==e.type(t)&&(t={message:t}),arguments[1]&&(t=e.extend(t,"string"==e.type(arguments[1])?{status:arguments[1]}:arguments[1])),new s(t).show()},s=function t(n){this.options=e.extend({},t.defaults,n),this.uuid="ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random()),this.element=e(['<div class="uk-notify-message alert-dismissable">','<a class="close">&times;</a>',"<div>"+this.options.message+"</div>","</div>"].join("")).data("notifyMessage",this),this.options.status&&(this.element.addClass("alert alert-"+this.options.status),this.currentstatus=this.options.status),this.group=this.options.group,a[this.uuid]=this,i[this.options.pos]||(i[this.options.pos]=e('<div class="uk-notify uk-notify-'+this.options.pos+'"></div>').appendTo("body").on("click",".uk-notify-message",function(){e(this).data("notifyMessage").close()}))};e.extend(s.prototype,{uuid:!1,element:!1,timout:!1,currentstatus:"",group:!1,show:function(){if(!this.element.is(":visible")){var e=this;i[this.options.pos].show().prepend(this.element);var t=parseInt(this.element.css("margin-bottom"),10);return this.element.css({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0}).animate({opacity:1,"margin-top":0,"margin-bottom":t},function(){if(e.options.timeout){var t=function(){e.close()};e.timeout=setTimeout(t,e.options.timeout),e.element.hover(function(){clearTimeout(e.timeout)},function(){e.timeout=setTimeout(t,e.options.timeout)})}}),this}},close:function(e){var t=this,n=function(){t.element.remove(),i[t.options.pos].children().length||i[t.options.pos].hide(),delete a[t.uuid]};this.timeout&&clearTimeout(this.timeout),e?n():this.element.animate({opacity:0,"margin-top":-1*this.element.outerHeight(),"margin-bottom":0},function(){n()})},content:function(e){var t=this.element.find(">div");return e?(t.html(e),this):t.html()},status:function(e){return e?(this.element.removeClass("alert alert-"+this.currentstatus).addClass("alert alert-"+e),this.currentstatus=e,this):this.currentstatus}}),s.defaults={message:"",status:"normal",timeout:5e3,group:null,pos:"top-center"},e.notify=r,e.notify.message=s,e.notify.closeAll=function(e,t){if(e)for(var n in a)e===a[n].group&&a[n].close(t);else for(var n in a)a[n].close(t)}}(jQuery,window,document),function(e){e.cookies={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,n,i,a,r){var s="";if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(a?"; domain="+a:"")+(i?"; path="+i:"")+(r?"; secure":""),!0},removeItem:function(e,t,n){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,n=0;n<t;n++)e[n]=decodeURIComponent(e[n]);return e}}}(window);var __LOCALES={ru_RU:{TEXTS:{BUTTON:{REMOVE_FAVORITE:"Убрать",ADD_FAVORITE:"В избранное",FAVORED:"В избранном",ADD_SUBSCRIPTION:"Подписаться",REMOVE_SUBSCRIPTION:"Отписаться",SUBSCRIBED:"Подписан",EDIT:"Изменить"},SUBSCRIBERS:{NOM:" подписчик",GEN:" подписчика",PLU:" подписчиков"},PEOPLE:{NOM:" человек",GEN:" человека",PLU:" человек"},FAVORED:{NOM:" участник",GEN:" участника",PLU:" участников"},ACTIVITY:{SUBSCRIBE:{MAS:"подписался на организацию",FEM:"подписалась на организацию",NEU:"подписалось на организацию"},UNSUBSCRIBE:{MAS:"отписался от организации",FEM:"отписалась от организации",NEU:"отписалось от организации"},FAVE:{MAS:"добавил в избранное событие",FEM:"добавила в избранное событие",NEU:"добавило в избранное событие"},UNFAVE:{MAS:"удалил из избранного событие",FEM:"удалила из избранного событие",NEU:"удалило из избранного событие"},SHARE:{MAS:"поделился событием",FEM:"поделилась событием",NEU:"поделилось событием"}},TICKET_STATUSES:{USED:"Билет использован",WAITING_PAYMENT_LEGAL_ENTITY:"Ожидает оплаты от юрлица",WAITING_FOR_PAYMENT:"Ожидает оплаты",IS_PENDING:"Ожидает подтверждения",APPROVED:"Подтверждено",PAYED:"Оплачено",WITHOUT_PAYMENT:"Без оплаты",TICKETS_ARE_OVER:"Билеты закончились",RETURNED_BY_ORGANIZATION:"Возврат билета организатором",PAYMENT_CANCELED_AUTO:"Истек срок оплаты",PAYMENT_CANCELED_BY_CLIENT:"Отменен клиентом",RETURNED_BY_CLIENT:"Возврат билета",REJECTED:"Отклонен"}},DATE:{DATE_FORMAT:"DD.MM.YYYY",TIME_FORMAT:"HH:mm",DATE_TIME_FORMAT:"DD.MM.YYYY, HH:mm",MONTH_SHORT_NAMES:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],MONTH_NAMES:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],CALENDAR_DATE_WITH_YEAR:{sameDay:"[Сегодня]",lastDay:"[Вчера]",nextWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" "+__C.MOMENTJS_CALENDAR.YEAR,lastWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" "+__C.MOMENTJS_CALENDAR.YEAR,sameElse:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" "+__C.MOMENTJS_CALENDAR.YEAR},CALENDAR_DATE_TIME:{sameDay:"[Сегодня в] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,lastDay:"[Вчера в] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,nextWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [в] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,lastWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [в] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,sameElse:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [в] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES}},DATATABLES_URL:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Russian.json"},en_EN:{DATE:{CALENDAR_DATE_TIME:{sameDay:"[Today at] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,lastDay:"[Yesterday at] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,nextWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [at] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,lastWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [at] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES,sameElse:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH+" [at] "+__C.MOMENTJS_CALENDAR.HOURS_AND_MINUTES}}}};__LOCALES.ru=__LOCALES.ru_RU,__LOCALES.en=__LOCALES.en_EN;var __S={ACTIVITY:"activity",FAVORED_EVENT:"favored_event",NO_ELEMENTS:"no_elements",NO_EVENTS:"no_events",NO_ACTIVITIES:"no_activities",NO_FRIENDS:"no_friends",NO_SUBSCRIPTIONS:"no_subscriptions",LOGOUT:"logout",SHOW_ALL:"show_all",USER_SUBSCRIBED_TO_ORG:"user_subscribed_to_org",USER_SUBSCRIBED_TO_USER:"user_subscribed_to_user",USER_UNSUBSCRIBED_FROM_ORG:"user_unsubscribed_from_org",USER_FAVORED_EVENT:"user_favored_event",USER_UNFAVORED_EVENT:"user_unfavored_event",USER_SHARED_EVENT:"user_shared_event"},__i18n={en:{values:(_values2={},_defineProperty(_values2,__S.ACTIVITY,[[0,1,"activity"],[1,null,"activities"]]),_defineProperty(_values2,__S.FAVORED_EVENT,[[0,1,"favored event"],[1,null,"favored events"]]),_defineProperty(_values2,__S.NO_ELEMENTS,"No elements"),_defineProperty(_values2,__S.NO_EVENTS,"No events"),_defineProperty(_values2,__S.NO_ACTIVITIES,"No activity"),_defineProperty(_values2,__S.NO_FRIENDS,"No friends"),_defineProperty(_values2,__S.NO_SUBSCRIPTIONS,"No subscriptions"),_defineProperty(_values2,__S.LOGOUT,"Logout"),_defineProperty(_values2,__S.SHOW_ALL,"Show all"),_defineProperty(_values2,__S.USER_SUBSCRIBED_TO_ORG,[[0,1,"subscribed to an organization"],[1,null,"subscribed to organizations"]]),_defineProperty(_values2,__S.USER_SUBSCRIBED_TO_USER,[[0,1,"subscribed to user"],[1,null,"subscribed to users"]]),_defineProperty(_values2,__S.USER_UNSUBSCRIBED_FROM_ORG,[[0,null,"unsubscribed from an organization"]]),_defineProperty(_values2,__S.USER_FAVORED_EVENT,[[0,null,"added to favorites an event"]]),_defineProperty(_values2,__S.USER_UNFAVORED_EVENT,[[0,null,"removed from favorites an event"]]),_defineProperty(_values2,__S.USER_SHARED_EVENT,[[0,null,"shared an event"]]),_values2),contexts:[{matches:{gender:"male"},values:{}},{matches:{gender:"female"},values:{}}]},ru:{values:(_values3={},_defineProperty(_values3,__S.ACTIVITY,[[0,1,"активность"],[1,null,"активности"]]),_defineProperty(_values3,__S.FAVORED_EVENT,[[0,1,"избранное событие"],[1,null,"избранные события"]]),_defineProperty(_values3,__S.NO_ELEMENTS,"Нет элементов"),_defineProperty(_values3,__S.NO_EVENTS,"Событий нет"),_defineProperty(_values3,__S.NO_ACTIVITIES,"Активности нет"),_defineProperty(_values3,__S.NO_FRIENDS,"Нет друзей"),_defineProperty(_values3,__S.NO_SUBSCRIPTIONS,"Нет подписок"),_defineProperty(_values3,__S.LOGOUT,"Выйти"),_defineProperty(_values3,__S.SHOW_ALL,"Показать все"),_values3),contexts:[{matches:{gender:"male"},values:(_values4={},_defineProperty(_values4,__S.USER_SUBSCRIBED_TO_ORG,[[0,1,"подписался на организацию"],[1,null,"подписался на организации"]]),_defineProperty(_values4,__S.USER_SUBSCRIBED_TO_USER,[[0,1,"подписался на пользователя"],[1,null,"подписался на пользователей"]]),_defineProperty(_values4,__S.USER_UNSUBSCRIBED_FROM_ORG,[[0,null,"отписался от организации"]]),_defineProperty(_values4,__S.USER_FAVORED_EVENT,[[0,null,"добавил в избранное событие"]]),_defineProperty(_values4,__S.USER_UNFAVORED_EVENT,[[0,null,"удалил из избранного событие"]]),_defineProperty(_values4,__S.USER_SHARED_EVENT,[[0,null,"поделился событием"]]),_values4)},{matches:{gender:"female"},values:(_values5={},_defineProperty(_values5,__S.USER_SUBSCRIBED_TO_ORG,[[0,1,"подписалась на организацию"],[1,null,"подписалась на организации"]]),_defineProperty(_values5,__S.USER_SUBSCRIBED_TO_USER,[[0,1,"подписалась на пользователя"],[1,null,"подписалась на пользователей"]]),_defineProperty(_values5,__S.USER_UNSUBSCRIBED_FROM_ORG,[[0,null,"отписалась от организации"]]),_defineProperty(_values5,__S.USER_FAVORED_EVENT,[[0,null,"добавила в избранное событие"]]),_defineProperty(_values5,__S.USER_UNFAVORED_EVENT,[[0,null,"удалила из избранного событие"]]),_defineProperty(_values5,__S.USER_SHARED_EVENT,[[0,null,"поделилась событием"]]),_values5)},{matches:{gender:"neutral"},values:(_values6={},_defineProperty(_values6,__S.USER_SUBSCRIBED_TO_ORG,[[0,1,"подписался(-ась) на организацию"],[1,null,"подписался(-ась) на организации"]]),_defineProperty(_values6,__S.USER_SUBSCRIBED_TO_USER,[[0,1,"подписался(-ась) на пользователя"],[1,null,"подписался(-ась) на пользователей"]]),_defineProperty(_values6,__S.USER_UNSUBSCRIBED_FROM_ORG,[[0,null,"отписался(-ась) от организации"]]),_defineProperty(_values6,__S.USER_FAVORED_EVENT,[[0,null,"добавил(а) в избранное событие"]]),_defineProperty(_values6,__S.USER_UNFAVORED_EVENT,[[0,null,"удалил(а) из избранного событие"]]),_defineProperty(_values6,__S.USER_SHARED_EVENT,[[0,null,"поделился(-ась) событием"]]),_values6)}]}},language=getBrowserLang(),language_without_region_code=language.toLowerCase().split(/[_-]+/)[0],__LOCALE=__LOCALES[language.replaceSeparator("-","_")]||__LOCALES.ru_RU;PostMessageConnection=function(){function e(e){this.window=e}return e.prototype.postMessageFactory=function(e,t,n){var i=this;return(n||i.window.parent).postMessage(JSON.stringify({command:e,data:t}),"*")},e.AVAILABLE_COMMANDS={SET_COLOR:"setColor",GET_HEIGHT:"getHeight",REDIRECT:"redirect",FETCH_REDIRECT_PARAM:"fetchRedirectToParam",OPEN_NEW_TAB:"openNewTab"},e.prototype.listen=function(e,t,n){function i(i){var r;try{r=JSON.parse(i.data)}catch(e){return null}return r.command!==e||!isFunction(t)||n&&i.origin!==n?null:t.call(a.window,r.data,i.source,i.origin)}var a=this;this.window.addEventListener?this.window.addEventListener("message",i):this.window.attachEvent("onmessage",i)},e}(),AppPostMessageConnection=extending(PostMessageConnection,function(){return function(e){PostMessageConnection.call(this,e)}}()),WidgetPostMessageConnection=extending(PostMessageConnection,function(){function e(e){PostMessageConnection.call(this,e)}return e.prototype.redirect=function(e,t){return this.postMessageFactory("redirect",e,t)},e.prototype.ready=function(e){return this.postMessageFactory("ready",null,e)},e.prototype.setHeight=function(e,t){return this.postMessageFactory("setHeight",e,t)},e.prototype.passRedirectToParam=function(e,t){return this.postMessageFactory("passRedirectToParam",e,t)},e.prototype.openNewTab=function(e,t){return this.postMessageFactory("openNewTab",e,t)},e}()),AsynchronousConnection=function(){function e(){if("object"===_typeof(e.instance))return e.instance;e.instance=this}return e.HTTP_METHODS={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},Object.freeze(e.HTTP_METHODS),e.prototype.dealAjax=e.dealAjax=function(e,t,n,i,a,r){return new Promise(function(a,r){$.ajax({url:t,data:n,method:e,contentType:i||"application/x-www-form-urlencoded; charset=UTF-8",success:a,error:r})}).then(function(e){return e.hasOwnProperty("status")&&e.hasOwnProperty("data")&&e.hasOwnProperty("code")&&e.hasOwnProperty("text")?e.data:e}).catch(r).then(a)},e.prototype.multipleAjax=e.multipleAjax=function(){var e,t=arguments,n=this,i=arguments[arguments.length-1]instanceof Function,a=i?Array.prototype.splice.call(arguments,0,arguments.length-1):Array.prototype.slice.call(arguments);return e=Promise.all(a),i&&e.then(function(e){return Array.prototype.shift.call(t).apply(n,[].concat(_toConsumableArray(e))),n}),e},e}(),HelpCenterConnection=extending(AsynchronousConnection,function(){function e(){AsynchronousConnection.call(this)}return e.URL_BASE="https://evendate.io/help/wp-json/wp/v2/article/",e.ENDPOINT=Object.freeze({ARTICLE:e.URL_BASE+"{id}"}),e.ARTICLE=Object.freeze({FUNDS_WITHDRAW:47,BOOKING:49,PROMOCODES:51,TICKETS:55,HOW_TO_ENABLE_REGISTRATION:61,MEMBERS_LIMITATION:65,ADMIN_ACCESS:71,SITE_DESIGN:77,PREMIUM_TARIFF:79,HOW_PUSH_WORKS:83,CROSSPOSTING_VK:105,HOW_TO_PAY_FROM_LEGAL_ENTITY:121,REQUEST_APPROVAL:127,DYNAMIC_PRICING:138,ORDER_STATUSES:170,WHY_AUTH_BY_SOC_NETWORK:471,DISPATCHES:497}),e.prototype.fetchArticle=function(t){return this.dealAjax(AsynchronousConnection.HTTP_METHODS.GET,e.ENDPOINT.ARTICLE.format({id:t})).then(function(e){return(new HelpArticleModel).setData({id:e.id,title:e.title.rendered,link:e.link,create_at:new Date(e.date_gmt),updated_at:new Date(e.modified_gmt),content:e.content.rendered})})},e}()),Payment=extending(AsynchronousConnection,function(){function e(){if("object"===_typeof(e.instance))return e.instance;e.instance=this}return e.payForTariff=function(e,t){return AsynchronousConnection.dealAjax(AsynchronousConnection.HTTP_METHODS.POST,"/api/v1/payments/organizations/",{organization_id:e},null,t)},e.doPayment=function(e,t,n){var i=tmpl("payment-form",{customer_id:__APP.USER.full_name,cps_email:__APP.USER.email,callback_url:n||location.href,payment_uuid:e,sum:t},__APP.CURRENT_PAGE.$wrapper);__APP.IS_WIDGET&&i.attr("target","__blank"),i.submit().remove()},e}()),ServerConnection=extending(AsynchronousConnection,function(){function e(){if("object"===_typeof(e.instance))return e.instance;this.current_connections=[],this.error_log=[],e.instance=this}return e.MAX_ENTITIES_LENGTH=1e4,e.stdErrorHandler=function(e){console.error("Exorcizamus te, omnis immundus spiritus, omnis satanica potestas, omnis incursio infernalis adversarii, omnis legio, omnis congregatio et secta diabolica, in nomine et virtute Domini Nostri Jesu Christi, eradicare et effugare a Dei Ecclesia, ab animabus ad imaginem Dei conditis ac pretioso divini Agni sanguine redemptis!\n",e),showNotifier({text:"Упс, что-то пошло не так",status:!1})},e.prototype.ajaxErrorHandler=function(e,t,n,i){var a,r=Array.prototype.slice.call(arguments),s={};switch(r.length){case 4:a=["event","jqxhr","settings","thrownError"],r.forEach(function(e,t){s[a[t]]=e});break;case 3:a=["jqxhr","text","thrownError"],r.forEach(function(e,t){s[a[t]]=e});break;case 1:s=r[0];break;default:r.forEach(function(e,t){s[t]=e})}console.groupCollapsed("AJAX error"),s.thrownError&&console.log("Thrown error:",s.thrownError),s.event&&s.event.type&&console.log("Error type:",s.event.type),s.event&&s.event.text&&console.log("Description:",s.event.text),s.jqxhr&&(s.jqxhr.responseJSON&&s.jqxhr.responseJSON.text?(console.log("Response:",s.jqxhr.responseJSON.text),showNotifier({text:s.jqxhr.responseJSON.text,status:!1})):s.jqxhr.statusText&&showNotifier({text:s.jqxhr.statusText,status:!1})),s.settings&&(console.log("URL:",s.settings.url),console.log("Method:",s.settings.type)),s.stack?(console.log("Thrown error:",s.name),console.log("Description:",s.message),console.log("Error stacktrace:",s.stack)):console.error("Error stacktrace:"),console.groupEnd(),this.error_log.push(s)},e.prototype.dealAjax=e.dealAjax=function(e,t,n,i,a,r){var s=this;return(n=n||{}).fields instanceof Fields&&(n.fields=n.fields.toString()),t=t.contains("/api/v1")?t:"/api/v1"+t,new Promise(function(a,r){s.current_connections.push($.ajax({url:t,data:n,method:e,contentType:i||"application/x-www-form-urlencoded; charset=UTF-8",success:function(e,t,n){try{e.status?a(e.data):r({jqXHR:n,textStatus:t,response:e})}catch(e){r({jqXHR:n,textStatus:t,errorThrown:e})}},error:function(e,t,n){return r({jqXHR:e,textStatus:t,errorThrown:n})}}))}).then(function(e){return isFunction(a)&&a(e),e}).catch(function(e){var t=e.jqXHR,n=e.textStatus,i=e.errorThrown,a=e.response;return"abort"!==i&&(isFunction(r)?r(t,n,i):s.ajaxErrorHandler(t,n,i)),a})},e.prototype.getData=function(e,t,n,i){return this.dealAjax(AsynchronousConnection.HTTP_METHODS.GET,e,this.validateData(t),"application/json",function(e){empty(t.length)||empty(t.offset)||(t.offset+=t.length),isFunction(n)&&n(e)},i)},e.prototype.updateData=function(e,t,n,i,a){return n?this.dealAjax(AsynchronousConnection.HTTP_METHODS.PUT,e,JSON.stringify(t),"application/json",i,a):this.dealAjax(AsynchronousConnection.HTTP_METHODS.PUT,e,t,"application/x-www-form-urlencoded; charset=UTF-8",i,a)},e.prototype.addData=function(e,t,n,i,a){return n?this.dealAjax(AsynchronousConnection.HTTP_METHODS.POST,e,JSON.stringify(t),"application/json",i,a):this.dealAjax(AsynchronousConnection.HTTP_METHODS.POST,e,t,"application/x-www-form-urlencoded; charset=UTF-8",i,a)},e.prototype.deleteData=function(e,t,n,i){return empty(t)||(e="{path}?{params}".format({path:e,params:$.param(t)})),this.dealAjax(AsynchronousConnection.HTTP_METHODS.DELETE,e,{},"application/json",n,i)},e.prototype.validateData=function(e){var t=[];return(e=e||{}).order_by&&(t=(t="string"==typeof e.order_by?e.order_by.split(","):e.order_by).map(function(e){return e.trim().replace("-","")}),e.order_by instanceof Array&&(e.order_by=e.order_by.join(","))),e.fields?e.fields instanceof Array?e.fields=e.fields.merge(t):e.fields instanceof Fields&&t.length&&t.forEach(function(t){e.fields.add(t)}):e.fields=t,e.fields=(e.fields=e.fields.toString())?e.fields:void 0,e},e.prototype.abortAllConnections=function(){for(var e;this.current_connections.length;)200===(e=this.current_connections.pop()).state&&"pending"!==e.state()||e.abort()},e}()),ServerExports=extending(AsynchronousConnection,function(){function e(){if("object"===_typeof(e.instance))return e.instance;e.instance=this}return e.EXPORT_EXTENSION={XLSX:"xlsx",HTML:"html"},e.ENDPOINT=Object.freeze({ORGANIZATION_SUBSCRIBERS:"/statistics/organizations/{organization_id}/subscribers/export",EVENT_ORDERS:"/statistics/events/{event_id}/orders/export",EVENT_TICKETS:"/statistics/events/{event_id}/tickets/export",EVENT_TICKET:"/events/{event_id}/tickets/{ticket_uuid}/export"}),e.prototype.export=function(t,n){return t=t.contains("/api/v1")?t:"/api/v1"+t,$.fileDownload(t,{data:{format:n||e.EXPORT_EXTENSION.XLSX}})},e.prototype.organizationSubscribers=function(t,n){return this.export(e.ENDPOINT.ORGANIZATION_SUBSCRIBERS.format({organization_id:t}),n)},e.prototype.eventOrders=function(t,n){return this.export(e.ENDPOINT.EVENT_ORDERS.format({event_id:t}),n)},e.prototype.eventTickets=function(t,n){return this.export(e.ENDPOINT.EVENT_TICKETS.format({event_id:t}),n)},e.prototype.eventTicket=function(t,n){return this.export(e.ENDPOINT.EVENT_TICKET.format({event_id:t,ticket_uuid:n}))},e}()),-1==window.location.hostname.indexOf(".test.evendate.ru")?window.socket=io.connect("https:"==window.location.protocol?":8443":":8080",{secure:"https:"==window.location.protocol}):window.socket=io({path:"/node/socket.io"}),socket.on("log",function(e){console.log(e)}),socket.on("image.getFromURLDone",function(e){e.error?showNotifier({text:e.error,status:!1}):ImgLoader.handleImgUpload(ImgLoader.current_load_context,e.data,e.filename)}),Data=function(){function e(){}return e.prototype.ID_PROP_NAME="id",e.prototype.setData=function(t){var n;t instanceof Array&&(t=t[0]);for(n in t)t.hasOwnProperty(n)&&this.hasOwnProperty(n)&&(this[n]instanceof e||this[n]instanceof DataSet?this[n].setData(t[n]):this[n]=t[n]);return this},e.prototype.toPlainObject=function(){return toPlainObject(this)},e}(),DataSet=extending(Array,function(){function e(){Object.defineProperties(this,{__lookup:{value:{},writable:!0,enumerable:!1,configurable:!1},__last_pushed:{value:[]}})}return classEscalation(e,{collection_of:Data,setData:function(e){return e=e instanceof Array?e:[e],this.push.apply(this,e),this},getByID:function(e){return this.__lookup.hasOwnProperty(e)?this.__lookup[e]:null},has:function(e){return this.getByID(e)instanceof Data},push:function(e){var t,n=this.collection_of.prototype.ID_PROP_NAME,i=arguments;if(this.__last_pushed.splice(0),!empty(e))for(var a=0,r=i[a];a<i.length;r=i[++a])(empty(r[n])||!empty(r[n])&&!this.has(r[n]))&&(t=r instanceof this.collection_of?r:"function"==typeof this.collection_of.factory?this.collection_of.factory(r):(new this.collection_of).setData(r),this.__last_pushed.push(t),this[this.length++]=t,empty(t[n])||(this.__lookup[t[n]]=t),this.createAdditionalLookup(t));return this.length},pull:function(e){var t;return this.has(e)?(t=this.getByID(e),this.remove(e),t):null},createAdditionalLookup:function(){},emptyAdditionalLookup:function(){},copy:function(){return(new this.constructor).setData(this)},getArrayCopy:function(){return this.map(function(e){return e})},toPlainArray:function(){return _toPlainArray(this)},remove:function(e){return this.has(e)?(delete this.__lookup[e],this.splice(this.indexOf(this.getByID(e)),1)):[]},empty:function(){return this.__last_pushed.splice(0,this.__last_pushed.length),this.__lookup={},this.emptyAdditionalLookup(),this.splice(0,this.length),this},sortBy:function(e,t){var n=e.split(".");return this.sort(function(e,i){var a=mergeObjects({},e),r=mergeObjects({},i);return n.forEach(function(e){a="object"===_typeof(a[e])?mergeObjects({},a[e]):a[e],r="object"===_typeof(r[e])?mergeObjects({},r[e]):r[e]}),isFinite(a)&&isFinite(r)?t?a-r:r-a:a.name>r.name?t?1:-1:a.name<r.name?t?-1:1:0}),this},toString:function(){return JSON.stringify(this)}}),e}()),Fields=function(){function e(e){this.push.apply(this,arguments),Object.defineProperty(this,"length",{configurable:!0,enumerable:!1,writable:!0,value:0})}function t(t){var n={};return t instanceof Array||(t=t.replace(/\s+/g,"").match(/(\w+\{[^}]+}|\w+)/g)),t.forEach(function(t){var i=t.split("{"),a={};i.length>1&&((a=JSON.parse("{"+i[1].replace(/(\w+):/g,function(e,t){return'"'+t+'":'}))).fields&&(a.fields=new(Function.prototype.bind.apply(e,[null].concat(a.fields.split(","))))),a.order_by&&(a.order_by=a.order_by.split(","))),n[i[0]]=a}),n}var n=function(){function t(e){var t;for(t in e)this[t]=e[t]}return Object.defineProperties(t.prototype,{toString:{value:function(){var t=this,n=Object.props(this),i={};return 0===n.length?"":(n.forEach(function(n){i[n]=t[n]instanceof Array||t[n]instanceof e?t[n].toString():t[n]}),JSON.stringify(i))}},merge:{value:function(e){return $.extend(this,e)}}}),t}();return e.parseFields=function(n){return n instanceof e?n.copy():new e(t(n))},classEscalation(e,function(){var t={get:function(e){return this.has(e)?this[e]:null},push:function(e,t){var i,a=Array.prototype.splice.call(arguments,0),r={};if("string"==typeof e&&t instanceof n)this.has(e)?this[e].merge(t):(this[e]=t,this.length++);else{a.forEach(function(e){"string"==typeof e?r[e]={}:e instanceof Array?e.forEach(function(e){r[e]={}}):e instanceof Object&&Object.props(e).forEach(function(t){r[t]=e[t]})});for(i in r)this.has(i)?this[i].merge(r[i]):(this[i]=new n(r[i]),this.length++)}return this},pull:function(e){var t=this.get(e);return this.delete(e),t},has:function(e){return void 0!==this[e]},delete:function(e){return!!this.has(e)&&(this.length--,delete this[e])},copy:function(){return new e(this)},forEach:function(e){var t;for(t in this)this.hasOwnProperty(t)&&!isFunction(this[t])&&e(t,this[t],this);return this},toString:function(){var e=this,t=Object.props(this);if(0!==t.length)return t.map(function(t){return t+e[t]}).join(",")}};return t.add=t.push,t}),e}(),OneEntity=extending(Data,function(){function e(){}return e.prototype.ID_PROP_NAME="id",e.prototype.fetch=function(e){},e}()),EntitiesCollection=extending(DataSet,function(){function e(){DataSet.call(this)}return e.prototype.collection_of=OneEntity,e}()),EntityInterface=function(){function e(){}return e.prototype.setData=function(e){},e}(),AbstractDataModel=extending(Data,function(){return function(){Data.call(this)}}()),AbstractDataModelsCollection=extending(DataSet,function(){function e(){DataSet.call(this)}return e.prototype.collection_of=AbstractDataModel,e}()),EventEmailTextsModel=extending(OneEntity,function(){return function(){OneEntity.call(this),this.payed=null,this.approved=null,this.not_approved=null,this.after_event=null}}()),HelpArticleModel=extending(OneEntity,function(){return function(){this.id=null,this.title=null,this.link=null,this.create_at=new Date,this.updated_at=new Date,this.content=null}}()),OrganizationModel=extending(OneEntity,function(){function e(e){this.organization_id=null,this.name=null,this.short_name=null,this.description=null,this.site_url=null,this.default_address=null,this.vk_url=null,this.facebook_url=null,this.type_id=null,this.background=null,this.background_filename=null,this.logo=null,this.logo_filename=null,this.detail_info_url=null,this.email=null,this.city_id=null,this.country_id=null,this.is_private=null,this.brand_color=null,this.brand_color_accent=null,e&&t(this,e)}function t(e,t){var n;for(n in t)if(t.hasOwnProperty(n))if(e.hasOwnProperty(n))e[n]=t[n];else switch(n){case"background_img_url":isBase64(t[n])&&(e.background=t[n]);break;case"img_url":isBase64(t[n])&&(e.logo=t[n]);break;case"city":e.city_id=t[n]instanceof OneCity?t[n].id:t[n];break;case"country":t[n]instanceof OneEntity?e.country_id=t[n].id:t.city instanceof OneCity?e.country_id=t.city.country_id:e.country_id=t[n]}return e}return e.prototype.setData=function(e){return t(this,e)},e.prototype.toString=function(){return JSON.stringify(this)},e}()),TariffModel=extending(OneEntity,function(){return function(e){var t=this;this.tariff_id=null,this.name=null,this.since=null,this.till=null,this.available_additional_notifications=null,this.available_event_publications=null,this.event_publications=null,this.available_tickets_selling=null,this.available_telegram_bots=null,this.available_slack_bots=null,this.available_auditory_analytics=null,this.available_in_city=null,this.price=null,Object.defineProperties(this,{is_full:{get:function(){return 0!==t.price}},events_publication_left:{get:function(){return t.available_event_publications-t.event_publications}}}),e&&setData(this,e)}}()),DateModel=extending(OneEntity,function(){return function(){this.event_date="",this.start_time="",this.end_time=""}}()),DateModelsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=DateModel,e}()),PromocodeModel=extending(OneEntity,function(){function e(){this.uuid=null,this.event_id=null,this.code=null,this.is_fixed=null,this.is_percentage=null,this.effort=null,this.total_effort=null,this.use_limit=null,this.use_count=null,this.start_date=null,this.end_date=null,this.enabled=null,this.created_at=null,this.updated_at=null}return e.prototype.ID_PROP_NAME="uuid",e}()),PromocodeModelsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=PromocodeModel,e}()),InterestModel=extending(OneEntity,function(){function e(){this.topic_id=setDefaultValue(this.topic_id,0),this.topic_name=null,this.value=null,this.updated_at=null}return e.prototype.ID_PROP_NAME="topic_id",e}()),InterestModelsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=InterestModel,e}()),AbstractFinanceModel=extending(OneEntity,function(){return function(){OneEntity.call(this),this.total_income=null,this.withdraw_available=null,this.processing_commission_value=null,this.processing_commission=null,this.evendate_commission_value=null,this.ticket_dynamics=new StatisticsCollection("ticket_dynamics"),this.income_dynamics=new StatisticsCollection("ticket_dynamics")}}()),OneAbstractStatistic=extending(OneEntity,function(){return function(){OneEntity.call(this),this.value=null,this.time_value=null}}()),AbstractStatisticsCollection=extending(EntitiesCollection,function(){function e(e){EntitiesCollection.call(this),Object.defineProperty(this,"field",{get:function(){return e}})}return e.prototype.collection_of=OneAbstractStatistic,e.SCALES={MINUTE:"minute",HOUR:"hour",DAY:"day",WEEK:"week",MONTH:"month",YEAR:"year",OVERALL:"overall"},e.fetchStatistics=function(e,t){},e.prototype.fetch=function(e,t,n,i){},e}()),OneStatistic=extending(OneAbstractStatistic,function(){return function(){OneAbstractStatistic.call(this)}}()),StatisticsCollection=extending(AbstractStatisticsCollection,function(){function e(e){AbstractStatisticsCollection.call(this,e)}return e.prototype.collection_of=OneStatistic,e.prototype.fetch=function(e,t,n,i){},e}()),EventStatisticsCollection=extending(StatisticsCollection,function(){function e(e,t){StatisticsCollection.call(this,t),Object.defineProperty(this,"event_id",{get:function(){return e}})}return e.ENDPOINT=Object.freeze({EVENT:"/statistics/events/{event_id}",FINANCE:"/statistics/events/{event_id}/finance"}),e.fetchStatistics=function(t,n,i){return __APP.SERVER.getData(e.ENDPOINT.EVENT.format({event_id:t}),{fields:n},i)},e.prototype.fetch=function(e,t,n,i){var a=this,r={};return r[this.field]=Object.assign({scale:e,since:t,till:n}),this.constructor.fetchStatistics(this.event_id,new Fields(r),function(e){a.setData(e[a.field]),isFunction(i)&&i.call(a,a.__last_pushed)})},e}()),EventFinanceStatisticsCollection=extending(EventStatisticsCollection,function(){function e(e,t){EventStatisticsCollection.call(this,e,t)}return e.fetchStatistics=function(e,t,n){return __APP.SERVER.getData(EventStatisticsCollection.ENDPOINT.FINANCE.format({event_id:e}),{fields:t},n)},e}()),EventFinanceModel=extending(AbstractFinanceModel,function(){return function(e){AbstractFinanceModel.call(this),this.sum_amount=null,this.sold_count=null,this.checked_out_count=null,this.ticket_dynamics=new EventFinanceStatisticsCollection(e,"ticket_dynamics"),this.income_dynamics=new EventFinanceStatisticsCollection(e,"income_dynamics")}}()),WithdrawModel=extending(OneEntity,function(){function e(){OneEntity.call(this),this.id=null,this.sum=null,this.user_id=null,this.user=new OneUser(this.user_id),this.organization_id=null,this.comment=null,this.response=null,this.number=null,this.status_type_code=null,this.created_at=null,this.updated_at=null,Object.defineProperty(this,"status_description",{get:function(){return getByValue(this.status_type_code,e.STATUS,e.STATUS_DESCRIPTION)}})}return e.STATUS={PENDING:"pending",IN_PROGRESS:"in_progress",BANK_CHARGING:"bank_charging",COMPLETED:"completed",REJECTED:"rejected",REJECTED_BY_ORGANIZATION:"rejected_by_organization"},e.STATUS_DESCRIPTION={PENDING:"Ожидает обработки",IN_PROGRESS:"Обрабатывается",BANK_CHARGING:"Отправлено в банк на исполнение",COMPLETED:"Выполнено",REJECTED:"Отказано",REJECTED_BY_ORGANIZATION:"Отозвано организаторов"},e}()),WithdrawModelsCollection=extending(EntitiesCollection,function(){function e(e){EntitiesCollection.call(this),Object.defineProperty(this,"org_id",{get:function(){return e}})}return e.prototype.collection_of=WithdrawModel,e.fetchWithdraws=function(e,t,n){return __APP.SERVER.getData(OrganizationStatisticsCollection.ENDPOINT.FINANCE.format({org_id:e}),{fields:new Fields({withdraws:{fields:new Fields(t)}})},n)},e.prototype.fetch=function(t,n){var i=this;return e.fetchWithdraws(this.org_id,t,function(e){i.setData(e.withdraws),isFunction(n)&&n.call(i,i.__last_pushed)})},e}()),OrganizationStatisticsCollection=extending(StatisticsCollection,function(){function e(e,t){StatisticsCollection.call(this,t),Object.defineProperty(this,"org_id",{get:function(){return e}})}return e.ENDPOINT=Object.freeze({ORGANIZATION:"/statistics/organizations/{org_id}",FINANCE:"/statistics/organizations/{org_id}/finance"}),e.fetchStatistics=function(t,n,i){return __APP.SERVER.getData(e.ENDPOINT.ORGANIZATION.format({org_id:t}),{fields:n},i)},e.prototype.fetch=function(e,t,n,i){var a=this,r={};return r[this.field]=Object.assign({scale:e,since:t,till:n}),this.constructor.fetchStatistics(this.org_id,new Fields(r),function(e){a.setData(e[a.field]),isFunction(i)&&i.call(a,a.__last_pushed)})},e}()),OrganizationFinanceStatisticsCollection=extending(OrganizationStatisticsCollection,function(){function e(e,t){OrganizationStatisticsCollection.call(this,e,t)}return e.fetchStatistics=function(e,t,n){return __APP.SERVER.getData(OrganizationStatisticsCollection.ENDPOINT.FINANCE.format({org_id:e}),{fields:t},n)},e}()),OrganizationFinanceModel=extending(AbstractFinanceModel,function(){return function(e){AbstractFinanceModel.call(this),this.withdraws=new WithdrawModelsCollection(e),this.ticket_dynamics=new OrganizationFinanceStatisticsCollection(e,"ticket_dynamics"),this.income_dynamics=new OrganizationFinanceStatisticsCollection(e,"income_dynamics")}}()),PricingRuleModel=extending(AbstractDataModel,function(){function e(){OneEntity.call(this),this.uuid=null,this.name=null,this.type_code=null,this.effort=null,this.min_count=null,this.max_count=null,this.is_percentage=null,this.is_fixed=null,this.enabled=null}return e.prototype.ID_PROP_NAME="uuid",e.TYPE=Object.freeze({ORDER_SUM_BETWEEN:"order_sum_between",TICKETS_COUNT_BETWEEN:"tickets_count_between",USER_ORDER_SUM_BETWEEN:"user_orders_sum_between",USER_ORDER_COUNT_BETWEEN:"user_orders_count_between"}),e}()),PricingRuleModelsCollection=extending(AbstractDataModelsCollection,function(){function e(){AbstractDataModelsCollection.call(this),Object.defineProperty(this,"enabled_rules",{get:function(){return this.filter(function(e){return e.enabled})}})}return e.prototype.collection_of=PricingRuleModel,e}()),RegistrationFieldModel=extending(OneEntity,function(){function e(){this.uuid=null,this.type=null,this.label=null,this.order_number=null,this.required=setDefaultValue(null,!1),this.values=[]}return e.TYPES={EMAIL:"email",FIRST_NAME:"first_name",LAST_NAME:"last_name",PHONE_NUMBER:"phone_number",ADDITIONAL_TEXT:"additional_text",CUSTOM:"custom",EXTENDED_CUSTOM:"extended_custom",SELECT:"select",SELECT_MULTI:"select_multi"},e.DEFAULT_LABEL={EMAIL:"E-mail",FIRST_NAME:"Имя",LAST_NAME:"Фамилия",PHONE_NUMBER:"Номер телефона",ADDITIONAL_TEXT:"Дополнительное текстовое поле",CUSTOM:"Дополнительное текстовое поле",EXTENDED_CUSTOM:"Дополнительное текстовое поле",SELECT:"Выбор одного варианта",SELECT_MULTI:"Выбор нескольких вариантов"},e.isCustomField=function(t){switch(t.type){case e.TYPES.EMAIL:case e.TYPES.FIRST_NAME:case e.TYPES.LAST_NAME:case e.TYPES.PHONE_NUMBER:return!1;default:case e.TYPES.CUSTOM:case e.TYPES.EXTENDED_CUSTOM:case e.TYPES.ADDITIONAL_TEXT:case e.TYPES.SELECT:case e.TYPES.SELECT_MULTI:return!0}},e.isPredefinedField=function(t){return!e.isCustomField(t)},e.prototype.setData=function(e){var t;Array.isArray(e)&&(e=e[0]);for(t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t]);return this},e}()),RegistrationFieldModelsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=RegistrationFieldModel,e.prototype.push=function(e){var t=this,n=Array.prototype.slice.call(arguments);return this.__last_pushed.splice(0),n.forEach(function(e){t.__last_pushed.push(t[t.length++]=e instanceof t.collection_of?e:(new t.collection_of).setData(e))}),this.length},e.prototype.sortByType=function(){var e=[RegistrationFieldModel.TYPES.LAST_NAME,RegistrationFieldModel.TYPES.FIRST_NAME,RegistrationFieldModel.TYPES.EMAIL];return this.sort(function(t,n){var i=e.indexOf(t.type),a=e.indexOf(n.type);return-1===i&&-1!==a?1:-1!==i&&-1===a?-1:i===a?0:i<a?-1:i>a?1:0}),this},e.prototype.sortByOrder=function(){return this.sort(function(e,t){return e.order_number-t.order_number}),this},e}()),RegistrationSelectFieldValue=function(){return function(e){this.value=setDefaultValue(e,null),this.uuid=null}}(),OneAbstractActivity=extending(OneEntity,function(){function e(){this.stat_type_id=null,this.user_id=null,this.user=new OneUser(this.user_id),this.entity="",this.type_code="",this.created_at=0}return e.prototype.ID_PROP_NAME="uuid",e.factory=function(e){var t=void 0;switch(!0){case!isVoid(e.event_id):t=new OneEventActivity;break;case!isVoid(e.organization_id):t=new OneOrganizationActivity;break;default:t=new OneAbstractDispatch}return t.setData(e),t},e.TYPES=Object.freeze({SUBSCRIBE:"subscribe",FAVE:"fave",UNSUBSCRIBE:"unsubscribe",UNFAVE:"unfave",SHARE_VK:"share_vk",SHARE_FB:"share_fb",SHARE_TW:"share_tw"}),e.TYPES_INDEX=Object.freeze({subscribe:"SUBSCRIBE",fave:"FAVE",unsubscribe:"UNSUBSCRIBE",unfave:"UNFAVE",share_vk:"SHARE",share_fb:"SHARE",share_tw:"SHARE"}),e}()),OneEventActivity=extending(OneAbstractActivity,function(){return function(){OneAbstractActivity.call(this),this.event_id=0,this.event=new OneEvent(this.event_id),Object.defineProperty(this,"uuid",{get:function(){return CryptoJS.MD5([this.user_id,this.event_id,this.type_code,this.entity,this.created_at].join("-")).toString()}})}}()),OneOrganizationActivity=extending(OneAbstractActivity,function(){return function(){OneAbstractActivity.call(this),this.organization_id=0,this.organization=new OneOrganization(this.organization_id),Object.defineProperty(this,"uuid",{get:function(){return CryptoJS.MD5([this.user_id,this.organization_id,this.type_code,this.entity,this.created_at].join("-")).toString()}})}}()),UsersActivitiesCollection=extending(EntitiesCollection,function(){function e(e){EntitiesCollection.call(this),Object.defineProperty(this,"user_id",{value:e})}return Object.defineProperty(e.prototype,"collection_of",{value:OneAbstractActivity}),e.setDefaultData=function(e){return"string"==typeof e.fields?e.fields=e.fields.split(","):e.fields instanceof Array||(e.fields=[]),e.fields=e.fields.merge(["created_at","type_code","event","organization"]),e.order_by=setDefaultValue(e.order_by,"-created_at"),e.length=setDefaultValue(e.length,20),e},e.fetch=function(t,n,i){return n=e.setDefaultData(n),__APP.SERVER.getData("/api/v1/users/"+t+"/actions",n,i)},e.prototype.fetch=function(e,t,n,i){var a=this,r={fields:e,offset:this.length,length:t};return n&&(r.order_by=n),this.constructor.fetch(this.user_id,r).then(function(e){return a.setData(e),(new a.constructor).setData(e)})},e}()),OneCity=extending(OneEntity,function(){return function(e){this.id=setDefaultValue(e,0),this.en_name=null,this.country_id=null,this.local_name=null,this.organization_type=new CategoriesCollection,this.timediff_seconds=null}}()),CitiesCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneCity,e.fetchCities=function(e,t){return __APP.SERVER.getData("/api/v1/organizations/cities",e,t)},e.prototype.getByName=function(e){for(var t=0;t<this.length;t++)if(this[t].en_name==e)return this[t];return null},e.prototype.has=function(e){return($.isNumeric(e)?this.getByID(e):this.getByName(e))instanceof OneEntity},e.prototype.fetchCities=function(t,n,i,a){var r=this;return e.fetchCities({fields:t||void 0,offset:this.length,length:n||void 0,order_by:i||void 0},function(e){r.setData(e),a&&"function"==typeof a&&a.call(r,r.__last_pushed)})},e}()),OneDate=extending(DateModel,function(){return function(){DateModel.call(this),this.id=0,this.event_id=0,this.organization_id=0,this.events_count=0,this.favored_count=0}}()),DatesCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneDate,e.fetchDates=function(e,t){return __APP.SERVER.getData("/api/v1/events/dates",e,t)},e}()),OneCategory=extending(OneEntity,function(){function e(e,t){this.id=setDefaultValue(e,0),this.name=null,this.order_position=null,this.organizations=new OrganizationsCollection,this.loading=!1,e&&t&&(this.loading=!0,this.fetchCategory([],function(){this.loading=!1,$(window).trigger("fetch.OneCategory")}))}return e.fetchCategory=function(e,t,n){return __APP.SERVER.getData("/api/v1/organizations/types",$.extend({},t,{id:e}),n)},e.prototype.fetchCategory=function(e,t){var n=this;return this.constructor.fetchCategory(n.id,{fields:e},function(e){n.setData(e),t&&"function"==typeof t&&t.call(n,e[0])})},e}()),CategoriesCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneCategory,e.fetchCategories=function(e,t){return __APP.SERVER.getData("/api/v1/organizations/types",e,t)},e.prototype.fetchCategories=function(e,t,n){var i=this,a=$.extend({},e,{offset:this.length,length:t});return this.constructor.fetchCategories(a,function(e){i.setData(e),n&&"function"==typeof n&&n.call(i,e)})},e.prototype.fetchCategoriesWithOrganizations=function(e,t,n,i){var a=this,r=$.extend({},e,{offset:this.length,length:n}),s="organizations"+JSON.stringify(__APP.SERVER.validateData(t));return r.fields?Array.isArray(r.fields)||(r.fields=r.fields.split(",")):r.fields=[],r.fields.push(s),this.constructor.fetchCategories(r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,e)})},e}()),OneTag=extending(OneEntity,function(){function e(e,t){this.id=e||0,this.name="",e&&t&&(this.loading=!0,this.fetchTag(function(){this.loading=!1,$(window).trigger("fetch.OneTag")}))}return e.fetchTag=function(e,t){return __APP.SERVER.getData("/api/v1/tags/"+e,{},t)},e.prototype.fetchTag=function(e){var t=this;return this.constructor.fetchTag(t.id,function(n){t.setData(n[0]),e&&"function"==typeof e&&e.call(t,n[0])})},e}()),TagsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneTag,e.fetchTags=function(e,t){return __APP.SERVER.getData("/api/v1/tags/",e,t)},e.prototype.fetchTags=function(e,t){var n=this;return this.constructor.fetchTags(e,function(e){n.setData(e),t&&"function"==typeof t&&t.call(n,e)})},e}()),OneOrder=extending(OneEntity,function(){function e(t,n){var i=this;this.uuid=setDefaultValue(t,null),this.event_id=setDefaultValue(n,0),this.number=null,this._order_content=null,this.is_canceled=null,this.status_id=null,this.status_type_code=null,this.sum=null,this.final_sum=null,this.shop_sum_amount=null,this.payment_type=null,this.created_at=null,this.updated_at=null,this.payed_at=null,this.canceled_at=null,this.event=new OneEvent(n),this.promocode=new PromocodeModel,this.tickets=new TicketsCollection,this.registration_fields=new RegistrationFieldsCollection,this.user_id=null,this.user=new OneUser,Object.defineProperties(this,{status_name:{get:function(){return localeFromNamespace(i.status_type_code,e.EXTENDED_ORDER_STATUSES,__LOCALES.ru_RU.TEXTS.TICKET_STATUSES)}},m_created_at:{get:function(){return moment.unix(i.created_at)}},m_updated_at:{get:function(){return moment.unix(i.updated_at)}},m_payed_at:{get:function(){return moment.unix(i.payed_at)}},m_canceled_at:{get:function(){return moment.unix(i.canceled_at)}},order_content:{get:function(){return JSON.parse(i._order_content||"{}")},set:function(e){return"string"==typeof e?i._order_content=e:"object"===(void 0===e?"undefined":_typeof(e))&&null!==e?i._order_content=JSON.stringify(e):void 0}}})}return e.prototype.ID_PROP_NAME="uuid",e.ENDPOINT=Object.freeze({ORDER:"/events/orders/{order_uuid}",EVENT_ORDER:"/events/{event_id}/orders/{order_uuid}",LEGAL_ENTITY:"/events/{event_id}/orders/{order_uuid}/legal_entity",LEGAL_ENTITY_CONTRACT:"/events/{event_id}/orders/{order_uuid}/legal_entity/contract",LEGAL_ENTITY_UTD:"/events/{event_id}/orders/{order_uuid}/legal_entity/utd",BITCOIN:"/events/{event_id}/orders/{order_uuid}/bitcoin"}),e.ORDER_STATUSES={WAITING_PAYMENT_LEGAL_ENTITY:"order_waiting_for_payment_legal_entity",WAITING_FOR_PAYMENT:"waiting_for_payment",IS_PENDING:"is_pending",APPROVED:"approved",PAYED:"payed",PAYED_LEGAL_ENTITY:"payed_legal_entity",WITHOUT_PAYMENT:"without_payment",RETURNED_BY_ORGANIZATION:"returned_by_organization",RETURNED_BY_CLIENT:"returned_by_client",REJECTED:"rejected"},e.EXTENDED_ORDER_STATUSES=$.extend({PAYMENT_CANCELED_AUTO:"payment_canceled_auto",PAYMENT_CANCELED_BY_CLIENT:"payment_canceled_by_client"},e.ORDER_STATUSES),e.PAYMENT_PROVIDERS={PC:"PC",AC:"AC",MC:"MC",GP:"GP",EP:"EP",WM:"WM",SB:"SB",MP:"MP",AB:"AB",MASTER_PASS:"MA",PB:"PB",QIWI_WALLET:"QW",KV:"KV",BITCOIN:"BTC",LEGAL_ENTITY_PAYMENT:"LEP",OTHER:"OTH"},e.PAYMENT_PROVIDERS_TEXT={PC:"Яндекс.Деньги",AC:"Банковская карта",MC:"Баланс телефона",GP:"Наличные",EP:"ЕРИП (Беларусь)",WM:"WebMoney",SB:"Сбербанк Онлайн",MP:"Мобильный терминал (mPOS)",AB:"Альфа-Клик",MA:"MasterPass",PB:"Интернет-банк Промсвязьбанка",QW:"QIWI Wallet",KV:"КупиВкредит",BTC:"Bitcoin",LEP:"Через юрлицо",OTH:"Иное"},e.isGreenStatus=function(t){switch(t){case e.EXTENDED_ORDER_STATUSES.APPROVED:case e.EXTENDED_ORDER_STATUSES.PAYED:case e.EXTENDED_ORDER_STATUSES.PAYED_LEGAL_ENTITY:case e.EXTENDED_ORDER_STATUSES.WITHOUT_PAYMENT:return!0;default:return!1}},e.isYellowStatus=function(t){switch(t){case e.EXTENDED_ORDER_STATUSES.WAITING_PAYMENT_LEGAL_ENTITY:case e.EXTENDED_ORDER_STATUSES.WAITING_FOR_PAYMENT:case e.EXTENDED_ORDER_STATUSES.IS_PENDING:return!0;default:return!1}},e.isRedStatus=function(t){switch(t){case e.EXTENDED_ORDER_STATUSES.PAYMENT_CANCELED_BY_CLIENT:case e.EXTENDED_ORDER_STATUSES.RETURNED_BY_ORGANIZATION:case e.EXTENDED_ORDER_STATUSES.PAYMENT_CANCELED_AUTO:case e.EXTENDED_ORDER_STATUSES.RETURNED_BY_CLIENT:case e.EXTENDED_ORDER_STATUSES.REJECTED:return!0;default:return!1}},e.isDisabledStatus=function(t){switch(t){case e.EXTENDED_ORDER_STATUSES.IS_PENDING:case e.EXTENDED_ORDER_STATUSES.WAITING_PAYMENT_LEGAL_ENTITY:case e.EXTENDED_ORDER_STATUSES.WAITING_FOR_PAYMENT:case e.EXTENDED_ORDER_STATUSES.PAYMENT_CANCELED_AUTO:case e.EXTENDED_ORDER_STATUSES.PAYMENT_CANCELED_BY_CLIENT:case e.EXTENDED_ORDER_STATUSES.RETURNED_BY_ORGANIZATION:case e.EXTENDED_ORDER_STATUSES.RETURNED_BY_CLIENT:case e.EXTENDED_ORDER_STATUSES.REJECTED:return!0;default:return!1}},e.fetchOrder=function(t,n){return __APP.SERVER.getData(e.ENDPOINT.ORDER.format({order_uuid:t}),{fields:n})},e.changeStatus=function(t,n,i,a){return __APP.SERVER.updateData(e.ENDPOINT.EVENT_ORDER.format({order_uuid:n,event_id:t}),{status:i},!1,a)},e.makeLegalEntityPayment=function(t,n,i,a){return __APP.SERVER.addData(e.ENDPOINT.LEGAL_ENTITY.format({order_uuid:n,event_id:t}),i,!0,a)},e.updateLegalEntityPayment=function(t,n,i,a){return __APP.SERVER.updateData(e.ENDPOINT.LEGAL_ENTITY.format({order_uuid:n,event_id:t}),i,!0,a)},e.fetchBitcoinData=function(t,n,i){return __APP.SERVER.addData(e.ENDPOINT.BITCOIN.format({order_uuid:uuid,event_id:t}),null,!1,i)},e.prototype.fetch=function(e){var t=this;return this.constructor.fetchOrder(this.uuid,e).then(function(e){return t.setData(e),t})},e.prototype.changeStatus=function(t,n){var i=this;return e.changeStatus(this.event_id,this.uuid,t,function(){i.status_type_code=t,isFunction(n)&&n.call(i,i)})},e.prototype.makeLegalEntityPayment=function(t,n){var i=this;return e.makeLegalEntityPayment(this.event_id,this.uuid,t,function(){isFunction(n)&&n.call(i,i)})},e.prototype.updateLegalEntityPayment=function(t,n){var i=this;return e.updateLegalEntityPayment(this.event_id,this.uuid,t,function(){isFunction(n)&&n.call(i,i)})},e.prototype.fetchBitcoinData=function(t){var n=this;return e.fetchBitcoinData(this.event_id,this.uuid,function(e){isFunction(t)&&t.call(n,e)})},e}()),OrdersCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneOrder,e.ENDPOINT=Object.freeze({ORDER:"/events/orders"}),e}()),AbstractEventOrdersCollection=extending(OrdersCollection,function(){function e(e){OrdersCollection.call(this),this.event_id=setDefaultValue(e,0)}return e.fetchOrders=function(e,t,n){return Promise.resolve()},e.prototype.fetchOrders=function(e,t,n,i){var a=this;return this.constructor.fetchOrders(this.event_id,{fields:e||void 0,offset:this.length,length:t||void 0,order_by:n||void 0},function(e){a.setData(e),isFunction(i)&&i.call(a,a.__last_pushed)})},e.prototype.fetchAllOrders=function(e,t,n){var i=this;return this.empty(),this.constructor.fetchOrders(this.event_id,{fields:e||void 0,offset:0,length:ServerConnection.MAX_ENTITIES_LENGTH,order_by:t||void 0},function(e){i.setData(e),isFunction(n)&&n.call(i,i.__last_pushed)}).then(function(){return i.__last_pushed})},e}()),OneTicket=extending(OneEntity,function(){function e(t,n){var i=this;this.uuid=setDefaultValue(n,0),this.event_id=setDefaultValue(t,0),this.user_id=null,this.type_code=null,this.ticket_type_uuid=null,this.ticket_order_uuid=null,this.status=null,this.checkout=null,this.price=null,this.number=null,this.event=new OneEvent,this.ticket_type=new OneTicketType,this.order=new OneOrder,this.user=new OneUser,this.created_at=null,Object.defineProperties(this,{status_name:{get:function(){return localeFromNamespace(i.order.status_type_code,e.TICKET_STATUSES,__LOCALES.ru_RU.TEXTS.TICKET_STATUSES)}},status_type_code:{get:function(){return i.order.status_type_code}}})}return e.prototype.ID_PROP_NAME="uuid",e.TICKET_STATUSES=Object.freeze(mergeObjects({USED:"used"},OneOrder.EXTENDED_ORDER_STATUSES)),e.ENDPOINT=Object.freeze({TICKET:"/events/tickets/{ticket_uuid}",ADMIN_TICKET:"/statistics/events/{event_id}/tickets/{ticket_uuid}"}),e.fetchTicket=function(t,n,i){return __APP.SERVER.getData(e.ENDPOINT.TICKET.format({ticket_uuid:n}),{fields:i})},e.check=function(t,n){return __APP.SERVER.updateData(e.ENDPOINT.ADMIN_TICKET.format({ticket_uuid:n}),{checkout:!0},!1)},e.uncheck=function(t,n){return __APP.SERVER.updateData(e.ENDPOINT.ADMIN_TICKET.format({ticket_uuid:n}),{checkout:!1},!1)},e.exportTicket=function(e,t){return(new ServerExports).eventTicket(e,t)},e.openTicketPage=function(e){return __APP.changeState("/ticket/{ticket_uuid}".format({ticket_uuid:e}))},e.prototype.fetch=function(t){var n=this;return e.fetchTicket(this.event_id,this.uuid,t).then(function(e){return n.setData(e),e})},e.prototype.check=function(){var t=this;return e.check(this.event_id,this.uuid).then(function(){return t.checkout=!0,t})},e.prototype.uncheck=function(){var t=this;return e.uncheck(this.event_id,this.uuid).then(function(){return t.checkout=!1,t})},e.prototype.export=function(){return e.exportTicket(this.event_id,this.uuid)},e.prototype.openPage=function(){return e.openTicketPage(this.uuid)},e}()),TicketsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneTicket,e}()),AbstractEventTicketsCollection=extending(TicketsCollection,function(){function e(e){TicketsCollection.call(this),Object.defineProperty(this,"event_id",{value:setDefaultValue(e,-1)})}return e.fetchTickets=function(e,t,n){return Promise.resolve()},e.prototype.fetchTickets=function(e,t,n,i){var a=this;return this.constructor.fetchTickets(this.event_id,{fields:e||void 0,offset:this.length,length:t||void 0,order_by:n||void 0},function(e){a.setData(e),isFunction(i)&&i.call(a,a.__last_pushed)})},e.prototype.fetchAllTickets=function(e,t,n,i){var a=this;return this.empty(),this.constructor.fetchTickets(this.event_id,Object.assign({fields:e||void 0,offset:0,length:ServerConnection.MAX_ENTITIES_LENGTH,order_by:n||void 0},t),function(e){a.setData(e),isFunction(i)&&i.call(a,a.__last_pushed)}).then(function(){return a.__last_pushed})},e}()),OneTicketType=extending(OneEntity,function(){function e(e,t){var n=this;this.uuid=setDefaultValue(t,null),this.event_id=setDefaultValue(e,null),this.type_code=null,this.name=null,this.comment=null,this.price=null,this.is_selling=null,this.sell_start_date=null,this.sell_end_date=null,this.start_after_ticket_type_code=null,this.amount=null,this.sold_count=null,this.min_count_per_user=null,this.max_count_per_user=null,this.promocode=null,this.promocode_effort=null,Object.defineProperties(this,{formatted_sell_start_date:{get:function(){return n.sell_start_date?moment.unix(n.sell_start_date).format(__LOCALE.DATE.DATE_FORMAT):""}},formatted_sell_end_date:{get:function(){return n.sell_end_date?moment.unix(n.sell_end_date).format(__LOCALE.DATE.DATE_FORMAT):""}}})}return e.prototype.ID_PROP_NAME="uuid",e.prototype.formatPrice=function(e,t,n,i){return 0===parseInt(this.price)?"Бесплатно":formatCurrency(this.price,n,i,t,e||"руб.")},e.fetchTicketType=function(e,t,n,i){return __APP.SERVER.getData("/api/v1/events/"+e+"/ticket_types/"+t,{fields:n},i)},e.prototype.fetchOrder=function(t,n){var i=this;return e.fetchTicketType(this.event_id,this.uuid,t,function(e){i.setData(e),isFunction(n)&&n.call(i,e)})},e}()),TicketTypesCollection=extending(EntitiesCollection,function(){function e(e){EntitiesCollection.call(this),this.event_id=setDefaultValue(e,0)}return e.prototype.collection_of=OneTicketType,e.fetchTicketTypes=function(e,t,n){return __APP.SERVER.getData("/api/v1/events/"+e+"/ticket_types",t,n)},e.prototype.fetchTicketTypes=function(t,n,i,a){var r=this;return e.fetchTicketTypes(this.event_id,{fields:t||void 0,offset:this.length,length:n||void 0,order_by:i||void 0},function(e){r.setData(e),a&&"function"==typeof a&&a.call(r,r.__last_pushed)})},e}()),OneOrganization=extending(OneEntity,function(){function e(e,t){var n=this;this.id=e||0,this.name=null,this.short_name=null,this.description=null,this.img_url=null,this.img_small_url=null,this.img_medium_url=null,this.background_img_url=null,this.background_small_img_url=null,this.background_medium_img_url=null,this.type_id=null,this.type_name=null,this.site_url=null,this.default_address=null,this.events=new EventsCollection,this.subscription_id=null,this.is_subscribed=null,this.subscribed_count=null,this.subscribed=new UsersCollection,this.privileges=[],this.finance=new OrganizationFinanceModel(e),this.is_private=null,this.brand_color=null,this.brand_color_accent=null,this.tariff=new TariffModel,this.city=new OneCity,this.country=null,this.email=null,this.staff=new UsersCollection,this.status=null,this.is_new=null,this.new_events_count=null,this.actual_events_count=null,this.vk_url=null,this.facebook_url=null,this.created_at=null,this.updated_at=null,Object.defineProperties(this,{role:{get:function(){return OneUser.recognizeRole(n.privileges)}},admins:{get:function(){return n.staff.getSpecificStaff(OneUser.ROLE.ADMIN)}},moderators:{get:function(){return n.staff.getSpecificStaff(OneUser.ROLE.MODERATOR)}},logo_large_url:{get:function(){return n.img_url},set:function(e){return n.img_url=e}},logo_medium_url:{get:function(){return n.img_medium_url},set:function(e){return n.img_medium_url=e}},logo_small_url:{get:function(){return n.img_small_url},set:function(e){return n.img_small_url=e}}}),this.loading=!1,e&&t&&(this.loading=!0,this.fetchOrganization([],function(){this.loading=!1,$(window).trigger("fetch.OneOrganization")}))}return e.ENDPOINT=Object.freeze({FEEDBACK:"/organizations/{org_id}/feedback",WITHDRAW:"/organizations/{org_id}/withdraws",REQUISITES:"/organizations/{org_id}/requisites"}),e.fetchOrganization=function(e,t,n){return __APP.SERVER.getData("/api/v1/organizations/"+e,{fields:t},n)},e.createOrganization=function(e,t,n){return __APP.SERVER.addData("/api/v1/organizations/",e,!0,t,n)},e.updateOrganization=function(e,t,n,i){return __APP.SERVER.updateData("/api/v1/organizations/"+e,t,!0,n,i)},e.addStaff=function(e,t,n,i){return __APP.SERVER.addData("/api/v1/organizations/"+e+"/staff",{user_id:t,role:n},!1,i)},e.removeStaff=function(e,t,n,i){return __APP.SERVER.deleteData("/api/v1/organizations/"+e+"/staff",{user_id:t,role:n},i)},e.subscribeOrganization=function(e,t){return __APP.SERVER.addData("/api/v1/organizations/"+e+"/subscriptions",{},!1,t)},e.unsubscribeOrganization=function(e,t){return __APP.SERVER.deleteData("/api/v1/organizations/"+e+"/subscriptions",{},t)},e.requestWithdrawFunds=function(t,n,i,a){return __APP.SERVER.addData(e.ENDPOINT.WITHDRAW.format({org_id:t}),{sum:n,comment:i},!1,a)},e.sendFeedback=function(t,n,i){return __APP.SERVER.addData(e.ENDPOINT.FEEDBACK.format({org_id:t}),n,!1,i)},e.fetchRequisites=function(t,n){return __APP.SERVER.getData(e.ENDPOINT.REQUISITES.format({org_id:t}),{},n)},e.saveRequisites=function(t,n,i){return __APP.SERVER.addData(e.ENDPOINT.REQUISITES.format({org_id:t}),n,i)},e.prototype.fetchOrganization=function(t,n){var i=this;return e.fetchOrganization(i.id,t,function(e){i.setData(e),isFunction(n)&&n.call(i,i)})},e.prototype.createOrganization=function(t,n,i){var a=this;return e.createOrganization(t,function(e){a.setData(t),a.id=e.organization_id,isFunction(n)&&n.call(a,a)},i)},e.prototype.updateOrganization=function(t,n,i){var a=this;return e.updateOrganization(a.id,t,function(e){a.setData(t),isFunction(n)&&n.call(a,a)},i)},e.prototype.subscribe=function(e){var t=this;return this.constructor.subscribeOrganization(this.id,function(n){this.is_subscribed=!0,this.subscribed_count++,isFunction(e)&&e.call(t,n)})},e.prototype.unsubscribe=function(e){var t=this;return this.constructor.unsubscribeOrganization(this.id,function(n){this.is_subscribed=!1,this.subscribed_count=this.subscribed_count?this.subscribed_count-1:this.subscribed_count,isFunction(e)&&e.call(t,n)})},e.prototype.addStaff=function(t,n,i){var a=this,r=new OneUser(t);return __APP.SERVER.multipleAjax(e.addStaff(this.id,t,n),r.fetchUser(new Fields)).then(function(e,t){a.staff.setData(r),isFunction(i)&&i.call(a,r)})},e.prototype.removeStaff=function(t,n,i){var a=this;return e.removeStaff(this.id,t,n,function(){isFunction(i)&&i.call(a,a.staff.remove(t))})},e.prototype.requestWithdrawFunds=function(t,n,i){var a=this;return e.requestWithdrawFunds(this.id,t,n,function(e){a.finance.withdraws.setData(e),isFunction(i)&&i.call(a,a.finance.withdraws.__last_pushed)})},e.prototype.sendFeedback=function(t,n){return e.sendFeedback(this.id,t,n)},e}()),OrganizationsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneOrganization,e.fetchSubscribedOrganizations=function(e,t){return __APP.SERVER.getData("/api/v1/organizations/subscriptions",e,t)},e.fetchMyOrganizations=function(e,t,n){return e=Array.isArray(e)?e.join(","):e,__APP.SERVER.getData("/api/v1/organizations/",$.extend({},t,{roles:e}),n)},e.fetchRecommendations=function(e,t){return __APP.SERVER.getData("/api/v1/organizations/recommendations",e,t)},e.prototype.fetchSubscribedOrganizations=function(e,t,n,i){var a=this,r={fields:e,offset:this.length,length:t,order_by:n||void 0};return this.constructor.fetchSubscribedOrganizations(r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,e)})},e.prototype.fetchMyOrganizations=function(t,n,i,a,r){var s=this,o={fields:n,length:i,offset:this.length,order_by:a||void 0};return e.fetchMyOrganizations(t,o,function(e){s.setData(e),isFunction(r)&&r.call(s,s.__last_pushed)})},e}()),OneUser=extending(OneEntity,function(){function e(e){var t=this;this.id=setDefaultValue(e,0),this.first_name=null,this.last_name=null,this.middle_name=null,this.gender=null,this.email=null,this.avatar_url=null,this.blurred_image_url=null,this.link=null,this.type=null,this.role=null,this.is_friend=null,this.is_editor=null,this.accounts=[],this.accounts_links={},this.vk_uid=null,this.google_uid=null,this.facebook_uid=null,this.subscriptions=new OrganizationsCollection,this.favored=new FavoredEventsCollection,this.actions=new UsersActivitiesCollection(e),this.interests=new InterestModelsCollection,Object.defineProperty(this,"full_name",{enumerable:!0,get:function(){return t.first_name+" "+t.last_name}})}return e.prototype.subscriptions_fields=["img_small_url","subscribed_count","new_events_count","actual_events_count"],Object.freeze(e.prototype.subscriptions_fields),e.ROLE={UNAUTH:"unauth",USER:"user",MODERATOR:"moderator",ADMIN:"admin"},Object.freeze(e.ROLE),e.GENDER={MALE:"male",FEMALE:"female",NEUTRAL:"neutral"},Object.freeze(e.GENDER),e.ACCOUNTS={VK:"vk",GOOGLE:"google",FACEBOOK:"facebook"},Object.freeze(e.ACCOUNTS),e.fetchUser=function(e,t,n){return __APP.SERVER.getData("/api/v1/users/"+e,{fields:t},n)},e.fetchFavored=function(e,t,n){return __APP.SERVER.getData("/api/v1/users/"+e+"/favorites",t,n)},e.fetchSubscriptions=function(e,t,n){return __APP.SERVER.getData("/api/v1/users/"+e+"/subscriptions",t,n)},e.fetchUserActivity=function(e,t,n){return UsersActivitiesCollection.fetch(e,{fields:t},n)},e.recognizeRole=function(t){var n=e.ROLE.USER;return t.forEach(function(t){1!=t.role_id&&t.name!=e.ROLE.ADMIN||(n=e.ROLE.ADMIN),2!=t.role_id&&t.name!=e.ROLE.MODERATOR||n===e.ROLE.ADMIN||(n=e.ROLE.MODERATOR)}),n||e.ROLE.UNAUTH},e.prototype.fetchUser=function(t,n){var i=this;return t=setDefaultValue(t,[]),e.fetchUser(i.id,t,function(e){return e=e instanceof Array?e[0]:e,i.setData(e),isFunction(n)&&n.call(i,e),e})},e.prototype.fetchFavored=function(t,n){var i=this;return t.offset=this.favored.length,e.fetchFavored(i.id,t).then(function(e){return i.favored.setData(e),isFunction(n)&&n.call(i,i.favored.__last_pushed),i.favored.__last_pushed})},e.prototype.fetchSubscriptions=function(t,n){var i=this;return t.offset=this.subscriptions.length,e.fetchSubscriptions(i.id,t).then(function(e){return i.subscriptions.setData(e),isFunction(n)&&n.call(i,i.subscriptions.__last_pushed),i.subscriptions.__last_pushed})},e}()),UsersCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneUser,e.getSpecificStaff=function(e,t){return t.filter(function(t){return t.role===e})},e.fetchUsers=function(e,t){return __APP.SERVER.getData("/api/v1/users/",e,t)},e.fetchEventFavorites=function(e,t,n){return __APP.SERVER.getData("/api/v1/events/"+e,{fields:"favored".appendAjaxData(__APP.SERVER.validateData(t))},function(e){t.length&&t.offset&&(t.offset+=t.length),n&&"function"==typeof n&&n(e[0].favored)})},e.fetchOrganizationSubscribers=function(e,t,n){return __APP.SERVER.getData("/api/v1/organizations/"+e,{fields:"subscribed".appendAjaxData(__APP.SERVER.validateData(t))},function(e){t.length&&t.offset&&(t.offset+=t.length),n&&"function"==typeof n&&n(e[0].subscribed)})},e.fetchOrganizationStaff=function(e,t,n){return __APP.SERVER.getData("/api/v1/organizations/"+e+"/staff/",t,n)},e.prototype.getSpecificStaff=function(t){return e.getSpecificStaff(t,this)},e.prototype.fetchUsers=function(t,n,i){var a=this,r=$.extend(t,{offset:this.length,length:n});return e.fetchUsers(r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,e)})},e.prototype.fetchEventFavorites=function(t,n,i,a){var r=this,s=$.extend({},i,{offset:this.length,length:n});return e.fetchEventFavorites(t,s,function(e){r.setData(e),a&&"function"==typeof a&&a.call(r,e)})},e.prototype.fetchOrganizationSubscribers=function(e,t,n,i){var a=this,r=$.extend({},n,{offset:this.length,length:t});return this.constructor.fetchOrganizationSubscribers(e,r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,e)})},e.prototype.fetchOrganizationStaff=function(t,n,i,a){var r=this,s=$.extend({},i,{offset:this.length,length:n});return e.fetchOrganizationStaff(t,s,function(e){r.setData(e),a&&"function"==typeof a&&a.call(r,e)})},e}()),OneNotification=extending(OneEntity,function(){function e(){var t=this;this.uuid=null,this.event_id=null,this.notification_time=null,this.notification_type=null,this.sent_time=null,this.done=null,this.created_at=null,this.updated_at=null,Object.defineProperty(this,e.prototype.ID_PROP_NAME,{get:function(){return t.uuid||t.notification_type}})}return e.prototype.ID_PROP_NAME="guid",e.NOTIFICATIN_TYPES={NOW:"notification-now",CANCELED:"notification-event-canceled",CHANGED_DATES:"notification-event-changed-dates",CHANGED_LOCATION:"notification-event-changed-location",CHANGED_PRICE:"notification-event-changed-price",CHANGED_REGISTRATION:"notification-event-changed-registration",ONE_DAY_REGISTRATION_CLOSE:"notification-one-day-registration-close",BEFORE_THREE_HOURS:"notification-before-three-hours",BEFORE_DAY:"notification-before-day",BEFORE_THREE_DAYS:"notification-before-three-days",BEFORE_WEEK:"notification-before-week",BEFORE_QUARTER_OF_HOUR:"notification-before-quarter-of-hour",CUSTOM:"notification-custom",REGISTRATION_APPROVED:"notification-registration-approved",REGISTRATION_CHECKED_OUT:"notification-registration-checked-out",REGISTRATION_NOT_CHECKED_OUT:"notification-registration-not-checked-out",REGISTRATION_NOT_APPROVED:"notification-registration-not-approved",USERS:"users-notification",ADDITIONAL_FOR_ORGANIZATION:"notification-additional-for-organization"},e}()),NotificationsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this),Object.defineProperties(this,{future:{get:function(){return this.filter(function(e){return!e.done})}}})}return e.prototype.collection_of=OneNotification,e}()),OneEvent=extending(OneEntity,function(){function e(e,t){var n=this,i=["organization_id","organization_short_name","organization_logo_large_url","organization_logo_medium_url","organization_logo_small_url","organization_is_private"];this.id=e||0,this.title=null,this.description=null,this.location=null,this.latitude=null,this.longitude=null,this.is_online=null,this.detail_info_url=null,this.orders=new AbstractEventOrdersCollection(e),this.orders_count=null,this.ticketing_locally=null,this.ticketing_available=null,this.tickets=new AbstractEventTicketsCollection(e),this.ticket_types=new TicketTypesCollection(e),this.booking_time=null,this.apply_promocodes_and_pricing_rules=null,this.pricing_rules=new PricingRuleModelsCollection,this.registration_locally=null,this.registration_available=null,this.registration_required=null,this.registration_limit_count=null,this.registration_till=null,this.registration_approve_status=null,this.registration_approvement_required=null,this.is_registered=null,this.registered_count=null,this.registered_users=new UsersCollection,this.registration_fields=new RegistrationFieldModelsCollection,this.organization=new OneOrganization,this.image_vertical_url=null,this.image_horizontal_url=null,this.image_horizontal_large_url=null,this.image_horizontal_medium_url=null,this.image_horizontal_small_url=null,this.has_landing=null,this.is_free=null,this.min_price=null,this.dates=new DatesCollection,this.is_same_time=null,this.first_event_date=null,this.last_event_date=null,this.nearest_event_date=null,this.networking_enabled=null,this.networking_start_date=null,this.networking_end_date=null,this.tags=new TagsCollection,this.promocodes=new PromocodeModelsCollection,this.accept_bitcoins=null,this.notifications=new NotificationsCollection,this.favored=new UsersCollection,this.favored_users_count=null,this.favored_friends_count=null,this.is_favorite=null,this.public_at=null,this.canceled=null,this.can_edit=null,this.actuality=null,this.vk_post_link=null,this.email_texts=new EventEmailTextsModel,this.finance=new EventFinanceModel(e),this.creator_id=null,this.created_at=null,this.updated_at=null,i.forEach(function(e){Object.defineProperty(n,e,{enumerable:!0,get:function(){return n.organization[e.replace("organization_","")]},set:function(t){return n.organization[e.replace("organization_","")]=t}})}),this.loading=!1,e&&t&&(this.loading=!0,this.fetchEvent(void 0,function(){this.loading=!1,$(window).trigger("fetch.OneEvent")}))}return e.ENDPOINT=Object.freeze({EVENT:"/events/{event_id}",STATUS:"/events/{event_id}/status",ORDERS:"/events/{event_id}/orders",PREORDER:"/events/{event_id}/preorder",FAVORITES:"/events/{event_id}/favorites",NOTIFICATIONS:"/events/{event_id}/notifications",NOTIFICATION:"/events/{event_id}/notifications/{notification_uuid}"}),e.STATUS={CANCEL:"cancel",BRING_BACK:"bring_back",HIDE:"hide",SHOW:"show"},e.fetchEvent=function(e,t,n){var i={fields:new Fields(t)};return i.utm=JSON.stringify(gatherUTMTags(window.location)),__APP.SERVER.getData("/api/v1/events/"+e,i,n)},e.createEvent=function(e,t,n){return __APP.SERVER.addData("/api/v1/events/",e,!0,t,n)},e.updateEvent=function(e,t,n,i){return __APP.SERVER.updateData("/api/v1/events/"+e,t,!0,n,i)},e.changeEventStatus=function(t,n){var i={};return(n=Array.isArray(n)?n:[n]).forEach(function(t){switch(t){case e.STATUS.CANCEL:i.canceled=!0;break;case e.STATUS.BRING_BACK:i.canceled=!1;break;case e.STATUS.HIDE:i.hidden=!0;break;case e.STATUS.SHOW:i.hidden=!1}}),__APP.SERVER.updateData(e.ENDPOINT.STATUS.format({event_id:t}),i,!1).then(function(){return i})},e.addFavored=function(t){return __APP.SERVER.addData(e.ENDPOINT.FAVORITES.format({event_id:t}),{},!1)},e.deleteFavored=function(t){return __APP.SERVER.deleteData(e.ENDPOINT.FAVORITES.format({event_id:t}))},e.addEventNotification=function(t,n){return __APP.SERVER.addData(e.ENDPOINT.NOTIFICATIONS.format({event_id:t}),{notification_type:n},!1)},e.deleteEventNotification=function(t,n){return __APP.SERVER.deleteData(e.ENDPOINT.NOTIFICATION.format({event_id:t,notification_uuid:n}))},e.registerToEvent=function(t,n,i,a){return __APP.SERVER.addData(e.ENDPOINT.ORDERS.format({event_id:t}),{registration_fields:n,tickets:[{uuid:null,count:1}],utm:i||null},!0,a)},e.buyTickets=function(t,n,i,a,r){return __APP.SERVER.addData(e.ENDPOINT.ORDERS.format({event_id:t}),{tickets:n,promocode:i||null,utm:a||null},!0,r)},e.makeOrder=function(t,n,i){return empty(n.tickets)?e.registerToEvent(t,n.registration_fields,n.utm,i):empty(n.registration_fields)?e.buyTickets(t,n.tickets,n.promocode,n.utm,i):__APP.SERVER.addData(e.ENDPOINT.ORDERS.format({event_id:t}),{registration_fields:n.registration_fields,tickets:n.tickets,promocode:n.promocode||null,utm:n.utm||null},!0,i)},e.preOrder=function(t,n){return __APP.SERVER.addData(e.ENDPOINT.PREORDER.format({event_id:t}),{registration_fields:n.registration_fields,tickets:n.tickets,promocode:n.promocode||null,utm:n.utm||null},!0)},e.prototype.fetchEvent=function(e,t){var n=this;return this.constructor.fetchEvent(this.id,e,function(e){var i=e instanceof Array?e[0]:e;n.setData(i),isFunction(t)&&t.call(n,i)})},e.prototype.createEvent=function(e,t,n){var i=this;return this.constructor.createEvent(e,function(n){i.setData(e),i.id=n.event_id,isFunction(t)&&t.call(i,e)},n)},e.prototype.updateEvent=function(e,t,n){var i=this;return this.constructor.updateEvent(i.id,e,function(n){i.setData(e),isFunction(t)&&t.call(i,e)},n)},e.prototype.favour=function(){var t=this;return e.addFavored(this.id).then(function(){return t.favored.push(__APP.USER),__APP.USER})},e.prototype.unfavour=function(){var t=this;return e.deleteFavored(this.id).then(function(){return t.favored.remove(__APP.USER.id),t.favored})},e.prototype.cancel=function(){var t=this;return e.changeEventStatus(this.id,e.STATUS.CANCEL).then(function(){return t.canceled=!0,t})},e.prototype.restore=function(){var t=this;return e.changeEventStatus(this.id,e.STATUS.BRING_BACK).then(function(){return t.canceled=!1,t})},e.prototype.hide=function(){var t=this;return e.changeEventStatus(this.id,e.STATUS.HIDE).then(function(){return t.hidden=!0,t})},e.prototype.bringBack=function(){var t=this;return e.changeEventStatus(this.id,e.STATUS.SHOW).then(function(){return t.hidden=!1,t})},e.prototype.addNotification=function(e){var t=this;return this.constructor.addEventNotification(this.id,e).then(function(n){var i=new OneNotification;return i.setData({uuid:n.uuid,notification_type:e,notification_time:n.notification_time,done:!1,event_id:t.id,created_at:(new Date).valueOf()}),t.notifications.push(i),i})},e.prototype.deleteNotification=function(e){var t=this;return this.constructor.deleteEventNotification(this.id,e).then(function(){t.notifications.remove(e)})},e.prototype.registerToEvent=function(e,t,n){var i=this;return this.constructor.registerToEvent(this.id,e,t,function(e){i.is_registered=!0,isFunction(n)&&n.call(i,e)})},e.prototype.buyTickets=function(e,t,n,i){return this.constructor.buyTickets(this.id,e,t,n,i)},e.prototype.makeOrder=function(e,t){var n=this;return this.constructor.makeOrder(this.id,e,t).then(function(e){var t=new OneOrder;return t.setData($.extend({registration_fields:e.registration_fields,tickets:e.tickets,user_id:__APP.USER.id,user:__APP.USER},e.order)),n.orders.push(t),{sum:e.sum,order:t,send_data:e}})},e.prototype.preOrder=function(e){return this.constructor.preOrder(this.id,e)},e}()),EventsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneEvent,e.KIND={MY:"my",FAVORED:"favored",RECOMMENDED:"recommended"},e.fetchEvents=function(e,t){return __APP.SERVER.getData("/api/v1/events/",e,t)},e.fetchMyEvents=function(e,t){return __APP.SERVER.getData("/api/v1/events/my",e,t)},e.fetchFavoredEvents=function(e,t){return __APP.SERVER.getData("/api/v1/events/favorites",e,t)},e.fetchRecommendedEvents=function(e,t){return __APP.SERVER.getData("/api/v1/events/recommendations",e,t)},e.fetchOrganizationsEvents=function(e,t,n){return __APP.SERVER.getData("/api/v1/events/",$.extend({},t,{organization_id:e}),n)},e.prototype.fetchEvents=function(t,n,i,a){var r=this,s="fetchEvents",o=$.extend({},n,{offset:this.length,length:i});switch(t){default:s="fetchEvents";break;case e.KIND.MY:s="fetchMyEvents";break;case e.KIND.FAVORED:s="fetchFavoredEvents";break;case e.KIND.RECOMMENDED:s="fetchRecommendedEvents"}return this.constructor[s](o,function(e){r.setData(e),isFunction(a)&&a.call(r,r.__last_pushed)})},e.prototype.fetchFeed=function(e,t,n,i){var a=this,r=$.extend({fields:e,offset:this.length,length:t},n);return this.constructor.fetchEvents(r,function(e){a.setData(e),isFunction(i)&&i.call(a,a.__last_pushed)})},e.prototype.fetchOrganizationsEvents=function(e,t,n,i){var a=this,r=$.extend({},t,{offset:this.length,length:n});return this.constructor.fetchOrganizationsEvents(e,r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,a.__last_pushed)})},e.prototype.fetchOrganizationsFeed=function(e,t,n,i){var a=this,r={fields:t,offset:this.length,length:n};return this.constructor.fetchOrganizationsEvents(e,r,function(e){a.setData(e),i&&"function"==typeof i&&i.call(a,a.__last_pushed)})},e}()),ActualEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchEvents=function(e,t){return e.fields=e.fields?"string"==typeof e.fields?e.fields.split(","):e.fields:[],e.fields.push("actuality"),e.future=!0,e.order_by="-actuality",EventsCollection.fetchMyEvents(e,t)},e}()),CanceledEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchOrganizationsEvents=function(e,t,n){return t.fields=t.fields?"string"==typeof t.fields?t.fields.split(","):t.fields:[],t.fields.push("updated_at"),t.is_canceled=!0,t.order_by="-updated_at",EventsCollection.fetchOrganizationsEvents(e,t,n)},e}()),DayEventsCollection=extending(EventsCollection,function(){function e(e){if(!e)throw Error("DayEventsCollection must have date parameter");EventsCollection.call(this),this.date=e}return e.fetchEvents=function(e,t,n){return t.date=e,EventsCollection.fetchMyEvents(t,n)},e.prototype.fetchFeed=function(e,t,n,i){var a=this,r=$.extend({fields:e,offset:this.length,length:t},n);return this.constructor.fetchEvents(this.date,r,function(e){a.setData(e),isFunction(i)&&i.call(a,e)})},e}()),DelayedEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchOrganizationsEvents=function(e,t,n){return t.fields=t.fields?"string"==typeof t.fields?t.fields.split(","):t.fields:[],t.fields.push("public_at"),t.is_delayed=!0,t.is_canceled=!1,t.order_by="public_at",EventsCollection.fetchOrganizationsEvents(e,t,n)},e}()),OneEventWithStatistics=extending(OneEvent,function(){function e(e,t){OneEvent.apply(this,arguments),this.view=0,this.view_detail=0,this.fave=0,this.unfave=0,this.open_site=0,this.notifications_sent=0}return e.fetchEvent=OneEvent.fetchEvent,e}()),EventsWithStatisticsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.prototype.collection_of=OneEventWithStatistics,e.fetchEvents=function(e,t){return e.statistics=!0,__APP.SERVER.getData("/api/v1/events/",e,t)},e.fetchMyEvents=function(e,t){return e.statistics=!0,__APP.SERVER.getData("/api/v1/events/my",e,t)},e.fetchFavoredEvents=function(e,t){return e.statistics=!0,__APP.SERVER.getData("/api/v1/events/favorites",e,t)},e.fetchRecommendedEvents=function(e,t){return e.statistics=!0,__APP.SERVER.getData("/api/v1/events/recommendations",e,t)},e.fetchOrganizationsEvents=function(e,t,n){return t.statistics=!0,__APP.SERVER.getData("/api/v1/events/",$.extend({},t,{organization_id:e}),n)},e}()),FavoredEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchEvents=function(e,t){return e.future=!0,EventsCollection.fetchFavoredEvents(e,t)},e}()),FriendsEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchEvents=function(e,t){return e.fields=e.fields?"string"==typeof e.fields?e.fields.split(","):e.fields:[],e.fields.push("favored_friends_count"),e.future=!0,e.order_by="-favored_friends_count",EventsCollection.fetchMyEvents(e,t)},e}()),FutureEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchOrganizationsEvents=function(e,t,n){return t.future=!0,t.order_by="nearest_event_date",EventsCollection.fetchOrganizationsEvents(e,t,n)},e}()),OneEventWithFinances=extending(OneEvent,function(){function e(e){OneEvent.call(this,e),this.sum_amount=null,this.sold_count=null,this.checked_out_count=null,this.total_income=null,this.withdraw_available=null,this.processing_commission_value=null,this.processing_commission=null,this.evendate_commission_value=null,this.ticket_dynamics=new EventFinanceStatisticsCollection(e,"ticket_dynamics"),this.income_dynamics=new EventFinanceStatisticsCollection(e,"income_dynamics")}return e.FINANCE_FIELDS=["sum_amount","sold_count","checked_out_count","total_income","withdraw_available","processing_commission_value","processing_commission","evendate_commission_value","ticket_dynamics","income_dynamics"],e.fetchEvent=function(t,n,i){var a=new Fields;return(n=new Fields(n)).forEach(function(t){e.FINANCE_FIELDS.contains(t)&&a.add(t,n.pull(t))}),a.length?__APP.SERVER.multipleAjax(__APP.SERVER.getData("/api/v1/events/{event_id}".format({event_id:t}),{fields:n}),__APP.SERVER.getData(EventStatisticsCollection.ENDPOINT.FINANCE.format({event_id:t}),{fields:a})).then(function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];isFunction(i)&&i(Object.assign({},n instanceof Array?n[0]:n,a))}):__APP.SERVER.getData("/api/v1/events/"+t,{fields:new Fields(n)},i)},e}()),PastEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchOrganizationsEvents=function(e,t,n){return t.till=moment().format(__C.DATE_FORMAT),t.order_by="-last_event_date",EventsCollection.fetchOrganizationsEvents(e,t,n)},e}()),RecommendedEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchEvents=function(e,t){return e.future=!0,e.order_by="-rating",EventsCollection.fetchRecommendedEvents(e,t)},e}()),TimelineEventsCollection=extending(EventsCollection,function(){function e(){EventsCollection.call(this)}return e.fetchEvents=function(e,t){return e.future=!0,EventsCollection.fetchMyEvents(e,t)},e}()),OneAbstractDispatch=extending(OneEntity,function(){function e(e){OneEntity.call(this),this.uuid=setDefaultValue(e,null),this.creator_id=null,this.owner_organization_id=null,this.is_email=null,this.is_push=null,this.is_sms=null,this.title=null,this.subject=null,this.message_text=null,this.url=null,this.notification_time=null,this.is_active=null,this.done=null,this.created_at=null,this.updated_at=null}return e.ENDPOINT=Object.freeze({DISPATCHES:"/broadcasts",DISPATCH:"/broadcasts/{uuid}"}),e.factory=function(t){var n=new e;switch(!0){case!isVoid(t.event_id):n=new OneEventDispatch;break;case!isVoid(t.organization_id):n=new OneOrganizationDispatch}return n.setData(t),n},e.convertToPostObject=function(e){return{is_email:e.is_email,is_push:e.is_push,is_sms:e.is_sms,is_active:e.is_active,title:e.title,subject:e.subject,message_text:e.message_text,notification_time:e.notification_time}},e.prototype.convertToPostObject=function(t){return e.convertToPostObject(t)},e.fetchDispatch=function(t,n){return __APP.SERVER.getData(e.ENDPOINT.DISPATCH.format({uuid:t}),{fields:n})},e.createDispatch=function(t){return __APP.SERVER.addData(e.ENDPOINT.DISPATCHES,t)},e.updateDispatch=function(t,n){return __APP.SERVER.updateData(e.ENDPOINT.DISPATCH.format({uuid:t}),n)},e.prototype.fetch=function(t){return e.fetchDispatch(this.uuid,t).then(function(t){return e.factory(t instanceof Array?t[0]:t)})},e.prototype.save=function(){return isVoid(this.uuid)?e.createDispatch(this.convertToPostObject(this)):e.updateDispatch(this.uuid,this.convertToPostObject(this))},e}()),DispatchesCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneAbstractDispatch,e.fetchDispatches=function(e){return __APP.SERVER.getData(OneAbstractDispatch.ENDPOINT.DISPATCHES,e)},e}()),OneEventDispatch=extending(OneAbstractDispatch,function(){function e(e,t){OneAbstractDispatch.call(this,e),this.event_id=setDefaultValue(t,null),this.event=new OneEvent(t)}return e.prototype.convertToPostObject=function(e){var t=OneAbstractDispatch.convertToPostObject(e);return t.event_id=e.event_id,t},e}()),OneOrganizationDispatch=extending(OneAbstractDispatch,function(){function e(e,t){OneAbstractDispatch.call(this,e),this.organization_id=setDefaultValue(t,null)}return e.prototype.convertToPostObject=function(e){var t=OneAbstractDispatch.convertToPostObject(e);return t.organization_id=e.organization_id,t},e}()),OrganizationDispatchesCollection=extending(DispatchesCollection,function(){function e(e){DispatchesCollection.call(this),Object.defineProperty(this,"organization_id",{value:e})}return e.prototype.fetch=function(e,t,n){var i=this;return DispatchesCollection.fetchDispatches({organization_id:this.organization_id,fields:e||void 0,offset:this.length,length:t||void 0,order_by:n||void 0}).then(function(e){return i.setData(e),i.__last_pushed})},e}());var OneNetworkingProfile=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.user_id=setDefaultValue(e,null),n.first_name=null,n.last_name=null,n.avatar_url=null,n.info=null,n.looking_for=null,n.vk_url=null,n.facebook_url=null,n.twitter_url=null,n.linkedin_url=null,n.telegram_url=null,n.instagram_url=null,n.github_url=null,n.email=null,n.signed_up=null,n.company_name=null,n.request_uuid=null,n.request=new OneNetworkingRequest(n.request_uuid),n.outgoing_request_uuid=null,n.outgoing_request=new OneNetworkingRequest(n.outgoing_request_uuid),n.user=new OneUser(n.user_id),Object.defineProperties(n.user,{first_name:{get:function(){return n.first_name}},last_name:{get:function(){return n.last_name}},avatar_url:{get:function(){return n.avatar_url}}}),n}return _inherits(t,OneEntity),_createClass(t,[{key:"fetch",value:function(e){var n=this;return t.fetchProfile(this.user_id,e).then(function(e){return n.setData(e),e})}}],[{key:"fetchProfile",value:function(e,n){return __APP.SERVER.getData(t.profilePath(e),{fields:n})}}]),t}();OneNetworkingProfile.prototype.ID_PROP_NAME="user_id",OneNetworkingProfile.profilePath=function(e){return"/events/networking/profiles/"+e};var NetworkingProfilesCollection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,EntitiesCollection),_createClass(t,[{key:"fetch",value:function(e,t,n){return Promise.resolve()}}]),t}();NetworkingProfilesCollection.prototype.collection_of=OneNetworkingProfile;var OneEventNetworkingProfile=function(e){function t(e,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.event_id=setDefaultValue(n,null),i.request=new OneEventNetworkingRequest(n,i.request_uuid),i.outgoing_request=new OneEventNetworkingRequest(n,i.outgoing_request_uuid),i}return _inherits(t,OneNetworkingProfile),_createClass(t,[{key:"fetch",value:function(e){var n=this;return t.fetchProfile(this.event_id,this.user_id,e).then(function(e){return n.setData(e),e})}}],[{key:"fetchProfile",value:function(e,n,i){return __APP.SERVER.getData(t.profilePath(e,n),{fields:i})}}]),t}();OneEventNetworkingProfile.profilePath=function(e,t){return"/events/"+e+"/networking/profiles/"+t};var EventNetworkingProfilesCollection=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperty(n,"event_id",{get:function(){return e}}),n}return _inherits(t,NetworkingProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,n,i){var a=this;return t.fetchProfiles(this.event_id,{fields:e,length:n,order_by:i,offset:this.length}).then(function(e){return a.setData(e),a.__last_pushed})}}],[{key:"fetchProfiles",value:function(e,n){return __APP.SERVER.getData(t.profilesPath(e),n)}}]),t}();EventNetworkingProfilesCollection.prototype.collection_of=OneEventNetworkingProfile,EventNetworkingProfilesCollection.profilesPath=function(e){return"/events/"+e+"/networking/profiles/"};var EventNetworkingAcceptedRequestProfilesCollection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,EventNetworkingProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,t,n){var i=this;return EventNetworkingProfilesCollection.fetchProfiles(this.event_id,{request_accepted:!0,fields:e,length:t,order_by:n,offset:this.length}).then(function(e){return i.setData(e),i.__last_pushed})}}]),t}(),NetworkingContactsProfilesCollection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,NetworkingProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,n,i){var a=this;return t.fetchProfiles({fields:e,length:n,order_by:i,offset:this.length}).then(function(e){return a.setData(e),a.__last_pushed})}}],[{key:"fetchProfiles",value:function(e){return __APP.SERVER.getData(t.profilesPath(),e)}}]),t}();NetworkingContactsProfilesCollection.prototype.collection_of=OneNetworkingProfile,NetworkingContactsProfilesCollection.profilesPath=function(){return"/users/me/contacts/"};var EventNetworkingContactsProfilesCollection=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperty(n,"event_id",{get:function(){return e}}),n}return _inherits(t,NetworkingContactsProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,n,i){var a=this;return t.fetchProfiles(this.event_id,{fields:e,length:n,order_by:i,offset:this.length}).then(function(e){return a.setData(e),a.__last_pushed})}}],[{key:"fetchProfiles",value:function(e,n){return __APP.SERVER.getData(t.profilesPath(e),n)}}]),t}();EventNetworkingContactsProfilesCollection.prototype.collection_of=OneEventNetworkingProfile,EventNetworkingContactsProfilesCollection.profilesPath=function(e){return"/events/"+e+"/networking/contacts"};var EventNetworkingPendingRequestProfilesCollection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,EventNetworkingProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,t,n){var i=this;return EventNetworkingProfilesCollection.fetchProfiles(this.event_id,{request_pending:!0,fields:e,length:t,order_by:n,offset:this.length}).then(function(e){return i.setData(e),i.__last_pushed})}}]),t}(),EventNetworkingRejectedRequestProfilesCollection=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,EventNetworkingProfilesCollection),_createClass(t,[{key:"fetch",value:function(e,t,n){var i=this;return EventNetworkingProfilesCollection.fetchProfiles(this.event_id,{request_rejected:!0,fields:e,length:t,order_by:n,offset:this.length}).then(function(e){return i.setData(e),i.__last_pushed})}}]),t}(),MyEventNetworkingProfile=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"me",e))}return _inherits(t,OneEventNetworkingProfile),_createClass(t,[{key:"checkAccess",value:function(e,t){var n=this;return isVoid(this.event_id)&&(this.event_id=t),OneEventNetworkingProfile.fetchProfile(this.event_id,"me",e).then(function(e){return n.setData(e),e},function(e){isVoid(e.response)})}},{key:"redeemAccess",value:function(e,n,i){var a=this;return isVoid(this.event_id)&&(this.event_id=i),t.redeemEventAccess(this.event_id,"me",e,n).then(function(e){return a.setData(e),e})}},{key:"update",value:function(e){return isVoid(e)||this.setData(e),t.updateProfile(this.event_id,{first_name:this.first_name,last_name:this.last_name,avatar_url:this.avatar_url,info:this.info,looking_for:this.looking_for,vk_url:this.vk_url,facebook_url:this.facebook_url,twitter_url:this.twitter_url,linkedin_url:this.linkedin_url,telegram_url:this.telegram_url,instagram_url:this.instagram_url,github_url:this.github_url,company_name:this.company_name})}}],[{key:"updateProfile",value:function(e,t){return __APP.SERVER.addData(OneEventNetworkingProfile.profilePath(e,"me"),t)}},{key:"redeemEventAccess",value:function(e,t,n,i){return __APP.SERVER.getData(OneEventNetworkingProfile.profilePath(e,t),{fields:i,code:n})}}]),t}(),MyNetworkingProfile=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"me"))}return _inherits(t,OneNetworkingProfile),_createClass(t,[{key:"update",value:function(e){return isVoid(e)||this.setData(e),t.updateProfile(this.event_id,{first_name:this.first_name,last_name:this.last_name,avatar_url:this.avatar_url,info:this.info,looking_for:this.looking_for,vk_url:this.vk_url,facebook_url:this.facebook_url,twitter_url:this.twitter_url,linkedin_url:this.linkedin_url,telegram_url:this.telegram_url,instagram_url:this.instagram_url,github_url:this.github_url,company_name:this.company_name})}}],[{key:"updateProfile",value:function(e){return __APP.SERVER.addData(OneNetworkingProfile.profilePath("me"),e,!0)}}]),t}(),OneNetworkingRequest=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.uuid=setDefaultValue(e,null),n.sender_user_id=null,n.recipient_user_id=null,n.message=null,n.status=null,n.accept_status=null,n.accepted_at=null,n.created_at=null,n.updated_at=null,n}return _inherits(t,OneEntity),t}(),OneEventNetworkingRequest=function(e){function t(e,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return i.event_id=setDefaultValue(e,null),i}return _inherits(t,OneNetworkingRequest),_createClass(t,[{key:"create",value:function(e){var n=this;return isVoid(e)||this.setData(_extends({},e,{recipient_user_id:e.user_id||e.recipient_user_id})),t.createRequest(this.event_id,this.recipient_user_id,this.message).then(function(e){return n.uuid=e instanceof Array?e[0].uuid:e,n})}},{key:"revokeRequest",value:function(){var e=this;return t.updateRequest(this.event_id,this.uuid,{status:!1}).then(function(t){return e.status=!1,t})}},{key:"cancelRequest",value:function(){var e=this;return t.updateRequest(this.event_id,this.uuid,{accept_status:!1}).then(function(t){return e.accept_status=!1,t})}},{key:"acceptRequest",value:function(){var e=this;return t.updateRequest(this.event_id,this.uuid,{accept_status:!0}).then(function(t){return e.accept_status=!0,t})}},{key:"fetch",value:function(e){var n=this;return t.fetchRequest(this.event_id,this.uuid,{fields:e}).then(function(e){return n.setData(e),e})}}],[{key:"createRequest",value:function(e,n,i){return __APP.SERVER.addData(t.requestsPath(e),{recipient_user_id:n,message:i})}},{key:"updateRequest",value:function(e,n,i){return __APP.SERVER.updateData(t.requestPath(e,n),i)}},{key:"revokeRequest",value:function(e,n){return __APP.SERVER.updateData(t.requestPath(e,n),{status:!1})}},{key:"fetchRequest",value:function(e,n,i){return __APP.SERVER.getData(t.requestPath(e,n),i)}}]),t}();OneEventNetworkingRequest.requestPath=function(e,t){return"/api/v1/events/"+e+"/networking/requests/"+t},OneEventNetworkingRequest.requestsPath=function(e){return"/api/v1/events/"+e+"/networking/requests/"},EventAllOrdersCollection=extending(AbstractEventOrdersCollection,function(){function e(e){AbstractEventOrdersCollection.call(this,e)}return e.fetchOrders=function(e,t,n){return __APP.SERVER.getData("/api/v1/statistics/events/"+e+"/orders",t,n)},e.prototype.export=function(e){return(new ServerExports).eventOrders(this.event_id,e)},e}()),EventMyOrdersCollection=extending(AbstractEventOrdersCollection,function(){function e(e){AbstractEventOrdersCollection.call(this,e)}return e.fetchOrders=function(e,t,n){return __APP.SERVER.getData("/api/v1/events/"+e+"/orders",t,n)},e}()),MyOrdersCollection=extending(OrdersCollection,function(){function e(){ExtendedOrdersCollection.call(this)}return e.fetchOrders=function(e){return __APP.SERVER.getData(OrdersCollection.ENDPOINT.ORDER,e)},e.prototype.fetch=function(t,n,i){var a=this;return e.fetchOrders({fields:t||void 0,offset:this.length||void 0,length:n||void 0,order_by:i||void 0}).then(function(e){return a.setData(e),a.__last_pushed})},e.prototype.fetchAll=function(t,n){var i=this;return e.fetchOrders({fields:t||void 0,offset:0,length:ServerConnection.MAX_ENTITIES_LENGTH,order_by:n||void 0}).then(function(e){return i.setData(e),i.__last_pushed})},e}()),RegistrationField=extending(OneEntity,function(){function e(){var e=this;this.form_field_uuid=null,this.form_field_label=null,this.form_field_type=null,this.form_field_type_id=null,this.form_field_required=null,this.value=null,this.values=[],this.created_at=null,this.updated_at=null,Object.defineProperties(this,{uuid:{get:function(){return e.form_field_uuid},set:function(t){return e.form_field_uuid=t}},label:{get:function(){return e.form_field_label},set:function(t){return e.form_field_label=t}},type:{get:function(){return e.form_field_type},set:function(t){return e.form_field_type=t}},required:{get:function(){return e.form_field_required},set:function(t){return e.form_field_required=t}}})}return e.prototype.ID_PROP_NAME="form_field_uuid",e.TYPES=RegistrationFieldModel.TYPES,e.DEFAULT_LABEL=RegistrationFieldModel.DEFAULT_LABEL,e.isCustomField=RegistrationFieldModel.isCustomField,e}()),RegistrationFieldsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this),Object.defineProperties(this,{__types:{value:{},writable:!0,enumerable:!1,configurable:!1}}),this.emptyAdditionalLookup(),Object.freeze(this.__types)}return e.prototype.collection_of=RegistrationField,e.prototype.createAdditionalLookup=function(e){e instanceof RegistrationField&&this.__types[e.type].push(e)},e.prototype.emptyAdditionalLookup=function(){for(var e in RegistrationFieldModel.TYPES)RegistrationFieldModel.TYPES.hasOwnProperty(e)&&(this.__types[RegistrationFieldModel.TYPES[e]]=[]);return this},e}()),OnePromocode=extending(PromocodeModel,function(){function e(e,t){PromocodeModel.call(this),this.event_id=setDefaultValue(e,null),this.uuid=setDefaultValue(t,null)}return e.fetchPromocodebyCodeName=function(e,t,n,i,a){return __APP.SERVER.getData("/api/v1/events/"+e+"/promocodes",{code:t,fields:n},i,a)},e.prototype.fetchPromocodebyCodeName=function(t,n,i,a){var r=this;return e.fetchPromocodebyCodeName(this.event_id,t,n,function(e){r.setData(e),isFunction(i)&&i.call(r,e)},a)},e}()),SearchResults=extending(OneEntity,function(){function e(e){this.query_string=e,this.events=new EventsCollection,this.organizations=new OrganizationsCollection}return e.sanitizeQueryVar=function(e){var t={};return 0===e.indexOf("#")?t.tags=e.replace("#",""):t.q=e,t},e.fetchEventsAndOrganizations=function(t,n,i){return __APP.SERVER.getData("/api/v1/search/",$.extend({},e.sanitizeQueryVar(t),n),i)},e.prototype.fetchEvents=function(t,n){var i=this,a={fields:"events"+JSON.stringify($.extend({},__APP.SERVER.validateData(t),{offset:this.events.length}))};return e.fetchEventsAndOrganizations(i.query_string,a,function(e){i.setData(e),n&&"function"==typeof n&&n.call(i,e.events)})},e.prototype.fetchOrganizations=function(t,n){var i=this,a={fields:"organizations"+JSON.stringify($.extend({},__APP.SERVER.validateData(t),{offset:this.organizations.length}))};return e.fetchEventsAndOrganizations(i.query_string,a,function(e){i.setData(e),n&&"function"==typeof n&&n.call(i,e.organizations)})},e.prototype.fetchEventsAndOrganizations=function(t,n,i){var a=this,r={fields:new Fields("search_score"),order:"-search_score"};return t&&r.fields.push({events:$.extend({},__APP.SERVER.validateData(t),{offset:this.events.length})}),n&&!e.sanitizeQueryVar(a.query_string).tags&&r.fields.push({organizations:$.extend({},__APP.SERVER.validateData(n),{offset:this.organizations.length})}),e.fetchEventsAndOrganizations(a.query_string,r,function(e){a.setData(e),isFunction(i)&&i.call(a,e)})},e}()),OneExtendedOrder=extending(OneOrder,function(){function e(e,t){OneOrder.call(this,e,t),this.event=new OneEvent(this.event_id)}return e.convertToExtended=function(e,t){var n;return e.orders&&e.orders instanceof Array?(n=e.orders.reduce(function(e,n){return empty(e)&&n.uuid===t?n:e},{})).event=e:n=null,n},e.fetchOrder=function(t,n,i){return n=Fields.parseFields(n),OneEvent.fetchEvent(event_id,new Fields($.extend(!0,{},n.pull("event"),{orders:{filters:"uuid="+t,fields:n}})),function(n){isFunction(i)&&i(e.convertToExtended(n[0],t))}).then(function(n){return e.convertToExtended(n[0],t)})},e}()),ExtendedOrdersCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this),Object.defineProperties(this,{__events_length:{writable:!0,value:0}})}return e.prototype.collection_of=OneExtendedOrder,e.convertToExtendedOrders=function(e){return e.reduce(function(e,t){return e.concat(t.orders?t.orders.reduce(function(e,n){return n.event=t,e.push(n),e},[]):[])},[])},e.convertFieldsToAjaxData=function(e){var t,n={};return(e=e?Fields.parseFields(e):new Fields).has("event")&&(n=e.pull("event")),t=new Fields({orders:{fields:e}}),n.fields?(n.fields=Fields.parseFields(n.fields),n.fields.push(t)):n.fields=t,n},e}()),OneConversionStatistic=extending(OneAbstractStatistic,function(){return function(){OneAbstractStatistic.call(this),this.to=null,this.with=null}}()),ConversionStatisticsCollection=extending(AbstractStatisticsCollection,function(){function e(e){AbstractStatisticsCollection.call(this,e)}return e.prototype.collection_of=OneConversionStatistic,e.prototype.fetch=function(e,t,n,i){},e}()),Statistics=function(){function e(){this.id=0,this.entity=null,this.view=[],this.fave=[],this.unfave=[],this.notifications_sent=[],this.dynamics={view:[],fave:[]}}return e.prototype.setData=function(e){return $.extend(!0,this,e instanceof Array?e[0]:e)},e.SCALES={MINUTE:"minute",HOUR:"hour",DAY:"day",WEEK:"week",MONTH:"month",YEAR:"year",OVERALL:"overall"},e.ENTITIES={EVENT:"events",ORGANIZATION:"organizations"},e.fetchStatistics=function(e,t,n,i,a,r,s){var o={scale:n,fields:[]};switch(a instanceof Array?o.fields=o.fields.concat(a):$.each(a,function(e,t){Object.getOwnPropertyNames(t).length?o.fields.push(e+JSON.stringify(t)):o.fields.push(e)}),r&&o.fields.push("dynamics"+JSON.stringify(__APP.SERVER.validateData(r))),void 0===i?"undefined":_typeof(i)){case"string":i&&(o.since=i);break;case"object":i.since&&(o.since=i.since),i.till&&(o.till=i.till);break;default:case"boolean":}return __APP.SERVER.getData("/api/v1/statistics/"+e+"/"+t,o,s)},e.prototype.fetchStatistics=function(t,n,i,a,r){var s=this;return e.fetchStatistics(this.entity,this.id,t,n,i,a,function(e){s.setData(e),r&&"function"==typeof r&&r.call(s,e)})},e}(),EventStatistics=extending(Statistics,function(){return function(e){Statistics.apply(this),this.id=e,this.entity=Statistics.ENTITIES.EVENT,this.open_site=[],this.view_detail=[],this.open_conversion=[],this.fave_conversion=[],this.dynamics.fave_conversion=[],this.dynamics.open_conversion=[]}}()),OrganizationsStatistics=extending(Statistics,function(){return function(e){Statistics.apply(this),this.id=e,this.entity=Statistics.ENTITIES.ORGANIZATION,this.subscribe=[],this.unsubscribe=[],this.conversion=[],this.audience={},this.dynamics.subscribe=[],this.dynamics.conversion=[]}}()),OneUTMStat=extending(OneEntity,function(){function e(){var e=this;OneEntity.call(this),this.utm_source=null,this.utm_medium=null,this.utm_campaign=null,this.utm_content=null,this.utm_term=null,this.open_count=null,this.tickets_count=null,this.orders_count=null,this.orders_sum=null,Object.defineProperty(this,"uuid",{get:function(){return CryptoJS.MD5([e.utm_source,e.utm_medium,e.utm_campaign,e.utm_content,e.utm_term].clean().join("-")).toString()}})}return e.prototype.ID_PROP_NAME="uuid",e}()),UTMStatsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneUTMStat,e.ENDPOINT=Object.freeze({UTM:"/statistics/events/{event_id}/utm"}),e.fetchEventUTMStats=function(t,n){return __APP.SERVER.getData(e.ENDPOINT.UTM.format({event_id:t}),n)},e}()),EventUTMStatsCollection=extending(UTMStatsCollection,function(){function e(e){UTMStatsCollection.call(this),Object.defineProperty(this,"event_id",{value:e})}return e.prototype.fetch=function(e,t,n){var i=this;return UTMStatsCollection.fetchEventUTMStats(this.event_id,{fields:e||void 0,offset:this.length,length:t||void 0,order_by:n||void 0}).then(function(e){return i.setData(e),i.__last_pushed})},e}()),EventAllTicketsCollection=extending(AbstractEventTicketsCollection,function(){function e(e){AbstractEventTicketsCollection.call(this,e)}return e.fetchTickets=function(e,t,n){return t=t||{},__APP.SERVER.getData("/api/v1/statistics/events/"+e+"/tickets",t,n)},e.prototype.export=function(e){return(new ServerExports).eventTickets(this.event_id,e)},e}()),EventMyTicketsCollection=extending(AbstractEventTicketsCollection,function(){function e(e){AbstractEventTicketsCollection.call(this,e)}return e.fetchTickets=function(e,t,n){return __APP.SERVER.getData("/api/v1/events/"+e+"/tickets",t,n)},e}()),SearchEventTicketsCollection=extending(EventAllTicketsCollection,function(){function e(e,t){EventAllTicketsCollection.call(this,t),this.query_string=e}return e.fetchTickets=function(e,t,n,i){return n=n||{},$.isNumeric(e)?n.number=e:n.user_name=e,EventAllTicketsCollection.fetchTickets(t,n,i)},e.prototype.fetchTickets=function(t,n,i,a){var r=this;return e.fetchTickets(this.query_string,this.event_id,{fields:t||void 0,offset:this.length,length:n||void 0,order_by:i||void 0},function(e){r.setData(e),isFunction(a)&&a.call(r,r.__last_pushed)})},e}()),OneExtendedTicket=extending(OneTicket,function(){function e(e,t){OneTicket.call(this,e,t)}return e.prototype.ID_PROP_NAME="uuid",e.TICKET_STATUSES=$.extend({USED:"used"},OneOrder.EXTENDED_ORDER_STATUSES),e.createFrom=function(t,n){var i=new e;return i.setData($.extend(!0,{event:n},t)),i},e.extractTicketFromData=function(e){return e.map(function(e){var t=1===e.tickets.length?e.tickets.shift():e.tickets,n=t.order,i=t.ticket_type;return!n&&e.orders&&(n=e.orders.reduce(function(e,n){return e||n.uuid===t.ticket_order_uuid&&n},!1)),!i&&e.ticket_types&&(i=e.ticket_types.reduce(function(e,n){return e||n.uuid===t.ticket_type_uuid&&n},!1)),$.extend(t,{event:e,order:n,ticket_type:i})})},e.extractTicketFromEvent=function(t){var n=new OneEvent,i=new e(t.id);return n.setData(t),i.setData($.extend(n.tickets[0],{event:n,event_id:n.id,order:n.orders.getByID(n.tickets[0].ticket_order_uuid)})),i},e.fetchTicket=function(e,t,n){var i;return n=Fields.parseFields(n),i=$.extend(!0,{},n.pull("event"),{fields:new Fields({tickets:{filters:"uuid="+t,fields:n}})}),__APP.SERVER.getData(OneEvent.ENDPOINT.EVENT.format({event_id:e}),i)},e.exportTicket=OneTicket.exportTicket,e.prototype.fetch=function(t){var n=this;return e.fetchTicket(this.event_id,this.uuid,t).then(function(t){var i=e.extractTicketFromData(t);return n.setData(i),i})},e}()),ExtendedTicketsCollection=extending(EntitiesCollection,function(){function e(){EntitiesCollection.call(this)}return e.prototype.collection_of=OneExtendedTicket,e.convertTicketFieldsToEventAjaxData=function(e){var t,n={};return(e=e?Fields.parseFields(e):new Fields).has("event")&&(n=e.pull("event")),t=new Fields({tickets:{fields:e}}),n.fields?(n.fields=Fields.parseFields(n.fields),n.fields.push(t)):n.fields=t,n},e.extractTicketsFromEvent=function(t){var n=new OneEvent,i=new e;return n.setData(t),i.setData(n.tickets.map(function(e){return $.extend({},e,{event_id:n.id,event:n})})),i},e.getGreenTickets=function(e){return e.filter(function(e){return OneOrder.isGreenStatus(e.status_type_code)})},e}()),EventsExtendedTicketsCollection=extending(ExtendedTicketsCollection,function(){function e(e){ExtendedTicketsCollection.call(this),Object.defineProperty(this,"event_id",{value:e})}return e.fetchTickets=function(e,t,n){return OneEvent.fetchEvent(e,ExtendedTicketsCollection.convertTicketFieldsToEventAjaxData(t).fields,n)},e.prototype.fetchTickets=function(t,n,i,a){var r=this;return e.fetchTickets(this.event_id,t).then(function(e){return r.setData(ExtendedTicketsCollection.extractTicketsFromEvent(e)),isFunction(a)&&a.call(r,r.__last_pushed),r.__last_pushed})},e}()),MyTicketsCollection=extending(ExtendedTicketsCollection,function(){function e(){ExtendedTicketsCollection.call(this)}return e.fetchTickets=function(e,t){e=e||{};var n=ExtendedTicketsCollection.convertTicketFieldsToEventAjaxData(e.fields);return __APP.SERVER.getData("/api/v1/events",$.extend(n,{length:e.length,offset:e.offset,registered:!0}),t)},e.prototype.fetchTickets=function(t,n,i,a){var r=this;return e.fetchTickets({fields:t||void 0,offset:this.length,length:n||void 0,order_by:i||void 0}).then(function(e){return r.setData(e.map(ExtendedTicketsCollection.extractTicketsFromEvent).reduce(function(e,t){return e.push.apply(e,t),e},[])),isFunction(a)&&a.call(r,r.__last_pushed),r.__last_pushed})},e}()),CurrentUser=extending(OneUser,function(){function e(){if("object"===_typeof(e.instance))return e.instance;OneUser.call(this,"me"),this.selected_city=new OneCity,this.friends=new UsersCollection,this.friends_activities=new t,e.instance=this}var t=extending(UsersActivitiesCollection,function(){function e(){}return e.fetch=function(e,t){return e=UsersActivitiesCollection.setDefaultData(e),e.fields=e.fields.merge(["user"]),__APP.SERVER.getData("/api/v1/users/feed",e,t)},e}());return e.fetchFriends=function(e,t){return __APP.SERVER.getData("/api/v1/users/friends",e,t)},e.prototype.fetchUser=function(e,t){var n=this,i=OneUser.fetchUser("me",e),a=function(e){return e=e instanceof Array?e[0]:e,n.setData(e),isFunction(t)&&t.call(n,e),e};return(e=setDefaultValue(e,[])).hasOwnProperty("friends")?Promise.all([i,this.fetchFriends(e.friends)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];return n=n instanceof Array?n[0]:n,n.friends=i,a(n)}):i.then(a)},e.prototype.fetchFriends=function(t,n){var i=this;return e.fetchFriends(_extends({},t,{offset:this.friends.length})).then(function(e){return i.friends.setData(e),isFunction(n)&&n.call(i,i.friends.__last_pushed),i.friends.__last_pushed})},e.prototype.auth=function(e,t){if(__APP.YA_METRIKA&&__APP.YA_METRIKA.reachGoal(e.toUpperCase()+"AuthStart"),t)try{window.localStorage.setItem("redirect_after_auth",t)}catch(e){}isNotDesktop()&&!__APP.IS_WIDGET?window.location.href=__APP.AUTH_URLS[e]:window.open(__APP.AUTH_URLS[e],e.toUpperCase()+"_AUTH_WINDOW","status=1,toolbar=0,menubar=0&height=500,width=700")},e.prototype.logout=function(){$.ajax({url:"/index.php",data:{logout:!0},complete:function(){window.location="/"}})},e.prototype.isLoggedOut=function(){return-1===this.id},e.prototype.subscribeToOrganization=function(e,t){var n=this;return n.subscriptions.has(e)?(console.warn("Current user is already subscribed to this organization"),null):(OneOrganization.fetchOrganization(e,n.subscriptions_fields,function(e){n.subscriptions.push(e[0]),t&&"function"==typeof t&&t.call(n,e)}),OneOrganization.subscribeOrganization(e))},e.prototype.unsubscribeFromOrganization=function(e,t){var n=this;return n.subscriptions.has(e)?OneOrganization.unsubscribeOrganization(e,function(){n.subscriptions.remove(e),t&&"function"==typeof t&&t.call(n,e)}):(console.warn("Current user isn`t subscribed to this organization"),null)},e}()),OrganizationSubscribersCollection=extending(UsersCollection,function(){function e(e){UsersCollection.call(this),Object.defineProperty(this,"organization_id",{value:e})}return e.fetchSubscribers=function(e,t,n){return t=t||{},__APP.SERVER.getData("/api/v1/organizations/"+e,{fields:new Fields({subscribed:t})},function(e){isFunction(n)&&n(e[0].subscribed)}).then(function(e){return e[0].subscribed})},e.prototype.fetchSubscribers=function(t,n,i,a){var r=this;return e.fetchSubscribers(this.organization_id,{fields:t||void 0,offset:this.length||void 0,length:n||void 0,order_by:i||void 0},function(e){r.setData(e),isFunction(a)&&a.call(r,r.__last_pushed)}).then(function(){return r.__last_pushed})},e.prototype.fetchAllSubscribers=function(t,n,i){var a=this;return e.fetchSubscribers(this.organization_id,{fields:t||void 0,offset:0,length:ServerConnection.MAX_ENTITIES_LENGTH,order_by:n||void 0},function(e){a.setData(e),isFunction(i)&&i.call(a,a.__last_pushed)}).then(function(){return a.__last_pushed})},e.prototype.export=function(e){return(new ServerExports).organizationSubscribers(this.organization_id,e)},e}()),Builder=function(){function e(){if("object"===_typeof(e.instance))return e.instance;e.instance=this}return e.normalizeBuildProps=function(e,t,n,i){return e=e||{},t?t.push("classes"):t=["classes"],n?n.push("dataset"):n=["dataset"],i?i.push("attributes"):i=["attributes"],t.forEach(function(t){e[t]=e[t]?"string"==typeof e[t]?e[t].split(" "):e[t]:[],e[t].toString=Array.toSpaceSeparatedString}),n.forEach(function(t){e[t]=e[t]?e[t]:{},e[t].toString=Array.isArray(e[t])?Array.toSpaceSeparatedString:Object.toHtmlDataSet}),i.forEach(function(t){e[t]=e[t]?e[t]:{},e[t].toString=Array.isArray(e[t])?Array.toSpaceSeparatedString:Object.toHtmlAttributes}),e},e.prototype.text=function(){return tmpl("span",Array.prototype.slice.call(arguments).map(e.normalizeBuildProps))},e.prototype.button=function(){var t=Array.prototype.slice.call(arguments);return tmpl("button",t.map(function(t){var n=e.normalizeBuildProps(t);return n.classes.push(__C.CLASSES.COMPONENT.BUTTON),n})).each(function(e,n){var i=t[e],a=$(n);i.dataset&&a.data(i.dataset),i.classes&&i.classes.contains(__C.CLASSES.HOOKS.RIPPLE)&&(bindRippleEffect(a),a.addClass(__C.CLASSES.HOOKS.HANDLED+__C.CLASSES.HOOKS.RIPPLE))})},e.prototype.input=function(t,n,i){return tmpl("input",e.normalizeBuildProps({classes:n,attributes:t,dataset:i})).each(function(e,t){i&&$(t).data(i)})},e.prototype.inputNumber=function(e,t,n,i){return e=$.extend({},e),t=t?t instanceof Array?t:t.split(","):[],n=n||{},this.input(e,t.concat("form_input"),n).inputmask($.extend({alias:"numeric",autoGroup:!1,digits:2,digitsOptional:!0,allowPlus:!1,allowMinus:!1,rightAlign:!1},i))},e.prototype.select=function(t,n,i,a,r){var s;return t.unshift({id:"-1",attributes:["hidden"]}),s=tmpl("select",e.normalizeBuildProps({options:__APP.BUILD.option(t),classes:i,attributes:n,dataset:a})),a&&s.data(a),s.val(r||"-1"),s},e.prototype.dateSelect=function(t,n,i,a,r,s){var o=tmpl("date-select",e.normalizeBuildProps({name:t,label:n,value:i,attributes:a||{},classes:r||[],dataset:s||{}}));return new DatePicker(o,s||{}).init(),o.addClass("-Handled_DatePicker"),o},e.prototype.textarea=function(t,n,i,a){return tmpl("textarea",e.normalizeBuildProps({value:i,classes:n,attributes:t,dataset:a})).each(function(e,t){a&&$(t).data(a)})},e.prototype.externalLink=function(t){return tmpl("external-link",[].map.call(arguments,function(t){return e.normalizeBuildProps(t)}))},e.prototype.link=function(t){return bindPageLinks(tmpl("link",[].map.call(arguments,function(t){var n=e.normalizeBuildProps(t);return n.classes.push(__C.CLASSES.COMPONENT.LINK,__C.CLASSES.HOOKS.LINK),n})))},e.prototype.linkButton=function(t){return bindPageLinks(tmpl("link",[].map.call(arguments,function(t){var n=e.normalizeBuildProps(t);return n.classes.push(__C.CLASSES.COMPONENT.BUTTON,__C.CLASSES.HOOKS.LINK),n})))},e.prototype.actionLink=function(t){return bindPageLinks(tmpl("link",[].map.call(arguments,function(t){var n=e.normalizeBuildProps(t);return n.classes.push(__C.CLASSES.COMPONENT.ACTION,__C.CLASSES.HOOKS.LINK),n})))},e.prototype.actionButton=function(t){var n=t instanceof Array?t:[].slice.call(arguments);return tmpl("button",n.map(function(t){var n=e.normalizeBuildProps(t);return n.classes.push(__C.CLASSES.COMPONENT.ACTION),n})).each(function(e){$(this).data(n[e].dataset)})},e.prototype.helpLink=function(t,n,i,a,r){var s=e.normalizeBuildProps({title:n,classes:i,dataset:a,attributes:r});return s.dataset.article_id=t,s.classes.push("HelpLink"),bindHelpLink(tmpl("help-link",s))},e.prototype.stamp=function(t,n){return tmpl("stamp",Object.assign({text:t},e.normalizeBuildProps(n)))},e.prototype.option=function(t){var n=t instanceof Array?t:arguments;return tmpl("option",[].map.call(n,function(t){return e.normalizeBuildProps(t)})).each(function(e,t){n[e].dataset&&$(t).data(n[e].dataset)})},e.prototype.switch=function(t,n,i,a,r,s){var o=e.normalizeBuildProps({id:t,name:n,attributes:a,classes:r,dataset:s});return i?o.attributes.checked=i:delete o.attributes.checked,o.attributes.tabindex=o.attributes.tabindex?o.attributes.tabindex:-1,tmpl("switch",o)},e.prototype.radioCheckbox=function(t,n){if("checkbox"===t||"radio"===t)return(n=e.normalizeBuildProps(n,["unit_classes"],["unit_dataset"])).classes.contains("form_"+t)||n.classes.unshift("form_"+t),n.unit_classes.contains("form_"+t+"_wrapper")||n.unit_classes.unshift("form_"+t+"_wrapper"),n.unit_classes.contains("form_unit")||n.unit_classes.unshift("form_unit"),n.attributes.checked||delete n.attributes.checked,n.attributes.tabindex=n.attributes.tabindex?n.attributes.tabindex:-1,tmpl("radio-checkbox",$.extend(n,{type:t}));throw Error('Принимаемый аргумент type может быть либо "radio" либо "checkbox", придурок')},e.prototype.radio=function(e){var t=this;return $.makeSet([].map.call(arguments,function(e){return t.radioCheckbox("radio",e)}))},e.prototype.checkbox=function(e){var t=this,n=e instanceof Array?e:arguments;return $.makeSet([].map.call(n,function(e){return t.radioCheckbox("checkbox",e)}))},e.prototype.radioGroup=function(t){var n,i=this,a=$.extend({},e.normalizeBuildProps(t));return a.units instanceof jQuery||(a.units=i.radio.apply(i,a.units.map(function(e){var t=$.extend(e,{name:a.name});return t.id||(t.id=guid()),t}))),(n=tmpl("radio-group",a)).data(t.dataset),n},e.prototype.formHelpText=function(t,n,i){return tmpl("form-helptext",e.normalizeBuildProps({text:t,dataset:n,attributes:i}))},e.prototype.formUnit=function(t){var n=this,i=["hidden","text","search","tel","url","email","password","date","time","number","range","color","checkbox","radio","file","submit","image","reset","button"];return $.makeSet(Array.prototype.map.call(arguments,function(t){switch(t.type){case"radio":return n.radio(t);case"checkbox":return n.checkbox(t);default:return tmpl("form-unit",e.normalizeBuildProps({unit_classes:t.unit_classes||[],label:t.label?tmpl("label",e.normalizeBuildProps({id:t.id,label:t.label,classes:t.label_classes,dataset:t.label_dataset})):"",helptext:t.helptext?n.formHelpText(t.helptext,t.helptext_dataset,t.helptext_attributes):"",form_element:function(e){var t=e.classes?e.classes instanceof Array?e.classes:e.classes.split(","):[],a={id:e.id,name:e.name,required:e.required?e.required:void 0,readonly:e.readonly?e.readonly:void 0,placeholder:e.placeholder,tabindex:e.tabindex};switch(e.type){case"date":return n.dateSelect(e.name,e.value?moment(e.value).format(__LOCALE.DATE.DATE_FORMAT):"Дата",e.value,$.extend({},e.attributes,{required:e.required?e.required:void 0}),t,e.dataset);case"textarea":return n.textarea($.extend({},e.attributes,a),t.concat("form_textarea"),e.value,e.dataset);case"time":return n.input($.extend({},e.attributes,a,{value:null!=e.value?e.value:void 0,placeholder:"23:59"}),t.concat("form_input","-time_input"),e.dataset).inputmask("hh:mm",{insertMode:!1,clearIncomplete:!0,placeholder:"  :  ",greedy:!1,showMaskOnHover:!1});case"switch":return n.switch(e.id,e.name,e.checked,$.extend({required:e.required?e.required:void 0,placeholder:e.placeholder,tabindex:e.tabindex},e.attributes),e.classes,e.dataset);case"number":return n.inputNumber($.extend({},e.attributes,a,{autocomplete:"off",value:empty(e.value)?void 0:e.value}),t,e.dataset,e.inputmask);case"select":return n.select(e.values,mergeObjects({},e.attributes,a,!0,!0),t.concat("form_select"),e.dataset,e.value);default:return n.input($.extend({},e.attributes,a,{type:e.type&&-1!==i.indexOf(e.type)?e.type:"text",value:null!=e.value?e.value:void 0}),t.concat("form_input"),e.dataset)}}(t)},["unit_classes"]))}}))},e.prototype.cap=function(t,n){return tmpl("cap",$.extend({message:t},e.normalizeBuildProps(n||{})))},e.prototype.overlayCap=function(t,n){return tmpl("overlay-cap",$.extend({content:t},e.normalizeBuildProps(n||{})))},e.prototype.tags=function(t,n){function i(e){return $.extend(!0,{},{name:e.name.toLowerCase(),page:"/search/tag/"+encodeURIComponent(e.name.toLowerCase())},n)}return n=e.normalizeBuildProps(n),t instanceof Array?tmpl("tag",t.map(i)):tmpl("tag",i(t))},e.prototype.orderStatusBlock=function(e){return tmpl("order-status",{name:localeFromNamespace(e,OneOrder.EXTENDED_ORDER_STATUSES,__LOCALE.TEXTS.TICKET_STATUSES),status:function(e){switch(!0){case OneOrder.isGreenStatus(e):return"success";case OneOrder.isYellowStatus(e):return"warning";case OneOrder.isRedStatus(e):return"error"}}(e)})},e.prototype.loaderBlock=function(e,t){return tmpl("loader-block",{loader:tmpl("loader")},e,t)},e.prototype.floatingLoader=function(e,t){return tmpl("loader-block",{classes:"-loader_floating",loader:tmpl("loader")},e,t)},e.prototype.overlayLoader=function(e,t){return tmpl("loader-block",{classes:"-loader_overlay",loader:tmpl("loader")},e,t)},e.prototype.fields=function(e){var t;return t=1===arguments.length?[e]:[].slice.call(arguments),$.makeSet(t.map(function(e){return e instanceof Array?tmpl("fields-wrapper",{classes:"-columns_"+e.length,fields:tmpl("field",e)}):tmpl("field",e)}))},e.prototype.pairList=function(e){return tmpl("pair-list",{pairs:tmpl("pair-list-unit",e instanceof Array?e:Object.keys(e).reduce(function(t,n){return t.push({key:n,value:e[n]}),t},[]))})},e.prototype.socialLinks=function(t,n){var i=[],a={VK:"vk",GOOGLE:"google-plus",FACEBOOK:"facebook-official"};return $.each(OneUser.ACCOUNTS,function(r,s){var o={slug:s,icon_slug:a[r]};t.hasOwnProperty(s)?(o.html_tag="a",o.attributes={href:t[s],target:"_blank"}):o.html_tag="span",i.push(e.normalizeBuildProps($.extend(o,n)))}),tmpl("user-social-links-wrapper",{links:tmpl("user-social-link",i)})},e.prototype.shareLinks=function(e,t){return t=t instanceof Array?t:[t],this.externalLink.apply(this,t.map(function(t){return{page:getByValue(t,__C.SOCIAL_NETWORKS,__C.SHARE_LINK).format(e),classes:["share_icon",t]}})).on("click",function(e){return window.open(this.href,"share","height=570,width=650,status=yes,toolbar=no,menubar=no"),e.preventDefault(),!1})},e.prototype.userTombstones=function(t,n){var i=this;return(n=e.normalizeBuildProps(n,["avatar_classes","tombstone_classes"])).avatar_classes.push("-rounded"),n.avatar_classes.push("-size_"+(n.size?n.size:"70x70")),n.is_link?(n.html_tag="a",n.tombstone_classes.push("link Link")):n.html_tag="div",tmpl("user-tombstone",(t instanceof Array?t:[t]).map(function(e){return n.is_link&&(n.attributes.href="/user/"+e.id),$.extend(!0,{},e,{avatar:i.avatars(e,{classes:n.avatar_classes}),name:e.full_name?e.full_name:[e.first_name,e.last_name].join(" ")},n)}))},e.prototype.avatarBlocks=function(t,n){var i=this;return(n=e.normalizeBuildProps(n,["avatar_classes","block_classes"])).is_link?(n.html_tag="a",n.block_classes.push("link","Link")):n.html_tag="div",tmpl("avatar-block",(t instanceof Array?t:[t]).map(function(e){var t,a;return n.entity&&n.entity===__C.ENTITIES.USER||e instanceof OneUser||e.first_name?(t=e.full_name?e.full_name:e.first_name+" "+e.last_name,a="/user/"+e.id):(t=e.short_name?e.short_name:e.name,a="/organization/"+e.id),$.extend(!0,{id:e.id,avatar:i.avatars(e,{classes:n.avatar_classes}),attributes:{href:a},name:t},n)}))},e.prototype.staffAvatarBlocks=function(e,t,n,i){var a=this;return tmpl("staff-avatar-block",t.map(function(e){return{avatar_block:a.avatarBlocks(e,n),can_edit:i?"-can_edit":""}})).each(function(e,i){var a={user:t[e]};n&&n.dataset&&$.extend(a,n.dataset),$(i).data(a)}).find(".RemoveStaff").on("click.RemoveStaff",function(){var t=$(this).closest(".StaffAvatarBlock"),n=t.data("user"),i=tmpl("staff-avatar-block-removing",{username:[n.first_name,n.last_name].join(" ")});OneOrganization.removeStaff(e,n.id,n.role).then(function(){t.after(i),t.detach(),i.find(".ReturnStaff").on("click",function(){OneOrganization.addStaff(e,n.id,n.role).then(function(){i.after(t),i.remove()})})})}).end()},e.prototype.addUserAvatarBlock=function(t,n,i){var a;switch((i=e.normalizeBuildProps(i,["avatar_classes","block_classes"])).block_classes.push("link",__C.CLASSES.HOOKS.ADD_STAFF,__C.CLASSES.HOOKS.CALL_MODAL),n){case OneUser.ROLE.ADMIN:a="Добавить администратора";break;case OneUser.ROLE.MODERATOR:a="Добавить модератора"}return tmpl("avatar-block",$.extend({html_tag:"div",name:a,avatar:tmpl("avatar",{classes:i.avatar_classes,avatar_url:window.location.origin+"/app/img/add_user.svg"})},i)).data({modal_type:"add_staff",modal_org_id:t,modal_role:n})},e.prototype.avatars=function(t,n){function i(e){return $.extend(!0,{avatar_url:e.avatar_url,name:e.full_name?e.full_name:e.first_name+" "+e.last_name},n)}function a(e){return $.extend(!0,{avatar_url:e.img_small_url?e.img_small_url:e.img_url,name:e.short_name?e.short_name:e.name},n)}var r,s=function(){};if(!(!t||t instanceof Array&&!t.length)){switch(n=e.normalizeBuildProps(n),!0){case t instanceof OneUser:case t instanceof UsersCollection:s=i;break;case t instanceof OneOrganization:case t instanceof OrganizationsCollection:s=a;break;default:s=(t instanceof Array?t:[t])[0].avatar_url?i:a}return r=t instanceof Array?t:[t],tmpl("avatar",r.map(s))}},e.prototype.avatarCollection=function(t,n,i,a){var r=e.normalizeBuildProps(i,["counter_classes"]),s=n;return r.dataset.max_amount=n,r.classes.push("-max_"+n),r.avatars=this.avatars(__APP.USER).add(this.avatars(t.filter(function(e){return __APP.USER.id!=e.id&&!(s--<=0)}))),r.more_avatars_count=(a||t.length)-n,r.more_avatars_count<=0&&r.counter_classes.push("-cast"),tmpl("avatars-collection",r)},e.prototype.activity=function(t,n){var i=this instanceof e?this:new e,a={};return a[OneAbstractActivity.TYPES.SUBSCRIBE]="plus",a[OneAbstractActivity.TYPES.FAVE]="star",a[OneAbstractActivity.TYPES.UNSUBSCRIBE]=a[OneAbstractActivity.TYPES.UNFAVE]="minus",(n=e.normalizeBuildProps(n,["avatar_classes"])).avatar_classes.push(__C.CLASSES.SIZES.X50,__C.CLASSES.UNIVERSAL_STATES.ROUNDED),tmpl("activity-block",(t instanceof Array?t:[t]).map(function(e){var t={},r=__LOCALES.ru_RU.TEXTS.ACTIVITY[OneAbstractActivity.TYPES_INDEX[e.type_code]];switch(!0){case e instanceof OneOrganizationActivity:t={entity:"organization",img_url:e.organization.img_small_url?e.organization.img_small_url:e.organization.img_url,entity_url:"/organization/"+e.organization.id,hero_text:e.organization.short_name};break;case e instanceof OneEventActivity:t={entity:"event",img_url:e.event.image_horizontal_small_url?e.event.image_horizontal_small_url:e.event.image_horizontal_url,entity_url:"/event/"+e.event.id,hero_text:e.event.title}}return $.extend(t,{creator_avatar:i.avatars(e.user,{classes:n.avatar_classes,is_link:n.avatar_is_link,badge:tmpl("avatar-badge",{icon_class:a[e.type_code]})}),type_code:e.type_code,additional_info:getGenderText(e.user.gender,r),creator_url:"/user/"+e.user.id,creator_name:e.user.full_name?e.user.full_name:e.user.first_name+" "+e.user.last_name,date:moment.unix(e.created_at).calendar(null,__LOCALES.ru_RU.DATE.CALENDAR_DATE_TIME)})}))},e.prototype.organizationItems=function(t,n){var i=this;return tmpl("organization-item",(t=t instanceof Array?t:[t]).map(function(e){return e.counter_classes=e.new_events_count?[]:[__C.CLASSES.HIDDEN],e}).map(function(t){return $.extend(!0,{avatar_block:i.avatarBlocks(t,{entity:__C.ENTITIES.ORGANIZATION,avatar_classes:[__C.CLASSES.SIZES.X30]})},t,e.normalizeBuildProps(n,["avatar_classes","block_classes","counter_classes"]))}))},e.prototype.organizationCard=function(e){var t=this;return tmpl("organization-card",e.map(function(e){return $.extend(!0,{},e,{background_image:e.background_small_img_url||e.background_img_url?t.link({page:"/organization/"+e.id,classes:["organization_unit_background"],attributes:{style:"background-image: url("+(e.background_small_img_url||e.background_img_url)+")"}}):"",avatar:t.avatars(e,{classes:["organization_unit_avatar",__C.CLASSES.SIZES.X55,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.SHADOWED]}),subscribe_button:new SubscribeButton(e.id,{is_checked:e.is_subscribed,colors:{unchecked:__C.CLASSES.COLORS.MARGINAL_ACCENT,unchecked_hover:__C.CLASSES.COLORS.MARGINAL_ACCENT},has_icons:!1,classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.RIPPLE]}),subscribed_text:e.subscribed_count+getUnitsText(e.subscribed_count,__LOCALES.ru_RU.TEXTS.SUBSCRIBERS),redact_org_button:e.role===OneUser.ROLE.UNAUTH||e.role===OneUser.ROLE.USER?"":t.link({classes:["button",__C.CLASSES.SIZES.LOW,__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PENCIL,__C.CLASSES.UNIVERSAL_STATES.EMPTY,__C.CLASSES.HOOKS.RIPPLE],page:"/admin/organization/"+e.id+"/edit"})})}))},e.prototype.eventBlocks=function(e,t){var n=this;return tmpl("event-block",e.map(function(e){var i=t.sort_date_type?t.sort_date_type:"nearest_event_date",a=moment.unix(e[i]?e[i]:e.first_event_date),r=t.last_date!==a.format(__C.DATE_FORMAT),s=[__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.SIZES.SMALL,__C.CLASSES.HOOKS.ADD_AVATAR.COLLECTION,__C.CLASSES.HOOKS.CALL_MODAL];return e.is_favorite&&s.push(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED),t.last_date=a.format(__C.DATE_FORMAT),$.extend({},e,{cover_width:550,divider:r?tmpl("divider",{title:a.calendar().capitalize()}):"",action_buttons:new AddToFavoriteButton(e,{is_add_avatar:!0,is_checked:e.is_favorite,classes:["event_block_main_action_button",__C.CLASSES.SIZES.LOW,__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.HOOKS.ADD_TO_FAVORITES,__C.CLASSES.HOOKS.RIPPLE]}),date:a.format(__C.DATE_FORMAT),avatars_collection:n.avatarCollection(e.favored,3,{dataset:{modal_type:"favors",modal_event_id:e.id},classes:s,counter_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CASTABLE]},e.favored_users_count),time:e.dates.reduce(function(e,t){return moment.unix(t.event_date).format(__C.DATE_FORMAT)===a.format(__C.DATE_FORMAT)&&e.push(displayTimeRange(t.start_time,t.end_time)),e},[]).join("; ")})}))},e.prototype.organisationsCategoriesItems=function(e){return e instanceof Array||(e=[e]),tmpl("organization-category",e.map(function(e){var t,n=[];return e.organizations&&e.organizations.new_events_count?n=(t=e.organizations.reduce(function(e,t){return e+t.new_events_count},0))?["counter"]:["counter",__C.CLASSES.HIDDEN]:(t="",n=[__C.CLASSES.HIDDEN]),{category_id:e.id,category_name:e.name,order_position:e.order_position,aside_classes:n,new_events_count:"+"+t}}))},e.prototype.subscribers=function(e,t){var n=this;return tmpl("subscriber",e.map(function(e,i){var a=void 0===t||t!==e.is_friend;return t=e.is_friend,{divider:a?tmpl("subscriber-divider",{label:e.is_friend?"Друзья":"Все подписчики"}):"",avatar_block:n.avatarBlocks(e,{is_link:!0,entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.UNIVERSAL_STATES.SHADOWED],block_classes:["subscriber"]})}}))},e.prototype.eventCards=function(e){var t,n=this,i=e instanceof Array?e:[e];return t=tmpl("event-card",i.map(function(e){var t=[__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.SIZES.SMALL,__C.CLASSES.HOOKS.ADD_AVATAR.COLLECTION,__C.CLASSES.HOOKS.CALL_MODAL],i=[],a=new OneOrganization(e.organization_id);return a.setData({short_name:e.organization_short_name,img_url:e.organization_logo_small_url}),e.is_favorite&&t.push(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED),i.push({text:displayDateRange(e.dates[0].event_date,e.dates[e.dates.length-1].event_date)+(e.is_same_time?", "+displayTimeRange(e.dates[0].start_time,e.dates[0].end_time):"")}),e.registration_required&&e.registration_till&&i.push({text:"Регистрация до "+moment.unix(e.registration_till).calendar().toLowerCase()}),e.is_free?i.push({text:"Бесплатно"}):i.push({text:"Цена от "+(e.min_price?formatCurrency(e.min_price):0)+" руб."}),$.extend(!0,{cover_width:405,organization_avatar_block:n.avatarBlocks(a,{block_classes:[__C.CLASSES.SIZES.SMALL],is_link:!0,entity:__C.ENTITIES.ORGANIZATION}),action_button:new AddToFavoriteButton(e,{is_add_avatar:!0,is_checked:e.is_favorite,classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.SIZES.WIDE,__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.HOOKS.RIPPLE]}),avatars_collection:n.avatarCollection(e.favored,4,{dataset:{modal_type:"favors",modal_event_id:e.id},classes:t,counter_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CASTABLE]},e.favored_users_count),feed_event_infos:tmpl("event-card-info",i),header_buttons:__APP.USER.isLoggedOut()?"":n.button({classes:["feed_event_header_button","feed_event_header_button_hide_event",__C.CLASSES.SIZES.LOW,__C.CLASSES.UNIVERSAL_STATES.EMPTY,"HideEvent"],dataset:{"event-id":e.id},title:"×"})},e)})),i.forEach(function(e,n){t.eq(n).appear(function(){storeStat(e.id,__C.STATS.EVENT_ENTITY,__C.STATS.EVENT_VIEW)},{accY:100})}),t},e.prototype.registrationFields=function(e){if(e instanceof RegistrationField)e=[e];else if(!(e instanceof Array))throw TypeError("Component builder accepts only RegistrationFieldsCollection, RegistrationField or array of RegistrationField object types");var t=$(),n=[],i=[RegistrationField.TYPES.EMAIL,RegistrationField.TYPES.PHONE_NUMBER,RegistrationField.TYPES.ADDITIONAL_TEXT,RegistrationField.TYPES.CUSTOM,RegistrationField.TYPES.SELECT,RegistrationField.TYPES.SELECT_MULTI,RegistrationField.TYPES.EXTENDED_CUSTOM];return(e.__types[RegistrationField.TYPES.FIRST_NAME].length||e.__types[RegistrationField.TYPES.LAST_NAME].length)&&(e.__types[RegistrationField.TYPES.LAST_NAME].length&&n.push({name:"Фамилия",value:e.__types[RegistrationField.TYPES.LAST_NAME][0].value}),e.__types[RegistrationField.TYPES.FIRST_NAME].length&&n.push({name:"Имя",value:e.__types[RegistrationField.TYPES.FIRST_NAME][0].value}),t=t.add(tmpl("fields-wrapper",{classes:2===n.length?"-columns_2":"",fields:tmpl("field",n)}))),t.add(tmpl("field",i.reduce(function(t,n){return n===RegistrationField.TYPES.FIRST_NAME||n===RegistrationField.TYPES.LAST_NAME?t:t.concat(e.__types[n].map(function(e){return{name:e.label||RegistrationField.DEFAULT_LABEL[n],value:function(e){switch(e.type){case RegistrationFieldModel.TYPES.SELECT:case RegistrationFieldModel.TYPES.SELECT_MULTI:return e.values&&e.values.length?e.values.map(function(e){return e.value}).join(", "):"—";default:return e.value||"—"}}(e)}}))},[])))},e.normalizeTicketProps=function(t){return(t instanceof Array?t:[t]).map(function(t){var n,i=e.normalizeBuildProps({card_classes:[],title:t.event.title,location:t.event.location,status_name:t.status_name,status_type_code:t.status_type_code,ticket_type_name:t.ticket_type.name,image_horizontal_url:t.event.image_horizontal_url,image_horizontal_large_url:t.event.image_horizontal_large_url||t.event.image_horizontal_url,image_horizontal_medium_url:t.event.image_horizontal_medium_url},["card_classes"]);switch(!0){case OneOrder.isGreenStatus(i.status_type_code):i.card_classes.push(__C.CLASSES.STATUS.SUCCESS);break;case OneOrder.isYellowStatus(i.status_type_code):i.card_classes.push(__C.CLASSES.STATUS.PENDING);break;case OneOrder.isRedStatus(i.status_type_code):i.card_classes.push(__C.CLASSES.STATUS.ERROR)}return i.card_classes.push(OneOrder.isDisabledStatus(i.status_type_code)?__C.CLASSES.DISABLED:__C.CLASSES.HOOKS.CALL_MODAL),t.event.is_same_time?(n=t.event.dates[0],i.formatted_dates="{date}, {time}".format({date:displayDateRange(n.event_date,t.event.dates[t.event.dates.length-1].event_date),time:displayTimeRange(n.start_time,n.end_time)})):(n=t.event.nearest_event_date,i.formatted_dates=displayDateRange(n,n)),i})},e.prototype.ticketCards=function(t){return tmpl("ticket-card",e.normalizeTicketProps(t).map(function(e){return e.cover_width=260,e})).each(function(e,n){$(n).data({modal_type:__C.MODAL_TYPES.TICKET,tickets:t[e]})})},e.prototype.modal=function(t){var n,i=e.normalizeBuildProps(t,["content_classes"]),a={modal_header:"",modal_type:i.type,modal_content:i.content,modal_classes:i.classes,modal_content_classes:i.content_classes,modal_footer:""};return i.header?a.modal_header=i.header:i.title&&(a.modal_header=tmpl("modal-header",{title:i.title,close_button:tmpl("button",{classes:["modal_destroy_button",__C.CLASSES.HOOKS.CLOSE_MODAL].join(" "),title:"×"})})),i.footer?a.modal_footer=i.footer:i.footer_buttons&&(a.modal_footer=tmpl("modal-footer",{footer_buttons:i.footer_buttons})),n=tmpl("modal",a),i.width&&n.width(i.width),i.height&&n.height(i.height),n},e}();var CreateNetworkingRequestModal=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={with_message:!1,fade_in:!0},n.inputs=[],n.modal=null,n.modal_wrapper=$(".ModalsWrapper").get(0),n.handleClickOutside=n.handleClickOutside.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentWillMount",value:function(){$("body").addClass("-open_modal")}},{key:"componentDidMount",value:function(){this.bindClickOutside(),this.setState({fade_in:!1})}},{key:"componentWillUnmount",value:function(){this.unbindClickOutside(),$("body").removeClass("-open_modal")}},{key:"bindClickOutside",value:function(){this.props.canHide||document.addEventListener("mousedown",this.handleClickOutside)}},{key:"unbindClickOutside",value:function(){this.props.canHide||document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"handleClickOutside",value:function(e){this.modal&&!this.modal.contains(e.target)&&this.setState({fade_in:!1},this.props.hideModalHandler)}},{key:"render",value:function(){var e=this,t=this.props.profile,n=this.state.with_message;return ReactDOM.createPortal(React.createElement("div",{className:"modal_unit material -floating_material "+(this.state.fade_in?"-faded":""),ref:function(t){return e.modal=t},style:{width:370}},React.createElement("header",{className:"modal_header"},React.createElement("span",null,"Отправка заявки"),React.createElement(RippleButton,{className:"modal_destroy_button CloseModal",onClick:function(t){e.props.hideModalHandler()}},"×")),React.createElement("div",{className:"modal_content"},React.createElement("header",{className:"create_networking_request_modal_head"},React.createElement("aside",{className:"create_networking_request_modal_head_side"},React.createElement(Avatar,{entity:t.user,className:new HtmlClassesArray(__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.SIZES.X55)})),React.createElement("div",{className:"create_networking_request_modal_head_body"},React.createElement("h5",{className:"create_networking_request_modal_title"},t.user.full_name),React.createElement("span",{className:"create_networking_request_modal_subtitle"},t.company_name))),n&&React.createElement("div",{className:"form_unit"},React.createElement("textarea",{className:"form_textarea",name:"message",placeholder:"Введите сообщение (необязательно)",ref:"message"})),React.createElement("div",{className:"form_group -parts_e_2"},React.createElement("div",{className:"form_unit"},n||React.createElement(Action,{className:"fa_icon fa-commenting",onClick:function(t){e.setState({with_message:!0})}},"Прикрепить сообщение")),React.createElement("div",{className:"form_unit"},React.createElement(RippleButton,{className:new HtmlClassesArray(__C.CLASSES.COLORS.ACCENT),onClick:function(i){t.request.create({event_id:t.event_id,user_id:t.user_id,sender_user_id:__APP.USER.id,message:n?e.refs.message.value:null}).then(function(t){return e.props.hideModalHandler(),t})}},"Отправить заявку"))))),this.modal_wrapper)}}]),t}();CreateNetworkingRequestModal.propTypes={profile:PropTypes.instanceOf(OneEventNetworkingProfile),canHide:PropTypes.bool,hideModalHandler:PropTypes.func},AppInspectorComponents=function(){function e(){if("object"===_typeof(e.instance))return e.instance;e.instance=this}return e.prototype.avatarBlock=function(e){return bindPageLinks(__APP.BUILD.avatarBlocks(e,{is_link:!0,entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X50,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}))},e.prototype.title=function(e){return tmpl("app-inspector-title",{title:e})},e.prototype.tickets=function(e,t){var n,i=e instanceof Array?e:[e];return(n=tmpl("app-inspector-ticket",i.map(function(e){return{fields:tmpl("fields-wrapper",[{classes:"-columns_2",fields:tmpl("field",[{name:"Номер",value:formatTicketNumber(e.number)},{name:"Цена",value:e.price?e.price:"Бесплатно"}])},{classes:"-field_big",fields:tmpl("field",{name:"Название",value:e.ticket_type.name})}]),footer:e.checkout?tmpl("app-inspector-ticket-footer"):""}}))).each(function(e,t){$(t).data("ticket_uuid",i[e].uuid).data("event_id",i[e].event_id)}),t&&n.on("click.OpenTicket",function(){var e=$(this),t=e.data("modal");t||(t=new TicketsModal({uuid:e.data("ticket_uuid"),event_id:e.data("event_id")}),e.data("modal",t)),t.show()}).addClass(__C.CLASSES.UNIVERSAL_STATES.CLICKABLE),n},e.prototype.event=function(e){return bindPageLinks(tmpl("app-inspector-event",e))},e}(),AbstractAppInspector=extendingJQuery(function(){function e(){var t=this;this.id=e.collection.push(this)-1,this.title=setDefaultValue(this.title,null),this.$content=setDefaultValue(this.$content,__APP.BUILD.loaderBlock()),this.is_fetched=!1,this.is_shown=!1,this.is_rendered=!1,jQuery.fn.init.call(this,tmpl("app-inspector",{id:this.id,title:this.title,content:this.$content})),this.find(".AppInspectorRemoveButton").on("click.CloseInspector",function(){t.callWithAncestors("hide")}),e.collection.length>5&&e.collection[0].destroy()}return e.$wrapper=$(".AppInspectorsWrapper"),e.collection=[],e.currentInspector=null,e.build=new AppInspectorComponents,e.hideCurrent=function(){e.currentInspector&&e.currentInspector.hide()},e.destroyAll=function(){e.collection.forEach(function(e){e.destroy()})},e.prototype.fetchData=function(){return Promise.resolve()},e.prototype.fetchDone=function(){},e.prototype.render=function(){return this.changeTitle(this.title),this.find(".AppInspectorContent").html(this.$content),this.is_rendered=!0,this.callWithAncestors("initiate"),this},e.prototype.initiate=function(){this.find(".AppInspectorScroll").scrollbar()},e.prototype.show=function(){var t=this;if(e.currentInspector){if(e.currentInspector===this)return this;e.currentInspector.hide()}e.$wrapper.append(this),setTimeout(function(){t.addClass(__C.CLASSES.SHOW)},100),e.currentInspector=this,this.is_shown=!0,this.is_fetched?this.is_rendered||this.callWithAncestors("render"):this.fetchData().then(function(){e.$wrapper.trigger("inspector:data_fetched"),t.fetchDone.apply(t,arguments),t.is_fetched=!0,t.is_rendered||t.callWithAncestors("render")})},e.prototype.changeTitle=function(e){return this.find(".AppInspectorTitle").html(e),this},e.prototype.hide=function(){return this.removeClass(__C.CLASSES.SHOW),e.currentInspector=null,e.$wrapper.trigger("inspector:hide"),this.is_shown=!1,this},e.prototype.destroy=function(){this.is_shown&&this.callWithAncestors("hide"),e.collection.splice(this.id,1),this.is_rendered=!1,this.remove()},e.prototype.callWithAncestors=function(t,n){return n=empty(n)?e:n,this instanceof n&&this[t]!==n.prototype[t]&&n.prototype[t].call(this),this[t]()},$("body").on("keyup.CloseCurrentAppInspector",function(t){isKeyPressed(t,__C.KEY_CODES.ESC)&&e.hideCurrent()}),Object.seal(e),e}()),ClientAppInspector=extending(AbstractAppInspector,function(){function e(e){this.client=e,this.title="Клиент",this.$interests_spiderweb_chart_container=$('<div class="SpiderWeb"></div>'),this.$content=tmpl("client-app-inspector",{client:AbstractAppInspector.build.avatarBlock(e),interests_title:AbstractAppInspector.build.title("Интересы"),interests_spiderweb_chart:this.$interests_spiderweb_chart_container}),AbstractAppInspector.call(this)}return e.prototype.initiate=function(){this.$interests_spiderweb_chart_container.highcharts({title:{text:!1},legend:{enabled:!1},tooltip:{pointFormatter:function(){return"<b>"+Math.roundTo(this.y,2)+"%</b>"}},chart:{backgroundColor:null,plotBorderWidth:null,plotShadow:!1,style:{fontFamily:"inherit",fontSize:"inherit"},polar:!0,type:"area",spacing:[0,0,0,0],width:364,height:340},plotOptions:{series:{states:{hover:{lineWidth:2}}},area:{fillOpacity:.5,marker:{enabled:!1,symbol:"circle",radius:2}}},colors:[__C.COLORS.FRANKLIN],pane:{size:"59%"},xAxis:{categories:this.client.interests.map(function(e){return e.topic_name}),tickmarkPlacement:"on",labels:{reserveSpace:!0,y:5},lineWidth:0},yAxis:{labels:!1,tickAmount:5,gridLineInterpolation:"polygon",lineWidth:0,min:0},series:[{data:this.client.interests.map(function(e){return e.value})}],credits:{enabled:!1}})},e}()),HelpAppInspector=extending(AbstractAppInspector,function(){function e(e){AbstractAppInspector.call(this),this.article_id=e}return e.prototype.fetchData=function(){return(new HelpCenterConnection).fetchArticle(this.article_id)},e.prototype.fetchDone=function(e){var t,n,i;this.$content=$('<div class="app_inspector_help_content_wrapper">'+e.content+"</div>"),this.title=$('<a class="link" href="'+e.link+'" target="_blank">'+e.title+"</a>"),t=this.$content.find("img"),n=this.$content.find("video"),i=this.$content.find("a"),this.$content.find('[style*="width"]').width("auto"),t.removeAttr("height"),n.removeAttr("height"),n.removeAttr("width"),i.attr("target","_blank")},e}()),NetworkingProfileAppInspector=extending(AbstractAppInspector,function(){return function(e){var t=e.user,n=e.company_name,i=e.info,a={vk_url:"vk",facebook_url:"facebook-official",twitter_url:"twitter",linkedin_url:"linkedin",telegram_url:"telegram",instagram_url:"instagram",github_url:"github"},r=["vk_url","facebook_url","twitter_url","linkedin_url","telegram_url","instagram_url","github_url"].reduce(function(t,n){return isVoid(e[n])||""===e[n]||(t[n]=e[n]),t},{}),s=Object.keys(r);this.profile=e,this.title=t.full_name,this.$content=tmpl("networking-profile-app-inspector",{avatar:__APP.BUILD.avatars(t,{classes:[__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),full_name:t.full_name,company_name:n,info:i||"-",contacts:s.length?tmpl("app-inspector-contact",s.map(function(e){return{icon_class:a[e],url:r[e]}})):"Нет контактов"}),AbstractAppInspector.call(this)}}()),OrderAppInspector=extending(AbstractAppInspector,function(){return function(e,t){var n=this;this.order=e,this.event=t,this.title="Заказ "+formatTicketNumber(this.order.number),this.$content=tmpl("order-app-inspector",{orderer:AbstractAppInspector.build.avatarBlock(this.order.user),payment_info:function(){var e=[];switch(n.order.status_type_code){case OneOrder.ORDER_STATUSES.PAYED:case OneOrder.ORDER_STATUSES.PAYED_LEGAL_ENTITY:return e.push({key:"Сумма заказа",value:formatCurrency(n.order.sum," ",".","","₽")}),n.order.promocode&&e.push({key:"Промокод",value:n.order.promocode.code},{key:"Скидка с промокода",value:formatCurrency(n.order.promocode.effort," ",".","",n.order.promocode.is_fixed?"₽":"%")}),e.push({key:"Итоговая сумма",value:formatCurrency(n.order.final_sum," ",".","","₽")},{key:"Способ оплаты",value:OneOrder.PAYMENT_PROVIDERS_TEXT[n.order.payment_type].toLowerCase()},{key:"Комиссия за способ оплаты",value:formatCurrency(n.order.final_sum-n.order.shop_sum_amount," ",".","","₽")}),AbstractAppInspector.build.title("Оплата").add(__APP.BUILD.pairList(e));default:return""}}(),sources:function(){var e=[];if(!empty(n.order.utm))for(var t in n.order.utm)n.order.utm.hasOwnProperty(t)&&e.push({key:t,value:n.order.utm[t]});return e.length?AbstractAppInspector.build.title("Источники").add(__APP.BUILD.pairList(e)):""}(),status_block:__APP.BUILD.orderStatusBlock(this.order.status_type_code),tickets_title:AbstractAppInspector.build.title("Билеты"),tickets:AbstractAppInspector.build.tickets(this.order.tickets),registration_form_title:AbstractAppInspector.build.title("Анкета регистрации"),registration_fields:__APP.BUILD.registrationFields(this.order.registration_fields),event_title:AbstractAppInspector.build.title("Событие"),event:AbstractAppInspector.build.event(this.event)}),AbstractAppInspector.call(this)}}()),AvatarBlocks.propTypes={entities:PropTypes.oneOfType([PropTypes.instanceOf(UsersCollection),PropTypes.instanceOf(OrganizationsCollection),PropTypes.arrayOf(PropTypes.instanceOf(OneUser)),PropTypes.arrayOf(PropTypes.instanceOf(OneOrganization)),PropTypes.instanceOf(OneUser),PropTypes.instanceOf(OneOrganization)]).isRequired,entity:PropTypes.oneOf([__C.ENTITIES.USER,__C.ENTITIES.ORGANIZATION]),avatarClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string),PropTypes.instanceOf(HtmlClassesArray)]),className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),isLink:PropTypes.bool},AvatarBlock.propTypes={entity:PropTypes.oneOfType([PropTypes.instanceOf(OneUser),PropTypes.instanceOf(OneOrganization)]).isRequired,entityType:PropTypes.oneOf([__C.ENTITIES.USER,__C.ENTITIES.ORGANIZATION]),avatarClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string),PropTypes.instanceOf(HtmlClassesArray)]),className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),isLink:PropTypes.bool};var AvatarCollectionContextProvider=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={is_subscribed:e.isSubscribed},n}return _inherits(t,React.Component),_createClass(t,[{key:"getChildContext",value:function(){var e=this;return _defineProperty({},t.CONTEXT_NAME,{isSubscribed:this.state.is_subscribed,subscribe:function(){e.setState({is_subscribed:!0})},unsubscribe:function(){e.setState({is_subscribed:!1})}})}},{key:"render",value:function(){return React.Children.map(this.props.children,function(e){return e})}}]),t}();AvatarCollectionContextProvider.CONTEXT_NAME="__avatar_collection__",AvatarCollectionContextProvider.propTypes={isSubscribed:PropTypes.bool},AvatarCollectionContextProvider.childContextTypes=_defineProperty({},AvatarCollectionContextProvider.CONTEXT_NAME,PropTypes.shape({isSubscribed:PropTypes.bool,subscribe:PropTypes.func,unsubscribe:PropTypes.func}));var AvatarCollection=function(e){function t(e,n){_classCallCheck(this,t);var i=e.maxCount,a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.avatars=[__APP.USER].concat(_toConsumableArray(e.users.filter(function(e){return __APP.USER.id!==parseInt(e.id)&&i-- >0}))),a}return _inherits(t,React.Component),_createClass(t,[{key:"getWidth",value:function(){var e=this.avatars.length;return this.context[AvatarCollectionContextProvider.CONTEXT_NAME].isSubscribed&&e<this.props.maxCount?1===e?30*e:30*e-6*(e-1):1===e?0:30*(e-1)-6*(e-2)}},{key:"render",value:function(){var e=this.props,t=e.users,n=e.overallAvatarsCount,i=e.className,a=e.counterClasses,r=e.maxCount,s=_objectWithoutProperties(e,["users","overallAvatarsCount","className","counterClasses","maxCount"]),o=new HtmlClassesArray("avatars_collection","-max_"+r,"-trimmed"),l=(n||t.length)-r,c=l<=0;return this.context[AvatarCollectionContextProvider.CONTEXT_NAME].isSubscribed&&o.push(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED),o.push(i),React.createElement(React.Fragment,null,React.createElement("div",_extends({className:o,style:{width:this.getWidth()}},s),React.createElement(Avatars,{entities:this.avatars})),React.createElement("span",{className:"counter "+new HtmlClassesArray(a)+" "+(c?"-cast":"")},"+",l))}}]),t}();AvatarCollection.propTypes={users:PropTypes.oneOfType([PropTypes.instanceOf(UsersCollection),PropTypes.arrayOf(PropTypes.instanceOf(OneUser))]).isRequired,maxCount:PropTypes.number.isRequired,overallAvatarsCount:PropTypes.number,className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),counterClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string),PropTypes.instanceOf(HtmlClassesArray)])},AvatarCollection.contextTypes=AvatarCollectionContextProvider.childContextTypes,Avatars.propTypes={entities:PropTypes.oneOfType([PropTypes.instanceOf(UsersCollection),PropTypes.instanceOf(OrganizationsCollection),PropTypes.instanceOf(OneUser),PropTypes.instanceOf(OneOrganization),PropTypes.arrayOf(PropTypes.instanceOf(OneUser)),PropTypes.arrayOf(PropTypes.instanceOf(OneOrganization))]).isRequired,className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)])},Avatar.propTypes={entity:PropTypes.oneOfType([PropTypes.instanceOf(OneUser),PropTypes.instanceOf(OneOrganization)]).isRequired,className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),badgeClass:PropTypes.oneOf(["plus","minus","star"])};var Dropdown=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={click_pos:{X:0,Y:0},opened:!1},n.open=n.open.bind(n),n.close=n.close.bind(n),n.handleClickOutside=n.handleClickOutside.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.state.opened&&this.bindClickOutside()}},{key:"componentWillUnmount",value:function(){this.unbindClickOutside()}},{key:"open",value:function(e){var t=this;this.setState({opened:!0,click_pos:{X:e.pageX,Y:e.pageY}},function(){t.bindClickOutside()})}},{key:"close",value:function(e){var t=this;this.setState({opened:!1},function(){t.unbindClickOutside(),t.setState({click_pos:{X:0,Y:0}})})}},{key:"bindClickOutside",value:function(){this.props.isDismissOnOuterClick&&document.addEventListener("mousedown",this.handleClickOutside)}},{key:"unbindClickOutside",value:function(){this.props.isDismissOnOuterClick&&document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"handleClickOutside",value:function(e){this.dropdown&&!this.dropdown.contains(e.target)&&this.close()}},{key:"getPos",value:function(){var e=window.outerWidth,t=this.state.click_pos,n=t.X,i=t.Y,a=void 0,r=void 0;return this.dropdown?(r=this.dropdown.offsetWidth,a=e<n+r/2?e-r:n-r/2,{left:a,top:i+25}):{}}},{key:"render",value:function(){var e=this,t=this.props,n=t.renderControl,i=t.renderDropdown,a=t.children,r=this.state.opened;return React.createElement(React.Fragment,null,n(r,this.open,this.close),a,ReactDOM.createPortal(React.createElement("div",{className:"dropdown_box "+(r?"-show":""),ref:function(t){return e.dropdown=t},style:this.getPos()},i(this.close)),document.body))}}]),t}();Dropdown.propTypes={renderControl:PropTypes.func.isRequired,renderDropdown:PropTypes.func.isRequired,isDismissOnOuterClick:PropTypes.bool},EventBlock.propTypes={event:PropTypes.instanceOf(OneEvent).isRequired,date:PropTypes.moment.isRequired,hasDivider:PropTypes.bool,coverWidth:PropTypes.number};var EventBlocks=componentsContainer(EventBlock,{entity_name:"event",entities_name:"events",CollectionClass:EventsCollection,noEntities:function(){return React.createElement(Cap,null,i18n(__S.NO_EVENTS))},renderEntities:function(e){var t=this.props,n=t.coverWidth,i=t.sortDateType,a=void 0===i?"nearest_event_date":i,r=void 0;return e.map(function(e){var t=moment.unix(e[a]||e.first_event_date),i=t.format(__C.DATE_FORMAT),s=r!==i;return r=i,React.createElement(EventBlock,{key:e.id,event:e,date:t,coverWidth:n,hasDivider:s})})}});EventBlocks.propTypes={events:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.instanceOf(OneEvent)),PropTypes.instanceOf(EventsCollection)]).isRequired,sortDateType:PropTypes.string,coverWidth:PropTypes.number},PageLink.propTypes={href:PropTypes.string.isRequired,children:PropTypes.oneOfType([PropTypes.string,PropTypes.node,PropTypes.element])};var Tabs=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={selected_tab:e.selectedTab||null},n.changeTab=n.changeTab.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"changeTab",value:function(e){this.setState(function(t){return t.selected_tab!==e?{selected_tab:e}:null})}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,i=t.headerClasses,a=t.bodyWrapperClasses,r=(t.selectedTab,_objectWithoutProperties(t,["className","headerClasses","bodyWrapperClasses","selectedTab"])),s=React.Children.toArray(this.props.children);return React.createElement("div",_extends({className:new HtmlClassesArray(n)+" Tabs"},r),React.createElement("header",{className:new HtmlClassesArray(i)+" tabs_header HeaderTabs"},s.map(function(t){return React.createElement("span",{key:t.props.name,className:"tab Tab "+(t.props.name===e.state.selected_tab?"-active":""),onClick:function(){return e.changeTab(t.props.name)}},t.props.title)})),React.createElement("div",{className:new HtmlClassesArray(a)+" tab_bodies_wrap TabsBodyWrapper"},s.map(function(t){return React.createElement("div",{className:"tab_body TabsBody "+(t.props.name===e.state.selected_tab?"-active":""),key:t.props.name},t.props.children)})))}}]),t}();Tabs.propTypes={className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),headerClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string),PropTypes.instanceOf(HtmlClassesArray)]),bodyWrapperClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string),PropTypes.instanceOf(HtmlClassesArray)]),selectedTab:PropTypes.string};var Tab=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),t}();Tab.propTypes={title:PropTypes.string.isRequired,name:PropTypes.string.isRequired},UserActivity.propTypes={user:PropTypes.instanceOf(OneUser).isRequired,activity:PropTypes.instanceOf(OneAbstractActivity).isRequired,avatarClasses:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)])},UserActivity.AVATAR_BADGE_ICON=(_UserActivity$AVATAR_={},_defineProperty(_UserActivity$AVATAR_,OneAbstractActivity.TYPES.SUBSCRIBE,"plus"),_defineProperty(_UserActivity$AVATAR_,OneAbstractActivity.TYPES.UNSUBSCRIBE,"minus"),_defineProperty(_UserActivity$AVATAR_,OneAbstractActivity.TYPES.FAVE,"star"),_defineProperty(_UserActivity$AVATAR_,OneAbstractActivity.TYPES.UNFAVE,"minus"),_UserActivity$AVATAR_),UserActivity.ACTION_TEXT=(_UserActivity$ACTION_={},_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.SUBSCRIBE,__S.USER_SUBSCRIBED_TO_ORG),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.UNSUBSCRIBE,__S.USER_UNSUBSCRIBED_FROM_ORG),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.FAVE,__S.USER_FAVORED_EVENT),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.UNFAVE,__S.USER_UNFAVORED_EVENT),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.SHARE_VK,__S.USER_SHARED_EVENT),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.SHARE_FB,__S.USER_SHARED_EVENT),_defineProperty(_UserActivity$ACTION_,OneAbstractActivity.TYPES.SHARE_TW,__S.USER_SHARED_EVENT),_UserActivity$ACTION_);var UserActivities=componentsContainer(UserActivity,{entity_name:"activity",entities_name:"activities",CollectionClass:UsersActivitiesCollection,noEntities:function(){return React.createElement(Cap,null,i18n(__S.NO_ACTIVITIES))}});UserActivities.propTypes={user:PropTypes.instanceOf(OneUser).isRequired,activities:PropTypes.oneOfType([PropTypes.instanceOf(UsersActivitiesCollection),PropTypes.arrayOf(PropTypes.instanceOf(OneAbstractActivity))]).isRequired};var UserPage=asyncPage({constructPage:function(e){var t=e.user_id,n=void 0===t?__APP.USER.id:t;return{user:new OneUser(n)}},fetchData:function(e){return e.user.fetchUser(new Fields("type","is_friend","link","accounts","accounts_links",{friends:{fields:["is_friend"],length:4},subscriptions:{fields:["img_small_url"],length:4,order_by:["organization_type_order","organization_type_id"]}}))},pageTitle:function(e){return e.user.full_name}},function(e){function t(e){var n,i;_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.disable_uploads=(n={},_defineProperty(n,__C.ENTITIES.EVENT,!1),_defineProperty(n,__C.ENTITIES.ACTIVITY,!1),n),a.block_scroll=(i={},_defineProperty(i,__C.ENTITIES.EVENT,!1),_defineProperty(i,__C.ENTITIES.ACTIVITY,!1),i),a.active_tab=__C.ENTITIES.EVENT,a.favored_fetch_data={fields:new Fields("image_horizontal_medium_url","favored_users_count","is_favorite","is_registered","registration_locally","registration_available","ticketing_locally","ticketing_available","dates",{favored:{length:5}}),order_by:"nearest_event_date,-first_event_date",length:10},a}return _inherits(t,React.Component),_createClass(t,null,[{key:"SidebarWrapper",value:function(e){var t=e.user,n=e.title,i=e.noEntitiesText,a=e.entities,r=e.entitiesType,s=e.showAllModalClass;if(a.length){var o=[__C.CLASSES.SIZES.X30];return r===__C.ENTITIES.USER&&o.push(__C.CLASSES.UNIVERSAL_STATES.ROUNDED),React.createElement("div",{className:"user_page_sidebar_wrapper"},React.createElement("span",{className:"sidebar_section_heading"},n),React.createElement(AvatarBlocks,{isLink:!0,entities:a.slice(0,4),entity:r,avatarClasses:o}),React.createElement("footer",{className:"user_page_sidebar_footer"},React.createElement(Button,{className:__C.CLASSES.COLORS.NEUTRAL_ACCENT,onClick:function(e){rippleEffectHandler(e),this.modal||(this.modal=new s(t)),this.modal.show()}},i18n(__S.SHOW_ALL))))}return React.createElement("div",{className:"user_page_sidebar_wrapper"},React.createElement("span",{className:"sidebar_section_heading"},n),React.createElement("div",{className:"cap"},React.createElement("span",{className:"cap_message"},i)))}}]),_createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.user,n=[];t.actions.length||n.push(this.uploadEntities(__C.ENTITIES.ACTIVITY)),t.favored.length||n.push(this.uploadEntities(__C.ENTITIES.EVENT)),n.length?Promise.race(n).then(function(){e.bindScrollEvents()}):this.bindScrollEvents()}},{key:"componentWillUnmount",value:function(){this.unbindScrollEvents()}},{key:"fetchActivities",value:function(){return this.props.user.actions.fetch(new Fields("organization","event","type_code","created_at"),20,"-created_at")}},{key:"fetchFavoredEvents",value:function(){return this.props.user.fetchFavored(this.favored_fetch_data)}},{key:"uploadEntities",value:function(e){var t=this,n=this.disable_uploads[e],i=void 0;if(this.block_scroll[e]||n)return Promise.resolve();switch(e){case __C.ENTITIES.EVENT:this.favored_events.setLoadingState(),i=this.fetchFavoredEvents();break;case __C.ENTITIES.ACTIVITY:this.activities.setLoadingState(),i=this.fetchActivities();break;default:return Promise.resolve()}return this.block_scroll[e]=!0,i.then(function(n){switch(t.block_scroll[e]=!1,n.length||(t.disable_uploads[e]=!0),e){case __C.ENTITIES.EVENT:return t.favored_events.unsetLoadingState().update();case __C.ENTITIES.ACTIVITY:return t.activities.unsetLoadingState().update()}return n})}},{key:"unbindScrollEvents",value:function(){$(window).off("scroll.uploadEntities")}},{key:"bindScrollEvents",value:function(){var e=this,t=$(window);switch(this.unbindScrollEvents(),this.tabs.state.selected_tab){case __C.ENTITIES.EVENT:case __C.ENTITIES.ACTIVITY:isScrollRemain(1e3)&&this.uploadEntities(this.tabs.state.selected_tab),t.on("scroll.uploadEntities",function(){isScrollRemain(1e3)&&e.uploadEntities(e.tabs.state.selected_tab)});default:return Promise.resolve()}}},{key:"render",value:function(){var e=this,n=this.props.user,i=t.SidebarWrapper,a=__APP.USER.id!==parseInt(n.id);return contentWrap(React.createElement("div",{className:"user_page_wrapper "+(a?"-another_user":"-this_user")},React.createElement("div",{className:"page user_page_sidebar"},React.createElement("header",{className:"user_page_sidebar_header"},React.createElement(UserTombstones,{users:n,avatarClasses:[__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.UNIVERSAL_STATES.SHADOWED]}),React.createElement("div",{className:"user_page_social_links"},React.createElement(SocialLinks,{links:n.accounts_links,className:__C.CLASSES.UNIVERSAL_STATES.ROUNDED})),!a&&React.createElement(Button,{className:__C.CLASSES.COLORS.NEUTRAL_ACCENT,onClick:function(e){rippleEffectHandler(e),__APP.USER.logout()}},i18n(__S.LOGOUT))),React.createElement(i,{user:n,title:i18n(__S.USER_SUBSCRIBED_TO_ORG,n.subscriptions.length,{},{gender:n.gender}),noEntitiesText:i18n(__S.NO_SUBSCRIPTIONS),entities:n.subscriptions,entitiesType:__C.ENTITIES.ORGANIZATION,showAllModalClass:SubscriptionsListModal}),!a&&React.createElement(i,{user:n,title:i18n(__S.USER_SUBSCRIBED_TO_USER,n.friends.length,{},{gender:n.gender}),noEntitiesText:i18n(__S.NO_FRIENDS),entities:n.friends,entitiesType:__C.ENTITIES.USER,showAllModalClass:FriendsListModal})),React.createElement(Tabs,{ref:function(t){return e.tabs=t},className:"page user_page_content",headerClasses:"user_page_content_header -color_accent",selectedTab:"event"},React.createElement(Tab,{title:i18n(__S.ACTIVITY,1),name:"activity"},React.createElement(UserActivities,{ref:function(t){return e.activities=t},user:n,activities:n.actions})),React.createElement(Tab,{title:i18n(__S.FAVORED_EVENT,2),name:"event"},React.createElement(EventBlocks,{ref:function(t){return e.favored_events=t},events:n.favored})))))}}]),t}()),MyProfilePage=asyncPage({constructPage:function(){return{user:__APP.USER}},fetchData:function(e){return e.user.friends.length?Promise.resolve():e.user.fetchFriends({fields:new Fields("is_friend"),length:4})},pageTitle:"Мой профиль"},function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.favored_fetch_data.fields.push("is_favorite"),n}return _inherits(t,UserPage.OriginPage),t}()),NoReactPage=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){__APP.HISTORY=this.props.history,__APP.IS_REACT_PAGE=!0,__APP.init()}},{key:"componentWillUpdate",value:function(){__APP.CURRENT_PAGE.destroy(),__APP.init()}},{key:"componentWillUnmount",value:function(){__APP.CURRENT_PAGE.destroy(),$("#app_page_root").html("")}},{key:"render",value:function(){return null}}]),t}();AbstractTopBar=function(){function e(){this.$main_header=$("#main_header"),this.$page_title=this.$main_header.find("#page_title"),this.$tabs_wrapper=this.$main_header.find(".HeaderTabsWrapper"),this.is_tabs_rendered=!1}return e.prototype.init=function(){var e=this.$main_header.find(".TopBarOverlay"),t=e.find(".TopBarSearchButton"),n=e.find(".TopBarSearchInput");t.on("click.OpenSearchBar",function(){e.hasClass("-open_search_bar")?__APP.changeState("/search/"+encodeURIComponent(n.val())):(e.addClass("-open_search_bar"),n.focus())}),n.on("keypress",function(e){13===e.which&&(0===n.val().indexOf("#")?__APP.changeState("/search/tag/"+encodeURIComponent(n.val().replace("#",""))):__APP.changeState("/search/"+encodeURIComponent(n.val())))}).on("keydown",function(t){27===t.keyCode&&(e.removeClass("-open_search_bar"),n.val(""))}).on("blur",function(){""===n.val()&&e.removeClass("-open_search_bar")}),this.$main_header.find(".SidebarBurger").add($(".MainSectionCap")).on("click",function(){$("body").toggleClass("-open_sidebar")}),bindRippleEffect(this.$main_header),bindPageLinks(this.$main_header)},e.prototype.showTabs=function(){this.is_tabs_rendered=!0,this.$main_header.addClass("-with_tabs")},e.prototype.hideTabs=function(){this.is_tabs_rendered=!1,this.$main_header.removeClass("-with_tabs")},e.prototype.renderHeaderTabs=function(e){return empty(e)?null:(e=e instanceof Array?e:[e],this.$tabs_wrapper.html(tmpl("tabs-header",{color:"default",tabs:__APP.BUILD.link.apply(__APP.BUILD,e.map(function(e){var t=Builder.normalizeBuildProps(e);return t.classes.push("tab","Tab"),window.location.pathname.contains(t.page)&&t.classes.push(__C.CLASSES.ACTIVE),t}))})),bindTabs(this.$tabs_wrapper,!1),bindPageLinks(this.$tabs_wrapper),this)},e.prototype.changeTitle=function(e){bindPageLinks(this.$page_title.html(function(){return e instanceof jQuery?e:("string"==typeof e&&(e=e.split(" > ")),e instanceof Array?e.reduce(function(e,t,n){return n&&(e=e.add('<span class="title_chunk fa_icon fa-angle-right -empty"></span>')),"object"===(void 0===t?"undefined":_typeof(t))?e.add('<a href="'+t.page+'" class="title_chunk link Link">'+t.title+"</a>"):e.add('<span class="title_chunk">'+t+"</span>")},$()):null)}))},e}(),TopBar=extending(AbstractTopBar,function(){function e(){AbstractTopBar.call(this)}return e.prototype.init=function(){AbstractTopBar.prototype.init.call(this)},e}()),TopBarNoAuth=extending(AbstractTopBar,function(){function e(){AbstractTopBar.call(this)}return e.prototype.init=function(){this.$main_header.find(".LoginButton").on("click",function(){cookies.removeItem("auth_command"),cookies.removeItem("auth_entity_id"),new AuthModal(location.href,{note:"Войдите и получите свою персонализированную ленту событий"}).show()}),AbstractTopBar.prototype.init.call(this)},e}()),AbstractSidebar=function(){function e(){this.$sidebar=$("#main_sidebar"),this.$subscribed_orgs=this.$sidebar.find(".SidebarOrganizationsList"),this.$nav_items=this.$sidebar.find(".SidebarNavItem")}return e.prototype.init=function(){this.$sidebar.find(".SidebarNav").addClass("-items_"+this.$nav_items.not(".-hidden").length),this.$sidebar.find(".SidebarScroll").scrollbar()},e.prototype.updateSubscriptions=function(){},e.prototype.activateNavItem=function(e){e=e||window.location.pathname,this.$nav_items.removeClass(__C.CLASSES.ACTIVE).filter(function(){return 0===e.indexOf(this.getAttribute("href"))}).addClass(__C.CLASSES.ACTIVE)},e}(),Sidebar=extending(AbstractSidebar,function(){function e(){AbstractSidebar.call(this)}return e.prototype.init=function(){var e=this;e.updateSubscriptions(),$(window).on("subscribe unsubscribe",function(){e.updateSubscriptions()}),AbstractSidebar.prototype.init.call(this)},e.prototype.updateSubscriptions=function(){var e=this.$subscribed_orgs,t=0,n=$.map(e.children(),function(e){return $(e).data("organization_id")}),i=__APP.USER.subscriptions.filter(function(e){return-1===n.indexOf(e.id)}),a=n.filter(function(e){return!__APP.USER.subscriptions.has(e)});i.length&&(__APP.BUILD.organizationItems(i,{block_classes:["animated"],avatar_classes:["-size_30x30"]})[e.length?"prependTo":"appendTo"](e).each(function(e,n){setTimeout(function(){$(n).addClass("-show")},t+=100)}),bindPageLinks(e)),a.length&&a.forEach(function(t){var n=e.find('.organization_item[data-organization_id="'+t+'"]').removeClass("-show");setTimeout(function(){n.remove()},500)})},e}()),SidebarNoAuth=extending(AbstractSidebar,function(){function e(){AbstractSidebar.call(this)}return e.prototype.init=function(){this.$sidebar.find(".SidebarOrganizationsScroll").addClass(__C.CLASSES.HIDDEN),AbstractSidebar.prototype.init.call(this)},e}());var ReactActionButton=function(e){function t(e,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={is_checked:e.isChecked,is_hovered:!1},i.labels=null===e.labels?t.DEFAULTS.labels:_extends({},i.constructor.DEFAULTS.labels,e.labels),i.colors=null===e.colors?t.DEFAULTS.colors:_extends({},i.constructor.DEFAULTS.colors,e.colors),i.icons=null===e.icons?t.DEFAULTS.icons:_extends({},i.constructor.DEFAULTS.icons,e.icons),i.mouseHoverHandler=i.mouseHoverHandler.bind(i),i.mouseLeaveHandler=i.mouseLeaveHandler.bind(i),i.checkedStateChange=i.checkedStateChange.bind(i),i.onClickHandler=i.onClickHandler.bind(i),i.clickAction=i.clickAction.bind(i),Object.defineProperties(i,{classes:{get:function(){var e=new HtmlClassesArray(this.props.className);return empty(this.icons[this.current_state])||e.push(__C.CLASSES.ICON_CLASS,this.icons[this.current_state]),empty(this.colors[this.current_state])||e.push(this.colors[this.current_state]),e}},current_state:{get:function(){switch(!0){case this.state.is_checked&&this.state.is_hovered:return t.STATES.CHECKED_HOVER;case this.state.is_checked&&!this.state.is_hovered:return t.STATES.CHECKED;case!this.state.is_checked&&this.state.is_hovered:return t.STATES.UNCHECKED_HOVER;case!this.state.is_checked&&!this.state.is_hovered:return t.STATES.UNCHECKED}}}}),i}return _inherits(t,React.Component),_createClass(t,[{key:"showAuthModal",value:function(){var e=this.modal;return e||(e=new AuthModal(null,{note:"Для выполнения этого действия, нужно войти через социальную сеть"}),this.modal=e),e.show()}},{key:"clickAction",value:function(){return Promise.resolve()}},{key:"onClickHandler",value:function(e){var t=this.props.onClick;if(__APP.USER.isLoggedOut())return this.showAuthModal();this.clickAction(),this.checkedStateChange(),isFunction(t)&&t(e),isFunction(window.askToSubscribe)&&window.askToSubscribe()}},{key:"checkedStateChange",value:function(){this.state.is_checked?this.setState({is_checked:!1}):this.setState({is_checked:!0})}},{key:"mouseHoverHandler",value:function(){this.setState({is_hovered:!0})}},{key:"mouseLeaveHandler",value:function(){this.setState({is_hovered:!1})}},{key:"render",value:function(){return React.createElement(RippleButton,{className:this.classes,onClick:this.onClickHandler,onMouseEnter:this.mouseHoverHandler,onMouseLeave:this.mouseLeaveHandler},this.labels[this.current_state])}}]),t}();ReactActionButton.STATES={CHECKED:"CHECKED",UNCHECKED:"UNCHECKED",CHECKED_HOVER:"CHECKED_HOVER",UNCHECKED_HOVER:"UNCHECKED_HOVER"},ReactActionButton.DEFAULTS={labels:(_labels={},_defineProperty(_labels,ReactActionButton.STATES.CHECKED,null),_defineProperty(_labels,ReactActionButton.STATES.UNCHECKED,null),_defineProperty(_labels,ReactActionButton.STATES.CHECKED_HOVER,null),_defineProperty(_labels,ReactActionButton.STATES.UNCHECKED_HOVER,null),_labels),colors:(_colors={},_defineProperty(_colors,ReactActionButton.STATES.CHECKED,null),_defineProperty(_colors,ReactActionButton.STATES.UNCHECKED,null),_defineProperty(_colors,ReactActionButton.STATES.CHECKED_HOVER,null),_defineProperty(_colors,ReactActionButton.STATES.UNCHECKED_HOVER,null),_colors),icons:(_icons={},_defineProperty(_icons,ReactActionButton.STATES.CHECKED,null),_defineProperty(_icons,ReactActionButton.STATES.UNCHECKED,null),_defineProperty(_icons,ReactActionButton.STATES.CHECKED_HOVER,null),_defineProperty(_icons,ReactActionButton.STATES.UNCHECKED_HOVER,null),_icons)},ReactActionButton.propTypes={isChecked:PropTypes.bool,className:PropTypes.oneOfType([PropTypes.string,PropTypes.instanceOf(HtmlClassesArray)]),labels:PropTypes.object,colors:PropTypes.object,icons:PropTypes.object,onClick:PropTypes.func};var ReactAddToFavoriteButton=function(e){function t(e,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.event=e.event,isVoid(n[AvatarCollectionContextProvider.CONTEXT_NAME])||(i.state.is_checked=n[AvatarCollectionContextProvider.CONTEXT_NAME].isSubscribed),i}return _inherits(t,ReactActionButton),_createClass(t,[{key:"showAuthModal",value:function(){var e=this.modal;return e||(e=new AuthModal(location.origin+"/event/"+this.event.id,{note:"Чтобы добавить событие в избранное, необходимо войти через социальную сеть"}),this.modal=e),cookies.setItem("auth_command","add_to_favorite"),cookies.setItem("auth_entity_id",this.event.id),e.show()}},{key:"clickAction",value:function(){var e=this;return this.state.is_checked?this.event.unfavour().then(function(t){return isVoid(e.context[AvatarCollectionContextProvider.CONTEXT_NAME])||e.context[AvatarCollectionContextProvider.CONTEXT_NAME].unsubscribe(),t}):this.event.favour().then(function(t){return isVoid(e.context[AvatarCollectionContextProvider.CONTEXT_NAME])||e.context[AvatarCollectionContextProvider.CONTEXT_NAME].subscribe(),t})}}]),t}();ReactAddToFavoriteButton.DEFAULTS={labels:(_labels2={},_defineProperty(_labels2,ReactActionButton.STATES.CHECKED,__LOCALES.ru_RU.TEXTS.BUTTON.FAVORED),_defineProperty(_labels2,ReactActionButton.STATES.UNCHECKED,__LOCALES.ru_RU.TEXTS.BUTTON.ADD_FAVORITE),_defineProperty(_labels2,ReactActionButton.STATES.CHECKED_HOVER,__LOCALES.ru_RU.TEXTS.BUTTON.REMOVE_FAVORITE),_defineProperty(_labels2,ReactActionButton.STATES.UNCHECKED_HOVER,__LOCALES.ru_RU.TEXTS.BUTTON.ADD_FAVORITE),_labels2),colors:(_colors2={},_defineProperty(_colors2,ReactActionButton.STATES.CHECKED,__C.CLASSES.COLORS.ACCENT),_defineProperty(_colors2,ReactActionButton.STATES.UNCHECKED,__C.CLASSES.COLORS.DEFAULT),_defineProperty(_colors2,ReactActionButton.STATES.CHECKED_HOVER,__C.CLASSES.COLORS.ACCENT),_defineProperty(_colors2,ReactActionButton.STATES.UNCHECKED_HOVER,__C.CLASSES.COLORS.NEUTRAL_ACCENT),_colors2),icons:(_icons2={},_defineProperty(_icons2,ReactActionButton.STATES.CHECKED,__C.CLASSES.ICONS.STAR),_defineProperty(_icons2,ReactActionButton.STATES.UNCHECKED,__C.CLASSES.ICONS.STAR_O),_defineProperty(_icons2,ReactActionButton.STATES.CHECKED_HOVER,__C.CLASSES.ICONS.TIMES),_defineProperty(_icons2,ReactActionButton.STATES.UNCHECKED_HOVER,__C.CLASSES.ICONS.STAR_O),_icons2)},ReactAddToFavoriteButton.propTypes=_extends({event:PropTypes.instanceOf(OneEvent)},ReactActionButton.propTypes),ReactAddToFavoriteButton.contextTypes=AvatarCollectionContextProvider.childContextTypes;var FormCheckbox=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=void 0===t?guid():t,i=e.label,a=e.name,r=e.value,s=e.inputRef,o=_objectWithoutProperties(e,["id","label","name","value","inputRef"]);return React.createElement("div",{className:"form_unit form_checkbox_wrapper"},React.createElement("input",_extends({id:n,className:"form_checkbox",type:"checkbox",name:a,tabIndex:"-1",ref:s},void 0===r?{value:r}:{},o)),i&&React.createElement("label",{className:"form_label",htmlFor:n},React.createElement("span",null,i)))}}]),t}(),EventNetworkingContactsPage=asyncPage({constructPage:function(e){var t=e.event_id;return{my_contacts_profiles:new EventNetworkingContactsProfilesCollection(t),my_contacts_profiles_fields:new Fields}},fetchData:function(){return this.props.my_contacts_profiles.fetch(this.props.my_contacts_profiles_fields)},pageTitle:"Аудитория события",headerTabs:function(){return[{title:"Участники",page:"/event/"+this.props.event_id+"/networking/participants"},{title:"Заявки",page:"/event/"+this.props.event_id+"/networking/requests"},{title:"Контакты",page:"/event/"+this.props.event_id+"/networking/contacts"},{title:"Мой профиль",page:"/event/"+this.props.event_id+"/networking/profile"}]}},function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.my_contacts_profiles;return contentWrap(React.createElement("div",{className:"event_networking_page material -level_2_material"},React.createElement("header",{className:"event_networking_header -hidden"},React.createElement("input",{className:"event_networking_search form_input -rounded",placeholder:"Поиск участников"})),React.createElement("div",{className:"event_networking_body"},e.length?e.map(function(e){return React.createElement(EventNetworkingPage.NetworkingProfileUnit,{key:e.user_id,profile:e},e.info&&React.createElement("p",null,React.createElement("b",null,"Полезен:")," ",e.info))}):React.createElement(Cap,null,"У вас пока нет контактов"))))}}]),t}()),EventNetworkingMyProfilePage=asyncPage({constructPage:function(e){var t=e.event_id,n=this.props.myProfile;return{my_profile:isVoid(n)?new MyEventNetworkingProfile(t):n,is_fetched:!isVoid(n)}},fetchData:function(){return this.props.is_fetched?Promise.resolve():this.props.my_profile.fetch()},pageTitle:"Мой профиль",headerTabs:function(){return[{title:"Участники",page:"/event/"+this.props.event_id+"/networking/participants"},{title:"Заявки",page:"/event/"+this.props.event_id+"/networking/requests"},{title:"Контакты",page:"/event/"+this.props.event_id+"/networking/contacts"},{title:"Мой профиль",page:"/event/"+this.props.event_id+"/networking/profile"}]}},function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={redirect_to:null},n.saveHandler=n.saveHandler.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"saveHandler",value:function(){var e=this;this.props.my_profile.update({first_name:this.refs.first_name.value,last_name:this.refs.last_name.value,info:this.refs.info.value,looking_for:this.refs.looking_for.value,vk_url:this.refs.vk_url.value,facebook_url:this.refs.facebook_url.value,twitter_url:this.refs.twitter_url.value,linkedin_url:this.refs.linkedin_url.value,telegram_url:this.refs.telegram_url.value,instagram_url:this.refs.instagram_url.value,github_url:this.refs.github_url.value}).then(function(t){return e.props.my_profile.signed_up=!0,e.setState({redirect_to:e.props.match.url.replace("profile","participants")}),t})}},{key:"render",value:function(){var e=this.props.my_profile,t=ReactRouter.Redirect,n={vk_url:e.vk_url,facebook_url:e.facebook_url,twitter_url:e.twitter_url,linkedin_url:e.linkedin_url,telegram_url:e.telegram_url,instagram_url:e.instagram_url,github_url:e.github_url},i={vk_url:"VK",facebook_url:"Facebook",twitter_url:"Twitter",linkedin_url:"LinkedIn",telegram_url:"Telegram",instagram_url:"Instagram",github_url:"Github"};return isVoid(this.state.redirect_to)?contentWrap(React.createElement("div",{className:"event_networking_page material -level_2_material"},React.createElement("header",{className:"event_networking_my_profile_header"},React.createElement("h2",{className:"event_networking_my_profile_title"},"Редактирование профиля")),React.createElement("div",{className:"event_networking_my_profile_body"},React.createElement("h4",null,"Имя"),React.createElement("div",{className:"form_group -parts_e_2"},React.createElement("div",{className:"form_unit "},React.createElement("input",{className:"form_input",name:"last_name",required:!0,placeholder:"Фамилия",type:"text",autoComplete:"off",defaultValue:e.last_name,ref:"last_name"})),React.createElement("div",{className:"form_unit "},React.createElement("input",{className:"form_input",name:"first_name",required:!0,placeholder:"Имя",type:"text",autoComplete:"off",defaultValue:e.first_name,ref:"first_name"}))),React.createElement("p",null,"Вводите только настоящие фамилию и имя"),React.createElement("h4",null,"Информация о себе"),React.createElement("p",null,"Например: Дизайн интерфейсов, разработка мобильных приложений"),React.createElement("div",{className:"form_unit"},React.createElement("textarea",{className:"form_textarea",name:"info",placeholder:"Несколько слов о себе (необязательно)",ref:"info",defaultValue:e.info})),React.createElement("h4",null,"Ищу"),React.createElement("p",null,"Напишите в поисках чего вы находитесь на этом событии. Это поможет другим участникам найти с Вами контакт."),React.createElement("div",{className:"form_unit"},React.createElement("textarea",{className:"form_textarea",name:"looking_for",placeholder:"Несколько слов о том что вы ищете (необязательно)",ref:"looking_for",defaultValue:e.looking_for})),React.createElement("h4",null,"Ссылки"),Object.keys(n).map(function(e){return React.createElement("div",{key:e,className:"form_unit -inline"},React.createElement("label",{className:"form_label",htmlFor:"event_networking_my_profile_"+e},i[e]),React.createElement("input",{id:"event_networking_my_profile_"+e,className:"form_input",name:e,placeholder:"Ссылка",type:"text",autoComplete:"off",defaultValue:n[e],ref:e}))}),React.createElement("div",{className:"form_unit -align_center"},React.createElement(RippleButton,{className:new HtmlClassesArray([__C.CLASSES.COLORS.ACCENT,__C.CLASSES.SIZES.HUGE]),onClick:this.saveHandler},"Сохранить"))))):React.createElement(t,{to:this.state.redirect_to})}}]),t}()),EventNetworkingPage=asyncPage({constructPage:function(e){var t=e.event_id,n=parseUri(window.location);return{my_profile:new MyEventNetworkingProfile(t),code:n.queryKey.code,my_profile_fields:new Fields}},fetchData:function(){var e=this.props,t=e.my_profile,n=e.my_profile_fields,i=e.code;return isVoid(i)?t.checkAccess(n).catch(function(e){}):t.redeemAccess(i,n)},is_auth_required:!0},function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=ReactRouter,n=t.Switch,i=t.Route,a=t.Redirect;return!1===this.props.my_profile.signed_up&&window.location.pathname!==this.props.match.url+"/profile"?React.createElement(a,{to:this.props.match.url+"/profile"}):React.createElement(n,null,React.createElement(i,{exact:!0,path:"/event/:event_id/networking/participants",component:EventNetworkingParticipantsPage}),React.createElement(i,{exact:!0,path:"/event/:event_id/networking/requests",component:EventNetworkingRequestsPage}),React.createElement(i,{exact:!0,path:"/event/:event_id/networking/contacts",component:EventNetworkingContactsPage}),React.createElement(i,{exact:!0,path:"/event/:event_id/networking/profile",component:function(t){return React.createElement(EventNetworkingMyProfilePage,_extends({},t,{myProfile:e.props.my_profile}))}}),React.createElement(a,{strict:!0,from:"/event/:event_id/networking",to:this.props.match.url+"/participants"}))}}]),t}());EventNetworkingPage.NetworkingProfileUnit=function(e){var t=e.profile,n=e.children;return React.createElement("div",{className:"networking_profile_block"},React.createElement("aside",{className:"networking_profile_block_avatar",onClick:function(e){new NetworkingProfileAppInspector(t).show()}},React.createElement(Avatar,{entity:t.user,className:new HtmlClassesArray(__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.SIZES.X55)})),React.createElement("div",{className:"networking_profile_block_main"},React.createElement("header",{className:"networking_profile_block_header",onClick:function(e){new NetworkingProfileAppInspector(t).show()}},React.createElement("h4",{className:"networking_profile_block_title"},t.user.full_name),t.company_name&&React.createElement("span",{className:"networking_profile_block_org"},t.company_name)),React.createElement("div",{className:"networking_profile_block_body"},n)))};var EventNetworkingParticipantsPage=asyncPage({constructPage:function(e){var t=e.event_id;return{profiles:new EventNetworkingProfilesCollection(t),profiles_fields:new Fields("request","outgoing_request")}},fetchData:function(){return this.props.profiles.fetch(this.props.profiles_fields,20)},pageTitle:"Аудитория события",headerTabs:function(){return[{title:"Участники",page:"/event/"+this.props.event_id+"/networking/participants"},{title:"Заявки",page:"/event/"+this.props.event_id+"/networking/requests"},{title:"Контакты",page:"/event/"+this.props.event_id+"/networking/contacts"},{title:"Мой профиль",page:"/event/"+this.props.event_id+"/networking/profile"}]}},function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={is_fetching:!1,current_modal:null,modal_props:null},n.disable_upload=!1,n.hideModal=n.hideModal.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.bindScrollEvents()}},{key:"componentWillUnmount",value:function(){this.unbindScrollEvents()}},{key:"unbindScrollEvents",value:function(){$(window).off("scroll.uploadEntities")}},{key:"bindScrollEvents",value:function(){var e=this,t=$(window);this.unbindScrollEvents(),isScrollRemain(1e3)&&this.uploadEntities(),t.on("scroll.uploadEntities",function(){isScrollRemain(1e3)&&e.uploadEntities()})}},{key:"uploadEntities",value:function(){var e=this;this.disable_upload||(this.disable_upload=!0,this.setState({is_fetching:!0}),this.props.profiles.fetch(this.props.profiles_fields).then(function(t){return t.length&&(e.disable_upload=!1),e.setState({is_fetching:!1}),t}))}},{key:"hideModal",value:function(){this.setState({current_modal:null,modal_props:null})}},{key:"render",value:function(){var e=this,t=this.state.current_modal;return contentWrap(React.createElement("div",{className:"event_networking_page material -level_2_material"},React.createElement("header",{className:"event_networking_header -hidden"},React.createElement("input",{className:"event_networking_search form_input -rounded",placeholder:"Поиск участников"})),React.createElement("div",{className:"event_networking_body"},this.props.profiles.map(function(t){return React.createElement(EventNetworkingPage.NetworkingProfileUnit,{key:t.user_id,profile:t},t.info&&React.createElement("p",null,React.createElement("b",null,"Полезен:")," ",t.info),t.looking_for&&React.createElement("p",null,React.createElement("b",null,"Ищет:")," ",t.looking_for),t.outgoing_request.uuid?isVoid(t.outgoing_request.accept_status)?React.createElement("span",{className:__C.CLASSES.TEXT_COLORS.MUTED_50},"Заявка отправлена"):t.outgoing_request.accept_status?React.createElement("span",{className:__C.CLASSES.TEXT_COLORS.FRANKLIN},"Заявка принята"):React.createElement("span",{className:__C.CLASSES.TEXT_COLORS.ACCENT},"Заявка отклонена"):React.createElement(Action,{onClick:function(n){e.setState({current_modal:CreateNetworkingRequestModal,modal_props:{profile:t}})}},"Отправить заявку"))}),this.state.is_fetching&&React.createElement(LoaderBlock,null)),t&&React.createElement(t,_extends({},this.state.modal_props,{hideModalHandler:this.hideModal}))))}}]),t}()),EventNetworkingRequestsPage=asyncPage({constructPage:function(e){var t=e.event_id;return{pending_requests_profiles:new EventNetworkingPendingRequestProfilesCollection(t),accepted_requests_profiles:new EventNetworkingAcceptedRequestProfilesCollection(t),rejected_requests_profiles:new EventNetworkingRejectedRequestProfilesCollection(t),requests_profiles_fields:new Fields("request")}},fetchData:function(){return Promise.all([this.props.pending_requests_profiles.fetch(this.props.requests_profiles_fields),this.props.accepted_requests_profiles.fetch(this.props.requests_profiles_fields),this.props.rejected_requests_profiles.fetch(this.props.requests_profiles_fields)])},pageTitle:"Аудитория события",headerTabs:function(){return[{title:"Участники",page:"/event/"+this.props.event_id+"/networking/participants"},{title:"Заявки",page:"/event/"+this.props.event_id+"/networking/requests"},{title:"Контакты",page:"/event/"+this.props.event_id+"/networking/contacts"},{title:"Мой профиль",page:"/event/"+this.props.event_id+"/networking/profile"}]}},function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={pending:e.pending_requests_profiles.length,accepted:e.accepted_requests_profiles.length,rejected:e.rejected_requests_profiles.length},n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.pending_requests_profiles,i=t.accepted_requests_profiles,a=t.rejected_requests_profiles,r=EventNetworkingPage.NetworkingProfileUnit;return contentWrap(React.createElement("div",{className:"event_networking_page material -level_2_material"},React.createElement("header",{className:"event_networking_header  -hidden"},React.createElement("input",{className:"event_networking_search form_input -rounded",placeholder:"Поиск участников"})),React.createElement("div",{className:"event_networking_body"},!![].concat(_toConsumableArray(n),_toConsumableArray(i),_toConsumableArray(a)).length||React.createElement(Cap,null,"Вам пока еще не поступило ни одной заявки"),n.map(function(t){return React.createElement(r,{key:t.user_id,profile:t},t.info&&React.createElement("p",null,React.createElement("b",null,"Полезен:")," ",t.info),t.looking_for&&React.createElement("p",null,React.createElement("b",null,"Ищет:")," ",t.looking_for),t.request.message&&React.createElement("p",{className:"networking_profile_block_comment fa_icon fa-commenting"},t.request.message),React.createElement("div",{className:"form_group -align_left"},React.createElement("div",{className:"form_unit"},React.createElement(RippleButton,{className:__C.CLASSES.COLORS.ACCENT,onClick:function(a){t.request.acceptRequest().then(function(a){return i.push(n.pull(t.user_id)),e.setState({pending:n.length,accepted:i.length}),a})}},"Принять заявку")),React.createElement("div",{className:"form_unit -valign_center"},React.createElement(Action,{className:__C.CLASSES.COLORS.MARGINAL,onClick:function(i){t.request.cancelRequest().then(function(i){return a.push(n.pull(t.user_id)),e.setState({pending:n.length,rejected:a.length}),i})}},"Скрыть"))))}),i.map(function(e){return React.createElement(r,{key:e.user_id,profile:e},e.info&&React.createElement("p",null,React.createElement("b",null,"Полезен:")," ",e.info),e.looking_for&&React.createElement("p",null,React.createElement("b",null,"Ищет:")," ",e.looking_for),e.request.message&&React.createElement("p",{className:"networking_profile_block_comment fa_icon fa-commenting"},e.request.message),React.createElement(RippleButton,{className:new HtmlClassesArray([__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.CHECK]),disabled:!0},"Принята"))}),a.map(function(e){return React.createElement(r,{key:e.user_id,profile:e},e.info&&React.createElement("p",null,React.createElement("b",null,"Полезен:")," ",e.info),e.looking_for&&React.createElement("p",null,React.createElement("b",null,"Ищет:")," ",e.looking_for),e.request.message&&React.createElement("p",{className:"networking_profile_block_comment fa_icon fa-commenting"},e.request.message),React.createElement(RippleButton,{className:new HtmlClassesArray([__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.TIMES]),disabled:!0},"Отклонена"))}))))}}]),t}());Calendar=function(){function e(t,n){if(this.options={classes:{wrapper_class:"calendar_wrapper",header_class:"calendar_header",prev_btn_class:"calendar_prev_btn",next_btn_class:"calendar_next_btn",month_name_class:"calendar_month_name",table_class:"calendar_month",thead_class:"calendar_thead",tbody_class:"calendar_tbody",tr_class:"calendar_week",head_tr_class:"calendar_weekdays_row",th_class:"calendar_weekday",td_class:"calendar_day",day_class:"day_num",td_additional_classes:[],td_disabled_class:"-disabled",table_cell_class:"calendar_cell",today_class:"today"},additional_dataset:{},selection_type:e.SELECTION_TYPES.SINGLE,weekday_selection:!1,month_selection:!1,disable_selection:!1,min_date:!1,max_date:!1,locale:"ru",labels:{}},t&&(t instanceof Element||"string"==typeof t)){if(0===(t=$(t)).length)throw new Error("Такого элемента не существует");if(t.length>1)throw new Error("Элементов с заданным аргументов найдено несколько")}if(!(t instanceof jQuery))throw new TypeError("Аргумент должен быть экземпляром jQuery, элементом DOM, либо CSS селектором");$.extend(!0,this.options,n,t.data()),!1!==this.options.min_date&&!1!==this.options.max_date&&moment(this.options.max_date).diff(this.options.min_date,"days")<=0&&(this.options.max_date=!1),!0!==this.options.weekday_selection&&!0!==this.options.month_selection||(this.options.selection_type=e.SELECTION_TYPES.MULTI),this.raw_dates=[],this.selected_days=[],this.selected_weeks={},this.selected_months=[],this.last_action="",this.last_selected_days="",this.now_selected_day="",this.prev_selected_day="",this.formatted_days={},this.$calendar=t,this.current_month=moment(new Date),this._today=moment(new Date)}return e.SELECTION_TYPES={SINGLE:"single",MULTI:"multi"},e.prototype.flush=function(){this.selected_days=[],this.selected_weeks={},this.selected_months=[],this.last_action="",this.last_selected_days="",this.now_selected_day="",this.prev_selected_day="",this.formatted_days={},this.destroyTable()},e.prototype.setMonth=function(e,t){switch(e){case"prev":this.current_month=this.current_month.add(-1,"months");break;case"next":this.current_month=this.current_month.add(1,"months");break;case"current":this.current_month=moment(new Date);break;default:this.current_month=t?this.current_month.set({year:t,month:e-1}):this.current_month.month(e-1)}return this.renderTable(),this.$calendar.trigger("change:month"),this.bindTime(this.raw_dates),this},e.prototype.destroyTable=function(){return this.$calendar.find("."+this.options.classes.th_class).removeClass(__C.CLASSES.ACTIVE).off("click"),this.$calendar.find(".MonthName").removeClass(__C.CLASSES.ACTIVE).off("click"),this.$calendar.find(".CalendarTableBody").remove(),this},e.prototype.setMonthName=function(){return this.$calendar.find(".MonthName").data("month",this.current_month.month()).text(this.current_month.format("MMMM YYYY").capitalize()),this},e.prototype.buildTable=function(){var e,t,n=this.$calendar.find(".CalendarTable"),i=this.current_month.daysInMonth(),a=this.current_month.date(1).day(),r=this.current_month.date(i).day(),s=[],o=[],l=[];for(var c in this.options.additional_dataset)this.options.additional_dataset.hasOwnProperty(c)&&l.push("data-"+c+"="+this.options.additional_dataset[c]);for(var _=1;_<=i;_++)this.current_month.date(_),e=this.current_month.format(__C.DATE_FORMAT),t=moment(e),o=[this.options.classes.table_cell_class,this.options.classes.td_class,"Day_"+e,"DayOfWeek_"+this.current_month.day(),"DayOfMonth_"+this.current_month.month()].concat(this.options.classes.td_additional_classes),(!1===this.options.min_date||t.diff(this.options.min_date,"d")>=0)&&(!1===this.options.max_date||t.diff(this.options.max_date,"d")<=0)||o.push(this.options.classes.td_disabled_class),this.current_month.format(__C.DATE_FORMAT)==this._today.format(__C.DATE_FORMAT)&&o.push(this.options.classes.today_class),s.push(tmpl("calendar-div",{td_classes:o.join(" "),number:this.current_month.date(),day_number:this.current_month.day(),date:this.current_month.format(__C.DATE_FORMAT),date_text:this.current_month.format("DD MMMM YYYY"),dataset:l.join(" ")}));var d=this.current_month.clone();if(1!=a){d.add(-1,"months"),d.date(d.daysInMonth());do{e=d.format(__C.DATE_FORMAT),t=moment(e),o=[this.options.classes.table_cell_class,this.options.classes.td_class,"Day_"+e,"DayOfWeek_"+d.day(),"DayOfMonth_"+d.month(),"not_this_month"].concat(this.options.classes.td_additional_classes),(!1===this.options.min_date||t.diff(this.options.min_date,"d")>=0)&&(!1===this.options.max_date||t.diff(this.options.max_date,"d")<=0)||o.push(this.options.classes.td_disabled_class),s.unshift(tmpl("calendar-div",{td_classes:o.join(" "),number:d.date(),day_number:d.day(),date:d.format(__C.DATE_FORMAT),date_text:d.format("DD MMMM YYYY"),dataset:l.join(" ")})),d.add(-1,"days")}while(0!=d.day())}if(0!=r){d=this.current_month.clone();do{d.add(1,"days"),e=d.format(__C.DATE_FORMAT),t=moment(e),o=[this.options.classes.table_cell_class,this.options.classes.td_class,"Day_"+e,"DayOfWeek_"+d.day(),"DayOfMonth_"+d.month(),"not_this_month"].concat(this.options.classes.td_additional_classes),(!1===this.options.min_date||t.diff(this.options.min_date,"d")>=0)&&(!1===this.options.max_date||t.diff(this.options.max_date,"d")<=0)||o.push(this.options.classes.td_disabled_class),s.push(tmpl("calendar-div",{td_classes:o.join(" "),number:d.date(),day_number:d.day(),date:d.format(__C.DATE_FORMAT),date_text:d.format("DD MMMM YYYY"),dataset:l.join(" ")}))}while(0!=d.day())}for(var u=$("<tbody>").addClass("CalendarTableBody"),p=0,h=0,f=[tmpl("calendar-row",{tr_class:this.options.classes.tr_class})],m=0;m<s.length;m++)7==p&&(f.push(tmpl("calendar-row",{tr_class:this.options.classes.tr_class})),p=0,h++),f[h].append(s[m]),p++;return f.forEach(function(e){u.append(e)}),n.append(u),this},e.prototype.renderTable=function(){if(this.destroyTable().buildTable().activateSelectedDays().setMonthName(),!this.options.disable_selection){switch(this.options.selection_type){case e.SELECTION_TYPES.MULTI:this.bindDragSelection();break;case e.SELECTION_TYPES.SINGLE:this.bindDaySelection()}!0===this.options.weekday_selection&&this.bindWeekdaySelection(),!0===this.options.month_selection&&this.bindMonthSelection()}return this},e.prototype.selectToday=function(){return this.$calendar.find("."+this.options.classes.td_class+"."+this.options.classes.today_class).addClass(__C.CLASSES.ACTIVE),this},e.prototype.formatDays=function(){var e={"январь":"января","февраль":"февраля","март":"марта","апрель":"апреля","май":"мая","июнь":"июня","июль":"июля","август":"августа","сентябрь":"сентября","октябрь":"октября","ноябрь":"ноября","декабрь":"декабря"},t=moment(this.now_selected_day),n=t.month(),i=t.month(n),a=i.daysInMonth(),r=i.date(1);for(void 0===this.formatted_days[n]&&(this.formatted_days[n]={},this.formatted_days[n].selected_days=[],this.formatted_days[n].month_name=e[t.format("MMMM")]),this.formatted_days[n].selected_days.push(t.format(__C.DATE_FORMAT)),this.formatted_days[n].text="";a;)console.log(this.formatted_days[n].selected_days),-1!==this.formatted_days[n].selected_days.indexOf(r.format(__C.DATE_FORMAT))&&(this.formatted_days[n].text+=""+r.format("D")),r=r.add(1,"d"),a--;return console.log(this.formatted_days[n].text),this},e.prototype.selectDays=function(t){function n(t){switch(i.options.selection_type){case e.SELECTION_TYPES.MULTI:-1===i.selected_days.indexOf(t)&&(i.selected_days.push(t),i.selected_days.sort());break;default:case e.SELECTION_TYPES.SINGLE:i.$calendar.find("."+i.options.classes.td_class+"."+__C.CLASSES.ACTIVE).removeClass(__C.CLASSES.ACTIVE),i.selected_days=[t]}i.$calendar.find(".Day_"+t).addClass(__C.CLASSES.ACTIVE)}var i=this;if(Array.isArray(t)){var a=[];t.forEach(function(e){(!1===i.options.min_date||moment(e).diff(i.options.min_date)>=0)&&(!1===i.options.max_date||moment(e).diff(i.options.max_date)<=0)?n(e):a.push(e)}),a.forEach(function(e){t.splice(t.indexOf(e),1)})}else(!1===i.options.min_date||moment(t).diff(i.options.min_date)>=0)&&(!1===i.options.max_date||moment(t).diff(i.options.max_date)<=0)?(n(t),t=[t]):t=[];return t.length&&(i.last_action="select",i.last_selected_days=t,i.$calendar.trigger("change:days")),this},e.prototype.deselectDays=function(t){function n(e){var t,n=i.$calendar.find(".Day_"+e),a=i.$calendar.find(".Week_"+n.data("weekday")),r=i.$calendar.find(".MonthName"),s=i.current_month.format("YYYY"),o=i.current_month.format("MM"),l=i.current_month.format("YYYY.MM");i.selected_days.splice(i.selected_days.indexOf(e),1),i.selected_days.sort(),-1!==i.selected_months.indexOf(l)&&(r.removeClass(__C.CLASSES.ACTIVE),i.selected_months.splice(i.selected_months.indexOf(l),1)),void 0!==i.selected_weeks[s]&&void 0!==i.selected_weeks[s][o]&&-1!==(t=i.selected_weeks[s][o].indexOf(n.data("weekday")))&&(a.removeClass(__C.CLASSES.ACTIVE),i.selected_weeks[s][o].splice(t,1)),i.$calendar.find(".Day_"+e).removeClass(__C.CLASSES.ACTIVE).removeAttr("title")}var i=this;return this.options.selection_type===e.SELECTION_TYPES.MULTI&&(Array.isArray(t)?t.forEach(function(e){n(e)}):n(t),i.last_action="deselect",i.last_selected_days=t,i.$calendar.trigger("change:days")),this},e.prototype.bindTime=function(e){var t=this;return this.raw_dates=e instanceof Array?e:[e],this.raw_dates.forEach(function(e){var n=moment.unix(e.event_date);t.$calendar.find(".Day_"+n.format(__C.DATE_FORMAT)).attr("title","{start_time} - {end_time}".format({start_time:trimSeconds(e.start_time),end_time:trimSeconds(e.end_time)}))}),this},e.prototype.selectWeek=function(e){var t,n=this,i=n.$calendar.find(".Week_"+e),a=n.$calendar.find(".DayOfWeek_"+e).not(".not_this_month"),r=n.current_month.format("YYYY"),s=n.current_month.format("MM"),o=[];return a.each(function(e){o.push(a.eq(e).data("date"))}),void 0===n.selected_weeks[r]&&(n.selected_weeks[r]={}),void 0===n.selected_weeks[r][s]&&(n.selected_weeks[r][s]=[]),-1===(t=n.selected_weeks[r][s].indexOf(e))?(i.addClass(__C.CLASSES.ACTIVE),n.selectDays(o),n.selected_weeks[r][s].push(e)):(i.removeClass(__C.CLASSES.ACTIVE),n.deselectDays(o),n.selected_weeks[r][s].splice(t,1)),this},e.prototype.selectMonth=function(e){var t=this,n=t.$calendar.find(".MonthName"),i=t.$calendar.find(".DayOfMonth_"+e),a=t.current_month.format("YYYY.MM"),r=t.selected_months.indexOf(a),s=[];return i.each(function(e){s.push(i.eq(e).data("date"))}),-1===r?(n.addClass(__C.CLASSES.ACTIVE),t.selectDays(s),t.selected_months.push(a)):(n.removeClass(__C.CLASSES.ACTIVE),t.deselectDays(s),t.selected_months.splice(r,1)),this},e.prototype.bindMonthArrows=function(){var e=this;return this.$calendar.find(".NextMonth").off("click.NextMonth").on("click.NextMonth",function(){e.setMonth("next")}),this.$calendar.find(".PrevMonth").off("click.PrevMonth").on("click.PrevMonth",function(){e.setMonth("prev")}),this},e.prototype.bindDaySelection=function(){var t=this,n=t.$calendar.find("."+this.options.classes.td_class),i=n.not("."+this.options.classes.td_disabled_class);return n.off("click.bindDaySelection"),i.on("click.bindDaySelection",function(){t.options.selection_type===e.SELECTION_TYPES.MULTI&&$(this).hasClass(__C.CLASSES.ACTIVE)?t.deselectDays($(this).data("date")):t.selectDays($(this).data("date"))}),this},e.prototype.bindWeekdaySelection=function(){var e=this;return e.$calendar.find("."+this.options.classes.th_class).on("click",function(){e.selectWeek($(this).data("weekday"))}),this},e.prototype.bindMonthSelection=function(){var e=this;return e.$calendar.find(".MonthName").on("click",function(){e.selectMonth($(this).data("month"))}),this},e.prototype.bindDragSelection=function(){function e(e){(e=e.is("."+n.options.classes.td_class)?e:e.closest("."+n.options.classes.td_class)).not("."+n.options.classes.td_disabled_class).length&&(e.hasClass(__C.CLASSES.ACTIVE)?n.deselectDays(e.data("date")):n.selectDays(e.data("date")))}function t(){n.$calendar.find("."+n.options.classes.td_class).off("mouseenter.DragSelection")}var n=this;return n.$calendar.off("mousedown.RangeSelection").on("mousedown.RangeSelection",function(t){e($(t.target)),n.$calendar.find("."+n.options.classes.td_class).not("."+n.options.classes.td_disabled_class).on("mouseenter.DragSelection",function(t){t.preventDefault(),e($(t.target))})}).on("mouseup",t).on("mouseleave",t),this},e.prototype.activateSelectedDays=function(){var e=this,t=e.current_month.format("YYYY"),n=e.current_month.format("MM");return e.selected_days.forEach(function(t){e.$calendar.find(".Day_"+t).addClass(__C.CLASSES.ACTIVE)}),-1!==e.selected_months.indexOf(t+"."+n)&&e.$calendar.find(".MonthName").addClass(__C.CLASSES.ACTIVE),void 0!==e.selected_weeks[t]&&void 0!==e.selected_weeks[t][n]&&e.selected_weeks[t][n].forEach(function(t){e.$calendar.find(".Week_"+t).addClass(__C.CLASSES.ACTIVE)}),this},e.prototype.setDaysWithEvents=function(e){var t=this,n=Object.assign({since:t.current_month.startOf("month").format(__C.DATE_FORMAT),till:t.current_month.endOf("month").format(__C.DATE_FORMAT),length:500,my:!0,unique:!0},e);return t.$calendar.find(".feed_calendar_td").removeClass("Controller has_favorites").addClass(__C.CLASSES.DISABLED),DatesCollection.fetchDates(n,function(e){e.forEach(function(e){var n=t.$calendar.find(".Day_"+moment.unix(e.event_date).format(__C.DATE_FORMAT));n.length&&n.html(__APP.BUILD.link({title:n.children().text(),classes:t.options.classes.day_class,page:"/feed/day/"+n.data("date")})).addClass(e.favorites_count>0?"has_favorites":"").removeClass(__C.CLASSES.DISABLED)}),t.bindDaySelection(),bindPageLinks(t.$calendar)}),this},e.prototype.init=function(){return this.$calendar.empty().append(tmpl("calendar",this.options.classes)),this.options.weekday_selection&&this.$calendar.addClass("-weekday_selection"),this.options.month_selection&&this.$calendar.addClass("-month_selection"),this.$calendar.data("calendar",this),this.$calendar.data("instance",this),this.$calendar.data("days",this.selected_days),this.$calendar.data("options",this.options),this.bindMonthArrows().renderTable(),this},e}(),DatePicker=function(){function e(e,t){var n=this;if(this.options={classes:{},close_on_pick:!0,min_date:!1,max_date:!1,labels:{}},(e instanceof Element||"string"==typeof e)&&(e=$(e)),!(e instanceof jQuery))throw new TypeError("Аргументом конструктора DatePicker должен быть экземпляром jQuery, элементом DOM, либо CSS селектором");if(0===e.length)throw new Error("Такого элемента не существует");if(e.length>1)throw new Error("Элементов с заданным аргументов найдено несколько");$.extend(!0,this.options,t,e.data()),this.$datepicker=e,this.$datepicker_modal=tmpl("datepicker",{}),this.$input=e.is("input")?e:e.find("input"),this.calendar=new Calendar(this.$datepicker_modal.children(".DatePickerCalendar"),{min_date:this.options.min_date,max_date:this.options.max_date}),this.selected_day=empty(this.options.selected_day)?this.$input.val()||"":this.options.selected_day,this.prev_selected_day=this.selected_day,this.format=empty(this.options.format)?__LOCALE.DATE.DATE_FORMAT:this.options.format,Object.defineProperties(this,{m_prev_selected_day:{get:function(){return n.prev_selected_day?moment(n.prev_selected_day):null}},m_selected_day:{get:function(){return n.selected_day?moment(n.selected_day):null}},formated_selected_day:{get:function(){return empty(n.selected_day)?null:isFunction(n.format)?n.format.call(n,n.m_selected_day,n.m_prev_selected_day):n.m_selected_day.format(n.format)}}})}return e.prototype.init=function(){var e=this;return this.bindOpener().$datepicker.data("datepicker",this).data("instance",this),this.$datepicker.addClass("-unselectable -Handled_DatePicker"),this.$input.length&&(this.$input.attr("readonly",!0),Object.defineProperty(this.$input.get(0),"value",{get:function(){return e.selected_day}})),this.calendar.init().$calendar.on("change:days",function(){e.prev_selected_day=e.selected_day,e.selected_day=e.calendar.selected_days.toString(),e.formated_selected_day=e.calendar.selected_days.toString().split("-").reverse().join("."),e.$datepicker.is("input")||e.$datepicker.find(".DatePickerDisplayText").text(e.formated_selected_day),e.$input.val(e.selected_day).trigger("change"),e.options.close_on_pick&&e.closeDialog(),e.$datepicker.trigger("date-picked"),e.$datepicker.trigger("change")}),this},e.prototype.bindOpener=function(){function e(){t.$input.is(":disabled")?t.$datepicker.one("click",e):t.openDialog()}var t=this;return this.$datepicker.one("click",e),this},e.prototype.openDialog=function(){var e=this.$datepicker.offset();return $("body").append(this.$datepicker_modal),this.$datepicker_modal.css({top:e.top+this.$datepicker.outerHeight()+2,left:e.left+this.$datepicker.width()-this.$datepicker_modal.width(),maxWidth:this.$datepicker.width()}),this.calendar.renderTable(),this.bindCloseDialog(),this},e.prototype.bindCloseDialog=function(){var e=this;return $(document).off("click.checkOnClick").on("click.checkOnClick",function(t){var n=$(t.target);(0===n.closest(e.$datepicker_modal).length&&0===n.closest(e.$datepicker).length||n.closest(".SubmitDatePicker").length)&&e.closeDialog()}).off("keydown.checkOnKeyDown").on("keydown.checkOnKeyDown",function(t){9!==t.keyCode&&13!==t.keyCode&&27!==t.keyCode||e.closeDialog()}),this},e.prototype.closeDialog=function(){return $(document).off("click.checkOnClick").off("keydown.checkOnKeyDown"),this.$datepicker_modal.detach(),this.calendar.flush(),this.bindOpener(),this},e.prototype.destroy=function(){return this.closeDialog().$datepicker.data("datepicker",""),this},e}(),DropDown=extendingJQuery(function(){function e(e,t,n,i,a,r){this.options=$.extend(!0,{position:{x:0,y:0}},i),this.afterInit=r||function(){},n=Builder.normalizeBuildProps(n),jQuery.fn.init.call(this,__APP.BUILD.button({title:t,classes:n.classes,attributes:n.attributes})),this.data(n.dataset),this.dropdown=tmpl("dropdown-"+e,a),this.data("instance",this)}return e.prototype.initiate=function(){var e=this;this.addClass(__C.CLASSES.HOOKS.HANDLED+__C.CLASSES.HOOKS.DROPDOWN_BUTTON),$("body").append(this.dropdown).one("Page:change/start",function(){e.destroy()}),this.on("click.OpenDropDown",function(){e.openDropdown()}),this.afterInit(),this.dropdown.find(".CloseDropdown").on("click.CloseDropdown",function(){e.closeDropdown()})},e.prototype.openDropdown=function(){var e=this,t=this.offset();this.dropdown.addClass(__C.CLASSES.SHOW),this.addClass("-dropdown_active"),empty(this.options.width)||("self"===this.options.width?this.dropdown.width(this.outerWidth()):(isFinite(this.options.width)||isPercentageString(this.options.width))&&this.dropdown.width(this.options.width)),this.dropdown.css({left:function(e,t,n,i){switch(e){case"center":return t+n/2-i/2;case"right":return t+n-i;default:if(isFinite(e))return t+e}}(this.options.position.x,t.left,this.outerWidth(),this.dropdown.outerWidth()),top:function(e,t,n,i){return"center"===e?t+n/2-i/2:isFinite(e)?t+n+e:void 0}(this.options.position.y,t.top,this.outerHeight(),this.dropdown.outerHeight())}),$("body").on("mousedown.CloseDropdown",function(t){$(t.target).closest(e.dropdown).length||e.closeDropdown()}),$(document).on("keyup.CloseDropdown",function(t){isKeyPressed(t,__C.KEY_CODES.ESC)&&e.closeDropdown()})},e.prototype.closeDropdown=function(){$("body").off("mousedown.CloseDropdown"),$(document).off("keyup.CloseDropdown"),this.dropdown.removeClass(__C.CLASSES.SHOW),this.removeClass("-dropdown_active")},e.prototype.destroy=function(){this.closeDropdown(),this.dropdown.remove(),this.remove()},e}()),ImgLoader=function(){function ImgLoader(){}return ImgLoader.current_load_context=null,ImgLoader.init=function(e){(e=e||$("body")).find(".ImgLoadWrap").each(function(){var e=$(this),t=e.find(".ImgSrc"),n=e.find(".ImgPreview");t.off("change.CroppedPreview").on("change.CroppedPreview",function(){n.attr("src",this.value)}),n.attr("src")&&e.find(".CropperButton").removeClass(__C.CLASSES.HIDDEN),e.find(".LoadImg").off("change.LoadImg").on("change.LoadImg",function(t){var n,i=t.target.files;if(0==i.length)return!1;for(var a,r=0;a=i[r];r++)(n=new FileReader).onload=function(t){return function(n){var i=n.target.result;ImgLoader.handleImgUpload(e,i,t.name)}}(a),n.readAsDataURL(a)}),e.find(".LoadByURLButton").not("-Handled_LoadByURLButton").on("click.LoadByURL",function(){ImgLoader.current_load_context=e,socket.emit("image.getFromURL",e.find(".LoadByURLAddress").val()),Pace.restart()}).addClass("-Handled_LoadByURLButton"),e.find(".CropperButton").off("click.CallCropper").on("click.CallCropper",function(){ImgLoader.callImgCropper(e,e.data("src")?e.data("src"):t.val())})})},ImgLoader.callImgCropper=function($context,source){var $parent=$context.closest(".ImgLoadWrap"),$img_source=$parent.find(".ImgSrc"),cropper_modal=$parent.data("modal");return cropper_modal&&cropper_modal.image_src!=source&&cropper_modal.destroy(),cropper_modal&&cropper_modal.image_src==source||($parent.data("src",source),cropper_modal=new CropperModal(source,{aspectRatio:eval($parent.data("aspect_ratio"))}),$parent.data("modal",cropper_modal)),cropper_modal.show(),cropper_modal.modal.on("crop",function(e,t){$img_source.val(t).trigger("change")}),cropper_modal},ImgLoader.handleImgUpload=function(e,t,n){var i=e.closest(".ImgLoadWrap");i.data("src",t),i.find(".FileName").val(n),i.find(".CropperButton").removeClass(__C.CLASSES.HIDDEN),ImgLoader.callImgCropper(i,t)},ImgLoader}(),QuantityInput=extendingJQuery(function(){function e(e,t){var n,i,a,r=this,s=(t=$.extend({min:0},t)).min&&t.min>0?t.min:0;n=__APP.BUILD.button({title:"+",classes:["QuantityInputPlus","quantity_input_button",__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.HOOKS.RIPPLE],attributes:{tabindex:-1}}),i=__APP.BUILD.button({title:"–",classes:["QuantityInputMinus","quantity_input_button",__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.HOOKS.RIPPLE],attributes:{tabindex:-1}}),a=__APP.BUILD.inputNumber($.extend({value:s,size:2},e),["quantity_input"],null,{min:t.min,max:t.max||null}),jQuery.fn.init.call(this,tmpl("quantity-input",{minus_button:i,input:a,plus_button:n})),this.options=t,bindRippleEffect(n),bindRippleEffect(i),this.plus=n,this.input=a,this.minus=i,!empty(this.options.min)&&s<=this.options.min&&(this.input.val(this.options.min),this.disableMinus()),!empty(this.options.max)&&s>=this.options.max&&(this.input.val(this.options.max),this.disablePlus()),Object.defineProperty(this[0],"value",{get:function(){return+r.input.val()},set:function(e){var t=r.input.val();return parseInt(t)!==parseInt(e)&&(r.input.val(e),r.check(),parseInt(r.input.val())===parseInt(e)&&r.input.trigger("QuantityInput::change",[e,t])),e}}),this.data("instance",this),this.initiate()}return e.prototype.activatePlus=function(){this.plus.removeAttr("disabled")},e.prototype.disablePlus=function(){this.plus.attr("disabled",!0)},e.prototype.activateMinus=function(){this.minus.removeAttr("disabled")},e.prototype.disableMinus=function(){this.minus.attr("disabled",!0)},e.prototype.check=function(e){e=empty(e)?this.input.val():e,!empty(this.options.max)&&e>=this.options.max?this.disablePlus():this.activatePlus(),!empty(this.options.min)&&e<=this.options.min?this.disableMinus():this.activateMinus()},e.prototype.decrement=function(){var e=+this.input.val();if(this.check(e-1),!empty(this.options.min)&&e-1<this.options.min)return!1;this.input.val(e-1).trigger("QuantityInput::change",[e-1,e])},e.prototype.increment=function(){var e=+this.input.val();if(this.check(e+1),!empty(this.options.max)&&e+1>this.options.max)return!1;this.input.val(e+1).trigger("QuantityInput::change",[e+1,e])},e.prototype.initiate=function(){var e=this;this.plus.on("click.PlusQuantity",function(){e.increment()}),this.minus.on("click.MinusQuantity",function(){e.decrement()}),this.input.on("input",function(){e.input.trigger("QuantityInput::change",[e.input.val()]),e.check()}).on("change",function(){e.input.trigger("QuantityInput::change",[e.input.val()])})},e}()),ActionButton=extendingJQuery(function(){function e(t){t=t||{};var n=this;this.options=$.extend(!0,{classes:[],icons:null,colors:null,labels:null},this.options,t),this.has_icon=!t.hasOwnProperty("has_icon")||!!t.has_icon,this.is_checked=!!t.is_checked,this.is_add_avatar=!!t.is_add_avatar,this.has_icon?this.options.classes.push(this.icon_class):this.options.icons={},this.options.icons=this.options.icons?this.options.icons:{},this.options.colors=this.options.colors?this.options.colors:{},this.options.labels=this.options.labels?this.options.labels:{},this.classes={},$.each(e.STATES,function(e,t){n.classes[t]=[].concat(n.options.icons?n.options.icons[t]:[]).concat(n.options.colors?n.options.colors[t]:[]).join(" ")}),jQuery.fn.init.call(this,__APP.BUILD.button(this.is_checked?{classes:this.options.classes.concat(this.classes[e.STATES.CHECKED]).concat(this.checked_state_class?this.checked_state_class:[]),title:this.options.labels[e.STATES.CHECKED]}:{classes:this.options.classes.concat(this.classes[e.STATES.UNCHECKED]),title:this.options.labels[e.STATES.UNCHECKED]})),this.data("instance",this),this.initiate()}function t(e){var t=e.closest("."+__C.CLASSES.HOOKS.ADD_AVATAR.ANCESTOR),n=t.find("."+__C.CLASSES.HOOKS.ADD_AVATAR.COLLECTION),i=t.find("."+__C.CLASSES.HOOKS.ADD_AVATAR.QUANTITY),a=n.find(".avatar"),r=a.length;if(n.data("max_amount")>=r)n.hasClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED)?(n.removeClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED),n.width(1==r?0:a.outerWidth()*(r-1)-6*(r-2))):(n.addClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED),n.width(a.outerWidth()*r-6*(r-1)));else{if(i.length){var s=parseInt(i.text());n.hasClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED)?(i.text(s-1),s-1<=0&&i.parent().addClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CAST)):(i.text(s+1),i.parent().removeClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CAST))}n.toggleClass(__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFT+" "+__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED)}}return e.STATES={CHECKED:"checked",UNCHECKED:"unchecked",CHECKED_HOVER:"checked_hover",UNCHECKED_HOVER:"unchecked_hover"},e.prototype.checked_state_class="",e.prototype.icon_class=__C.CLASSES.ICON_CLASS,e.prototype.onClick=function(){},e.prototype.afterCheck=function(){var t=this.is(":hover");this.is_checked=!0,this.removeClass("".concat(this.classes[e.STATES.UNCHECKED_HOVER]," ",this.classes[e.STATES.UNCHECKED])).addClass("".concat(this.classes[t?e.STATES.CHECKED_HOVER:e.STATES.CHECKED]," ",this.checked_state_class)).children("."+__C.CLASSES.HOOKS.TEXT).text(this.options.labels[t?e.STATES.CHECKED_HOVER:e.STATES.CHECKED]).trigger("ActionButton:change",["checked",this])},e.prototype.afterUncheck=function(){var t=this.is(":hover");this.is_checked=!1,this.removeClass("".concat(this.classes[e.STATES.CHECKED_HOVER]," ",this.classes[e.STATES.CHECKED]," ",this.checked_state_class)).addClass("".concat(this.classes[t?e.STATES.UNCHECKED_HOVER:e.STATES.UNCHECKED])).children("."+__C.CLASSES.HOOKS.TEXT).text(this.options.labels[t?e.STATES.UNCHECKED_HOVER:e.STATES.UNCHECKED]).trigger("ActionButton:change",["unchecked",this])},e.prototype.showAuthModal=function(){var e;return(e=this.data("modal"))||(e=new AuthModal(null,{note:"Для выполнения этого действия, нужно войти через социальную сеть"}),this.data("modal",e)),e.show()},e.prototype.initiate=function(){var n=this;this.on("mouseenter.HoverActionButton",function(){n.removeClass(n.classes[n.is_checked?e.STATES.CHECKED:e.STATES.UNCHECKED]).addClass(n.classes[n.is_checked?e.STATES.CHECKED_HOVER:e.STATES.UNCHECKED_HOVER]),n.children("."+__C.CLASSES.HOOKS.TEXT).text(n.options.labels[n.is_checked?e.STATES.CHECKED_HOVER:e.STATES.UNCHECKED_HOVER])}).on("mouseleave.LeaveActionButton",function(){n.removeClass(n.classes[n.is_checked?e.STATES.CHECKED_HOVER:e.STATES.UNCHECKED_HOVER]).addClass(n.classes[n.is_checked?e.STATES.CHECKED:e.STATES.UNCHECKED]),n.children("."+__C.CLASSES.HOOKS.TEXT).text(n.options.labels[n.is_checked?e.STATES.CHECKED:e.STATES.UNCHECKED])}).on("click.Action",function(){if(__APP.USER.isLoggedOut())return n.showAuthModal();n.onClick(),n.is_add_avatar&&t(n),window.askToSubscribe instanceof Function&&window.askToSubscribe()})},e}()),AddToFavoriteButton=extending(ActionButton,function(){function e(e,t){this.options={labels:{checked:__LOCALES.ru_RU.TEXTS.BUTTON.FAVORED,unchecked:__LOCALES.ru_RU.TEXTS.BUTTON.ADD_FAVORITE,checked_hover:__LOCALES.ru_RU.TEXTS.BUTTON.REMOVE_FAVORITE,unchecked_hover:__LOCALES.ru_RU.TEXTS.BUTTON.ADD_FAVORITE},colors:{checked:__C.CLASSES.COLORS.ACCENT,unchecked:__C.CLASSES.COLORS.DEFAULT,checked_hover:__C.CLASSES.COLORS.ACCENT,unchecked_hover:__C.CLASSES.COLORS.NEUTRAL_ACCENT},icons:{checked:__C.CLASSES.ICONS.STAR,unchecked:__C.CLASSES.ICONS.STAR_O,checked_hover:__C.CLASSES.ICONS.TIMES,unchecked_hover:__C.CLASSES.ICONS.STAR_O}},this.event=e,ActionButton.call(this,t)}return e.prototype.checked_state_class="-Favored",e.prototype.showAuthModal=function(){var e;return(e=this.data("modal"))||(e=new AuthModal(location.origin+"/event/"+this.event.id,{note:"Чтобы добавить событие в избранное, необходимо войти через социальную сеть"}),this.data("modal",e)),cookies.setItem("auth_command","add_to_favorite"),cookies.setItem("auth_entity_id",this.event.id),e.show()},e.prototype.onClick=function(){var e=this;this.is_checked?this.event.unfavour().then(function(){e.afterUncheck()}):this.event.favour().then(function(){e.afterCheck()})},e}()),OrderButton=extending(ActionButton,function(){function e(e,t){this.options={labels:{checked:e.ticketing_locally?"Куплен":"Зарегистрирован",unchecked:e.ticketing_locally?"Купить билет":"Регистрация",checked_hover:"Открыть билеты",unchecked_hover:e.ticketing_locally?"Купить билет":"Регистрация"},colors:{checked:__C.CLASSES.COLORS.ACCENT,unchecked:__C.CLASSES.COLORS.DEFAULT,checked_hover:__C.CLASSES.COLORS.ACCENT,unchecked_hover:__C.CLASSES.COLORS.NEUTRAL_ACCENT},icons:{checked:__C.CLASSES.ICONS.CHECK,unchecked:e.ticketing_locally?__C.CLASSES.ICONS.TICKET:__C.CLASSES.ICONS.PENCIL,checked_hover:__C.CLASSES.ICONS.TICKET,unchecked_hover:e.ticketing_locally?__C.CLASSES.ICONS.TICKET:__C.CLASSES.ICONS.PENCIL}},this.event=e,this.modal=null,this.is_disabled=this.event.ticketing_locally?!this.event.ticketing_available:this.event.registration_locally&&!this.event.registration_available,t.is_checked=!1,ActionButton.call(this,t)}return e.prototype.checked_state_class="-Ordered",e.prototype.showAuthModal=function(){var e;return(e=this.data("modal"))||(e=new AuthModal(location.origin+"/event/"+this.event.id+"/order",{note:"Для выполнения этого действия, нужно войти через социальную сеть"}),this.data("modal",e)),cookies.removeItem("auth_command"),cookies.removeItem("auth_entity_id"),e.show()},e.prototype.onClick=function(){if(this.is_disabled)return this.off("click.RippleEffect").addClass(__C.CLASSES.HOOKS.HANDLED+__C.CLASSES.HOOKS.RIPPLE),!1;__APP.changeState("/event/"+this.event.id+"/order")},e.prototype.initiate=function(){this.is_disabled?this.attr("disabled",!0):ActionButton.prototype.initiate.call(this)},e}()),SubscribeButton=extending(ActionButton,function(){function e(e,t){this.options={labels:{checked:__LOCALES.ru_RU.TEXTS.BUTTON.SUBSCRIBED,unchecked:__LOCALES.ru_RU.TEXTS.BUTTON.ADD_SUBSCRIPTION,checked_hover:__LOCALES.ru_RU.TEXTS.BUTTON.REMOVE_SUBSCRIPTION,unchecked_hover:__LOCALES.ru_RU.TEXTS.BUTTON.ADD_SUBSCRIPTION},colors:{checked:__C.CLASSES.COLORS.ACCENT,unchecked:__C.CLASSES.COLORS.NEUTRAL_ACCENT,checked_hover:__C.CLASSES.COLORS.ACCENT,unchecked_hover:__C.CLASSES.COLORS.NEUTRAL_ACCENT},icons:{checked:__C.CLASSES.ICONS.CHECK,unchecked:__C.CLASSES.ICONS.PLUS,checked_hover:__C.CLASSES.ICONS.TIMES,unchecked_hover:__C.CLASSES.ICONS.PLUS}},this.org_id=e,ActionButton.call(this,t)}return e.prototype.checked_state_class="-Subscribed",e.prototype.showAuthModal=function(){var e;return(e=this.data("modal"))||(e=new AuthModal(location.origin+"/organization/"+this.org_id,{note:"Чтобы подписаться на организатора необходимо войти через социальную сеть"}),this.data("modal",e)),cookies.setItem("auth_command","subscribe_to"),cookies.setItem("auth_entity_id",this.org_id),e.show()},e.prototype.onClick=function(){var e=this;e.is_checked?__APP.USER.unsubscribeFromOrganization(e.org_id,function(){e.afterUncheck(),$(window).trigger("unsubscribe",[e.org_id])}):__APP.USER.subscribeToOrganization(e.org_id,function(){e.afterCheck(),$(window).trigger("subscribe",[e.org_id])})},e}()),AbstractProgressBar=extendingJQuery(function(){function e(e){e=setDefaultValue(e,{}),jQuery.fn.init.call(this,tmpl("progress-bar",Builder.normalizeBuildProps(e))),this.percentage=0,this.options=e,this.$strip=this.find(".ProgressBarComplete"),this.data("instance",this)}return e.STRINGS={NUMBER:"abs_number",OVERALL:"abs_of",PERCENTAGE:"percentage"},e.MODIFICATORS={SIZE:{TALL:"-size_tall"},WITH_LABEL:"-with_label"},e.prototype.__setWidth=function(){return 100===this.percentage?this.addClass(__C.CLASSES.COLORS.ACCENT):this.removeClass(__C.CLASSES.COLORS.ACCENT),this.$strip.width(Math.roundTo(this.percentage,3)+"%")},e.prototype.set=function(){},e}()),PercentageProgressBar=extending(AbstractProgressBar,function(){function e(e,t){AbstractProgressBar.call(this,function(t){var n=Object.assign({},t);return n.dataset=setDefaultValue(t.dataset,{}),n.dataset[AbstractProgressBar.STRINGS.PERCENTAGE]=e||0,n}(t)),this.percentage=parseFloat(e),this.__setWidth()}return e.prototype.set=function(e){this.percentage=parseFloat(e),this.attr("data-"+AbstractProgressBar.STRINGS.PERCENTAGE,this.percentage),this.__setWidth()},e}()),ProgressBar=extending(AbstractProgressBar,function(){function e(e,t,n){AbstractProgressBar.call(this,function(n){var i=Object.assign({},n);return i.dataset=setDefaultValue(n.dataset,{}),i.dataset[AbstractProgressBar.STRINGS.NUMBER]=t||0,i.dataset[AbstractProgressBar.STRINGS.OVERALL]=e||0,i}(n)),this.number=parseInt(t),this.overall=parseInt(e),Object.defineProperty(this,"percentage",{get:function(){return this.number/this.overall*100},set:function(e){return parseFloat(e)*this.overall/100}}),this.__setWidth()}return e.prototype.set=function(e){this.number=parseInt(e),this.attr("data-"+AbstractProgressBar.STRINGS.NUMBER,this.number),this.__setWidth()},e.prototype.setMax=function(e){this.attr("data-"+AbstractProgressBar.STRINGS.OVERALL,e),this.overall=parseFloat(e),this.__setWidth()},e}()),ModalsCollection=extending(Array,function(){function e(e){this.max_length=e,Object.defineProperty(this,"last_id",{value:0,writable:!0,enumerable:!1,configurable:!1})}return e.prototype.push=function(e){return e instanceof AbstractModal&&(e.id=++this.last_id,this[this.length++]=e,this.length>this.max_length&&this.shift().destroy()),this.length},e}()),Modals=function(){function e(){if("object"===_typeof(e.instance))return e.instance;this.collection=new ModalsCollection(5),this.active_modal=null,this.modal_wrapper=$(".ModalsWrapper"),this.modal_destroyer=new t($(".ModalDestroyer")),e.instance=this}var t=extendingJQuery(function(){function e(e){jQuery.fn.init.call(this,e),this.on("click.CloseModal",function(){AbstractModal.hideCurrent()})}return e.prototype.adjustHeight=function(e){var t=$(window).height(),n=e;return this.height(n>t?n:t)},e}());return e.prototype.bindCallModal=bindCallModal,e}(),AbstractModal=function(){function e(t){this.id=0,this.title="",this.type=this.constructor.name,this.style=t||e.STYLES.NONE,this.modal=$(),this.content_wrapper=$(),this.content="",this.scrollTop=0,this.wrapper_is_scrollable=!1,this.content_is_scrollable=!1,this.is_upload_disabled=!1,this.is_fetched=!1,this.is_rendered=!1,this.is_inited=!1,this.is_shown=!1,this.is_hidable=!0,__APP.MODALS.collection.push(this)}return e.prototype.modal_wrapper=(new Modals).modal_wrapper,Object.defineProperty(e.prototype,"block_scroll",{get:function(){return e.prototype.modal_wrapper.data("block_scroll")},set:function(t){return e.prototype.modal_wrapper.data("block_scroll",t)}}),e.hideCurrent=function(){__APP.MODALS.active_modal&&__APP.MODALS.active_modal.hide()},e.STYLES={NONE:0,OK_ONLY:1,OK_CANCEL:2,ABORT_RETRY_IGNORE:3,YES_NO_CANCEL:4,YES_NO:5,RETRY_CANCEL:6,CRITICAL:10,QUESTION:11,EXCLAMATION:12,INFORMATION:13},Object.freeze(e.STYLES),e.prototype.__render=function(t){var n;switch(this.style){case e.STYLES.OK_ONLY:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.PRIMARY,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"OK"});break;case e.STYLES.OK_CANCEL:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.PRIMARY,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"OK"},{classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Отмена"});break;case e.STYLES.ABORT_RETRY_IGNORE:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.MARGINAL_BUBBLEGUM,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Прервать"},{classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Повтор"},{classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Пропустить"});break;case e.STYLES.YES_NO_CANCEL:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.MARGINAL_FRANKLIN,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Да"},{classes:[__C.CLASSES.COLORS.MARGINAL_BUBBLEGUM,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Нет"},{classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Отмена"});break;case e.STYLES.YES_NO:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.MARGINAL_FRANKLIN,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Да"},{classes:[__C.CLASSES.COLORS.MARGINAL_BUBBLEGUM,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Нет"});break;case e.STYLES.RETRY_CANCEL:n=__APP.BUILD.button({classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Повтор"},{classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.SIZES.LOW,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Отмена"})}return this.modal=__APP.BUILD.modal($.extend({type:this.type,title:this.title,content:this.content,footer_buttons:n},t)),this.content_wrapper=this.modal.find(".ModalContent"),this.is_hidable||this.modal.find("."+__C.CLASSES.HOOKS.CLOSE_MODAL).addClass(__C.CLASSES.HIDDEN),this.is_rendered=!0,this.content||(this.content=this.content_wrapper.children()),this},e.prototype.__init=function(){function t(e){e.is_upload_disabled||e.block_scroll||(e.block_scroll=!0,e.onScrollToBottom(function(){e.block_scroll=!1,e.adjustDestroyerHeight()}))}var n=this;return this.is_rendered?(this.modal.find(".CloseModal").on("click.CloseModal",function(){e.hideCurrent()}),$(document).on("keyup.CloseModal",function(t){isKeyPressed(t,__C.KEY_CODES.ESC)&&($(this).off("keyup.CloseModal"),e.hideCurrent())}),this.wrapper_is_scrollable&&this.onScrollToBottom!==e.prototype.onScrollToBottom&&this.modal_wrapper.on("scroll",function(){n.modal_wrapper.height()+n.modal_wrapper.scrollTop()>=n.modal.height()&&t(n)}),this.content_is_scrollable&&(this.content.scrollbar({onScroll:this.onScrollToBottom!==e.prototype.onScrollToBottom?function(e){e.scroll===e.maxScroll&&t(n)}:void 0}),this.modal.on("modal:disappear",function(){n.content.scrollTop(0)})),this.is_inited=!0,this):(console.error("Modal has not been rendered yet"),this)},e.prototype.__show=function(){function t(){return i.is_rendered?(i.modal_wrapper.append(i.modal.addClass("-faded").removeClass(__C.CLASSES.HIDDEN)),i.adjustDestroyerHeight(),i.modal.trigger("modal:show"),setTimeout(function(){i.modal.removeClass("-faded"),i.modal_wrapper.scrollTop(i.scrollTop),i.modal.trigger("modal:appear"),i.is_shown=!0},200),i.is_inited||i.init(),i):i.render().show()}var n,i=this;return __APP.MODALS.active_modal===i||(e.hideCurrent(),__APP.MODALS.active_modal=i,$("body").addClass("-open_modal"),this.is_fetched)?t():(n=__APP.BUILD.overlayLoader(this.modal_wrapper),this.adjustDestroyerHeight(),this.modal.trigger("modal:fetch/start"),this.fetchData().then(function(){n.remove(),i.is_fetched=!0,i.modal.trigger("modal:fetch/done"),t()}),this)},e.prototype.__hide=function(){var e=this;return this.is_hidable&&(this.scrollTop=this.modal_wrapper.scrollTop(),$(document).off("keyup.CloseModal"),$("body").removeClass("-open_modal"),__APP.MODALS.active_modal=void 0,this.modal.addClass("-faded"),this.modal.trigger("modal:disappear"),setTimeout(function(){e.modal.addClass(__C.CLASSES.HIDDEN).trigger("modal:close"),e.is_shown=!1},200)),this},e.prototype.onScrollToBottom=function(e){return e.call(this),this},e.prototype.adjustDestroyerHeight=function(){return __APP.MODALS.modal_destroyer.adjustHeight(this.modal.outerHeight(!0)),this},e.prototype.render=function(e){return this.__render($.extend({classes:[__C.CLASSES.FLOATING_MATERIAL]},e))},e.prototype.fetchData=function(){return Promise.resolve()},e.prototype.init=function(){return this.__init()},e.prototype.show=function(){return this.__show()},e.prototype.hide=function(){return this.__hide()},e.prototype.destroyNested=function(){return this},e.prototype.destroy=function(){var e=__APP.MODALS.collection.indexOf(this);return this.hide(),__APP.MODALS.modal_wrapper.trigger("modal.beforeDestroy"),this.destroyNested(),this.modal.remove(),-1!=e&&__APP.MODALS.collection.splice(e,1),__APP.MODALS.modal_wrapper.trigger("modal.afterDestroy"),this},e}(),AddStaffModal=extending(AbstractModal,function(){function e(e,t){AbstractModal.call(this),this.org_id=e,this.organization=new OneOrganization(this.org_id),this.role=t}return e.prototype.render=function(){return this.content=tmpl("modal-add-staff-content",{modal_id:this.id,org_id:this.org_id,role:this.role}),this.__render({width:380,classes:[__C.CLASSES.FLOATING_MATERIAL,__C.CLASSES.MODAL_STATES.SIZE.TINY],content_classes:[__C.CLASSES.ALIGN.CENTER]}),this},e.prototype.init=function(){function e(e){return __APP.BUILD.avatarBlocks(e,{avatar_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}).outerHTML()}var t=this,n=this.content.find(".SearchByName");return bindRippleEffect(this.content),initSelect2(n,{width:"100%",placeholder:n.attr("placeholder"),ajax:{url:"/api/v1/users/",dataType:"JSON",data:function(e,t,n){return{name:e}},results:function(t,n,i){var a=new UsersCollection;return a.setData(t.data),{results:a,text:e}}},containerCssClass:"",dropdownCssClass:"form_select2_drop",formatResult:e,formatSelection:e}),this.content.find(".AddStaff").on("click",function(){var e=$(this).closest("form").serializeForm();t.organization.addStaff(e.user_id,e.role,function(n){__APP.CURRENT_PAGE.$view.trigger("staff:add",[e.role,n]),t.hide()})}),this},e}()),AuthModal=extending(AbstractModal,function(){function e(e,t){AbstractModal.call(this),this.options=t||{},this.redirect_to=e}return e.prototype.render=function(e){var t=this;return this.content=tmpl("modal-auth-content",function(){var e={};return t.options.note&&(e.note=t.options.note),e}()),this.__render({classes:[__C.CLASSES.FLOATING_MATERIAL],width:480}),this},e.prototype.init=function(){var e=this;return this.modal.find(".AuthButton").each(function(){$(this).on("click",function(t){__APP.USER.auth($(this).data("auth_network"),e.redirect_to),t.preventDefault()})}),this.__init(),bindRippleEffect(this.modal),bindHelpLink(this.modal),this},e}()),BitcoinModal=extending(AbstractModal,function(){function e(e,t){var n=[];AbstractModal.call(this),this.title="Оплата через Bitcoin",this.event=new OneEvent,this.order=new OneOrder,this.fetching_promise=Promise,this.render_deferred=Promise,e instanceof OneEvent?this.event.setData(e):"number"==typeof e&&(this.event.id=e),t instanceof OneOrder?this.order.setData(t):"string"==typeof t&&(this.order.event_id=this.event.id,this.order.uuid=t),this.address=null,this.amount=null,n.push(this.order.fetchBitcoinData()),(empty(e)||"number"==typeof e)&&n.push(this.event.fetchEvent()),(empty(t)||"string"==typeof t)&&n.push(this.order.fetch()),this.fetching_promise=__APP.SERVER.multipleAjax.apply(__APP.SERVER,n)}return e.prototype.render=function(e){var t=this;return this.fetching_promise.then(function(e){t.amount=e.amount,t.address=e.address,t.content=tmpl("modal-bitcoin-content",{order_number:formatTicketNumber(t.order.number),ticket_types:tmpl("modal-bitcoin-ticket-type-row",[]),event_id:t.event.id,order_uuid:t.order.uuid,bitcoin_amount:t.amount,bitcoin_address:t.address}),t.__render({classes:[__C.CLASSES.FLOATING_MATERIAL],width:480,content_classes:[__C.CLASSES.MODAL_STATES.NO_PADDING],footer_buttons:__APP.BUILD.button({classes:[__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.HOOKS.CLOSE_MODAL,__C.CLASSES.HOOKS.RIPPLE],title:"Готово"})}),t.render_deferred.resolve()}),this},e.prototype.show=function(){var e=this;return this.render(),this.render_deferred.then(function(){e.__show()}),this},e}()),CityChooseModal=extending(AbstractModal,function(){function e(e){AbstractModal.call(this,AbstractModal.STYLES.OK_ONLY),this.cities=e,this.title="Выбор города"}return e.prototype.show=function(){var e=this;return this.cities?(this.__show(),this):(this.cities=new CitiesCollection,this.cities.fetchCities("timediff_seconds",0,"distance,local_name",function(){e.__show()}),this)},e.prototype.render=function(){return this.content=tmpl("modal-city-choose-content",{cities:tmpl("option",this.cities.map(function(e){return{val:e.id,display_name:e.local_name}}))}),this.__render({classes:[__C.CLASSES.FLOATING_MATERIAL],width:400}),this},e.prototype.init=function(){return initSelect2(this.content.find("#city_choose_modal_select")).select2("val",1),this.__init(),this},e.prototype.hide=function(){__APP.USER.selected_city=this.cities.getByID(this.content.find("#city_choose_modal_select").val());try{localStorage.setItem("selected_city",JSON.stringify(__APP.USER.selected_city))}catch(e){}return this.__hide(),__APP.reload(),this},e}()),CropperModal=extending(AbstractModal,function(){function e(e,t){if(AbstractModal.call(this),!e)throw Error("To initiate cropper you need to pass image source (image_src)");t="object"==(void 0===t?"undefined":_typeof(t))?t:{},this.image_src=e,this.is_fetched=!0,this.content=tmpl("modal-cropper-content",{image_src:this.image_src}),this.options=$.extend({viewMode:1,responsive:!1,scalable:!1,zoomable:!1,zoomOnWheel:!1},t)}return e.prototype.render=function(){var e=this,t=this.content;return this.__render({classes:[__C.CLASSES.FLOATING_MATERIAL,__C.CLASSES.MODAL_STATES.SIZE.WIDE],content_classes:[__C.CLASSES.MODAL_STATES.NO_PADDING,__C.CLASSES.IMG_HOLDER],footer_buttons:__APP.BUILD.button({classes:[__C.CLASSES.COLORS.PRIMARY,"CropButton",__C.CLASSES.HOOKS.RIPPLE],title:"Кадрировать"},{classes:[__C.CLASSES.COLORS.DEFAULT,"DestroyCropButton",__C.CLASSES.HOOKS.RIPPLE],title:"Отмена"})}),t.on("load",function(){t.cropper(e.options)}).attr("src",this.image_src),this},e.prototype.init=function(){var e=this;return this.modal.find(".CropButton").on("click.Crop",function(){e.crop(),e.hide()}),this.modal.find(".DestroyCropButton").on("click.DestroyCrop",function(){e.hide()}),this},e.prototype.destroyNested=function(){return this.content.cropper("destroy"),this.modal.find(".CropButton").off("click.Crop"),this.modal.find(".DestroyCropButton").off("click.DestroyCrop"),this},e.prototype.crop=function(){return this.modal.trigger("crop",[this.content.cropper("getCroppedCanvas").toDataURL()]),this},e}()),MapModal=extending(AbstractModal,function(){function e(e){if(AbstractModal.call(this),!e)throw Error("To initiate map you need to pass location (location)");this.location=e}return e.prototype.render=function(){return this.content=tmpl("modal-map-content",{iframe_height:$(window).height()-200,location:this.location}),this.__render({classes:[__C.CLASSES.FLOATING_MATERIAL,__C.CLASSES.MODAL_STATES.SIZE.WIDE],content_classes:[__C.CLASSES.MODAL_STATES.NO_PADDING]}),this},e.prototype.show=function(){var e=this,t=$(window);return t.on("resize.changeMapHeight",function(){e.content.height(t.height()-200),e.adjustDestroyerHeight()}),this.__show(),this},e.prototype.hide=function(){return $(window).off("resize.changeMapHeight"),this.__hide(),this},e}()),MediaModal=extending(AbstractModal,function(){function e(e,t){if(AbstractModal.call(this),!e)throw Error("To open media you need to pass media source (src)");"image"===t&&(this.content=tmpl("modal-image-media-content",{src:e})),this.src=e,this.format=t||"image"}return e.prototype.render=function(){return this.__render({classes:[__C.CLASSES.FLOATING_MATERIAL,__C.CLASSES.MODAL_STATES.SIZE.RESPONSIVE],content_classes:[__C.CLASSES.IMG_HOLDER,__C.CLASSES.MODAL_STATES.NO_PADDING]}),this},e.prototype.show=function(){var e=this;return this.content.on("load",function(){e.adjustDestroyerHeight()}),this.__show(),this},e}()),StdModal=extending(AbstractModal,function(){function e(e,t,n){AbstractModal.call(this,n),this.title=e,this.content=t}return e.STYLES=AbstractModal.STYLES,Object.freeze(e.STYLES),e}()),TicketsModal=extending(AbstractModal,function(){function e(e){if(AbstractModal.call(this),this.fetch_ticket_data=null,e instanceof TicketsCollection)this.tickets=e;else if(e instanceof Array||e instanceof OneTicket)this.tickets=new TicketsCollection,this.tickets.setData(e);else{if(empty(e)||!e.event_id||!e.uuid)throw Error("Constructor needs instance of OneExtendedTicket class to create new instance of TicketsModal");this.tickets=new TicketsCollection,this.fetch_ticket_data=e}}return e.NECESSARY_FIELDS=new Fields("created_at","number","ticket_type","order",{event:{fields:new Fields("dates","is_same_time","location")}}),e.prototype.fetchData=function(){var t,n=this;return this.fetch_ticket_data?(t=new OneTicket(this.fetch_ticket_data.event_id,this.fetch_ticket_data.uuid)).fetch(e.NECESSARY_FIELDS).then(function(){n.tickets.push(t)}):AbstractModal.prototype.fetchData.call(this)},e.prototype.render=function(e){var t=this;return this.content=tmpl("modal-ticket-content",Builder.normalizeTicketProps(this.tickets).map(function(e,n){var i=t.tickets[n].order.payed_at||t.tickets[n].created_at;return e.cover_width=480,e.card_classes.push("-ticket_extended",__C.CLASSES.FLOATING_MATERIAL),$.extend(e,{cover_height:269,event_id:t.tickets[n].event.id,ticket_uuid:t.tickets[n].uuid,number_formatted:formatTicketNumber(t.tickets[n].number),payed_at_formatted:moment.unix(i).format(__LOCALES.ru_RU.DATE.DATE_TIME_FORMAT),price_formatted:+t.tickets[n].price?formatCurrency(t.tickets[n].price," ",".","","₽"):"Бесплатно"})})),this.__render({content_classes:[__C.CLASSES.MODAL_STATES.NO_PADDING]}),this},e}()),WithdrawModal=extending(AbstractModal,function(){function e(e){AbstractModal.call(this),this.withdraw=new WithdrawModel,this.organization=e}return e.prototype.init=function(){function e(){return isFormValid(t.content)&&(t.withdraw.setData(Object.assign({created_at:moment().unix(),status_type_code:WithdrawModel.STATUS.PENDING,user:__APP.USER},t.content.serializeForm())),t.organization.requestWithdrawFunds(t.withdraw.sum,t.withdraw.comment).then(function(){__APP.CURRENT_PAGE instanceof AdminOrganizationFinancesPage&&__APP.CURRENT_PAGE.appendWithdraw(t.withdraw),t.destroy()})),!1}var t=this;return this.modal.find(".WithdrawFunds").on("click.WithdrawFunds",e),this.content.on("submit",e),this.__init(),this},e.prototype.render=function(e){return this.content=tmpl("modal-withdraw-content",{avatar_block:__APP.BUILD.avatarBlocks(__APP.USER,{avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),amount_form_unit:__APP.BUILD.formUnit({label:"Сумма",name:"sum",type:"number",placeholder:"Желаемая сумма для вывода",required:!0}),comment_form_unit:__APP.BUILD.formUnit({label:"Примечание",name:"comment",type:"textarea",helptext:"Для вашего удобства, можете написать причину вывода средств, либо любую другую служебную информацию."})}),this.__render({width:480,title:"Запрос вывода средств на расчетный счет",classes:[__C.CLASSES.FLOATING_MATERIAL],footer_buttons:__APP.BUILD.button({classes:[__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.HOOKS.RIPPLE,"WithdrawFunds"],title:"Запросить вывод средств"})}),this},e}()),PreviewRegistrationModal=extending(AbstractModal,function(){function e(e){AbstractModal.call(this),this.event=e,this.title="Регистрация"}return e.prototype.render=function(){var e=this;return this.__render({classes:["material","-floating"],width:400,content:tmpl("modal-registration-content",{modal_id:this.id,required_star:tmpl("required-star"),event_title:this.event.title,fields:$.makeSet(this.event.registration_fields.map(e.buildRegistrationField.bind(e)))})}),this},e.prototype.init=function(){return this.content.find(".RegisterButton").prop("disabled",!0),initSelect2(this.content.find(".ToSelect2"),{dropdownCssClass:"form_select2_drop form_select2_drop_no_search"}),this.__init(),this},e.prototype.buildRegistrationField=function(e){var t=this;switch(e.type){case RegistrationFieldModel.TYPES.SELECT:return function(e,t){return tmpl("form-unit",Builder.normalizeBuildProps($.extend(!0,{},e,{label:tmpl("label",Builder.normalizeBuildProps({id:e.id,label:e.label})),form_element:__APP.BUILD.select(t.map(function(e){return{display_name:e.value,val:e.uuid||guid()}}),{id:e.id,name:e.name,required:e.required},e.classes)})))}({id:"registration_form_"+t.id+"_"+e.uuid,name:e.uuid,unit_classes:["Registration"+e.type.toCamelCase("_")+"Field"],classes:["form_select2","ToSelect2"],label:$("<span>"+e.label+"</span>").add(e.required?tmpl("required-star"):$()),required:e.required},e.values instanceof Array?e.values:[]);case RegistrationFieldModel.TYPES.SELECT_MULTI:return function(e,t){return tmpl("form-unit",Builder.normalizeBuildProps($.extend(!0,{},e,{unit_classes:e.classes,label:tmpl("label",Builder.normalizeBuildProps({id:e.id+"_label",label:e.label})),form_element:__APP.BUILD.checkbox.apply(__APP.BUILD,t.map(function(t){return{id:"registration_field_value_"+(t.uuid||guid()),name:e.name,label:t.value,attributes:{value:t.uuid||guid(),required:e.required}}}))})))}({id:"registration_form_"+t.id+"_"+e.uuid,type:"checkbox",name:e.uuid,classes:["Registration"+e.type.toCamelCase("_")+"Field"],label:$("<span>"+e.label+"</span>").add(e.required?tmpl("required-star"):$()),required:e.required},e.values instanceof Array?e.values:[]);default:return __APP.BUILD.formUnit({id:"registration_form_"+this.id+"_"+e.uuid,type:e.type===RegistrationFieldModel.TYPES.EXTENDED_CUSTOM?"textarea":e.type,name:e.uuid,classes:["Registration"+e.type.toCamelCase("_")+"Field"],label:$("<span>"+e.label+"</span>").add(e.required?tmpl("required-star"):$()),placeholder:e.label,required:e.required,helptext:function(t){switch(e.type){case RegistrationFieldModel.TYPES.EMAIL:return"На почту Вам поступит сообщение с подтверждением регистрации";case RegistrationFieldModel.TYPES.FIRST_NAME:return"Используйте настоящее имя для регистрации";case RegistrationFieldModel.TYPES.LAST_NAME:return"Используйте настоящую фамилию для регистрации";default:return""}}()})}},e}()),RegistrationModal=extending(PreviewRegistrationModal,function(){function e(e){PreviewRegistrationModal.call(this,e)}return e.prototype.init=function(){var e=this;return this.content.find(".RegisterButton").on("click.Register",function(){var t=$(this),n=t.closest(".RegistrationModalForm");t.attr("disabled",!0),isFormValid(n)&&OneEvent.registerToEvent(e.event.id,n.serializeForm("array").map(function(e){return{uuid:e.name,value:e.value}})).then(function(){e.modal.trigger("registration:success"),e.hide()}),t.removeAttr("disabled")}),this.content.find(".RegistrationFirstNameField").val(__APP.USER.first_name),this.content.find(".RegistrationLastNameField").val(__APP.USER.last_name),this.content.find(".RegistrationEmailField").val(__APP.USER.email),bindRippleEffect(this.content),initSelect2(this.content.find(".ToSelect2"),{dropdownCssClass:"form_select2_drop form_select2_drop_no_search"}),this.__init(),this},e}()),AbstractListModal=extending(AbstractModal,function(){function e(e){AbstractModal.call(this),this.content=tmpl("modal-list-content"),this.entity=e,this.entities=new EntitiesCollection,this.content_is_scrollable=!0}return e.prototype.render=function(){return this.__render({width:384,height:"calc(100% - 140px)",classes:["material","-floating","-fixed"],content_classes:["list_modal_content"]}),this},e.prototype.uploadEntities=function(){return Promise.resolve()},e.prototype.buildEntities=function(e){return $()},e.prototype.show=function(){var e=this;return this.content.children().length?(this.__show(),this):(this.render(),this.content.append(this.buildEntities(this.entities)),this.entities.length<5?this.uploadEntities().then(function(){e.__show()}):this.__show(),this)},e.prototype.onScrollToBottom=function(e){var t=this,n=__APP.BUILD.loaderBlock(this.content);return this.uploadEntities().catch(function(){t.block_scroll=!1}).then(function(){n.remove(),e.call(t)}),this},e}()),FriendsListModal=extending(AbstractListModal,function(){function e(t){if("object"===_typeof(e.instance))return e.instance;AbstractListModal.call(this,t),this.title="Подписки на пользователей",this.entities=this.entity.friends,e.instance=this}return e.prototype.uploadEntities=function(){var e=this;return __APP.USER.fetchFriends({length:20}).then(function(t){t.length?e.content.append(e.buildEntities(t)):e.is_upload_disabled=!0})},e.prototype.buildEntities=function(e){var t=__APP.BUILD.avatarBlocks(e,{is_link:!0,entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]});return bindPageLinks(t),t},e}()),SubscriptionsListModal=extending(AbstractListModal,function(){function e(e){AbstractListModal.call(this,e),this.title="Подписки на организации",this.entities=this.entity.subscriptions}return e.prototype.uploadEntities=function(){var e=this;return this.entity.fetchSubscriptions({length:20}).then(function(t){t.length?e.content.append(e.buildEntities(t)):e.is_upload_disabled=!0})},e.prototype.buildEntities=function(e){var t=__APP.BUILD.avatarBlocks(e,{is_link:!0,entity:__C.ENTITIES.ORGANIZATION,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]});return bindPageLinks(t),t},e}()),AbstractUsersModal=extending(AbstractModal,function(){function e(t,n){if(AbstractModal.call(this),this.title=n,this.entity_id=t,this.entities_length=30,this.is_upload_disabled=!1,this.users=new UsersCollection,this.is_first=!0,this.wrapper_is_scrollable=!0,this.constructor===e)throw new Error("Can't instantiate abstract class!")}return e.prototype.show=function(){var e=this;return this.block_scroll=!1,this.users.length?(this.__show(),this):(this.render({width:"60%"}),this.uploadUsers(function(){e.__show()}),this)},e.prototype.init=function(){return bindPageLinks(this.modal),this.__init(),this},e.prototype.onScrollToBottom=function(e){var t=this;return this.uploadUsers(function(){e.call(t)}),this},e.prototype.hide=function(){return this.block_scroll=!1,this.modal_wrapper.off("scroll.uploadUsers"),this.__hide(),this},e.prototype.uploadUsers=function(e){},e.prototype.buildUsers=function(e){var t=$(),n="true"==this.content_wrapper.find(".UserTombstone").eq(-1).data("is_friend"),i=this;return e.forEach(function(e,a){(i.is_first&&!a||n!=e.is_friend)&&(t=t.add(tmpl("modal-users-divider",{label:e.is_friend?"Друзья":"Все"})),n=e.is_friend),t=t.add(__APP.BUILD.userTombstones(e,{tombstone_classes:["UserTombstone"],is_link:!0,dataset:{is_friend:e.is_friend}}))}),t},e.prototype.afterUpload=function(e){var t,n=this;e.length?(t=this.buildUsers(e),this.content_wrapper.append(t),this.is_first=!1,this.entities_length=10,this.adjustDestroyerHeight(),bindPageLinks(t),t.on("click.hideModal",function(){n.hide()})):this.is_upload_disabled=!0},e}()),EditorsModal=extending(AbstractUsersModal,function(){function e(e,t,n){AbstractUsersModal.call(this,e,t||"Редакторы"),this.ajax_data={order_by:"role,first_name"},n&&(this.ajax_data.roles=n)}return e.prototype.uploadUsers=function(e){var t=this;return this.users.fetchOrganizationStaff(this.entity_id,this.entities_length,this.ajax_data,function(n){t.afterUpload(n),e&&"function"==typeof e&&e(n)})},e.prototype.buildUsers=function(e){var t=$(),n=this.content_wrapper.find(".UserTombstone").last().data("role"),i={admin:"Администраторы",moderator:"Модераторы"},a=this;return e.forEach(function(e,r){(a.is_first&&!r||n!=e.role)&&(t=t.add(tmpl("modal-users-divider",{label:i[e.role]})),n=e.role),t=t.add(__APP.BUILD.userTombstones(e,{tombstone_classes:["UserTombstone"],is_link:!0,dataset:{role:e.role}}))}),t},e}()),FavoredModal=extending(AbstractUsersModal,function(){function e(e,t){if(!e)throw Error("To open favored modal you need to pass event_id");AbstractUsersModal.call(this,e,t||"Добавили в избранное"),this.ajax_data={fields:["is_friend"],order_by:"-is_friend,first_name"}}return e.prototype.uploadUsers=function(e){var t=this;return this.users.fetchEventFavorites(this.entity_id,this.entities_length,this.ajax_data,function(n){t.afterUpload(n),e&&"function"==typeof e&&e(n)})},e}()),SubscribersModal=extending(AbstractUsersModal,function(){function e(e,t){if(!e)throw Error("To open favored modal you need to pass organization_id");AbstractUsersModal.apply(this,[e,t||"Подписались"]),this.entity_id=e,this.ajax_data={fields:["is_friend"],order_by:"-is_friend,first_name"}}return e.prototype.uploadUsers=function(e){var t=this;return this.users.fetchOrganizationSubscribers(this.entity_id,this.entities_length,this.ajax_data,function(n){t.afterUpload(n),e&&"function"==typeof e&&e(n)})},e}());var Page=function(){function e(){_classCallCheck(this,e),this.name=this.constructor.name,this.state_name=this.name,this.page_component=null,this.page_title=setDefaultValue(this.page_title,""),this.pageTitle=setDefaultValue(this.pageTitle,function(){}),this.page_title_obj=setDefaultValue(this.page_title_obj,""),this.$view=setDefaultValue(this.$view,$(".PageView")),this.$wrapper=setDefaultValue(this.$wrapper,$()),this.$loader=$(),this.wrapper_tmpl=setDefaultValue(this.wrapper_tmpl,"std"),this.with_header_tabs=setDefaultValue(this.with_header_tabs,!1),this.location=parseUri(window.location),this.render_vars=setDefaultValue(this.render_vars,{}),this.rendering_defer=null,this.fetching_data_defer=null}return _createClass(e,[{key:"show",value:function(){var e,t=this,n=__APP.IS_REACT_PAGE||__APP.PREVIOUS_PAGE.wrapper_tmpl!==t.wrapper_tmpl,i=n?"$view":"$wrapper",a=$(".PageView"),r=__APP.PREVIOUS_PAGE[i].length?__APP.PREVIOUS_PAGE[i]:n?a:a.find(".Content"),s=History.getState();r.addClass("-faded"),$("body").trigger("Page:change/start",[__APP.CURRENT_PAGE,__APP.PREVIOUS_PAGE]),__APP.IS_PREV_PAGE_REACT=__APP.IS_REACT_PAGE,__APP.IS_REACT_PAGE=!1,__APP.LOADER.appendTo(a),t.rendering_defer=new Promise(function(e){setTimeout(function(){r.addClass(__C.CLASSES.HIDDEN),$("body").removeClass(function(e,t){return(t.match(/(^|\s)-state_\S+/g)||[]).join(" ")}).addClass("-state_"+t.state_name.toUnderscore()),n&&t.$view.html(tmpl(t.wrapper_tmpl+"-wrapper",{})),t.$wrapper=t.$view.find(".Content"),t.$wrapper.empty(),t.$view.removeClass(__C.CLASSES.HIDDEN),t.$wrapper.removeClass(__C.CLASSES.HIDDEN),t[i].addClass("-faded"),e()},200)}),Promise.all([t.rendering_defer,t.fetching_data_defer]).then(function(){if(t.checkRedirect())return t.redirect();(t.page_title_obj||t.page_title||t.pageTitle())&&__APP.changeTitle(t.page_title_obj||t.page_title||t.pageTitle()),__APP.IS_WIDGET||(t.with_header_tabs?(__APP.TOP_BAR.renderHeaderTabs(t.renderHeaderTabs()),__APP.TOP_BAR.showTabs()):__APP.TOP_BAR.hideTabs()),$(document.scrollingElement).scrollTop(0),t.preRender(),t.render(),e=s.data.parsed_page_uri&&s.data.parsed_page_uri.anchor?t.$wrapper.find("#"+s.data.parsed_page_uri.anchor):$(),bindPageLinks(),$("body").trigger("Page:change/end",[__APP.CURRENT_PAGE,__APP.PREVIOUS_PAGE]),setTimeout(function(){t[i].removeClass("-faded"),__APP.LOADER.detach(),scrollTo(e,400)},200)})}},{key:"renderHeaderTabs",value:function(){}},{key:"fetchData",value:function(){return this.fetching_data_defer=Promise.resolve()}},{key:"checkRedirect",value:function(){return!1}},{key:"redirect",value:function(){}},{key:"init",value:function(){}},{key:"preRender",value:function(){}},{key:"render",value:function(){}},{key:"destroy",value:function(){}}],[{key:"routeNewPage",value:function(t){var n,i=[];return(n=decodeURIComponent(t).split("/").reduce(function(e,t){return t?e.hasOwnProperty(t)?e[t]:Object.keys(e).reduce(function(n,a){return!n&&0===a.indexOf("^")&&new RegExp(a).test(t)?(i.push(t),e[a]):n},!1):e},__APP.ROUTING)).prototype instanceof e||(n=n[""]&&n[""].prototype instanceof e?n[""]:NotFoundPage),new(Function.prototype.bind.apply(n,[null].concat(i)))}}]),e}();AdminPage=extending(Page,function(){function e(){Page.apply(this),this.state_name="admin"}return e.HIGHCHART_DEFAULT_OPTIONS=Object.freeze({chart:{backgroundColor:null,plotBorderWidth:null,plotShadow:!1,style:{fontFamily:"inherit",fontSize:"inherit"}},title:{text:!1},credits:{enabled:!1}}),e.HIGHSTOCK_AREA_OPTIONS=Object.freeze($.extend(!0,{},e.HIGHCHART_DEFAULT_OPTIONS,{chart:{type:"areaspline",plotBackgroundColor:"#fcfcfc",plotBorderColor:"#ebebeb",plotBorderWidth:1,spacingBottom:25},colors:[__C.COLORS.FRANKLIN,__C.COLORS.MUTED_80,__C.COLORS.ACCENT,__C.COLORS.MUTED,__C.COLORS.MUTED_50,__C.COLORS.MUTED_30],title:{align:"left",style:{"font-size":"1.25rem","font-weight":500}},legend:{enabled:!0,align:"left",itemStyle:{color:__C.COLORS.TEXT,cursor:"pointer",fontSize:"14px",fontWeight:"500",y:0},itemMarginTop:24,itemMarginBottom:5,symbolHeight:18,symbolWidth:18,symbolRadius:9,itemDistance:42,x:30},plotOptions:{series:{states:{hover:{lineWidth:2}}},areaspline:{fillOpacity:.5,marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}},dataGrouping:{dateTimeLabelFormats:{millisecond:["%b %e, %H:%M:%S.%L","%b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%b %e, %H:%M:%S","%b %e, %H:%M:%S","-%H:%M:%S"],minute:["%b %e, %H:%M","%b %e, %H:%M","-%H:%M"],hour:["%b %e, %H:%M","%b %e, %H:%M","-%H:%M"],day:["%b %e, %Y","%b %e","-%b %e, %Y"],week:["%b %e, %Y","%b %e","-%b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}}}},tooltip:{headerFormat:"<b>{point.key}</b><br/>",positioner:function(e,t){return{x:this.chart.plotLeft,y:this.chart.plotTop}},shadow:!1,shape:"square",valueDecimals:0,xDateFormat:"%e %b %Y",shared:!0},scrollbar:{enabled:!1},navigator:{outlineColor:"#ebebeb",outlineWidth:0,maskInside:!1,maskFill:"rgba(245, 245, 245, 0.66)",handles:{backgroundColor:"#9fa7b6",borderColor:"#fff"},xAxis:{gridLineWidth:0,labels:{align:"left",reserveSpace:!0,style:{color:"#888"},x:0,y:null}}},rangeSelector:{buttonTheme:{width:null,height:22,fill:"none",stroke:"none",r:14,style:{color:__C.COLORS.MUTED_80,fontSize:"13px",fontWeight:"400",textTransform:"uppercase",dominantBaseline:"middle"},states:{hover:{fill:__C.COLORS.MUTED_50,style:{color:"#fff"}},select:{fill:__C.COLORS.MUTED_80,style:{color:"#fff",fontWeight:"400"}}}},buttons:[{type:"day",count:7,text:"   Неделя   "},{type:"month",count:1,text:"   Месяц   "},{type:"year",count:1,text:"   Год   "},{type:"all",text:"   Все время   "}],allButtonsEnabled:!0,selected:2,labelStyle:{display:"none"},inputEnabled:!1},xAxis:{gridLineWidth:1,gridLineDashStyle:"dash",type:"datetime",showEmpty:!1,tickPosition:"inside",dateTimeLabelFormats:{minute:"%H:%M",hour:"%H:%M",day:"%e %b",week:"%e %b",month:"%b %y",year:"%Y"}},yAxis:{allowDecimals:!1,floor:0,min:0,gridLineDashStyle:"dash",opposite:!1,title:{text:!1}}})),e.areaChartSeriesNormalize=function(e){return e.sortBy("time_value",!0).map(function(e){return[moment.unix(e.time_value).valueOf(),e.value]})},e.buildStockChart=function(t,n,i,a){t.highcharts("StockChart",$.extend(!0,{},e.HIGHSTOCK_AREA_OPTIONS,{title:{text:n},series:i},a))},e.prototype.areaChartSeriesNormalize=function(e){function t(e,t,n){return{name:a[t],data:e.map(function(e,t){return[moment.unix(e.time_value).valueOf(),e[n]]})}}var n={open_conversion:{with:"open_site",to:"view"},fave_conversion:{with:"fave",to:"open_site"},conversion:{with:"subscribe",to:"view"}},i={subscribe_unsubscribe:{subscribe:"subscribe",unsubscribe:"unsubscribe"}},a={notifications_sent:"Отправлено уведомлений",view:"Просмотры",view_detail:"Открытий страницы события из ленты Evendate",conversion:"Конверсия",subscribe:"Подписалось",unsubscribe:"Отписалось",open_site:"Открытий страницы события",open_conversion:"Конверсия просмотра события в ленте к открытию страницы события",fave:"Кол-во пользователей, которые добавили событие в избранное",fave_conversion:"Конверсия открытия страницы события к добавлениям в избранное"},r={showInLegend:!1,lineWidth:0,fillOpacity:0,states:{hover:{enabled:!1}}},s={};return $.each(e,function(e,a){s[e]=[],n.hasOwnProperty(e)?(s[e].push($.extend(!0,{tooltip:{valueSuffix:" %"}},t(a,e,"value"))),$.each(n[e],function(n,i){s[e].push($.extend(!0,{},r,t(a,i,n)))})):i.hasOwnProperty(e)?$.each(i[e],function(n,i){s[e].push(t(a,i,n))}):s[e].push(t(a,e,"value"))}),s},e.prototype.buildAreaCharts=function(t,n){var i=this,a=i.areaChartSeriesNormalize(t),r={notifications_sent:{title:"Отправлено уведомлений пользователям",wrapper_class:"NotificationsSentAreaChart"},view:{title:"Просмотры",wrapper_class:"ViewAreaChart"},view_detail:{title:"Открытий страницы события",wrapper_class:"ViewDetailAreaChart"},open_site:{title:"Открытий страницы события из ленты Evendate",wrapper_class:"OpenSiteAreaChart"},open_conversion:{title:"Конверсия просмотров/открытий",wrapper_class:"OpenConversionsAreaChart"},fave:{title:"Добавлений в избранное",wrapper_class:"FaveAreaChart"},fave_conversion:{title:"Конверсия открытий/добавлений в избранное",wrapper_class:"FaveConversionsAreaChart"},subscribe_unsubscribe:{title:"Подписчики",wrapper_class:"SubscriberAreaChart"},conversion:{title:"Конверсия просмотров/подписок",wrapper_class:"ConversionAreaChart"}},s=[["rgba(35, 215, 146, 0.18)","rgba(101, 101, 101, 0.6)","rgba(101, 101, 101, 0.6)"],["rgba(35, 215, 146, 0.09)","rgba(101, 101, 101, 0.6)","rgba(101, 101, 101, 0.6)"]],o=$.extend(!0,{},e.HIGHCHART_DEFAULT_OPTIONS,{chart:{type:"areaspline",plotBackgroundColor:"#fcfcfc",plotBorderColor:"#ebebeb",plotBorderWidth:1},colors:[__C.COLORS.FRANKLIN,__C.COLORS.MUTED_80,__C.COLORS.ACCENT,__C.COLORS.MUTED,__C.COLORS.MUTED_50,__C.COLORS.MUTED_30],title:{align:"left",margin:20},legend:{enabled:!0,align:"left",itemStyle:{color:__C.COLORS.TEXT,cursor:"pointer",fontSize:"14px",fontWeight:"500",y:0},itemMarginTop:24,itemMarginBottom:5,symbolHeight:18,symbolWidth:18,symbolRadius:9,itemDistance:42,x:30},plotOptions:{series:{states:{hover:{lineWidth:2}}},areaspline:{fillOpacity:.5,marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}},dataGrouping:{dateTimeLabelFormats:{millisecond:["%b %e, %H:%M:%S.%L","%b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%b %e, %H:%M:%S","%b %e, %H:%M:%S","-%H:%M:%S"],minute:["%b %e, %H:%M","%b %e, %H:%M","-%H:%M"],hour:["%b %e, %H:%M","%b %e, %H:%M","-%H:%M"],day:["%b %e, %Y","%b %e","-%b %e, %Y"],week:["%b %e, %Y","%b %e","-%b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}}}},tooltip:{headerFormat:"<b>{point.key}</b><br/>",positioner:function(e,t){return{x:this.chart.plotLeft,y:this.chart.plotTop}},shadow:!1,shape:"square",valueDecimals:0,xDateFormat:"%e %b %Y",shared:!0},scrollbar:{enabled:!1},navigator:{outlineColor:"#ebebeb",outlineWidth:1,maskInside:!1,maskFill:"rgba(245, 245, 245, 0.66)",handles:{backgroundColor:"#9fa7b6",borderColor:"#fff"},xAxis:{gridLineWidth:0,labels:{align:"left",reserveSpace:!0,style:{color:"#888"},x:0,y:null}}},rangeSelector:{buttonTheme:{width:null,height:22,fill:"none",stroke:"none",r:14,style:{color:__C.COLORS.MUTED_80,fontSize:"13px",fontWeight:"400",textTransform:"uppercase",dominantBaseline:"middle"},states:{hover:{fill:__C.COLORS.MUTED_50,style:{color:"#fff"}},select:{fill:__C.COLORS.MUTED_80,style:{color:"#fff",fontWeight:"400"}}}},buttons:[{type:"day",count:7,text:"   Неделя   "},{type:"month",count:1,text:"   Месяц   "},{type:"year",count:1,text:"   Год   "},{type:"all",text:"   Все время   "}],allButtonsEnabled:!0,selected:2,labelStyle:{display:"none"},inputEnabled:!1},xAxis:{gridLineWidth:1,gridLineDashStyle:"dash",type:"datetime",showEmpty:!1,tickPosition:"inside",dateTimeLabelFormats:{minute:"%H:%M",hour:"%H:%M",day:"%e %b",week:"%e %b",month:"%b %y",year:"%Y"}},yAxis:{allowDecimals:!1,floor:0,min:0,gridLineDashStyle:"dash",opposite:!1,title:{text:!1}}},n);$.each(a,function(e){var t={title:{text:r[e].title}};t.series=a[e].map(function(e,t){return 0!==e.fillOpacity?$.extend(!0,{},e,{fillColor:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:s.map(function(e,n){return[n,e[t]]})}}):e}),"conversion"!=e&&"open_conversion"!=e&&"fave_conversion"!=e||(t.yAxis={max:100,labels:{format:"{value}%"}}),i.$wrapper.find("."+r[e].wrapper_class).highcharts("StockChart",$.extend(!0,{},o,t))})},e.prototype.updateScoreboards=function(e,t,n,i,a){var r=!!t.dynamics;i||(i=Object.keys(n)),i.forEach(function(i){var s,o="Scoreboard"+i.toCamelCase("_"),l=e.find("."+o);switch(i){case"conversion":case"open_conversion":case"fave_conversion":s="%"}l.length||(l=tmpl(r?"scoreboard-with-dynamics":"scoreboard",{type:o,title:n[i],size:a?"-size_"+a:"-size_normal",number:0+s,dynamic_by_week:0+s},e)),void 0!==t.numbers[i]&&l.find(".ScoreboardNumber").animateNumber({number:Math.round(t.numbers[i]),suffix:s},2e3,"easeOutSine"),r&&void 0!==t.dynamics[i]&&l.find(".ScoreboardDynamic").animateNumber({number:Math.round(t.dynamics[i]),prefix:0==t.dynamics[i]?void 0:t.dynamics[i]>0?"+":"-",suffix:s},2e3,"easeOutSine").siblings("label").removeClass("fa-caret-up -text_color_franklin fa-caret-down -text_color_bubblegum").addClass(0==t.dynamics[i]?"":t.dynamics[i]>0?"fa-caret-up -text_color_franklin":"fa-caret-down -text_color_bubblegum")})},e}()),AdminAbstractDispatchPage=extending(AdminPage,function(){function e(e){AdminPage.call(this),this.organization_id=e,this.dispatch=new OneAbstractDispatch,this.events=new EventsCollection,this.events_defer=Promise,this.is_disabled=!this.dispatch.is_active||this.dispatch.done}return e.prototype.gatherSendData=function(){var e=this.$wrapper.serializeForm();return{uuid:e.uuid,event_id:0==+e.event_id||isNaN(+e.event_id)?null:e.event_id,organization_id:e.organization_id,is_email:"is_email"===e.dispatch_type,is_push:"is_push"===e.dispatch_type,is_sms:!0===e.is_sms,title:e.title,subject:e.subject,message_text:e.message_text,url:e.url,is_active:!0,notification_time:e.notification_send_now?moment().tz("UTC").format():moment(e.notification_date+" "+e.notification_time).tz("UTC").format()}},e.prototype.preRender=function(){},e.prototype.fetchEvents=function(){return this.events_defer.resolve()},e.prototype.initEventSelect=function(e){},e.prototype.init=function(){var e=this;this.events_defer.then(function(){e.initEventSelect(e.$wrapper.find(".EventsSelect").append(__APP.BUILD.option(e.events.map(function(e){return{val:e.id,display_name:e.title}}))))}),this.$wrapper.find(".SaveDispatch").on("click.SaveDispatch",function(){var t=e.gatherSendData();(function(e){var t=!0;return e.find(":required").not(e.find(":disabled")).each(function(){var e=$(this);""===e.val().trim()?(scrollTo(e,400,function(){showNotifier({text:"Заполните все обязательные поля",status:!1})}),t=!1):e.hasClass("LimitSize")&&e.val().trim().length>e.data("maxlength")&&(scrollTo(e,400,function(){showNotifier({text:"Количество символов превышает установленное значение",status:!1})}),t=!1)}),t})(e.$wrapper.find("form"))&&OneAbstractDispatch.factory(t).save().then(function(){showNotifier({text:"Рассылка успешно создана",status:!0}),__APP.changeState("admin/organization/{organization_id}/dispatches".format({organization_id:e.organization_id}))})}),bindControlSwitch(this.$wrapper),initWysiwyg(this.$wrapper,{btnsDef:{dropdownButtonName:{dropdown:["Фамилия","Имя"],title:"Добавить персонализацию",ico:"iconName",hasIcon:екгу}}})},e.prototype.render=function(){this.fetchEvents(),this.$wrapper.html(tmpl("admin-dispatch-page",{uuid:this.dispatch.uuid,organization_id:this.organization_id,page_title:this.dispatch.title||this.page_title,dispatch_title_input:__APP.BUILD.input({placeholder:"Например: Спонсорская кампания",name:"title",value:this.dispatch.title||"",required:!0},["form_input"]),dispatch_subject_input:__APP.BUILD.input({name:"subject",placeholder:"Тема для письма",value:this.dispatch.subject||"",required:!0},["form_input"]),dispatch_content_input:__APP.BUILD.textarea({name:"message_text",required:!0},["form_textarea","Wysiwyg"],escapeHtml(this.dispatch.message_text)||""),email_help:__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.DISPATCHES,"Как сделать рассылку для пользователей"),dispatch_datepicker:__APP.BUILD.formUnit({name:"notification_date",type:"date",value:this.dispatch.notification_time?moment(this.dispatch.notification_time).format(__C.DATE_FORMAT):void 0,dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)}},required:!0}),dispatch_timepicker:__APP.BUILD.formUnit({type:"time",name:"notification_time",value:this.dispatch.notification_time?moment(this.dispatch.notification_time).format(__C.TIME_FORMAT):"",required:!0}),notification_send_now_checkbox:__APP.BUILD.checkbox({id:"dispatch_notification_send_now",label:"Разослать немедленно",name:"notification_send_now",classes:["Switch"],dataset:{switch_id:"notification_time"}}),submit_button:__APP.BUILD.button({title:"Сохранить",classes:["SaveDispatch",__C.CLASSES.COLORS.ACCENT,__C.CLASSES.SIZES.HUGE]})})),this.init()},e}()),AdminAddDispatchPage=extending(AdminAbstractDispatchPage,function(){function e(e){AdminAbstractDispatchPage.call(this,e),this.page_title="Создание рассылки"}return e.prototype.fetchEvents=function(){return this.events_defer=this.events.fetchOrganizationsEvents(this.organization_id,{future:!0,order_by:"nearest_event_date"},ServerConnection.MAX_ENTITIES_LENGTH)},e.prototype.initEventSelect=function(e){this.events.length||e.prop("disabled",!0),initSelect2(e)},e.prototype.init=function(){AdminAbstractDispatchPage.prototype.init.call(this)},e}()),AdminEditDispatchPage=extending(AdminAbstractDispatchPage,function(){function e(e,t){AdminAbstractDispatchPage.call(this,e),this.dispatch=new OneAbstractDispatch(t),this.dispatch_fields=new Fields("message_text","url","notification_time"),Object.defineProperty(this,"page_title_obj",{get:function(){return this.dispatch.title+" - редактирование"}})}return e.prototype.fetchData=function(){var e=this;return this.fetching_data_defer=this.dispatch.fetch(this.dispatch_fields).then(function(t){e.dispatch=t})},e.prototype.fetchEvents=function(){var e=this;return this.dispatch.done?this.dispatch.done&&this.dispatch instanceof OneEventDispatch?this.events_defer=new OneEvent(this.dispatch.event_id).fetchEvent().then(function(t){e.events.setData([t])}):this.events_defer.resolve():this.events_defer=this.events.fetchOrganizationsEvents(this.organization_id,{future:!0,order_by:"nearest_event_date"},ServerConnection.MAX_ENTITIES_LENGTH),this.events_defer},e.prototype.initEventSelect=function(e){this.events.length&&!this.dispatch.done||e.prop("disabled",!0),initSelect2(e),this.dispatch instanceof OneEventDispatch&&e.select2("val",this.dispatch.event_id)},e.prototype.init=function(){AdminAbstractDispatchPage.prototype.init.call(this),this.dispatch.is_push&&this.$wrapper.find(".DispatchTypePushInput").prop("checked",!0),this.dispatch.done&&this.$wrapper.find("form").prop("readonly",!0).find(".SaveDispatch").prop("disabled",!0)},e.prototype.preRender=function(){},e}()),NotFoundPage=extending(Page,function(){function e(){Page.call(this)}return e.prototype.render=function(){__APP.changeTitle("Страница не найдена")},e}()),AdminOrganizationsPage=extending(AdminPage,function(){function e(){AdminPage.call(this),this.is_upload_disabled=!1,this.block_scroll=!1,this.my_organizations_fields=new Fields("img_medium_url","subscribed_count","staff"),this.page_title="Организации",this.my_organizations=new OrganizationsCollection}return e.buildMyOrganizationsBlocks=function(e){return tmpl("statistics-overview-organization",e.map(function(e){var t=[{name:OneUser.ROLE.ADMIN,title:"Администраторы",staff:e.admins,plural_name:OneUser.ROLE.ADMIN+"s_block"},{name:OneUser.ROLE.MODERATOR,title:"Модераторы",staff:e.moderators,plural_name:OneUser.ROLE.MODERATOR+"s_block"}];return $.extend(!0,{},e,{subscribers:e.subscribed_count+getUnitsText(e.subscribed_count,__LOCALES.ru_RU.TEXTS.SUBSCRIBERS),buttons:__APP.BUILD.linkButton({title:"Редактировать",classes:[__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PENCIL,__C.CLASSES.COLORS.NEUTRAL,__C.CLASSES.HOOKS.RIPPLE],page:"/admin/organization/"+e.id+"/edit"},{title:"Создать событие",classes:[__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PLUS,__C.CLASSES.COLORS.ACCENT,__C.CLASSES.HOOKS.RIPPLE],page:"/add/event/to/"+e.id})},t.reduce(function(t,n){return t[n.plural_name]=__APP.BUILD.avatarCollection(n.staff.map(function(e){return $.extend({},e,{is_link:!0,avatar_classes:["-size_100x100","-rounded"]})}),2,{dataset:{modal_type:"editors",modal_specific_role:n.name,modal_title:n.title,modal_organization_id:e.id},classes:["-size_30x30","-rounded","-shifted","CallModal"],counter_classes:["-size_30x30","-color_marginal_primary"]}),t},{}))}))},e.prototype.fetchData=function(){return this.fetching_data_defer=this.my_organizations.fetchMyOrganizations([OneUser.ROLE.ADMIN,OneUser.ROLE.MODERATOR],this.my_organizations_fields,10,"")},e.prototype.bindOrganizationsEvents=function(e){return trimAvatarsCollection(e),bindPageLinks(e),__APP.MODALS.bindCallModal(e),bindRippleEffect(e),e},e.prototype.init=function(){var t=this;this.bindOrganizationsEvents(this.$wrapper),$(window).on("scroll.uploadOrganizations",function(){var n,i,a;!isScrollRemain(200)||t.is_upload_disabled||t.block_scroll||(t.block_scroll=!0,i=t.$wrapper.find(".StatOverviewOrganizations"),n=__APP.BUILD.loaderBlock(i),t.my_organizations.fetchMyOrganizations([OneUser.ROLE.ADMIN,OneUser.ROLE.MODERATOR],t.my_organizations_fields,10,"",function(r){t.block_scroll=!1,n.remove(),a=e.buildMyOrganizationsBlocks(r),r.length?(i.append(a),t.bindOrganizationsEvents(a)):t.is_upload_disabled=!0}))})},e.prototype.render=function(){if(-1===__APP.USER.id)return __APP.changeState("/feed/actual",!0,!0),null;this.$wrapper.html(tmpl("statistics-overview-wrapper",{organizations:e.buildMyOrganizationsBlocks(this.my_organizations)})),this.init()},e.prototype.destroy=function(){$(window).off("scroll.uploadOrganizations")},e}()),OnboardingPage=extending(Page,function(){function e(){Page.apply(this,arguments),this.ajax_data={length:30,offset:0,fields:"img_small_url"},this.state_name="onboarding_page",this.is_upload_disabled=!1,this.block_scroll=!0}return e.prototype.init=function(){bindRippleEffect(this.$wrapper),bindPageLinks(this.$wrapper),this.$wrapper.find(".Link").on("click",function(){$(this).is(".SkipOnboarding")&&cookies.setItem("skip_onboarding",1,moment().add(7,"d")._d),__APP.SIDEBAR.updateSubscriptions()})},e.prototype.bindSubscriptions=function(){this.$wrapper.find(".OnboardingOrgItem").not(".-Handled_OnboardingOrgItem").on("click",function(){var e=$(this);e.hasClass(__C.CLASSES.ACTIVE)?__APP.USER.unsubscribeFromOrganization(e.data("organization_id")):__APP.USER.subscribeToOrganization(e.data("organization_id")),e.toggleClass(__C.CLASSES.ACTIVE)}).addClass("-Handled_OnboardingOrgItem")},e.prototype.render=function(){function e(e){n.detach(),e.length?(t.$wrapper.find(".RecommendationsWrapper").last().append(tmpl("onboarding-recommendation",e)),t.bindSubscriptions(),t.block_scroll=!1):t.is_upload_disabled=!0}var t=this,n=tmpl("loader",{});if(-1===__APP.USER.id)return __APP.changeState("/feed/actual",!0,!0),null;t.$wrapper.html(tmpl("onboarding-main",{})),t.init(),t.$wrapper.find(".RecommendationsWrapper").last().append(n),OrganizationsCollection.fetchRecommendations(t.ajax_data,e),t.$wrapper.find(".RecommendationsScrollbar").scrollbar({onScroll:function(i,a){i.scroll!=i.maxScroll||t.is_upload_disabled||t.block_scroll||(t.block_scroll=!0,t.$wrapper.find(".RecommendationsWrapper").last().append(n),OrganizationsCollection.fetchRecommendations(t.ajax_data,e))}})},e}()),AbstractEditEventPage=extending(Page,function(){function e(){var e=this,t=["id","title","description","location","detail_info_url","organization_id","image_horizontal_url"];Page.call(this),this.event=new OneEvent,this.state_name="admin",this.MainCalendar=null,this.my_organizations=new OrganizationsCollection,this.my_organizations_fields=new Fields("default_address",{tariff:{fields:new Fields("available_additional_notifications","available_event_publications","event_publications")}}),this.render_vars={organization_options:null,start_time:null,end_time:null,min_price_input:null,image_horizontal_filename:null,registration_help:null,registration_till_date_select:null,registration_till_time_input:null,registration_limit_count_input:null,registration_limit_help:null,registration_predefined_fields:null,registration_custom_fields:null,ticket_types:null,tickets_help:null,add_ticket_type_button:null,booking_time_input:null,promocodes:null,add_promocode_button:null,public_at_date_select:null,public_at_time_input:null,additional_notification_date_select:null,additional_notification_time_input:null,push_help:null,vk_image_base64:null,vk_image_filename:null,vk_image_url:null,vk_post_link:null,button_text:null},t.forEach(function(t){Object.defineProperty(e.render_vars,t,{enumerable:!0,get:function(){return e.event[t]}})}),Object.defineProperties(this.render_vars,{organizations_wrapper_classes:{enumerable:!0,get:function(){return e.my_organizations.length<2?__C.CLASSES.HIDDEN:""}},current_date:{enumerable:!0,get:function(){return moment().format(__C.DATE_FORMAT)}}}),Object.defineProperties(this,{organization_id:{get:function(){return e.event.organization_id},set:function(t){e.event.organization_id=t}},is_edit:{get:function(){return!!e.event.id}}})}return e.lastRegistrationFieldId=0,e.lastTicketTypeRowId=0,e.lastPromocodeRowId=0,e.lastPricingRuleRowId=0,e.registrationCustomFieldBuilder=function(t){t=t?t instanceof Array?t:[t]:[{}];var n;return n=tmpl("edit-event-registration-custom-field",t.filter(function(t){return!!RegistrationFieldModel.isCustomField(t)&&(t.id=t.id?t.id:e.lastRegistrationFieldId++,!0)}).map(function(t){return $.extend({},t,{registration_custom_field_values:t.values&&t.values.length?e.registrationCustomFieldValuesBuilder(t.id,t.values):""})})),initSelect2(n.find(".RegistrationCustomFieldType"),{dropdownCssClass:"form_select2_drop form_select2_drop_no_search"}).on("change.SelectRegistrationCustomFieldType",function(){var t=$(this),n=t.closest(".RegistrationCustomField"),i=n.find(".RegistrationCustomFieldValues");switch(t.val()){case RegistrationFieldModel.TYPES.ADDITIONAL_TEXT:case RegistrationFieldModel.TYPES.EXTENDED_CUSTOM:i.html("");break;case RegistrationFieldModel.TYPES.SELECT:case RegistrationFieldModel.TYPES.SELECT_MULTI:i.is(":empty")&&i.html(e.registrationCustomFieldValuesBuilder(n.find(".RegistrationFieldId").val()))}}),t.forEach(function(e){e.required&&n.find("#edit_event_registration_"+e.id+"_custom_field_required").prop("checked",!0),e.type&&n.find("#edit_event_registration_"+e.id+"_field_type").select2("val",e.type)}),n.find(".RegistrationCustomFieldLabel, .RegistrationCustomFieldType").on("change.RemoveRegistrationFieldUUID",function(){$(this).closest(".RegistrationCustomField").find(".RegistrationCustomFieldUUID").val("")}),n},e.registrationCustomFieldValuesBuilder=function(t,n){var i=n instanceof Array?n:[],a=tmpl("edit-event-registration-custom-field-values",{id:t,values:e.registrationCustomFieldValueBuilder(t,i),last_value_id:i.length});return a.find(".AddValue").on("click.AddValue",function(){var n=+a.data("last_value_id")+1,i=e.registrationCustomFieldValueBuilder(t,{value:"Вариант "+n,value_id:n});a.find(".RegistrationCustomFieldValuesWrapper").append(i),a.data("last_value_id",n),i.find(".ValueInput").focus().get(0).select()}),a},e.registrationCustomFieldValueBuilder=function(e,t){var n=tmpl("edit-event-registration-custom-field-value",(t instanceof Array?t:t?[t]:[]).map(function(t,n){return{id:e,value_id:t.value_id||n,value_uuid:t.uuid,checkbox_radio:__APP.BUILD.checkbox({attributes:{disabled:!0}}),input:__APP.BUILD.input({name:"registration_"+e+"_field_"+(t.value_id||n)+"_value",value:t.value},["edit_event_registration_custom_field_value_input","form_input","-flat","ValueInput"])}}));return n.find(".RemoveValue").on("click.RemoveValue",function(){$(this).closest(".RegistrationFieldValue").remove()}),n},e.ticketTypeRowsBuilder=function(t){var n=t?t instanceof Array?t:[t]:[new OneTicketType],i=tmpl("edit-event-tickets-row",n.map(function(t){var n=++e.lastTicketTypeRowId;return{row_num:n,uuid:t.uuid,type_code:t.type_code||randomString(),name_input:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_name",classes:["TicketTypeName"],name:"ticket_type_"+n+"_name",value:t.name||"",placeholder:"Название типа билета",required:!0}).on("input",function(){e.checkTicketTypeSellAfter($(this).closest(".TicketTypes"))}),amount_input:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_amount",name:"ticket_type_"+n+"_amount",value:empty(t.amount)?"":t.amount,placeholder:0,required:!0}),price_input:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_price",name:"ticket_type_"+n+"_price",value:empty(t.price)?"":t.price,placeholder:0,required:!0}),comment_form_unit:__APP.BUILD.formUnit({label:"Описание типа билетов",type:"textarea",name:"ticket_type_{row_num}_comment".format({row_num:n}),value:t.comment,placeholder:"Описание типа билетов (опционально)",helptext:"Краткое описание типа билетов, объясняющее пользователям отличие этого типа от других"}),tickets_sell_start_date_checkbox:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_start_by_date",label:"По дате",type:"checkbox",name:"ticket_type_"+n+"_start_by_date",dataset:{switch_id:"ticket_type_"+n+"_start_by_date"},classes:["TicketTypeStartByDateSwitch","Switch"],unit_classes:["-inline"]}),tickets_sell_start_date_select:__APP.BUILD.formUnit({type:"date",name:"ticket_type_"+n+"_sell_start_date",value:t.sell_start_date?unixTimestampToISO(t.sell_start_date):void 0,dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)}}}),tickets_sell_start_after_checkbox:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_start_after",label:"По окончании продаж билета",type:"checkbox",name:"ticket_type_"+n+"_start_after",dataset:{switch_id:"ticket_type_"+n+"_start_after"},classes:["TicketTypeStartAfterSwitch","Switch"],unit_classes:["-inline"]}),tickets_sell_start_after_select:__APP.BUILD.select([],{name:"ticket_type_"+n+"_start_after_code"},"TicketTypeSellAfter",null,t.start_after_ticket_type_code),tickets_sell_end_date_select:__APP.BUILD.formUnit({label:"Дата",type:"date",name:"ticket_type_"+n+"_sell_end_date",value:t.sell_end_date?unixTimestampToISO(t.sell_end_date):void 0,unit_classes:["-inline"],dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)}}}),tickets_by_order_min_amount_input:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_min_count_per_user",type:"number",label:"Минимум",name:"ticket_type_"+n+"_min_count_per_user",value:t.min_count_per_user||0,unit_classes:["-inline"],required:!0,attributes:{size:6}}),tickets_by_order_max_amount_input:__APP.BUILD.formUnit({id:"event_edit_ticket_type_"+n+"_max_count_per_user",type:"number",label:"Максимум",name:"ticket_type_"+n+"_max_count_per_user",value:t.max_count_per_user||30,unit_classes:["-inline"],attributes:{size:6}}),close_expanded_button:__APP.BUILD.actionButton({title:"Скрыть настройки",classes:["-color_marginal","TicketTypeHideButton"]}).on("click.HideTicketType",function(){$(this).closest(".CollapsingWrapper").resolveInstance().closeCollapsing()})}}));return bindControlSwitch(i),bindCollapsing(i),bindPageLinks(i),i.not(".ExpandRow").each(function(t){var i=$(this),a=i.next(".ExpandRow");i.data("ticket_type",n[t]),i.find(".TicketTypeExpandButton").on("click.ExpandTicketType",function(){a.siblings(".ExpandRow").find(".CollapsingWrapper").each(function(){$(this).resolveInstance().closeCollapsing()}),a.find(".CollapsingWrapper").resolveInstance().toggleCollapsing()}),i.find(".TicketTypeDeleteButton").on("click.DeleteTicketType",function(){var t=i.parent();a.remove(),i.remove(),t.children().length||t.append(tmpl("edit-event-tickets-row-empty")),e.checkTicketTypeSellAfter(t.closest(".TicketTypes"))})}),i.filter(".ExpandRow").each(function(e){var t=$(this);t.data("ticket_type",n[e]),n[e].sell_start_date&&t.find(".TicketTypeStartByDateSwitch").prop("checked",!0).trigger("change"),n[e].promocode&&t.find(".TicketTypePromoSwitch").prop("checked",!0).trigger("change")}),i},e.promocodeRowsBuilder=function(t){var n,i=t?t instanceof Array?t:[t]:[new PromocodeModel];return n=tmpl("edit-event-promocode-row",i.map(function(t){var n=++e.lastPromocodeRowId,i=!1!==t.enabled;return{id:n,uuid:t.uuid,code_input:__APP.BUILD.formUnit({name:"promocode_"+n+"_code",value:t.code,placeholder:"Введите промокод",readonly:!i||void 0,classes:["PromocodeFormInput"],required:!0}),effort_input:__APP.BUILD.inputNumber({name:"promocode_"+n+"_effort",value:t.effort,placeholder:"0",readonly:!i||void 0,required:!0},["PromocodeFormInput"]),type_switch:__APP.BUILD.switch("event_edit_promocode_"+n+"_is_fixed","promocode_"+n+"_is_fixed",t.is_fixed),service_control:t.uuid?__APP.BUILD.switch("event_edit_promocode_"+n+"_enabled","promocode_"+n+"_enabled",t.enabled,null,["PromocodeDisable"]):__APP.BUILD.button({title:"×",classes:["event_edit_row_delete_button",__C.CLASSES.COMPONENT.ACTION,__C.CLASSES.UNIVERSAL_STATES.EMPTY,"PromocodeDeleteButton"]}),use_limit_form_unit:__APP.BUILD.formUnit({label:"Лимит использований",name:"promocode_"+n+"_use_limit",value:t.use_limit,placeholder:0,helptext:"Укажите здесь сколько раз можно использовать этот промокод. Оставьте поле пустым, если не хотите ставить ограничений"}),promocode_start_date_select:__APP.BUILD.formUnit({type:"date",name:"promocode_"+n+"_start_date",value:t.start_date?unixTimestampToISO(t.start_date):void 0,dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)}}}),promocode_end_date_select:__APP.BUILD.formUnit({type:"date",name:"promocode_"+n+"_end_date",value:t.end_date?unixTimestampToISO(t.end_date):void 0,dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)}}})}})),bindControlSwitch(n),bindCollapsing(n),n.find(".PromocodeDeleteButton").on("click.DeletePromocode",function(){var e=$(this).closest(".PromocodeRow");(e=e.add(e.next(".ExpandedPromocodeRow"))).remove()}),n.find(".PromocodeExpandButton").on("click.ExpandPromocode",function(){var e=$(this).closest(".PromocodeRow").next(".ExpandedPromocodeRow");n.filter(".ExpandedPromocodeRow").not(e).find(".CollapsingWrapper").each(function(){$(this).resolveInstance().closeCollapsing()}),e.find(".CollapsingWrapper").resolveInstance().toggleCollapsing()}),n.find(".PromocodeDisable").on("click.DisablePromocode",".FormSwitchInput",function(){var e,t=$(this).closest(".PromocodeRow");e=(t=t.add(t.next(".ExpandedPromocodeRow"))).find(".PromocodeFormInput"),this.checked?e.removeAttr("readonly"):e.attr("readonly",!0)}),n},e.pricingRuleTexts=function(e){switch(e){default:case PricingRuleModel.TYPE.TICKETS_COUNT_BETWEEN:return{rule_start_text:"При покупке",rule_end_text:" билетов",count_measure:"ед."};case PricingRuleModel.TYPE.ORDER_SUM_BETWEEN:return{rule_start_text:"При покупке на сумму",rule_end_text:"",count_measure:"₽"};case PricingRuleModel.TYPE.USER_ORDER_COUNT_BETWEEN:return{rule_start_text:"При количестве заказов у клиента",rule_end_text:"",count_measure:"ед."};case PricingRuleModel.TYPE.USER_ORDER_SUM_BETWEEN:return{rule_start_text:"При общей всех сумме заказов клиента",rule_end_text:"",count_measure:"₽"}}},e.pricingRuleRowBuilder=function(t){var n;return(n=tmpl("pricing-rule-row",(t instanceof Array?t:[t]).map(function(t){return{i:++e.lastPricingRuleRowId,uuid:t.uuid,name:t.name,type_code:t.type_code,effort:t.effort,min_count:t.min_count,max_count:t.max_count,is_fixed:t.is_fixed?t.is_fixed:"",condition:function(t){function n(e,t,n){return e.add(__APP.BUILD.text({content:t,classes:n?[__C.CLASSES.TEXT_COLORS.ACCENT]:[]}))}var i=$(),a=e.pricingRuleTexts(t.type_code),r=t.is_fixed?"₽":"%";return i=n(i,a.rule_start_text),t.min_count&&0!=+t.min_count&&(i=n(n(i," от")," {min_count}".format({min_count:formatCurrency(t.min_count," ",".","",a.count_measure)}),!0)),t.max_count&&+t.max_count!==Number.MAX_SAFE_INTEGER&&(i=n(n(i," до")," {max_count}".format({max_count:formatCurrency(t.max_count," ",".","",a.count_measure)}),!0)),i=n(n(i,a.rule_end_text+", скидка")," {effort}".format({effort:formatCurrency(t.effort," ",".","",r)}),!0)}(t)}}))).find(".RemovePricingRule").on("click.RemovePricingRule",function(){$(this).closest(".PricingRuleRow").remove()}),n.find(".ChangePricingRule").on("click.ChangePricingRule",function(){var t=$(this).closest(".PricingRuleRow"),n=new PricingRuleModel,i=t.serializeForm(),a="pricing_rule_{id}_".format({id:i.pricing_rules});n.setData({uuid:i[a+"uuid"],name:i[a+"name"],type_code:i[a+"type_code"],effort:i[a+"effort"],min_count:0==+i[a+"min_count"]?null:i[a+"min_count"],max_count:+i[a+"max_count"]===Number.MAX_SAFE_INTEGER?null:i[a+"max_count"],is_fixed:!!i[a+"is_fixed"],is_percentage:!i[a+"is_fixed"]}),__APP.CURRENT_PAGE.addPricingRuleEditBlock(n).on("save:rule",function(n,i){t.after(e.pricingRuleRowBuilder(i)),t.remove()})}),n},e.pricingRuleTextRowBuilder=function(t){var n=e.pricingRuleTexts(t.type_code);return tmpl("pricing-rule-text-row",{min_count:0==+t.min_count?"":t.min_count,max_count:+t.max_count===Number.MAX_SAFE_INTEGER?"":t.max_count,effort:t.effort,rule_start_text:n.rule_start_text,rule_end_text:n.rule_end_text,count_measure:n.count_measure,measure_select:__APP.BUILD.select([{val:"is_percentage",display_name:"%"},{val:"is_fixed",display_name:"₽"}],{name:"dynamic_pricing_measure"},["form_input_group_after"],{},t.is_fixed?"is_fixed":"is_percentage")})},e.checkTicketTypeSellAfter=function(e){var t=e.find("select.TicketTypeSellAfter"),n=[];e.children("tbody").children().not(".ExpandRow").each(function(e){var t=$(this);n.push({display_name:t.find(".TicketTypeName").val()||"Тип билета "+(e+1),val:t.find(".TicketTypeCode").val()})}),t.each(function(){var e=$(this),t=e.closest("tr").prev().find(".TicketTypeCode").val(),i=e.select2("val");e.select2("destroy"),e.html(__APP.BUILD.option(n.filter(function(e){return e.val!==t}))),initSelect2(e),e.select2("val",i)}),t.length<2?e.find(".TicketTypeSellAfterFieldset").attr("disabled",!0):e.find(".TicketTypeSellAfterFieldset").removeAttr("disabled"),t.length>0?e.closest(".EditEventForm").find(".EmailTicketing").removeClass(__C.CLASSES.HIDDEN):e.closest(".EditEventForm").find(".EmailTicketing").addClass(__C.CLASSES.HIDDEN)},e.prototype.fetchData=function(){return this.fetching_data_defer=this.my_organizations.fetchMyOrganizations(["admin","moderator"],this.my_organizations_fields)},e.prototype.gatherSendData=function(){var e=this.$wrapper.find(".EditEventForm").serializeForm(),t={event_id:parseInt(e.event_id)?parseInt(e.event_id):null,title:e.title?e.title.trim():"",organization_id:e.organization_id,description:e.description?e.description.trim():"",different_time:!!e.different_time,dates:new DateModelsCollection,is_online:!!e.is_online,location:e.location&&e.location.trim()?e.location.trim():null,detail_info_url:e.detail_info_url?e.detail_info_url.trim():null,image_horizontal:e.image_horizontal,filenames:{horizontal:e.filename_horizontal},is_free:!!e.is_free,vk_post:!!e.vk_post,min_price:e.is_free?null:e.min_price,delayed_publication:!!e.delayed_publication,registration_required:!!e.registration_required,registration_locally:!!e.registration_locally,registration_approvement_required:!!e.registration_approvement_required,email_texts:{payed:e.email_payed_text||null,approved:e.email_approved_text||null,not_approved:e.email_not_approved_text||null,after_event:e.email_after_event_text||null}};return e.different_time?(e.event_date instanceof Array||(e.event_date=[e.event_date],e.start_time=[e.start_time],e.end_time=[e.end_time]),t.dates.setData(e.event_date.map(function(t,n){return{event_date:t,start_time:e.start_time[n],end_time:e.end_time[n]}}))):t.dates.setData(this.MainCalendar.selected_days.map(function(t){return{event_date:t,start_time:e.start_time,end_time:e.end_time}})),t.dates=t.dates.getArrayCopy(),e.registration_required&&(e.registration_limit_by_date&&(t.registration_till=moment(e.registration_till_date+(e.registration_till_time?" "+e.registration_till_time:"")).tz("UTC").format()),e.registration_limit_by_quantity&&(t.registration_limit_count=e.registration_limit_count),e.registration_fields&&e.registration_fields.length&&(t.registration_fields=(new RegistrationFieldModelsCollection).setData(e.registration_fields.map(function(t){var n=new RegistrationFieldModel;return e["registration_"+t+"_field_type"]&&(n.type=e["registration_"+t+"_field_type"]),n.required=e["registration_"+t+"_field_required"],e["registration_"+t+"_field_uuid"]&&(n.uuid=e["registration_"+t+"_field_uuid"]),e["registration_"+t+"_field_label"]&&(n.label=e["registration_"+t+"_field_label"].trim()),e["registration_"+t+"_field_order_number"]&&(n.order_number=e["registration_"+t+"_field_order_number"]||null),e["registration_"+t+"_field_values"]&&(n.values=e["registration_"+t+"_field_values"].map(function(n){var i=new RegistrationSelectFieldValue;return i.value=e["registration_"+t+"_field_"+n+"_value"],i.uuid=setDefaultValue(e["registration_"+t+"_field_"+n+"_value_uuid"],null),i})),n})).getArrayCopy())),e.tags&&(t.tags=e.tags.split(",")),e.ticket_types&&(t.ticket_types=(e.ticket_types instanceof Array?e.ticket_types:[e.ticket_types]).map(function(t){return{uuid:e["ticket_type_"+t+"_uuid"]||null,name:e["ticket_type_"+t+"_name"],comment:e["ticket_type_"+t+"_comment"],type_code:e["ticket_type_"+t+"_type_code"],amount:e["ticket_type_"+t+"_amount"],price:e["ticket_type_"+t+"_price"],start_after_ticket_type_code:e["ticket_type_"+t+"_start_after_ticket_type_code"]||null,sell_start_date:e["ticket_type_"+t+"_start_by_date"]?e["ticket_type_"+t+"_sell_start_date"]:null,sell_end_date:e["ticket_type_"+t+"_sell_end_date"]||null,min_count_per_user:e["ticket_type_"+t+"_min_count_per_user"],max_count_per_user:e["ticket_type_"+t+"_max_count_per_user"]}}),t.ticketing_locally=!0,t.booking_time=0==+e.booking_time?1:e.booking_time,t.accept_bitcoins=e.accept_bitcoins),e.pricing_rules&&(t.pricing_rules=(e.pricing_rules instanceof Array?e.pricing_rules:[e.pricing_rules]).map(function(t){var n="pricing_rule_{id}_".format({id:t});return{uuid:e[n+"uuid"],name:e[n+"name"],type_code:e[n+"type_code"],effort:e[n+"effort"]||0,min_count:e[n+"min_count"]?e[n+"min_count"]:0,max_count:e[n+"max_count"]?e[n+"max_count"]:Number.MAX_SAFE_INTEGER,is_fixed:!!e[n+"is_fixed"],is_percentage:!e[n+"is_fixed"]}})),e.promocodes&&(t.promocodes=(e.promocodes instanceof Array?e.promocodes:[e.promocodes]).map(function(t){return{uuid:e["promocode_"+t+"_uuid"]||null,code:e["promocode_"+t+"_code"],effort:e["promocode_"+t+"_effort"],is_fixed:e["promocode_"+t+"_is_fixed"],is_percentage:!e["promocode_"+t+"_is_fixed"],enabled:!1!==e["promocode_"+t+"_enabled"],use_limit:e["promocode_"+t+"_use_limit"]||1e5,start_date:e["promocode_"+t+"_start_date"]||null,end_date:e["promocode_"+t+"_end_date"]||null}})),e.delayed_publication&&(t.public_at=moment(e.public_at_date+" "+e.public_at_time).tz("UTC").format()),e.additional_notification&&(t.additional_notification_time=moment(e.additional_notification_date+" "+e.additional_notification_time).tz("UTC").format()),e.vk_post&&(t.vk={guid:e.vk_guid,image:e.vk_image,filename:e.vk_filename,description:e.vk_description}),t},e.prototype.checkTariffAvailabilities=function(){var e=this,t=e.my_organizations.getByID(e.organization_id),n=e.$wrapper.find(".FormOverallFields"),i=e.$wrapper.find(".AdditionalNotificationSwitch"),a=e.$wrapper.find(".AvailableEventPublicationsWrapper");t.tariff.available_additional_notifications?(i.prop("disabled",!1),i.closest(".AdditionalNotificationSwitchParent").removeClass(__C.CLASSES.STATUS.DISABLED),e.$wrapper.find(".BuySubscriptionLink").addClass(__C.CLASSES.HIDDEN)):(i.prop("checked")&&i.prop("checked",!1).trigger("change"),i.prop("disabled",!0),i.closest(".AdditionalNotificationSwitchParent").addClass(__C.CLASSES.STATUS.DISABLED),e.$wrapper.find(".BuySubscriptionLink").removeClass(__C.CLASSES.HIDDEN).attr("href","/admin/organization/"+e.organization_id+"/settings#change_tariff")),t.tariff.events_publication_left<=5?(a.removeClass(__C.CLASSES.HIDDEN),a.find(".AvailableEventPublications").text(t.tariff.events_publication_left)):a.addClass(__C.CLASSES.HIDDEN),n.attr("disabled",t.tariff.events_publication_left<=0&&!e.is_edit)},e.prototype.addPricingRuleEditBlock=function(t){function n(e){var t=new PricingRuleModel,n=e.serializeForm();return t.setData({uuid:n.uuid||null,name:n.name,type_code:n.type_code,effort:n.effort,min_count:n.min_count,max_count:n.max_count,is_fixed:"is_fixed"===n.dynamic_pricing_measure,is_percentage:"is_percentage"===n.dynamic_pricing_measure}),t}var i;return t=t||new PricingRuleModel,(i=tmpl("pricing-rule-edit",{name_input_form_field:__APP.BUILD.formUnit({id:"event_edit_dynamic_pricing_add_row_type",label:"Название",value:t.name||"Условие №"+(e.lastPricingRuleRowId+1),name:"name"}),type_select_form_field:__APP.BUILD.formUnit({id:"event_edit_dynamic_pricing_add_row_type",label:"Выберите тип условия",type:"select",classes:["PricingRuleTypeSelect"],value:t.type_code||PricingRuleModel.TYPE.TICKETS_COUNT_BETWEEN,name:"type_code",values:[{val:PricingRuleModel.TYPE.TICKETS_COUNT_BETWEEN,display_name:"Количество билетов"},{val:PricingRuleModel.TYPE.ORDER_SUM_BETWEEN,display_name:"Сумма заказа"},{val:PricingRuleModel.TYPE.USER_ORDER_COUNT_BETWEEN,display_name:"Количество всех заказов пользователя"},{val:PricingRuleModel.TYPE.USER_ORDER_SUM_BETWEEN,display_name:"Сумма всех заказов пользователя"}]}),text_row:e.pricingRuleTextRowBuilder(t)})).find(".PricingRuleTypeSelect").on("change.PricingRuleTypeSelect",function(){var t=i.find(".PricingRuleTextRow");t.after(e.pricingRuleTextRowBuilder(n(i))),t.remove()}),i.find(".CancelPricingRule").on("click.CancelPricingRule",function(){i.remove()}),i.find(".SavePricingRule").on("click.SavePricingRule",function(){i.trigger("save:rule",[n(i)]),i.remove()}),this.$wrapper.find(".PricingRuleHolder").html(i),i},e.prototype.initCrossPosting=function(){function e(){var e,n=t.gatherSendData(),i="";i+=n.title?n.title+"\n\n":"",n.dates&&n.dates.length&&(i+=n.dates.length>1?"Дата начала: ":"Начало: ",i+=moment(n.dates[0].event_date).format("D MMMM YYYY"),1===n.dates.length&&n.dates[0].start_time&&(i+=" в "+n.dates[0].start_time)),n.registration_required&&n.registration_till?i+=" (регистрация заканчивается: "+(e=moment(n.registration_till)).format("D MMMM YYYY")+" в "+e.format("HH:mm")+")\n":i+="\n",i+=n.location?n.location+"\n\n":"",i+=n.description?n.description+"\n\n":"",n.is_free||(i+=n.min_price?"Цена от "+n.min_price+"\n\n":""),n.detail_info_url?i+=n.detail_info_url:n.event_id&&(i+="https://evendate.ru/event/"+n.event_id),t.$wrapper.find(".VKPostText").val(i)}var t=this;this.$wrapper.find(".OnChangeCrossPost").on("change.crossPostingToVK",e),this.MainCalendar.$calendar.on("change:days.crossPostingToVK",e),this.$wrapper.find(".VKPostText").one("click",function(){t.deInitCrossPosting()}),function(){var e=t.$wrapper.find(".EventEditHorizontalImageHolder"),n=e.find(".ImgSrc"),i=e.find(".FileName"),a=t.$wrapper.find(".EditEventVKImageHolder"),r=a.find(".ImgPreview"),s=a.find(".ImgSrc"),o=a.find(".FileName");new MutationObserver(function(){var e=n.val();r.attr("src",e),s.val(e),o.val(i.val())}).observe(n.get(0),{attributes:!0})}()},e.prototype.deInitCrossPosting=function(){this.$wrapper.find(".OnChangeCrossPost").off("change.crossPostingToVK"),this.MainCalendar.$calendar.off("change:days.crossPostingToVK")},e.prototype.submitForm=function(){function e(){__APP.changeState("/event/"+n.event.id)}var t,n=this,i=n.$wrapper.find(".EditEventForm"),a=i.find("input.EventTags"),r=i.serializeForm(),s=!!n.event.id,o=$();if(function(e,t){function n(e,t,n){var i,a;return t&&((a=(i=e.parents(".TabsBody:last")).closest(".Tabs").resolveInstance()).setToTab(a.find(".TabsBodyWrapper:first").children().index(i)),scrollTo(e,400,function(){showNotifier({text:n,status:!1})})),handleErrorField(e),!1}var i=!0,o=e.find("#edit_event_different_time").prop("checked")?e.find('[class^="TableDay_"]'):e.find(".MainTime");return e.find(":required").not(e.find(":disabled")).each(function(){var e=$(this);""===e.val().trim()?i=n(e,i,"Заполните все обязательные поля"):e.hasClass("LimitSize")&&e.val().trim().length>e.data("maxlength")&&(i=n(e,i,"Количество символов превышает установленное значение"))}),t.selected_days.length||(i=n(t.$calendar,i,"Выберите даты для события")),o.each(function(){var e=$(this),t=e.find(".StartTime, .EndTime"),a=t.filter(".StartTime").inputmask("unmaskedvalue"),r=t.filter(".EndTime").inputmask("unmaskedvalue");t.each(function(){var e=$(this);""===e.val()&&(i=n(e,i,"Заполните время события"))}),i&&a>r&&(i=n(e,i,"Начальное время не может быть позже конечного"))}),""===a.val().trim()&&(i=n(a.siblings(".EventTags"),i,"Необходимо выбрать хотя бы один тэг")),!r.registration_limit_by_quantity||r.registration_fields&&r.registration_fields.length||(i=n(e.find("#edit_event_registration_fields"),i,"Должно быть выбрано хотя бы одно поле регистрации в анкете")),s||e.find(".DataUrl").each(function(){var e=$(this);""===e.val().trim()&&(i=n(e.closest(".ImgLoadWrap"),i,"Пожалуйста, добавьте к событию обложку"))}),i}(i,n.MainCalendar)){n.$wrapper.addClass(__C.CLASSES.STATUS.DISABLED),o=__APP.BUILD.overlayLoader(n.$view);try{t=this.gatherSendData(),s?n.event.updateEvent(t).then(e):n.event.createEvent(t).then(e),n.$wrapper.removeClass(__C.CLASSES.STATUS.DISABLED),o.remove()}catch(e){ServerConnection.stdErrorHandler(e)}}},e.prototype.init=function(){function t(){l.find(".RegistrationFieldOrderNumber").val("").filter(function(){return 0===$(this).closest(":disabled").length}).each(function(e){$(this).val(e+1)})}var n=this,i=n.$wrapper.find(".EditEventPageTabs"),a=n.$wrapper.find(".EditEventBottomButtons").children(),r=a.filter(".EditEventNextPageButton"),s=a.filter(".EditEventPrevPageButton"),o=a.filter(".EditEventSubmitButton"),l=n.$wrapper.find(".RegistrationFields");bindDatePickers(n.$wrapper),bindSelect2(n.$wrapper),bindTabs(n.$wrapper),bindHelpLink(n.$wrapper),bindControlSwitch(n.$wrapper),bindCallModal(n.$wrapper),bindLimitInputSize(n.$wrapper),bindRippleEffect(n.$wrapper),bindFileLoadButton(n.$wrapper),ImgLoader.init(n.$wrapper),initSelect2(n.$wrapper.find(".EditEventOrganizationsSelect")).on("change",function(){n.organization_id=+this.value,n.checkTariffAvailabilities(n.organization_id)}).select2("val",n.organization_id),initSelect2(n.$wrapper.find(".EventTags"),{tags:!0,width:"100%",placeholder:"Выберите до 5 тегов",maximumSelectionLength:5,maximumSelectionSize:5,tokenSeparators:[",",";"],multiple:!0,createSearchChoice:function(e,t){if(0===$(t).filter(function(){return 0===this.text.localeCompare(e)}).length)return{id:e,text:e}},ajax:{url:"/api/v1/tags/",dataType:"JSON",data:function(e,t){return{name:e}},results:function(e){var t=[];return e.data.forEach(function(e){e.text=e.name,t.push(e)}),{results:t}}}}),n.checkTariffAvailabilities(n.organization_id),function(){function e(e){e.find(".RemoveRow").not(".-Handled_RemoveRow").each(function(e,t){$(t).on("click",function(){n.MainCalendar.deselectDays($(this).closest("tr").data("date"))}).addClass("-Handled_RemoveRow")})}function t(e,t){e.sort(function(e,t){var n=$(e).data("date"),i=$(t).data("date");return n>i?1:n<i?-1:0}),e.detach().appendTo(t)}function i(n){var i;e(i=function(e){return e=e instanceof Array?e:[e],tmpl("selected-table-day",e.map(function(e,t){return{date:e,formatted_date:moment(e).calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR),start_time:__APP.BUILD.formUnit({name:"start_time",type:"time",classes:["StartTime"]}),end_time:__APP.BUILD.formUnit({name:"end_time",type:"time",classes:["EndTime"]})}}))}(n)),t(c=c.add(i),r)}var a=n.$wrapper.find(".EventSelectedDaysText"),r=n.$wrapper.find(".SelectedDaysRows"),s=n.$wrapper.find(".AddDayToTable").data("datepicker"),o={},l={"январь":"января","февраль":"февраля","март":"марта","апрель":"апреля","май":"мая","июнь":"июня","июль":"июля","август":"августа","сентябрь":"сентября","октябрь":"октября","ноябрь":"ноября","декабрь":"декабря"},c=$();n.MainCalendar=new Calendar(".EventDatesCalendar",{weekday_selection:!0,month_selection:!0,min_date:moment().format(__C.DATE_FORMAT)}),n.MainCalendar.init(),i(n.MainCalendar.selected_days),n.$wrapper.find(".SelectedDaysRows").toggleStatus("disabled"),n.MainCalendar.$calendar.on("change:days.displayFormattedText",function(){o={},n.MainCalendar.selected_days.forEach(function(e,t,n){var i=moment(e);void 0===o[i.month()]&&(o[i.month()]={},o[i.month()].selected_days=[],o[i.month()].month_name=l[i.format("MMMM")]),o[i.month()].selected_days.push(i.date())}),a.empty().removeClass("hidden"),Object.keys(o).length?$.each(o,function(e,t){a.append($("<p>").text(t.selected_days.join(", ")+" "+t.month_name))}):a.html("<p>Даты не выбраны</p>")}),n.MainCalendar.$calendar.on("change:days.buildTable",function(){if("select"===n.MainCalendar.last_action)i(n.MainCalendar.last_selected_days);else if("deselect"===n.MainCalendar.last_action)if(Array.isArray(n.MainCalendar.last_selected_days)){var e=[];n.MainCalendar.last_selected_days.forEach(function(t){e.push(".TableDay_"+t)}),c.remove(e.join(", ")),c=c.not(e.join(", "))}else c.remove(".TableDay_"+n.MainCalendar.last_selected_days),c=c.not(".TableDay_"+n.MainCalendar.last_selected_days);t(c,r)}),s.$datepicker.on("date-picked",function(){n.MainCalendar.selectDays(s.selected_day)})}(),__APP.USER.accounts.contains(OneUser.ACCOUNTS.VK)&&__APP.SERVER.dealAjax(AsynchronousConnection.HTTP_METHODS.GET,"/api/v1/organizations/vk_groups").then(function(e){var t=n.$wrapper.find("select.VkGroupsSelect");t.append(__APP.BUILD.option(e.map(function(e){return{val:e.gid,display_name:e.name,dataset:{img:e.photo}}}))).trigger("change"),1===e.length&&t.prop("disabled",!0).after(__APP.BUILD.input({type:"hidden",name:"vk_guid",value:t.val()})),n.initCrossPosting()}),bindCollapsing(n.$wrapper),i=i.resolveInstance(),n.$wrapper.find(".Placepicker").placepicker(),initWysiwyg(n.$wrapper),n.$wrapper.find(".EditEventDefaultAddress").off("click.defaultAddress").on("click.defaultAddress",function(){n.$wrapper.find(".Placepicker").val(n.my_organizations.getByID(n.organization_id).default_address).trigger("input").trigger("change")}),n.$wrapper.find(".EditEventIsOnline").off("change.OnlineEvent").on("change.OnlineEvent",function(){n.$wrapper.find("#edit_event_placepicker").prop("required",!$(this).prop("checked"))}),(l=n.$wrapper.find(".RegistrationFields").sortable({scroll:!0,animation:150,draggable:".Draggable",handle:".DragHandle",filter:".RemoveRegistrationCustomField",onFilter:function(e){$(e.item).closest(".RegistrationCustomField").remove(),t()},onEnd:t})).find(".PredefinedFieldSwitch").on("change",t),n.$wrapper.find(".AddRegistrationCustomField").off("click.AddRegistrationCustomField").on("click.AddRegistrationCustomField",function(){l.append(e.registrationCustomFieldBuilder()),t()}),n.$wrapper.find(".RegistrationLocallySwitch").off("change.EmailRegistrationLocallySwitch").on("change.EmailRegistrationLocallySwitch",function(){n.$wrapper.find(".EmailRegistration").toggleClass(__C.CLASSES.HIDDEN)}),n.$wrapper.find(".RegistrationPreview").on("click.RegistrationPreview",function(){var e=$(this),t=$(this).closest("fieldset").serializeForm(),n=new RegistrationFieldModelsCollection,i=new OneEvent,a=e.data("modal");t.registration_fields&&n.setData(t.registration_fields.map(function(e){return{uuid:guid(),type:t["registration_"+e+"_field_type"],label:t["registration_"+e+"_field_label"]||RegistrationFieldModel.DEFAULT_LABEL[t["registration_"+e+"_field_type"].toUpperCase()],required:t["registration_"+e+"_field_required"],order_number:t["registration_"+e+"_field_order_number"],values:t["registration_"+e+"_field_values"]?t["registration_"+e+"_field_values"].map(function(n){var i=new RegistrationSelectFieldValue;return i.value=t["registration_"+e+"_field_"+n+"_value"],i.uuid=t["registration_"+e+"_field_"+n+"_value_uuid"]||guid(),i}):null}})).sortByOrder(),t.registration_fields=n,i.setData(t),a instanceof PreviewRegistrationModal&&a.destroy(),a=new PreviewRegistrationModal(i),e.data("modal",a),a.show()}),e.checkTicketTypeSellAfter(n.$wrapper.find(".TicketTypes")),n.$wrapper.find(".AddPricingRule").on("click.AddPricingRule",function(){n.$wrapper.find(".PricingRuleHolder").children().length||n.addPricingRuleEditBlock().on("save:rule",function(t,i){n.$wrapper.find(".PricingRules").append(e.pricingRuleRowBuilder(i))})}),i.on("tabs:change",function(){0===i.currentTabsIndex?s.addClass(__C.CLASSES.HIDDEN):s.removeClass(__C.CLASSES.HIDDEN),i.currentTabsIndex===i.tabsCount-1?(r.addClass(__C.CLASSES.HIDDEN),o.removeClass(__C.CLASSES.HIDDEN)):(r.removeClass(__C.CLASSES.HIDDEN),o.addClass(__C.CLASSES.HIDDEN))}),r.off("click.nextPage").on("click.nextPage",i.nextTab),s.off("click.nextPage").on("click.prevPage",i.prevTab),o.off("click.Submit").on("click.Submit",function(){n.submitForm()})},e.prototype.preRender=function(){var t=this,n=moment.unix(this.event.registration_till),i=moment.unix(this.event.public_at),a=this.event.notifications.getByID(OneNotification.NOTIFICATIN_TYPES.ADDITIONAL_FOR_ORGANIZATION),r=a?moment.unix(a.notification_time):null;this.render_vars.organization_options=__APP.BUILD.option(this.my_organizations.map(function(e){return{val:e.id,dataset:{organization:e,"image-url":e.img_url,"default-address":e.default_address},display_name:e.name}})),this.render_vars.start_time=__APP.BUILD.formUnit({label:"Начало",id:"edit_event_start_time",name:"start_time",type:"time",classes:["StartTime","OnChangeCrossPost"],unit_classes:["-inline"],value:this.event.dates.length?this.event.dates[0].start_time:void 0,required:!0}),this.render_vars.end_time=__APP.BUILD.formUnit({label:"Конец",id:"edit_event_end_time",name:"end_time",type:"time",classes:["EndTime"],unit_classes:["-inline"],value:this.event.dates.length?this.event.dates[0].end_time:void 0}),this.render_vars.min_price_input=__APP.BUILD.formUnit({label:"Цена от",id:"edit_event_min_price",name:"min_price",type:"number",unit_classes:["-inline","MinPrice"],classes:["OnChangeCrossPost"],value:this.event.min_price,placeholder:"Минимальная цена"}),this.render_vars.registration_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.HOW_TO_ENABLE_REGISTRATION,"Как включить регистрацию"),this.render_vars.registration_till_date_select=__APP.BUILD.formUnit({label:"Дата окончания регистрации",name:"registration_till_date",type:"date",value:this.event.registration_till?n.format(__C.DATE_FORMAT):void 0,required:!0,unit_classes:["-inline"],attributes:{class:"OnChangeCrossPost"},dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)},selected_day:this.event.registration_till?n.format(__C.DATE_FORMAT):"",min_date:moment().add(1,"d").format(__C.DATE_FORMAT)}}),this.render_vars.registration_till_time_input=__APP.BUILD.formUnit({label:"Время",id:"edit_event_registration_till_time",type:"time",name:"registration_till_time",value:this.event.registration_till?n.format(__C.TIME_FORMAT):void 0,classes:["OnChangeCrossPost"],unit_classes:["-inline"],required:!0}),this.render_vars.registration_limit_count_input=__APP.BUILD.formUnit({label:"Максимальное кол-во",id:"edit_event_registration_limit_count",name:"registration_limit_count",type:"number",unit_classes:["-inline","RegistrationQuantity"],value:this.event.registration_limit_count,placeholder:"3 000",required:!0}),this.render_vars.registration_limit_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.MEMBERS_LIMITATION,"Как установить лимит участников события"),this.render_vars.registration_predefined_fields=tmpl("edit-event-registration-predefined-field",[{id:e.lastRegistrationFieldId++,order_number:e.lastRegistrationFieldId,type:"last_name",name:"Фамилия",description:"Текстовое поле для ввода фамилии"},{id:e.lastRegistrationFieldId++,order_number:e.lastRegistrationFieldId,type:"first_name",name:"Имя",description:"Текстовое поле для ввода имени"},{id:e.lastRegistrationFieldId++,order_number:e.lastRegistrationFieldId,type:"email",name:"E-mail",description:"Текстовое поле для ввода адреса электронной почты"},{id:e.lastRegistrationFieldId++,order_number:e.lastRegistrationFieldId,type:"phone_number",name:"Номер телефона",description:"Текстовое поля для ввода номера телефона"}]),this.render_vars.auto_price_change_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.DYNAMIC_PRICING,"Как организовать автоматическое изменение цен"),this.render_vars.tickets_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.TICKETS,"Как выглядит электронный билет"),this.render_vars.add_ticket_type_button=__APP.BUILD.actionButton({title:"Добавить билет",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PLUS]}).on("click.AddTicketTypeRow",function(){var n=t.$wrapper.find(".TicketTypes"),i=n.find(".ExpandRow").find(".CollapsingWrapper");0===n.find("tbody").length&&n.append($("<tbody></tbody>")),1===(n=n.find("tbody")).children().length&&n.children().hasClass("EmptyRow")?n.html(e.ticketTypeRowsBuilder()):n.append(e.ticketTypeRowsBuilder()),e.checkTicketTypeSellAfter(n),i.length&&i.each(function(){$(this).resolveInstance().closeCollapsing()})}),this.render_vars.booking_time_input=__APP.BUILD.formUnit({label:"Срок брони билета",label_classes:["help_link","HelpLink"],label_dataset:{article_id:HelpCenterConnection.ARTICLE.BOOKING},id:"edit_event_booking_time",name:"booking_time",type:"number",helptext:"Количество часов, в течении которых участник может оплатить свой заказ",value:this.event.booking_time||1,required:!0,attributes:{size:2}}),this.render_vars.add_promocode_button=__APP.BUILD.actionButton({title:"Добавить промокод",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PLUS]}).on("click.AddPromocodeRow",function(){var n=t.$wrapper.find(".Promocodes");0===n.find("tbody").length&&n.append($("<tbody></tbody>")),1===(n=n.find("tbody")).children().length&&n.children().hasClass("EmptyRow")?n.html(e.promocodeRowsBuilder()):n.append(e.promocodeRowsBuilder())}),this.render_vars.email_payed_form_unit=__APP.BUILD.formUnit({label:"Сообщение при успешной оплате заказа",id:"edit_event_email_payed_form_unit",name:"email_payed_text",type:"textarea",classes:["Wysiwyg"],value:this.event.email_texts.payed}),this.render_vars.email_approved_form_unit=__APP.BUILD.formUnit({label:"Сообщение при подтверждении заявки",id:"edit_event_email_approved_form_unit",name:"email_approved_text",type:"textarea",classes:["Wysiwyg"],value:this.event.email_texts.approved}),this.render_vars.email_not_approved_form_unit=__APP.BUILD.formUnit({label:"Сообщение при отказе в заявке",id:"edit_event_email_not_approved_form_unit",name:"email_not_approved_text",type:"textarea",classes:["Wysiwyg"],value:this.event.email_texts.not_approved}),this.render_vars.email_after_event_form_unit=__APP.BUILD.formUnit({label:"Сообщение после окончания события",id:"edit_event_email_after_event_form_unit",name:"email_after_event_text",type:"textarea",classes:["Wysiwyg"],value:this.event.email_texts.after_event}),this.render_vars.public_at_date_select=__APP.BUILD.formUnit({label:"Дата",name:"public_at_date",type:"date",value:this.event.public_at?i.format(__C.DATE_FORMAT):void 0,required:!0,unit_classes:["-inline"],dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)},min_date:moment().format(__C.DATE_FORMAT)}}),this.render_vars.public_at_time_input=__APP.BUILD.formUnit({label:"Время",id:"edit_event_public_at_time",name:"public_at_time",type:"time",unit_classes:["-inline"],value:this.event.public_at?i.format(__C.TIME_FORMAT):void 0,required:!0}),this.render_vars.additional_notification_date_select=__APP.BUILD.formUnit({label:"Дата",name:"additional_notification_date",type:"date",value:a?r.format(__C.DATE_FORMAT):void 0,required:!0,unit_classes:["-inline"],dataset:{format:function(e){return e.calendar(null,__LOCALE.DATE.CALENDAR_DATE_WITH_YEAR)},min_date:moment().format(__C.DATE_FORMAT)}}),this.render_vars.additional_notification_time_input=__APP.BUILD.formUnit({label:"Время",id:"edit_event_additional_notification_time",name:"additional_notification_time",type:"time",unit_classes:["-inline"],value:a?r.format(__C.TIME_FORMAT):void 0,required:!0}),this.render_vars.push_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.HOW_PUSH_WORKS,"Как работают push-уведомления"),this.render_vars.crossposting_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.CROSSPOSTING_VK,"Как публиковать в VK")},e.prototype.render=function(){return __APP.USER.isLoggedOut()?(__APP.changeState("/feed/actual",!0,!0),null):checkRedirect("event/add",this.organization_id?"/add/event/to/"+this.organization_id:"/add/event")?this.organization_id&&!this.my_organizations.has(this.organization_id)?__APP.changeState("/",!0,!0):(this.organization_id=this.organization_id?this.organization_id:this.my_organizations[0].id,this.$wrapper.html(tmpl("edit-event-page",this.render_vars)),void this.init()):null},e}()),AddEventPage=extending(AbstractEditEventPage,function(){function e(e){AbstractEditEventPage.call(this),this.page_title="Добавить событие",this.organization_id=e}return e.prototype.preRender=function(){AbstractEditEventPage.prototype.preRender.call(this),this.render_vars.button_text="Опубликовать",this.render_vars.ticket_types=tmpl("edit-event-tickets-row-empty")},e.prototype.init=function(){AbstractEditEventPage.prototype.init.call(this),this.$wrapper.find(".RemoveEventWrapper").addClass(__C.CLASSES.HIDDEN),this.$wrapper.find(".ReturnEventWrapper").addClass(__C.CLASSES.HIDDEN)},e}()),EditEventPage=extending(AbstractEditEventPage,function(){function e(t){AbstractEditEventPage.call(this),this.page_title="Редактирование события",this.event=new OneEvent(t),this.event_fields=e.fields}return e.fields=new Fields("accept_bitcoins","email_texts","booking_time","pricing_rules","vk_post_link",{promocodes:{fields:new Fields("use_limit")},ticket_types:{fields:new Fields("amount","comment","price","sell_start_date","sell_end_date","min_count_per_user","max_count_per_user")}}),e.prototype.fetchData=function(){return this.fetching_data_defer=__APP.SERVER.multipleAjax(this.event.fetchEvent(this.event_fields),this.my_organizations.fetchMyOrganizations(["admin","moderator"],this.my_organizations_fields))},e.prototype.preRender=function(){var e={last_name:{type:"last_name",name:"Фамилия",description:"Текстовое поле для ввода фамилии"},first_name:{type:"first_name",name:"Имя",description:"Текстовое поле для ввода имени"},email:{type:"email",name:"E-mail",description:"Текстовое поле для ввода адреса электронной почты"},phone_number:{type:"phone_number",name:"Номер телефона",description:"Текстовое поля для ввода номера телефона"}},t=[],n=this.event.ticket_types.filter(function(e){return"registration"!==e.type_code});AbstractEditEventPage.prototype.preRender.call(this),this.render_vars.button_text="Сохранить",this.render_vars.image_horizontal_filename=getFilenameFromURL(this.event.image_horizontal_url),this.render_vars.registration_custom_fields=AbstractEditEventPage.registrationCustomFieldBuilder(this.event.registration_fields.filter(RegistrationFieldModel.isCustomField)),this.render_vars.ticket_types=n.length?AbstractEditEventPage.ticketTypeRowsBuilder(n):tmpl("edit-event-tickets-row-empty"),this.render_vars.pricing_rules=this.event.pricing_rules.enabled_rules.length?AbstractEditEventPage.pricingRuleRowBuilder(this.event.pricing_rules.enabled_rules):"",this.render_vars.promocodes=this.event.promocodes.length?AbstractEditEventPage.promocodeRowsBuilder(this.event.promocodes):tmpl("edit-event-promocode-row-empty"),this.render_vars.vk_post_link=this.event.vk_post_link?__APP.BUILD.externalLink({page:this.event.vk_post_link,title:"Страница публикации во Вконтакте",classes:[__C.CLASSES.COLORS.ACCENT,"-no_uppercase"],attributes:{target:"_blank"}}):"",this.event.registration_fields.length&&(this.event.registration_fields.filter(RegistrationFieldModel.isPredefinedField).sort(function(e,t){return e.order_number-t.order_number}).forEach(function(n){e[n.type].id=AbstractEditEventPage.lastRegistrationFieldId++,e[n.type].order_number=n.order_number,t.push(e[n.type]),delete e[n.type]}),Object.values(e).forEach(function(e){e.id=AbstractEditEventPage.lastRegistrationFieldId++,t.push(e)}),this.render_vars.registration_predefined_fields=tmpl("edit-event-registration-predefined-field",t)),this.render_vars.delete_event_button=__APP.BUILD.button({title:"Отменить событие",classes:["RemoveEvent",__C.CLASSES.COLORS.BUBBLEGUM,__C.CLASSES.SIZES.WIDE,__C.CLASSES.HOOKS.RIPPLE]}),this.render_vars.return_event_button=__APP.BUILD.button({title:"Вернуть событие",classes:["ReturnEvent",__C.CLASSES.COLORS.FRANKLIN,__C.CLASSES.SIZES.WIDE,__C.CLASSES.HOOKS.RIPPLE]})},e.prototype.init=function(){var e=this;AbstractEditEventPage.prototype.init.call(this),function(){var t=e.$wrapper.find(".RemoveEventWrapper"),n=e.$wrapper.find(".ReturnEventWrapper");e.event.canceled?t.addClass(__C.CLASSES.HIDDEN):n.addClass(__C.CLASSES.HIDDEN),e.$wrapper.find(".RemoveEvent").on("click.RemoveEvent",function(){e.event.cancel().then(function(){n.removeClass(__C.CLASSES.HIDDEN),t.addClass(__C.CLASSES.HIDDEN)})}),e.$wrapper.find(".ReturnEvent").on("click.ReturnEvent",function(){e.event.restore().then(function(){t.removeClass(__C.CLASSES.HIDDEN),n.addClass(__C.CLASSES.HIDDEN)})})}(),function(t,n,i){var a=t.find(".EventDatesCalendar").data("calendar"),r=t.find(".SelectedDaysRows");i||e.$wrapper.find("#edit_event_different_time").prop("checked",!0).trigger("change"),a.selectDays(n.map(function(e){return moment.unix(e.event_date).format(__C.DATE_FORMAT)})),n.forEach(function(e){var t=r.find(".TableDay_"+moment.unix(e.event_date).format(__C.DATE_FORMAT));t.find(".StartTime").val(e.start_time),e.end_time.length&&t.find(".EndTime").val(e.end_time)})}(this.$wrapper,this.event.dates,this.event.is_same_time),this.$wrapper.find("input.EventTags").select2("data",this.event.tags.map(function(e){return{id:parseInt(e.id),text:e.name}})),this.event.image_horizontal_url&&toDataUrl(this.event.image_horizontal_url,function(t){e.$wrapper.find(".HorizontalImageSource").val(t||null)}),empty(this.event.public_at)?this.$wrapper.find(".DelayedPublicationSwitch").toggleStatus("disabled"):this.$wrapper.find(".DelayedPublicationSwitch").prop("checked",!0).trigger("change"),this.event.is_free||this.$wrapper.find(".IsFreeSwitch").prop("checked",!1).trigger("change"),this.event.registration_required&&(this.$wrapper.find("#edit_event_registration_required").prop("checked",!0).trigger("change"),this.event.registration_locally?this.$wrapper.find(".RegistrationLocallySwitch").prop("checked",!0).trigger("change"):this.$wrapper.find("#edit_event_registration_side").prop("checked",!0).trigger("change"),this.event.registration_till&&this.$wrapper.find("#edit_event_registration_limit_by_date").prop("checked",!0).trigger("change"),this.event.registration_limit_count&&this.$wrapper.find("#edit_event_registration_limit_by_quantity").prop("checked",!0).trigger("change"),this.event.registration_approvement_required&&this.$wrapper.find("#edit_event_registration_approvement_required").prop("checked",!0).trigger("change"),this.event.registration_fields.forEach(function(t){RegistrationFieldModel.isCustomField(t)||(e.$wrapper.find("#edit_event_registration_"+t.type+"_field_uuid").val(t.uuid),e.$wrapper.find("#edit_event_registration_"+t.type+"_field_enable").prop("checked",!0).trigger("change"),t.required&&e.$wrapper.find("#edit_event_registration_"+t.type+"_field_required").prop("checked",!0))})),this.event.accept_bitcoins&&this.$wrapper.find(".AcceptBitcoinsCheckbox").prop("checked",!0).trigger("change"),this.event.notifications.has(OneNotification.NOTIFICATIN_TYPES.ADDITIONAL_FOR_ORGANIZATION)&&this.$wrapper.find(".AdditionalNotificationSwitch").prop("disabled",!1).trigger("change"),this.$wrapper.find(".VkPostFieldset").prop("disabled",!0),this.event.vk_post_link&&this.$wrapper.find(".VkPostTrigger").prop("checked",!0)},e}()),EventPage=extending(Page,function(){function e(e){var t=this,n=["title","description","image_horizontal_url"];Page.call(this),this.event=new OneEvent(e),this.render_vars={cover_width:731,avatars_collection:null,action_button:null,map:null,event_edit_functions:null,event_additional_info:null,favored_additional_text:null,organization_avatar_block:null,event_additional_fields:null,overlay_cap:null},this.calendar=null,n.forEach(function(e){Object.defineProperty(t.render_vars,e,{enumerable:!0,get:function(){return t.event[e]}})}),this.$overlay_cap=$(),Object.defineProperty(this,"page_title",{get:function(){return t.event.title}})}return e.fields=new Fields(["image_horizontal_medium_url","image_horizontal_large_url","favored_users_count","favored_friends_count","is_favorite","description","location","latitude","longitude","is_online","can_edit","is_free","min_price","organization_logo_small_url","organization_short_name","organization_is_private","is_same_time","tags","detail_info_url","canceled","public_at","has_landing","is_registered","registration_locally","registration_available","registration_required","registration_approvement_required","registration_till","registration_limit_count","registration_fields","registration_approved","registered_count","registered","ticketing_locally","ticketing_available"],{dates:{length:0,fields:new Fields("start_time","end_time")},favored:{fields:new Fields("is_friend"),order_by:"-is_friend",length:10},notifications:{fields:new Fields("notification_type","done")},orders:{fields:new Fields("created_at","order_content")},tickets:{fields:new Fields("created_at","number","ticket_type")}}),e.prototype.fetchData=function(){return this.fetching_data_defer=this.event.fetchEvent(e.fields)},e.prototype.init=function(){var e=this,t=this.$wrapper.find(".EventNotificationsButton"),n=(this.$wrapper.find(".FavoredAdditionalText"),this.$wrapper.find(".AvatarsCollectionWrapper"));trimAvatarsCollection(this.$wrapper),bindRippleEffect(this.$wrapper),bindDropdown(this.$wrapper),__APP.MODALS.bindCallModal(this.$wrapper),bindCollapsing(this.$wrapper),bindPageLinks(this.$wrapper),this.$wrapper.find(".CancelEvent").on("click.CancelEvent",function(){e.event.cancel().then(function(){e.$wrapper.find(".EventPage").append(e.$overlay_cap)})}),this.$wrapper.find(".ExternalLink").on("click.sendStat",function(){storeStat(e.event.id,__C.STATS.EVENT_ENTITY,__C.STATS.EVENT_OPEN_SITE)}),this.$wrapper.find(".EventMap").on("click.sendStat",function(){storeStat(e.event.id,__C.STATS.EVENT_ENTITY,__C.STATS.EVENT_OPEN_MAP)}),this.event.favored.length||n.addClass(__C.CLASSES.HIDDEN),this.$wrapper.find(".AddToFavored").on("ActionButton:change",function(t,i,a){e.event.favored.length?n.removeClass(__C.CLASSES.HIDDEN):n.addClass(__C.CLASSES.HIDDEN)}),this.event.notifications.future.length&&t.removeClass(__C.CLASSES.COLORS.NEUTRAL).addClass(__C.CLASSES.COLORS.NEUTRAL_ACCENT),this.$wrapper.on("notifications.change",function(n,i,a){switch(i){case"add":t.removeClass(__C.CLASSES.COLORS.NEUTRAL).addClass(__C.CLASSES.COLORS.NEUTRAL_ACCENT);break;case"remove":e.event.notifications.future.length||t.addClass(__C.CLASSES.COLORS.NEUTRAL).removeClass(__C.CLASSES.COLORS.NEUTRAL_ACCENT)}})},e.prototype.preRender=function(){var e=this;this.$overlay_cap=__APP.BUILD.overlayCap($("<p>Организатор отменил событие</p>")),this.event.can_edit&&this.$overlay_cap.find(".CapWrapper").append(bindRippleEffect(__APP.BUILD.button({title:"Вернуть событие",classes:[__C.CLASSES.COLORS.PRIMARY,__C.CLASSES.HOOKS.RIPPLE]}).on("click.CancelCancellation",function(){e.event.restore().then(function(){e.$overlay_cap.detach()})}))),this.event.location&&(this.render_vars.map=tmpl("event-map",{location_sanitized:encodeURI(this.event.location),location:this.event.location})),this.event.can_edit&&(this.render_vars.event_functions=tmpl("event-functions",{functions:function(){var t,n=["event_function_button",__C.CLASSES.SIZES.WIDE,__C.CLASSES.ICON_CLASS];return t=__APP.BUILD.actionLink({page:"/admin/event/{event_id}/edit".format({event_id:e.event.id}),title:"Редактировать событие",classes:n.concat([__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.ICONS.PENCIL])}),t=t.add(__APP.BUILD.externalLink({page:"/event_landing/?id={event_id}&edit=true".format({event_id:e.event.id}),title:e.event.has_landing?"Изменить лендинг":"Создать лендинг",classes:n.concat([__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.COMPONENT.ACTION,"fa-file-text"]),attributes:{target:"__blank"}})),e.event.registration_approvement_required&&(t=t.add(__APP.BUILD.actionLink({page:"/admin/event/{event_id}/requests".format({event_id:e.event.id}),title:"Просмотреть заявки",classes:n.concat([__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.ICONS.USER_PLUS])},{page:"/admin/event/{event_id}/check_in".format({event_id:e.event.id}),title:"Контроль входа",classes:n.concat([__C.CLASSES.COLORS.MARGINAL,"fa-calendar-check-o"])}))),t=t.add(__APP.BUILD.actionButton({title:"Отменить событие",classes:n.concat(["event_hide_function_button","DropdownButton",__C.CLASSES.COLORS.NEUTRAL,__C.CLASSES.ICONS.TIMES_CIRCLE]),dataset:{"dd-width":"self",dropdown:"cancel_event"}}))}()})),this.render_vars.organization_avatar_block=__APP.BUILD.avatarBlocks(this.event.organization,{block_classes:[__C.CLASSES.SIZES.SMALL],is_link:!0,entity:__C.ENTITIES.ORGANIZATION}),this.render_vars.org_contact_link=__APP.BUILD.linkButton({title:"Связаться с организатором",page:"/organization/{org_id}/feedback".format({org_id:this.event.organization.id}),classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.ENVELOPE,__C.CLASSES.HOOKS.RIPPLE]}),(this.event.ticketing_locally||this.event.registration_locally)&&(this.render_vars.event_action=new OrderButton(this.event,{classes:["event_main_action_button",__C.CLASSES.SIZES.BIG,__C.CLASSES.HOOKS.RIPPLE],colors:{unchecked:__C.CLASSES.COLORS.ACCENT,unchecked_hover:__C.CLASSES.COLORS.ACCENT}})),this.render_vars.event_additional_info=$(),this.event.is_free||(this.render_vars.event_additional_info=this.render_vars.event_additional_info.add(tmpl("event-additional-info",{text:"Стоимость от "+(this.event.min_price?formatCurrency(this.event.min_price):"0")+" ₽"}))),this.event.registration_required&&(this.render_vars.event_additional_info=this.render_vars.event_additional_info.add(tmpl("event-additional-info",{text:this.event.registration_till?"Регистрация до "+moment.unix(this.event.registration_till).calendar(null,__LOCALES.ru_RU.DATE.CALENDAR_DATE_TIME).toLowerCase():"Регистрация обязательна"}))),this.event.is_online&&(this.render_vars.event_additional_info=this.render_vars.event_additional_info.add(tmpl("event-additional-info",{text:"Online"}))),this.render_vars.event_additional_fields=$(),(this.event.dates.length<5||!this.event.is_same_time)&&(this.render_vars.event_additional_fields=this.render_vars.event_additional_fields.add(tmpl("event-date-time",{date_times:tmpl("event-date-time-row",formatDates(this.event.dates,{date:"{D} {MMMMs}",time:"{T}"},this.event.is_same_time))}))),this.render_vars.avatars_collection=__APP.BUILD.avatarCollection(this.event.favored,8,{dataset:{modal_type:"favors",modal_event_id:this.event.id},classes:[__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.SIZES.SMALL,__C.CLASSES.HOOKS.ADD_AVATAR.COLLECTION,__C.CLASSES.HOOKS.CALL_MODAL,this.event.is_favorite?__C.CLASSES.HOOKS.ADD_AVATAR.STATES.SHIFTED:""],counter_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.COLORS.MARGINAL,__C.CLASSES.HOOKS.ADD_AVATAR.STATES.CASTABLE]},this.event.favored_users_count),this.render_vars.action_button=new AddToFavoriteButton(this.event,{is_add_avatar:!0,is_checked:this.event.is_favorite,classes:["event_main_action_button","AddToFavored",__C.CLASSES.SIZES.BIG,__C.CLASSES.HOOKS.RIPPLE],labels:{unchecked:"Добавить в избранное",unchecked_hover:"Добавить в избранное"},icons:{checked:__C.CLASSES.ICONS.CHECK},colors:{checked:__C.CLASSES.COLORS.MUTED,checked_hover:__C.CLASSES.COLORS.NEUTRAL,unchecked:__C.CLASSES.COLORS.NEUTRAL_ACCENT,unchecked_hover:__C.CLASSES.COLORS.NEUTRAL_ACCENT}}),__APP.USER.isLoggedOut()||(this.render_vars.action_button=this.render_vars.action_button.add(new DropDown("event-edit-notifications","",{classes:["EventNotificationsButton",__C.CLASSES.SIZES.BIG,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.BELL,__C.CLASSES.UNIVERSAL_STATES.EMPTY,__C.CLASSES.COLORS.NEUTRAL,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.HOOKS.DROPDOWN_BUTTON]},{width:190,position:{x:"right",y:3}},{notifications:function(t){var n=moment(),i={},a={},r=0;i[OneNotification.NOTIFICATIN_TYPES.BEFORE_QUARTER_OF_HOUR]={label:"За 15 минут",moment:moment.unix(t.last_event_date).subtract(15,"minutes").unix()},i[OneNotification.NOTIFICATIN_TYPES.BEFORE_THREE_HOURS]={label:"За 3 часа",moment:moment.unix(t.last_event_date).subtract(3,"hours").unix()},i[OneNotification.NOTIFICATIN_TYPES.BEFORE_DAY]={label:"За день",moment:moment.unix(t.last_event_date).subtract(1,"days").unix()},i[OneNotification.NOTIFICATIN_TYPES.BEFORE_THREE_DAYS]={label:"За 3 дня",moment:moment.unix(t.last_event_date).subtract(3,"days").unix()},i[OneNotification.NOTIFICATIN_TYPES.BEFORE_WEEK]={label:"За неделю",moment:moment.unix(t.last_event_date).subtract(1,"week").unix()};for(var s in t.notifications)t.notifications.hasOwnProperty(s)&&(a[t.notifications[s].notification_type]=t.notifications[s]);return __APP.BUILD.checkbox(Object.keys(i).map(function(e){var s=moment.unix(i[e].moment).isBefore(n),o={id:"event_notify_"+ ++r,classes:["ToggleNotification"],name:"notification_time",label:i[e].label,attributes:{value:e},dataset:{event_id:t.id}};return a[e]&&(s=s||a[e].done||!a[e].uuid,a[e].uuid&&(o.dataset.uuid=a[e].uuid),o.attributes.checked=!0),s&&(o.unit_classes=[__C.CLASSES.STATUS.DISABLED],o.attributes.disabled=!0),o})).each(function(){$(this).on("change",":checkbox",function(){var n=$(this);n.prop("disabled",!0),n.prop("checked")?t.addNotification(n.val()).then(function(t){n.data("uuid",t.uuid),n.prop("disabled",!1),e.$wrapper.trigger("notifications:change",["add",t])}):t.deleteNotification(n.data("uuid")).then(function(){var t=e.event.notifications.pull(n.data("uuid"));n.data("uuid",void 0),n.prop("disabled",!1),e.$wrapper.trigger("notifications:change",["remove",t])})})})}(this.event)}))),this.event.organization.is_private||(this.render_vars.event_additional_fields=this.render_vars.event_additional_fields.add(tmpl("event-additional-field",{key:"Поделиться",value:__APP.BUILD.shareLinks({url:encodeURIComponent(window.location),title:this.event.title,image_url:this.event.image_horizontal_url},[__C.SOCIAL_NETWORKS.VK,__C.SOCIAL_NETWORKS.TWITTER,__C.SOCIAL_NETWORKS.GOOGLE,__C.SOCIAL_NETWORKS.FACEBOOK])}))),this.event.detail_info_url&&(this.render_vars.event_additional_fields=this.render_vars.event_additional_fields.add(tmpl("event-detail-link",{detail_info_url:this.event.detail_info_url}))),this.render_vars.event_additional_fields=this.render_vars.event_additional_fields.add(tmpl("event-additional-field",{key:"Теги",value:__APP.BUILD.tags(this.event.tags)})),this.event.location&&(this.render_vars.event_additional_fields=this.render_vars.event_additional_fields.add(tmpl("event-additional-field",{key:"Место проведения",value:$("<p>"+this.event.location+"</p>").add(__APP.BUILD.actionButton({title:"Показать на карте",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE,"CallModal","EventMap"],dataset:{modal_type:"map",modal_map_location:encodeURIComponent(this.event.location)}}))}))),this.event.canceled&&(this.render_vars.overlay_cap=this.$overlay_cap)},e.prototype.render=function(){var e=this.event.nearest_event_date?moment.unix(this.event.nearest_event_date):moment.unix(this.event.first_event_date);this.$wrapper.html(tmpl("event-page",this.render_vars)),this.event.is_same_time&&this.event.dates.length>=5&&(this.calendar=new Calendar(this.$wrapper.find(".EventCalendar"),{classes:{wrapper_class:"event_calendar_wrapper",td_class:"event_calendar_day",th_class:"event_calendar_weekday",table_class:"feed_calendar_table"},selection_type:Calendar.SELECTION_TYPES.MULTI,disable_selection:!0}),this.calendar.init().setMonth(e.format("M"),e.format("YYYY")).selectDays(this.event.dates.map(function(e){return moment.unix(e.event_date).format(__C.DATE_FORMAT)})).bindTime(this.event.dates)),this.init()},e}()),OrderPage=extending(Page,function(){function e(e){var t=this;Page.call(this),this.event=new OneEvent(e),this.event_fields=new Fields("accept_bitcoins","apply_promocodes_and_pricing_rules","ticketing_locally","ticketing_available","registration_locally","registration_required","registration_available","registration_fields",{ticket_types:{fields:new Fields("is_selling","comment","price","min_count_per_user","max_count_per_user")}}),this.promocode=new OnePromocode(e),this.promocode_fields=new Fields,this.is_promocode_active=!1,this.overall_sum=0,this.total_sum=0,this.render_vars={event_id:e,tickets_selling:null,registration:null,pay_button:null,register_button:null,main_action_button:null,legal_entity_payment_button:null,bitcoin_payment_button:null},this.$main_action_buttton=null,Object.defineProperties(this,{page_title:{get:function(){return(t.event.ticketing_locally?"Заказ билетов на событие ":"Регистрация на событие ")+t.event.title}}})}return e.prototype.fetchData=function(){return this.fetching_data_defer=this.event.fetchEvent(this.event_fields)},e.buildRegistrationField=function(e){var t={id:"registration_form_"+e.uuid,name:e.uuid,unit_classes:["Registration"+e.type.toCamelCase("_")+"Field"],label:$("<span>"+e.label+"</span>").add(e.required?tmpl("required-star"):$()),required:e.required};switch(e.type){case RegistrationFieldModel.TYPES.SELECT:return function(e,t){return tmpl("form-unit",Builder.normalizeBuildProps({unit_classes:e.unit_classes,label:tmpl("label",{id:e.id,label:e.label}),form_element:__APP.BUILD.select(t.map(function(e){return{display_name:e.value,val:e.uuid||guid()}}),{id:e.id,name:e.name,required:e.required},e.classes)}))}($.extend({},t,{classes:["form_select2","ToSelect2"]}),e.values instanceof Array?e.values:[]);case RegistrationFieldModel.TYPES.SELECT_MULTI:return function(e,t){return tmpl("form-unit",Builder.normalizeBuildProps($.extend(!0,{},e,{unit_classes:e.classes,label:tmpl("label",{id:e.id+"_label",label:e.label}),form_element:__APP.BUILD.checkbox.apply(__APP.BUILD,t.map(function(t){return{id:"registration_field_value_"+(t.uuid||guid()),name:e.name,label:t.value,attributes:{value:t.uuid||guid(),required:e.required}}}))})))}($.extend({},t,{type:"checkbox"}),e.values instanceof Array?e.values:[]);default:return __APP.BUILD.formUnit($.extend({},t,{type:e.type===RegistrationFieldModel.TYPES.EXTENDED_CUSTOM?"textarea":e.type,placeholder:e.label,helptext:function(t){switch(e.type){case RegistrationFieldModel.TYPES.EMAIL:return"На почту Вам поступит сообщение с подтверждением регистрации";case RegistrationFieldModel.TYPES.FIRST_NAME:return"Используйте настоящее имя для регистрации";case RegistrationFieldModel.TYPES.LAST_NAME:return"Используйте настоящую фамилию для регистрации";default:return""}}()}))}},e.prototype.gatherSendData=function(){var e;return e={tickets:this.$wrapper.find(".OrderFields").serializeForm("array").reduce(function(e,t){return+t.value&&e.push({uuid:t.name,count:+t.value}),e},[]),registration_fields:this.$wrapper.find(".RegistrationFields").serializeForm("array").map(function(e){return{uuid:e.name,value:e.value}}),promocode:this.$wrapper.find(".PromocodeInput").val(),utm:gatherUTMTags()},$.isEmptyObject(e.utm)&&delete e.utm,e},e.prototype.checkRedirect=function(){return this.event.ticketing_locally&&!this.event.ticketing_available||this.event.registration_locally&&!this.event.registration_available},e.prototype.commitOrder=function(e){var t,n=this,i=this.$wrapper.find(".OrderForm");if(e=setDefaultValue(e,!0),__APP.USER.isLoggedOut())return new AuthModal(window.location.href,{note:"Вам необходимо войти через социальную сеть чтобы сделать заказ"}).show(),Promise.reject(new Error("Вы не авторизованы"));if(isFormValid(i)){return t=this.gatherSendData(),e?(this.$main_action_buttton.attr("disabled",!0),this.event.makeOrder(t).then(function(e){return n.$main_action_buttton.removeAttr("disabled"),e},function(){n.$main_action_buttton.removeAttr("disabled")})):Promise.resolve(t)}return Promise.reject(new Error("Форма заполнена неверно"))},e.prototype.redirect=function(){return __APP.openPage(new NotAvailableOrderPage(this.event.organization.id,this.event))},e.prototype.init=function(){function e(){for(var e=o.$wrapper.find(".TicketType").find(".QuantityInput"),t=0;!empty(e[t]);){if(0!==e[t].value)return!0;t++}return!1}function t(e){var t=e.find(".TicketTypeSum"),n=e.find(".QuantityInput").val();n>0?t.removeClass(__C.CLASSES.HIDDEN):t.addClass(__C.CLASSES.HIDDEN),e.find(".TicketTypeSumText").text(formatCurrency(e.data("ticket_type").price*n))}function n(){o.overall_sum=Array.prototype.reduce.call(o.$wrapper.find(".TicketTypeSumText"),function(e,t){return e+parseInt(t.innerHTML.replace(" ",""))},0),o.$wrapper.find(".TicketsOverallSum").text(formatCurrency(o.overall_sum)),e()?p.removeAttr("disabled"):p.attr("disabled",!0)}function i(){f||(f=!0,s=window.setTimeout(function(){f=!1,o.event.preOrder(o.gatherSendData()).then(function(e){o.total_sum=e.price.final_sum,e.pricing_rule||e.promocode?(o.$wrapper.find(".TicketsOverallSum").addClass(__C.CLASSES.UNIVERSAL_STATES.LINE_THROUGH),o.$wrapper.find(".TicketsDiscountedWrapper").removeClass(__C.CLASSES.HIDDEN),o.$wrapper.find(".TicketsTotalSum").text(formatCurrency(o.total_sum))):(o.$wrapper.find(".TicketsOverallSum").removeClass(__C.CLASSES.UNIVERSAL_STATES.LINE_THROUGH),o.$wrapper.find(".TicketsDiscountedWrapper").addClass(__C.CLASSES.HIDDEN)),0===o.total_sum?$.contains(o.$wrapper[0],o.render_vars.pay_button[0])&&(o.render_vars.pay_button.after(o.render_vars.register_button),o.render_vars.pay_button.detach(),o.$main_action_buttton=o.render_vars.register_button,u.addClass(__C.CLASSES.HIDDEN)):$.contains(o.$wrapper[0],o.render_vars.register_button[0])&&(o.render_vars.register_button.after(o.render_vars.pay_button),o.render_vars.register_button.detach(),o.$main_action_buttton=o.render_vars.pay_button,u.removeClass(__C.CLASSES.HIDDEN))})},500))}var a,r,s,o=this,l=parseUri(location),c=this.$wrapper.find(".ActivatePromocode"),_=this.$wrapper.find(".PromocodeInput"),d=this.$wrapper.find(".QuantityInput"),u=this.$wrapper.find(".PayButtons"),p=this.$wrapper.find(".OrderFormFooter"),h=l.queryKey.ticket_selected,f=!1;this.$main_action_buttton=this.render_vars.register_button,bindRippleEffect(this.$wrapper),bindControlSwitch(this.$wrapper),initSelect2(this.$wrapper.find(".ToSelect2"),{dropdownCssClass:"form_select2_drop form_select2_drop_no_search"}),c.on("click.ActivatePromocode",function(){var e=o.$wrapper.find(".OrderFormWrapper"),t=_.val();""===t?showNotifier({status:!1,text:"Пожалуйста, введите промокод"}):(e.attr("disabled",!0),o.promocode.fetchPromocodebyCodeName(t,o.promocode_fields,function(){var t=e.find(".PromocodeWrapper");e.removeAttr("disabled"),t.after(__APP.BUILD.text({classes:[__C.CLASSES.TEXT_COLORS.MUTED_80,__C.CLASSES.TEXT_WEIGHT.BOLDER],content:"Промокод активирован"})),t.addClass(__C.CLASSES.HIDDEN),o.is_promocode_active=!0,n(),i()},function(){showNotifier({status:!1,text:"Указанный промокод не существует или более не активен"}),e.removeAttr("disabled"),_.focus().select()}))}),_.on("keypress",function(e){isKeyPressed(e,__C.KEY_CODES.ENTER)&&c.trigger("click.ActivatePromocode")}),this.$wrapper.find(".RegistrationFirstNameField").find("input").val(__APP.USER.first_name),this.$wrapper.find(".RegistrationLastNameField").find("input").val(__APP.USER.last_name),this.$wrapper.find(".RegistrationEmailField").find("input").val(__APP.USER.email),h&&(h=decodeURIComponent(h),(r=this.$wrapper.find(".TicketType").filter(function(){return $(this).data().ticket_type.name===h})).length&&r.find(".QuantityInput").resolveInstance().increment()),this.event.ticketing_locally&&(d.on("QuantityInput::change",function(){t($(this).closest(".TicketType")),n(),e()?i():(o.$wrapper.find(".TicketsOverallSum").removeClass(__C.CLASSES.UNIVERSAL_STATES.LINE_THROUGH),o.$wrapper.find(".TicketsDiscountedWrapper").addClass(__C.CLASSES.HIDDEN))}),this.$wrapper.find(".TicketType").each(function(){t($(this))}),n(),this.render_vars.legal_entity_payment_button.on("click.LegalEntityPayment",function(){o.commitOrder().then(function(e){var t=parseUri(location);__APP.changeState(t.path+"/"+e.order.uuid+"/from_legal_entity")})})),this.render_vars.pay_button.on("click.MakeOrder",function(){var e=decodeURIComponent(l.queryKey.away_to)||window.location.origin+"/event/"+o.event.id;Array.prototype.reduce.call(d,function(e,t){return e||0!==t.value},!1)?__APP.IS_WIDGET?o.commitOrder(!1).then(function(t){(a=o.$wrapper.find(".OrderFormPayload")).val(JSON.stringify(mergeObjects({redirect_to_payment:!0,callback_url:e},t))),o.$wrapper.find(".OrderForm").submit()}):o.commitOrder().then(function(t){Payment.doPayment("order-"+t.order.uuid,t.order.final_sum,e)}):showNotifier({status:!1,text:"Сначала выберите тип билета, который хотите приобрести"})}),this.render_vars.register_button.on("click.Register",function(){o.commitOrder().then(function(e){var t,n;l.queryKey.away_to?(t=l.queryKey.away_to,o.overall_sum<=0&&(t=(n=parseUri(decodeURIComponent(t))).wo_query+"?"+objectToQueryString(Object.assign({registration:"free"},n.query))),__APP.IS_WIDGET?__APP.POST_MESSAGE.redirect(t):window.location=t):(__APP.changeState("/event/{event_id}".format({event_id:o.event.id})),showNotifier({text:"Регистрация прошла успешно",status:!0}))})}),this.event.accept_bitcoins&&this.render_vars.bitcoin_payment_button.on("click.BitcoinPayment",function(){var e,t=$(this);t.data("modal")?(e=t.data("modal")).show():o.commitOrder().then(function(n){e=new BitcoinModal(o.event,n.order.uuid),t.data("modal",e),e.show()})})},e.prototype.preRender=function(){var t=this.event.ticket_types.filter(function(e){return e.is_selling});this.event.ticketing_locally&&(this.render_vars.tickets_selling=tmpl("order-tickets-selling",{ticket_types:tmpl("order-ticket-type",t.map(function(e){return{name:e.name,ticket_type_uuid:e.uuid,quantity_input:new QuantityInput({name:e.uuid},{min:e.min_count_per_user||0,max:e.max_count_per_user||e.amount||30}),description:e.comment,type_price:formatCurrency(e.price),sum_price:0}})),overall_price:0}),this.render_vars.tickets_selling.find(".TicketType").each(function(e){var n=$(this);n.data("ticket_type",t[e]),t[e].is_selling||n.attr("disabled",!0)})),this.event.registration_locally&&(this.render_vars.registration=tmpl("order-registration",{registration_fields:$.makeSet(this.event.registration_fields.map(e.buildRegistrationField))})),this.render_vars.pay_button=__APP.BUILD.button({title:"Заплатить через Яндекс",classes:[__C.CLASSES.COLORS.YANDEX,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE,"MainActionButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.HUGE]}),this.render_vars.register_button=__APP.BUILD.button({title:"Зарегистрироваться",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE,"MainActionButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.HUGE]}),this.render_vars.main_action_button=this.render_vars.register_button,this.event.ticketing_locally&&(this.render_vars.legal_entity_payment_button=__APP.BUILD.button({title:"Оплатить через юр. лицо",classes:[__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.TEXT_WEIGHT.LIGHTER,__C.CLASSES.HOOKS.RIPPLE,"LegalEntityPaymentButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.BIG,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]}),this.render_vars.legal_entity_payment_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.HOW_TO_PAY_FROM_LEGAL_ENTITY,"Как оплатить со счета компании")),this.event.accept_bitcoins&&(this.render_vars.bitcoin_payment_button=__APP.BUILD.button({title:"Заплатить через Bitcoin",classes:[__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.TEXT_WEIGHT.LIGHTER,__C.CLASSES.HOOKS.RIPPLE,"BitcoinPaymentButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.BIG,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]}))},e.prototype.render=function(){if(__APP.USER.isLoggedOut()){var e=new AuthModal(window.location.href,{note:"Вам необходимо войти через социальную сеть чтобы сделать заказ"});return e.is_hidable=!1,e.show()}this.$wrapper.html(tmpl("order-page",this.render_vars)),this.init()},e}()),LegalEntityPayment=extending(Page,function(){function e(e,t){var n=this;Page.call(this),this.order=new OneOrder(t,e),this.order_fields=new Fields("sum","event"),this.render_vars={event_id:e,order_uuid:t,event_info:null,receivers_form_field:null,company_form_field:null,inn_form_field:null,kpp_form_field:null,real_address_form_field:null,post_address_form_field:null,bank_name_form_field:null,bic_form_field:null,correspondent_account_form_field:null,checking_account_form_field:null,signer_name_form_field:null,signer_position_form_field:null,self_name_form_field:null,self_email_form_field:null,self_phone_form_field:null,back_to_link:null},this.$submit_button=$(),Object.defineProperties(this,{event:{get:function(){return n.order.event}},page_title:{get:function(){return"Оплата участия на событие "+n.event.title+" от юридического лица"}}})}return e.prototype.fetchData=function(){return this.fetching_data_defer=this.order.fetch(this.order_fields)},e.prototype.init=function(){var e=this,t=this.$wrapper.find(".CompanyNameInput"),n=this.$wrapper.find(".InnInput"),i=this.$wrapper.find(".KppInput"),a=this.$wrapper.find(".AddressInput"),r=this.$wrapper.find(".BankNameInput"),s=this.$wrapper.find(".BikInput"),o=this.$wrapper.find(".CorrespondentAccountInput");t.on("input.ToggleCompanyInfo",function(){""!==$(this).val().trim()&&e.$wrapper.find(".CompanyAdditionalInfo").removeClass(__C.CLASSES.HIDDEN)}),t.add(n).suggestions({token:__C.API_TOKENS.DADATA,type:"PARTY",count:5,onSelect:function(e){t.val(e.unrestricted_value).trigger("change"),e.data&&(n.val(e.data.inn).trigger("change"),i.val(e.data.kpp).trigger("change"),e.data.address&&a.val(e.data.address.value).trigger("change"))}}),r.on("input.ToggleBankInfo",function(){""!==$(this).val().trim()&&e.$wrapper.find(".BankAdditionalInfo").removeClass(__C.CLASSES.HIDDEN)}),r.add(s).suggestions({token:__C.API_TOKENS.DADATA,type:"BANK",count:5,onSelect:function(e){r.val(e.unrestricted_value).trigger("change"),e.data&&(s.val(e.data.bic).trigger("change"),o.val(e.data.correspondent_account).trigger("change"))}}),this.$submit_button.on("click.SubmitForm",function(){var t,n=e.$wrapper.find(".LegalEntityPaymentForm");isFormValid(n)&&(t=__APP.BUILD.overlayLoader(e.$wrapper),e.order.makeLegalEntityPayment(n.serializeForm()).then(function(){var t=e.$wrapper.find(".LegalEntityPaymentContract");try{window.localStorage.removeItem(e.event.id+"_order_info")}catch(e){}showNotifier({text:"Договор-счет сформирован, вы можете его открыть, либо скачать",status:!0}),n.attr("disabled",!0),e.$wrapper.find(".LegalEntityPaymentFooter").addClass(__C.CLASSES.HIDDEN),t.removeClass(__C.CLASSES.HIDDEN),scrollTo(t,400)}),t.remove())})},e.prototype.preRender=function(){this.render_vars.event_info=__APP.BUILD.fields([{name:"Название события:",value:this.event.title},{name:"Дата события:",value:displayDateRange(this.event.first_event_date,this.event.last_event_date)},{name:"Сумма платежа:",value:formatCurrency(this.order.sum)+" руб."}]),this.render_vars.receivers_form_field=__APP.BUILD.formUnit({label:"Перечислите ФИО участников от компании",id:"legal_entity_payment_receivers",name:"participants",type:"textarea",helptext:"По одному участнику на каждой строке",required:!0}),this.render_vars.company_form_field=__APP.BUILD.formUnit({label:"Название компании",id:"legal_entity_payment_company_name",name:"company_name",classes:"CompanyNameInput",placeholder:"Начните вводить чтобы появились предложения",helptext:"Полное наименование организации, включая форму предприятия",required:!0}),this.render_vars.inn_form_field=__APP.BUILD.formUnit({label:"ИНН",id:"legal_entity_payment_inn",name:"company_inn",classes:"InnInput",placeholder:"Попробуйте найти организацию через ИНН",helptext:"10 или 12 знаков в зависимости от организационной формы",required:!0,attributes:{maxlength:12}}),this.render_vars.kpp_form_field=__APP.BUILD.formUnit({label:"КПП",id:"legal_entity_payment_kpp",name:"company_kpp",classes:"KppInput",helptext:"9 знаков, если у вас нет КПП - поставьте прочерк",required:!0,attributes:{maxlength:9}}),this.render_vars.real_address_form_field=__APP.BUILD.formUnit({label:"Юридический адрес",id:"legal_entity_payment_real_address",name:"company_address",classes:"AddressInput",helptext:"Например: 150000, Россия, Москыв, ул. Ленина, д. 108, корп. 1, кв. 8",required:!0}),this.render_vars.bank_name_form_field=__APP.BUILD.formUnit({label:"Наименование банка",id:"legal_entity_payment_bank_name",name:"bank_name",classes:"BankNameInput",placeholder:"Начните вводить чтобы появились предложения",helptext:"Полное наименование банка, включая отделение (если есть)",required:!0}),this.render_vars.bic_form_field=__APP.BUILD.formUnit({label:"БИК",id:"legal_entity_payment_bic",name:"bank_bik",classes:"BikInput",placeholder:"Попробуйте найти банк через БИК",helptext:"9 знаков",required:!0,attributes:{maxlength:9}}),this.render_vars.correspondent_account_form_field=__APP.BUILD.formUnit({label:"Корреспондентский счет",id:"legal_entity_payment_correspondent_account",name:"bank_correspondent_account",classes:"CorrespondentAccountInput",helptext:"20 знаков",required:!0,attributes:{maxlength:20},inputmask:{}}),this.render_vars.checking_account_form_field=__APP.BUILD.formUnit({label:"Расчетный счет",id:"legal_entity_payment_checking_account",name:"bank_payment_account",helptext:"20 знаков",required:!0,attributes:{maxlength:20}}),this.render_vars.signer_name_form_field=__APP.BUILD.formUnit({label:"ФИО подписывающего лица",id:"legal_entity_payment_signer_name",name:"signer_full_name",helptext:"ФИО лица, подписывающего договор (полностью). Например, Иванов Иван Иванович",required:!0}),this.render_vars.signer_position_form_field=__APP.BUILD.formUnit({label:"Должность подписывающего лица",id:"legal_entity_payment_signer_position",name:"signer_position",helptext:"Должность директора или ответственного лица, подписывающего договор",required:!0}),this.render_vars.self_name_form_field=__APP.BUILD.formUnit({label:"Ваши имя и фамилия",id:"legal_entity_payment_self_name",name:"contact_full_name",value:__APP.USER.full_name,required:!0}),this.render_vars.self_email_form_field=__APP.BUILD.formUnit({label:"Ваш e-mail",id:"legal_entity_payment_self_email",name:"contact_email",value:__APP.USER.email,helptext:"На него мы вышлем заполненный договор",required:!0}),this.render_vars.self_phone_form_field=__APP.BUILD.formUnit({label:"Контактный телефон",id:"legal_entity_payment_self_phone",name:"contact_phone_number",helptext:"В формате: +7 (xxx) xxx-xx-xx",required:!0}),this.render_vars.submit_button=this.$submit_button=__APP.BUILD.button({classes:[__C.CLASSES.SIZES.HUGE,__C.CLASSES.COLORS.ACCENT,"LegalEntityPaymentSubmit"],title:"Сформировать договор-счет"}),this.render_vars.back_to_link=__APP.BUILD.link({title:"Назад к событию",page:"/event/{event_id}".format({event_id:this.event.id})})},e.prototype.render=function(){if(__APP.USER.isLoggedOut()){var e=new AuthModal(window.location.href,{note:"Для оплаты вам необходимо войти через социальную сеть"});return e.is_hidable=!1,e.show()}this.$wrapper.html(tmpl("legal-entity-payment-page",this.render_vars)),this.init()},e}()),AbstractFeedbackPage=extending(Page,function(){function e(e){Page.call(this),this.organization=new OneOrganization(e),this.fields=new Fields,this.render_vars={header:null,sub_header:null,name_field:null,email_field:null,phone_field:null,message_field:null,submit_button:null}}return e.prototype.fetchData=function(){return this.fetching_data_defer=this.organization.fetchOrganization(this.fields)},e.prototype.afterFormSend=function(){},e.prototype.init=function(){var e,t=this,n=this.$wrapper.find(".FeedbackForm"),i=this.$wrapper.find(".FeedbackFormWrapper");this.render_vars.submit_button.on("click.SendFeedback",function(){isFormValid(n)&&(i.addClass(__C.CLASSES.HIDDEN),e=__APP.BUILD.loaderBlock(),i.after(e),t.organization.sendFeedback(n.serializeForm()).then(function(){showNotifier({text:"Сообщение успешно отправлено",status:!0}),t.afterFormSend(),i.removeClass(__C.CLASSES.HIDDEN)}),e.remove())})},e.prototype.preRender=function(){this.render_vars.name_field=__APP.BUILD.formUnit({label:"Ваше имя",id:"order_page_feedback_form_name",name:"name",value:__APP.USER.full_name,placeholder:"Имя",helptext:"Чтобы мы знали как в вам обращаться",required:!0}),this.render_vars.email_field=__APP.BUILD.formUnit({label:"Ваш e-mail",id:"order_page_feedback_form_email",name:"email",value:__APP.USER.email,placeholder:"E-mail",helptext:"Чтобы мы знали как с вами связаться",required:!0}),this.render_vars.phone_field=__APP.BUILD.formUnit({label:"Ваш телефон",id:"order_page_feedback_form_phone",name:"phone",placeholder:"Номер телефона",helptext:"Будем звонить только в экстренных случаях!"}),this.render_vars.message_field=__APP.BUILD.formUnit({label:"Сообщение",id:"order_page_feedback_form_message",name:"message",type:"textarea",placeholder:"Сообщите нам, если что-то пошло не так, либо если у вас есть какие-то пожелания",required:!0}),this.render_vars.submit_button=__APP.BUILD.button({title:"Отправить",classes:[__C.CLASSES.COLORS.ACCENT,"SendFeedbackButton"]})},e.prototype.render=function(){this.$wrapper.html(tmpl("organization-feedback-page",this.render_vars)),this.init()},e}()),NotAvailableOrderPage=extending(AbstractFeedbackPage,function(){function e(e,t){var n=this;AbstractFeedbackPage.call(this,e),this.event=t,Object.defineProperties(this,{page_title:{get:function(){return(n.event.ticketing_locally?"Заказ билетов на событие ":"Регистрация на событие ")+n.event.title}}})}return e.prototype.fetchData=Page.prototype.fetchData,e.prototype.afterFormSend=function(){this.$wrapper.find(".FeedbackFormWrapper").html(__APP.BUILD.linkButton({title:"Вернуться к событию",page:"/event/{event_id}".format({event_id:this.event.id}),classes:[__C.CLASSES.COLORS.ACCENT]}))},e.prototype.preRender=function(){AbstractFeedbackPage.prototype.preRender.call(this),this.render_vars.header=tmpl("organization-feedback-header",{header:"Регистрация на событие окончена"}),this.render_vars.sub_header=tmpl("organization-feedback-sub-header",{sub_header:"Что-то пошло не так? Дайте знать нам и организаторам события."})},e}()),SearchPage=extending(Page,function(){function e(e){Page.call(this),this.page_title="Поиск",this.$search_bar_input=$("#search_bar_input"),this.search_string=decodeURIComponent(e),this.events_ajax_data={length:10,fields:FeedPage.fields.copy(),order_by:"nearest_event_date,-first_event_date"},this.organizations_ajax_data={length:30,fields:new Fields(["subscribed_count","img_small_url"])},this.past_events=!1,this.search_results=new SearchResults(this.search_string)}return e.buildOrganizationItems=function(e){return __APP.BUILD.organizationItems(e,{block_classes:["-show"],avatar_classes:["-size_50x50","-rounded"],counter_classes:[__C.CLASSES.HIDDEN]})},e.buildEventCards=function(e){var t=$();return 0==e.length?t=tmpl("search-no-events",{}):e.forEach(function(e){void 0!=e.nearest_event_date||this.past_events||(t=t.add(tmpl("divider",{title:"Прошедшие события"})),this.past_events=!0),t=t.add(__APP.BUILD.eventCards(e))}),t},e.prototype.fetchData=function(){return this.fetching_data_defer=this.search_results.fetchEventsAndOrganizations(this.events_ajax_data,this.organizations_ajax_data)},e.prototype.init=function(){function t(e){trimAvatarsCollection(e),bindRippleEffect(e),__APP.MODALS.bindCallModal(e),bindPageLinks(e),e.find(".HideEvent").remove()}var n,i=this,a=$(window);n=this.$wrapper.find(".SearchOrganizationsScrollbar").scrollbar({disableBodyScroll:!0,onScroll:function(t){t.scroll==t.maxScroll&&i.search_results.fetchOrganizations(i.organizations_ajax_data,function(t){t.length?n.append(e.buildOrganizationItems(t)):n.off("scroll.onScroll"),bindPageLinks(n)})}}),a.off("scroll.upload"+i.constructor.name),a.on("scroll.upload"+i.constructor.name,function(){a.height()+a.scrollTop()+200>=$(document).height()&&!i.block_scroll&&(i.block_scroll=!0,i.search_results.fetchEvents(i.events_ajax_data,function(n){var r;n.length?(r=e.buildEventCards(i.search_results.events.__last_pushed),i.$wrapper.find(".SearchEvents").append(r),t(r),i.block_scroll=!1):a.off("scroll.upload"+i.constructor.name)}))}),t(this.$wrapper)},e.prototype.render=function(){var t={};$(".TopBarOverlay").addClass("-open_search_bar"),this.$search_bar_input.val(this.search_string),t.events=e.buildEventCards(this.search_results.events),0==this.search_results.organizations.length?t.no_organizations=__C.CLASSES.HIDDEN:t.organizations=e.buildOrganizationItems(this.search_results.organizations),this.$wrapper.append(tmpl("search-wrapper",t)),this.init()},e.prototype.destroy=function(){$(".TopBarOverlay").removeClass("-open_search_bar"),this.$search_bar_input.val("")},e}()),SearchByTagPage=extending(SearchPage,function(){return function(e){SearchPage.call(this,e),this.search_string="#"+decodeURIComponent(e),this.search_results=new SearchResults(this.search_string)}}()),AbstractEditOrganizationPage=extending(Page,function(){function e(){Page.call(this),this.organization=new OneOrganization,this.categories=new CategoriesCollection,this.cities=new CitiesCollection,this.state_name="admin",this.fields=new Fields("description","city","site_url","default_address","vk_url","privileges","facebook_url","email"),this.adding_is_over=!1}return e.prototype.init=function(){function e(){var e,n=t.$wrapper.find("#add-organization-form"),i=new OrganizationModel,a=n.serializeForm(),r=function(e,t){var n=!0;return e.find(":required").not(":disabled").each(function(){var e=$(this),t=e.data("maxlength");(""===e.val()||t&&e.val().length>t)&&(n&&scrollTo(e,400),handleErrorField(e),n=!1)}),t||e.find(".DataUrl").each(function(){var e=$(this);""===e.val()&&(n&&scrollTo(e,400,function(){showNotifier({text:"Пожалуйста, добавьте обложку организации",status:!1})}),n=!1)}),n}(n,!!a.organization_id),s=t.organization.id?"updateOrganization":"createOrganization";r&&(t.$wrapper.addClass(__C.CLASSES.STATUS.DISABLED),e=__APP.BUILD.overlayLoader(t.$view),i.setData(a),t.organization[s](i,function(){t.adding_is_over=!0;try{sessionStorage.removeItem("organization_info")}catch(e){}$(".SidebarNav").find(".ContinueRegistration").remove(),socket.emit("utils.registrationFinished",{uuid:t.$wrapper.find("#add_organization_organization_registration_uuid").val()}),socket.emit("utils.updateImages"),__APP.changeState("/organization/"+t.organization.id)}),t.$wrapper.removeClass(__C.CLASSES.STATUS.DISABLED),e.remove())}var t=this;!function(t){bindSelect2(t),bindTabs(t),bindLimitInputSize(t),bindRippleEffect(t),bindFileLoadButton(t),ImgLoader.init(t),t.find("#add_organization_address").placepicker(),t.find("#add_organization_submit").off("click.Submit").on("click.Submit",e)}(this.$wrapper),bindCallModal(this.$wrapper),function(e){t.categories.fetchCategories({},0,function(n){var i=t.$wrapper.find("#add_organization_type");i.html(tmpl("option",n.map(function(e){return{val:e.id,display_name:e.name}}))),initSelect2(i),e&&i.select2("val",e)})}(this.organization.type_id),function(e){var n=t.$wrapper.find(".OrganizationCity");t.cities.fetchCities(null,0,"local_name",function(){initSelect2(n,{tags:t.cities.map(function(e){return{text:e.local_name,id:e.id}}),width:"100%",placeholder:"Выберите или введите город",maximumSelectionLength:1,maximumSelectionSize:1,tokenSeparators:[",",";"],containerCssClass:"form_select2 -select2_no_tags",multiple:!1}),e&&n.select2("val",[e])})}(this.organization.city.id||__APP.USER.selected_city.id)},e.prototype.render=function(){if(__APP.USER.isLoggedOut()){var e=new AuthModal(window.location,{note:"Для выполнения этого действия Вам необходимо авторизоваться через социальную сеть"});return e.is_hidable=!1,void e.show()}if(!checkRedirect("organization/add","/add/organization"))return null;this.renderRest(),this.init()},e.prototype.renderRest=function(e){},e}()),AddOrganizationPage=extending(AbstractEditOrganizationPage,function(){function e(){AbstractEditOrganizationPage.call(this),this.page_title="Новая организация",this.adding_is_over=!1}return e.prototype.destroy=function(){var e=this.$wrapper.find("#add-organization-form").serializeForm(),t=$(".SidebarNav");if(!this.adding_is_over){t.find(".ContinueRegistration").length||(t.prepend(__APP.BUILD.link({page:"/add/organization",title:"Продолжить регистрацию",classes:["sidebar_navigation_item","SidebarNavItem","ContinueRegistration"]})),bindPageLinks(t));try{sessionStorage.setItem("organization_info",JSON.stringify({city_id:e.city_id,type_id:e.type_id,name:e.name,short_name:e.short_name,email:e.email,site_url:e.site_url,default_address:e.default_address,description:e.description,facebook_url:e.facebook_url,vk_url:e.vk_url}))}catch(e){}}},e.prototype.renderRest=function(){var e,t;try{t=JSON.parse(sessionStorage.getItem("organization_info")?sessionStorage.getItem("organization_info"):localStorage.getItem("organization_info")),sessionStorage.removeItem("organization_info")}catch(e){t={}}e=$.extend({header_text:this.page_title},t,!0),this.$wrapper.html(tmpl("add-organization-page",e))},e}()),CatalogPage=extending(Page,function(){function e(e,t){Page.apply(this),$.isNumeric(e)&&!t&&(t=e,e=__APP.USER.selected_city.en_name),this.wrapper_tmpl="organizations",this.categories_ajax_data={new_separated:!0,order_by:"order_position"},this.organizations_ajax_data={fields:["background_small_img_url","img_small_url","is_subscribed","subscribed_count","privileges"],order_by:"-subscribed_count"},this.default_title="Организации",this.selected_city=new OneCity,this.selected_city_name=e||__APP.USER.selected_city.en_name,this.selected_category_id=t,this.cities=new CitiesCollection,this.categories=new CategoriesCollection,this.all_organizations=new OrganizationsCollection}return e.prototype.fetchData=function(){var e=this;return this.fetching_data_defer=this.cities.fetchCities(null,0,"distance,local_name",function(){e.selected_city_name&&(e.selected_city=this.getByName(e.selected_city_name),e.categories_ajax_data.city_id=e.selected_city.id)}).then(function(){return e.categories.fetchCategoriesWithOrganizations(e.categories_ajax_data,e.organizations_ajax_data,0).then(function(){e.all_organizations.setData(e.categories.reduce(function(e,t){return e.concat.apply(e,t.organizations)},[])).sortBy("subscribed_count")})})},e.prototype.selectCategory=function(e){this.selected_category_id=empty(e)?this.selected_category_id:e,this.$view.find(".Category").filter('[data-category-id="'+this.selected_category_id+'"]').addClass(__C.CLASSES.ACTIVE),__APP.changeState("/organizations/at/"+this.selected_city_name+"/"+this.selected_category_id,!0),__APP.changeTitle(this.categories.getByID(this.selected_category_id).name)},e.prototype.init=function(){function e(){bindRippleEffect(t.$view),bindPageLinks(t.$view)}var t=this,n=t.$view.find(".Category"),i=t.$view.find("#organizations_cities_select");$(window).on("subscribe.updateCatalog",function(e,n){var i=t.all_organizations.getByID(n);i.is_subscribed=!0,i.subscribed_count++}),$(window).on("unsubscribe.updateCatalog",function(e,n){var i=t.all_organizations.getByID(n);i.is_subscribed=!1,i.subscribed_count--}),e(),t.$view.find(".OrganizationsCategoriesScroll").scrollbar({disableBodyScroll:!0}),initSelect2(i),i.off("change.SelectCity").on("change.SelectCity",function(){var e=t.cities.getByID($(this).val());__APP.USER.selected_city=e,__APP.changeState("/organizations/at/"+e.en_name,!0,!0)}),t.selected_city_name&&i.select2("val",t.cities.getByName(t.selected_city_name).id),t.$view.find(".ShowAllOrganizations").off("click.showAllOrganizations").on("click.showAllOrganizations",function(){n.removeClass(__C.CLASSES.ACTIVE).siblings(".SubcategoryWrap").height(0),t.selected_category_id=void 0,__APP.changeState("/organizations/at/"+t.selected_city_name,!0),__APP.changeTitle(t.default_title),t.$wrapper.html(__APP.BUILD.organizationCard(t.all_organizations)),e()}),n.off("click.selectCategory").on("click.selectCategory",function(){var n=$(this),i=n.data("category-id"),a=n.next(".SubcategoryWrap"),r=!!a.length,s=n.hasClass(__C.CLASSES.ACTIVE);n.parent().find(".Category").not(n).removeClass(__C.CLASSES.ACTIVE).filter(".SubcategoryWrap").height(0),r?(a.height(s?0:a.children().outerHeight()),n.toggleClass(__C.CLASSES.ACTIVE)):s?(t.categories=new CategoriesCollection,t.categories.fetchCategoriesWithOrganizations(t.categories_ajax_data,t.organizations_ajax_data,0,function(){t.render()})):(t.selectCategory(i),t.$wrapper.html(__APP.BUILD.organizationCard(t.categories.getByID(i).organizations)),e())})},e.prototype.render=function(){this.$view.find("#organizations_cities_select").html(tmpl("option",this.cities.map(function(e){return{val:e.id,display_name:e.local_name}}))),this.$view.find(".OrganizationsCategoriesScroll").html(__APP.BUILD.organisationsCategoriesItems(this.categories)),this.$wrapper.html(__APP.BUILD.organizationCard(this.selected_category_id?this.categories.getByID(this.selected_category_id).organizations:this.all_organizations)),"/organizations"!==window.location.pathname&&"/organizations/"!==window.location.pathname||!this.selected_city_name||__APP.changeState("/organizations/at/"+this.selected_city_name,!0),this.selected_category_id?this.selectCategory(this.selected_category_id):__APP.changeTitle(this.default_title),this.init()},e.prototype.destroy=function(){$(window).off("subscribe.updateCatalog unsubscribe.updateCatalog")},e}()),EditOrganizationPage=extending(AbstractEditOrganizationPage,function(){function e(e){AbstractEditOrganizationPage.call(this),this.page_title="Редактировать организацию",this.organization=new OneOrganization(e),this.adding_is_over=!0}return e.prototype.fetchData=function(){var e=this.cities.fetchCities(null,0,"local_name");return this.organization.id?this.fetching_data_defer=__APP.SERVER.multipleAjax(e,this.organization.fetchOrganization(this.fields)):this.fetching_data_defer=e},e.prototype.renderRest=function(){var e,t=this;if(this.organization.role===OneUser.ROLE.USER)return __APP.changeState("/",!0,!0);this.adding_is_over=!0,(e=$.extend(!0,{},this.organization)).header_text=this.page_title,e.background_img_url&&(e.background_filename=e.background_img_url.split("/").reverse()[0]),e.img_url&&(e.logo_filename=e.img_url.split("/").reverse()[0]),e.branding_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.SITE_DESIGN,"Как настроить дизайн страницы организации"),this.$wrapper.html(tmpl("add-organization-page",e)),e.img_url&&toDataUrl(e.img_url,function(e){t.$wrapper.find("#add_organization_img_src").val(e||null)}),e.background_img_url&&toDataUrl(e.background_img_url,function(e){t.$wrapper.find("#add_organization_background_src").val(e||null)})},e}()),OrganizationFeedbackPage=extending(AbstractFeedbackPage,function(){function e(e){var t=this;AbstractFeedbackPage.call(this,e),Object.defineProperties(this,{page_title:{get:function(){return"Связь с организатором "+t.organization.short_name}}})}return e.prototype.afterFormSend=function(){__APP.changeState(isDirectInstance(__APP.PREVIOUS_PAGE,Page)?"/organization/{org_id}".format({org_id:this.organization.id}):__APP.PREVIOUS_PAGE.location.path)},e.prototype.preRender=function(){AbstractFeedbackPage.prototype.preRender.call(this),this.render_vars.header=tmpl("organization-feedback-header",{header:"Связь с организатором"}),this.render_vars.sub_header=tmpl("organization-feedback-sub-header",{sub_header:"Что-то пошло не так? Дайте знать нам и организаторам события."}),this.render_vars.additional_fields=$(),this.render_vars.additional_fields=this.render_vars.additional_fields.add(__APP.BUILD.input({type:"hidden",name:"Название страницы",value:isDirectInstance(__APP.PREVIOUS_PAGE,Page)?null:__APP.PREVIOUS_PAGE.page_title})),this.render_vars.additional_fields=this.render_vars.additional_fields.add(__APP.BUILD.input({type:"hidden",name:"URL",value:isDirectInstance(__APP.PREVIOUS_PAGE,Page)?"{origin}/organization/{org_id}".format({origin:this.location.wo_path,org_id:this.organization.id}):__APP.PREVIOUS_PAGE.location.source}))},e}()),OrganizationPage=extending(Page,function(){function e(e){var t={last_date:"",block_scroll:!1,is_upload_disabled:!1},n=this;Page.call(this),this.fields=new Fields("img_small_url","background_medium_img_url","description","site_url","is_subscribed","privileges","brand_color","brand_color_accent","default_address","subscribed_count",{subscribed:{fields:"is_friend",order_by:"-is_friend,first_name",length:10}}),this.events_fields=new Fields("image_horizontal_medium_url","favored_users_count","is_favorite","is_registered","registration_available","registration_locally","ticketing_locally","ticketing_available","dates",{favored:{length:5}}),this.event_types={future:$.extend(!0,{},t,{name:"future",scroll_event:"scroll.uploadFutureEvents",sort_date_type:"nearest_event_date"}),past:$.extend(!0,{},t,{name:"past",scroll_event:"scroll.uploadPastEvents",sort_date_type:"last_event_date"}),delayed:$.extend(!0,{},t,{name:"delayed",scroll_event:"scroll.uploadDelayedEvents",sort_date_type:"public_at"}),canceled:$.extend(!0,{},t,{name:"canceled",scroll_event:"scroll.uploadCanceledEvents",sort_date_type:"first_event_date"})},this.current_tab=this.event_types.future.name,this.is_admin=!1,this.future_events=new FutureEventsCollection,this.past_events=new PastEventsCollection,this.delayed_events=new DelayedEventsCollection,this.canceled_events=new CanceledEventsCollection,this.organization=new OneOrganization(e),Object.defineProperty(this,"page_title",{get:function(){return n.organization.short_name}})}return e.prototype.fetchData=function(){var e=this;return this.fetching_data_defer=this.organization.fetchOrganization(this.fields).then(function(t){e.is_admin=e.organization.role!==OneUser.ROLE.USER})},e.prototype.fetchAndAppendFeed=function(e,t){var n,i,a,r=this;e.is_upload_disabled||e.block_scroll||(n=this.$wrapper.find("."+e.name.capitalize()+"Events"),i=__APP.BUILD.loaderBlock(n),e.block_scroll=!0,r[e.name+"_events"].fetchOrganizationsFeed(r.organization.id,r.events_fields,10,function(s){i.remove(),e.block_scroll=!1,s.length?a=__APP.BUILD.eventBlocks(s,e):(e.is_upload_disabled=!0,a=tmpl("organization-feed-no-event",{text:"Больше событий нет :("})),n.append(a),r.bindFeedEvents(a),isFunction(t)&&t()}))},e.prototype.bindFeedEvents=function(e){bindRippleEffect(e),trimAvatarsCollection(e),bindCallModal(e),bindPageLinks(e)},e.prototype.init=function(){var e=this,t=e.$wrapper.find(".SubscribersScroll");(this.organization.brand_color||this.organization.brand_color_accent)&&__APP.repaint({header:this.organization.brand_color,accent:this.organization.brand_color_accent}),bindTabs(e.$wrapper),bindCallModal(e.$wrapper),e.$wrapper.find(".Tabs").on("tabs:change",function(){e.current_tab=$(this).find(".Tab.-active").data("type")}),e.$wrapper.find(".ExternalPage").on("click.sendStat",function(){storeStat(e.organization.id,__C.STATS.ORGANIZATION_ENTITY,__C.STATS.ORGANIZATION_OPEN_SITE)}),isScrollRemain(1e3)&&e.fetchAndAppendFeed(e.event_types[e.current_tab]),$(window).on("scroll.uploadEvents",function(){isScrollRemain(1e3)&&e.fetchAndAppendFeed(e.event_types[e.current_tab])}),e.organization.subscribed.__last_pushed.length&&t.scrollbar({onScroll:function(n){var i,a=!1;e.organization.subscribed.__last_pushed.length&&(a=e.organization.subscribed.__last_pushed[e.organization.subscribed.__last_pushed.length-1].is_friend),n.scroll+200>=n.maxScroll&&!t.block_scroll&&(t.block_scroll=!0,i=__APP.BUILD.loaderBlock(t),e.organization.subscribed.fetchOrganizationSubscribers(e.organization.id,10,{fields:"is_friend",order_by:"-is_friend,first_name"},function(e){e.length?(t.append(__APP.BUILD.subscribers(e,a)),t.block_scroll=!1):t.off("scroll.onScroll"),i.remove(),bindPageLinks(t)}))}})},e.prototype.render=function(){var e=this,t=new OneOrganization(e.organization.id);t.setData(e.organization),__APP.SIDEBAR.$subscribed_orgs.find('[data-organization_id="'+t.id+'"]').find(".OrganizationCounter").addClass(__C.CLASSES.HIDDEN),e.$wrapper.html(tmpl("organization-wrapper",$.extend(!0,{background_image:tmpl("organization-background-image",{background_img_url:t.background_medium_img_url||t.background_img_url,background_full_img_url:t.background_img_url}),avatar_block:__APP.BUILD.avatarBlocks(t,{block_classes:["organization_title_block"],avatar_classes:[__C.CLASSES.SIZES.SMALL,"organization_avatar"],entity:__C.ENTITIES.ORGANIZATION}),subscribe_button:new SubscribeButton(t.id,{is_checked:t.is_subscribed,colors:{checked:__C.CLASSES.COLORS.NEUTRAL,unchecked:__C.CLASSES.COLORS.ACCENT,checked_hover:__C.CLASSES.COLORS.NEUTRAL,unchecked_hover:__C.CLASSES.COLORS.ACCENT},classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.SIZES.WIDE,__C.CLASSES.HOOKS.RIPPLE]}),has_address:t.default_address?"":__C.CLASSES.HIDDEN,redact_org_button:t.role===OneUser.ROLE.ADMIN?__APP.BUILD.linkButton({title:__LOCALES.ru_RU.TEXTS.BUTTON.EDIT,classes:[__C.CLASSES.SIZES.WIDE,__C.CLASSES.COLORS.NEUTRAL,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.PENCIL,__C.CLASSES.HOOKS.RIPPLE],page:"/admin/organization/"+t.id+"/edit/"}):__APP.BUILD.linkButton({title:"Связаться с организатором",page:"/organization/{org_id}/feedback".format({org_id:this.organization.id}),classes:[__C.CLASSES.COLORS.DEFAULT,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.ENVELOPE,__C.CLASSES.HOOKS.RIPPLE]}),hidden_for_users:e.is_admin?"":__C.CLASSES.HIDDEN,subscribed_blocks:__APP.BUILD.subscribers(t.subscribed)},t))),e.init(),e.fetchAndAppendFeed(e.event_types.future),e.fetchAndAppendFeed(e.event_types.past),e.is_admin&&(e.fetchAndAppendFeed(e.event_types.delayed),e.fetchAndAppendFeed(e.event_types.canceled))},e.prototype.destroy=function(){__APP.IS_REPAINTED&&__APP.setDefaultColors()},e}()),TicketPage=extending(Page,function(){function e(){Page.call(this)}return e.prototype.render=function(){this.$view.find(".Print").on("click",function(){window.print()})},e}()),MyOrdersPage=extending(Page,function(){function e(){Page.call(this),this.page_title="Мои заказы",this.orders=new MyOrdersCollection,this.fetch_orders_fields=new Fields("final_sum","sum",{event:{fields:new Fields("dates")}}),this.fetch_order_fields=new Fields("payment_type","registration_fields",{event:{fields:new Fields("accept_bitcoins","location")},tickets:{fields:new Fields("ticket_type","number")}}),this.block_scroll=!1,this.$orders=$(),this.$detail_wrapper=$(),this.$registration_fields_wrapper=$()}return e.orderItemsBuilder=function(t){var n=t instanceof Array?t:[t];return tmpl("my-orders-order-unit",n.map(function(t){return{order_number:formatTicketNumber(t.number),order_datetime:moment.unix(t.created_at).calendar(__LOCALE.DATE.CALENDAR_DATE_TIME),event_title:t.event.title,order_footer:e.buildPayInfo(t)}})).each(function(e){$(this).data("order_uuid",n[e].uuid)})},e.buildPayInfo=function(e){var t="success",n=localeFromNamespace(e.status_type_code,OneOrder.EXTENDED_ORDER_STATUSES,__LOCALE.TEXTS.TICKET_STATUSES);return OneOrder.isRedStatus(e.status_type_code)?t="error":OneOrder.isYellowStatus(e.status_type_code)&&(t="warning"),null!==e.final_sum&&e.payed_at&&(n="Оплачен "+moment.unix(e.payed_at).format(__LOCALE.DATE.DATE_TIME_FORMAT)+" — "+formatCurrency(e.final_sum)+" руб."),tmpl("my-orders-order-unit-footer",{text:n,color:t})},e.prototype.fetchData=function(){return this.fetching_data_defer=this.orders.fetch(this.fetch_orders_fields,12,"-created_at")},e.prototype.selectOrderItem=function(t){function n(){i.$detail_wrapper.html(tmpl("my-orders-order-detail-info",{order_number:formatTicketNumber(a.number),pay_info:e.buildPayInfo(a),pay_button:function(e){var t=$();switch(e.status_type_code){case OneOrder.ORDER_STATUSES.WAITING_FOR_PAYMENT:return t=__APP.BUILD.button({title:"Заплатить через Яндекс",classes:["orders_page_pay_button",__C.CLASSES.COLORS.YANDEX,__C.CLASSES.HOOKS.RIPPLE,"PayButton",__C.CLASSES.SIZES.HUGE,__C.CLASSES.SIZES.WIDE,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]},{title:"Оплатить через юр. лицо",classes:["orders_page_pay_button",__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.TEXT_WEIGHT.LIGHTER,__C.CLASSES.HOOKS.RIPPLE,"LegalEntityPaymentButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.BIG,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]}),e.event.accept_bitcoins&&(t=t.add(__APP.BUILD.button({title:"Заплатить через Bitcoin",classes:["orders_page_pay_button",__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.TEXT_WEIGHT.LIGHTER,__C.CLASSES.HOOKS.RIPPLE,"BitcoinPaymentButton",__C.CLASSES.SIZES.WIDE,__C.CLASSES.SIZES.BIG,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]}))),t=t.add(__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.HOW_TO_PAY_FROM_LEGAL_ENTITY,"Как оплатить со счета компании"));case OneOrder.ORDER_STATUSES.PAYED:case OneOrder.ORDER_STATUSES.PAYED_LEGAL_ENTITY:case OneOrder.ORDER_STATUSES.WAITING_PAYMENT_LEGAL_ENTITY:return(e.status_type_code===OneOrder.ORDER_STATUSES.PAYED&&e.payment_type===OneOrder.PAYMENT_PROVIDERS.LEGAL_ENTITY_PAYMENT||e.status_type_code===OneOrder.ORDER_STATUSES.PAYED_LEGAL_ENTITY||e.status_type_code===OneOrder.ORDER_STATUSES.WAITING_PAYMENT_LEGAL_ENTITY)&&(t=__APP.BUILD.externalLink({title:"Договор-счет",page:"/api/v1"+OneOrder.ENDPOINT.LEGAL_ENTITY_CONTRACT.format({event_id:e.event.id,order_uuid:e.uuid}),classes:["orders_page_pay_button",__C.CLASSES.COMPONENT.BUTTON,__C.CLASSES.COLORS.ACCENT,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.SIZES.WIDE],attributes:{target:"__blank"}})),e.payment_type===OneOrder.PAYMENT_PROVIDERS.LEGAL_ENTITY_PAYMENT&&(t=t.add(__APP.BUILD.externalLink({title:"Универсальный передаточный документ",page:"/api/v1"+OneOrder.ENDPOINT.LEGAL_ENTITY_UTD.format({event_id:e.event.id,order_uuid:e.uuid}),classes:["orders_page_pay_button",__C.CLASSES.COMPONENT.BUTTON,__C.CLASSES.COLORS.FRANKLIN,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.SIZES.WIDE],attributes:{target:"__blank"}}))),t;default:return""}}(a),event_title:AbstractAppInspector.build.title("Событие"),event:AbstractAppInspector.build.event(a.event),tickets_title:AbstractAppInspector.build.title("Билеты"),tickets:OneOrder.isGreenStatus(a.status_type_code)?AbstractAppInspector.build.tickets(a.tickets,!0):"Билетов нет"})),i.$registration_fields_wrapper.html(tmpl("my-orders-order-registration-fields",{registration_fields_title:AbstractAppInspector.build.title("Анкета"),registration_fields:__APP.BUILD.registrationFields(a.registration_fields)})),i.$detail_wrapper.find(".PayButton").on("click.Pay",function(){Payment.doPayment("order-"+a.uuid,a.final_sum)}),i.$detail_wrapper.find(".LegalEntityPaymentButton").on("click.PayByLegalEntity",function(){__APP.changeState("/event/"+a.event.id+"/order/"+a.uuid+"/from_legal_entity")}),i.$detail_wrapper.find(".BitcoinPaymentButton").on("click.BitcoinPayment",function(){var e=$(this),t=e.data("modal");t||(t=new BitcoinModal(a.event,a),e.data("modal",t)),t.show()})}var i=this,a=this.orders.getByID(t);empty(a)&&(a=new OneOrder(t)),empty(a.tickets)?(this.$detail_wrapper.html(__APP.BUILD.floatingLoader()),this.$registration_fields_wrapper.html(""),a.fetch(this.fetch_order_fields).then(function(){n()}).catch(function(){i.$detail_wrapper.html("")})):n()},e.prototype.bindSelectOrder=function(e){var t=this;return e.on("click.SelectOrder",function(){var n=$(this);e.not(n).removeClass("-item_selected"),n.addClass("-item_selected"),t.selectOrderItem(n.data("order_uuid"))}),e},e.prototype.init=function(){var t=this,n=this.$wrapper.find(".OrdersWrapper");n.scrollbar({onScroll:function(i){var a;i.scroll+200>=i.maxScroll&&!t.block_scroll&&(t.block_scroll=!0,a=__APP.BUILD.loaderBlock(n),t.orders.fetch(t.fetch_orders_fields,5,"-created_at").then(function(n){a.remove(),n.length&&(t.block_scroll=!1,t.$wrapper.find(".OrdersWrapper").append(t.bindSelectOrder(e.orderItemsBuilder(n))))}))}}),this.$wrapper.find(".Scroll").not(".OrdersWrapper").scrollbar(),this.bindSelectOrder(this.$orders)},e.prototype.render=function(){var t=parseUri(location);if(__APP.USER.isLoggedOut()){var n=new AuthModal(window.location.href,{note:"Войдите чтобы увидеть список ваших заказов"});return n.is_hidable=!1,n.show()}this.orders.sortBy("created_at"),this.$wrapper.html(tmpl("my-orders-page",{orders:this.$orders=e.orderItemsBuilder(this.orders),order_detail:__APP.BUILD.cap("Выберите заказ, чтобы посмотреть детальную информацию о ней"),order_registration_fields:__APP.BUILD.cap("Выберите заказ, чтобы посмотреть детальную информацию о ней")})),this.$detail_wrapper=this.$wrapper.find(".OrderDetailInfo"),this.$registration_fields_wrapper=this.$wrapper.find(".OrderRegistrationFields"),t.queryKey.uuid&&this.selectOrderItem(t.queryKey.uuid),this.init()},e}());var OldUserPage=function(e){function t(e){var n,i;_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.user_id=e,a.user=new OneUser(e),a.events_metadata={last_date:""},a.disable_uploads=(n={},_defineProperty(n,__C.ENTITIES.EVENT,!1),_defineProperty(n,__C.ENTITIES.ACTIVITY,!1),n),a.block_scroll=(i={},_defineProperty(i,__C.ENTITIES.EVENT,!1),_defineProperty(i,__C.ENTITIES.ACTIVITY,!1),i),a.active_tab=__C.ENTITIES.EVENT,a.favored_fetch_data={fields:new Fields("image_horizontal_medium_url","favored_users_count","is_favorite","is_registered","registration_locally","registration_available","ticketing_locally","ticketing_available","dates",{favored:{length:5}}),order_by:"nearest_event_date,-first_event_date",length:10},a.pageTitle=function(){return a.user.full_name},a}return _inherits(t,Page),_createClass(t,[{key:"fetchData",value:function(){return parseInt(this.user_id)!==__APP.USER.id&&"me"!==this.user_id?this.fetching_data_defer=this.user.fetchUser(new Fields("type","is_friend","link","accounts","accounts_links",{friends:{fields:["is_friend"],length:4},subscriptions:{fields:["img_small_url"],length:4,order_by:["organization_type_order","organization_type_id"]}})):Promise.resolve()}},{key:"fetchActivities",value:function(){return this.user.actions.fetch(new Fields("organization","event","type_code","created_at"),20,"-created_at")}},{key:"fetchFavoredEvents",value:function(){return this.user.fetchFavored(this.favored_fetch_data)}},{key:"buildActivities",value:function(e){var t=this;return __APP.BUILD.activity(e.map(function(e){return e.user=t.user,e}))}},{key:"buildFavoredEvents",value:function(e){return __APP.BUILD.eventBlocks(e,this.events_metadata)}},{key:"uploadEntities",value:function(e){var n=this,i=this.disable_uploads[e],a=this.block_scroll[e];if(!i&&!a){var r=this.$wrapper.find(".TabsBody").filter('[data-tab_body_type="'+e+'"]'),s=void 0,o=void 0;switch(e){case __C.ENTITIES.EVENT:s=this.fetchFavoredEvents();break;case __C.ENTITIES.ACTIVITY:s=this.fetchActivities();break;default:return Promise.resolve()}return this.block_scroll[e]=!0,o=__APP.BUILD.loaderBlock(r),s.then(function(i){if(n.block_scroll[e]=!1,o.remove(),i.length){var a=void 0;switch(e){case __C.ENTITIES.EVENT:return n.page_component.favored_events.appendEvents(i);case __C.ENTITIES.ACTIVITY:a=n.buildActivities(i)}r.append(a),t.bindEvents(a)}else r.children().length||(r.append(__APP.BUILD.cap("Активности нет")),n.disable_uploads[e]=!0)})}return Promise.resolve()}},{key:"renderEntities",value:function(e,n){this.$wrapper.find(".TabsBody").filter('[data-tab_body_type="'+e+'"]').append(n),t.bindEvents(n)}},{key:"init",value:function(){var e=this,n=this.$wrapper;bindTabs(n),t.bindEvents(n),n.find(".Tabs").on("tabs:change",function(){e.active_tab=n.find(".TabsBody").filter("."+__C.CLASSES.ACTIVE).data("tab_body_type"),e.bindScrollEvents()})}},{key:"bindScrollEvents",value:function(){var e,t=this,n=$(window),i=(e={},_defineProperty(e,__C.ENTITIES.EVENT,"scroll.uploadEvents"),_defineProperty(e,__C.ENTITIES.ACTIVITY,"scroll.uploadActivities"),e);switch(n.off(Object.values(i).join(" ")),this.active_tab){case __C.ENTITIES.EVENT:case __C.ENTITIES.ACTIVITY:return isScrollRemain(1e3)?this.uploadEntities(this.active_tab):new Promise(function(e){n.on(i[t.active_tab],function(){isScrollRemain(1e3)&&e(t.uploadEntities(t.active_tab))})});default:return Promise.resolve()}}},{key:"render",value:function(){var e=this,t=this.user,n=[];if(this instanceof OldMyProfilePage==!1&&parseInt(this.user_id)===__APP.USER.id)return __APP.changeState("/my/profile",!0,!0),null;this.user.setData(_extends({},t,{actions:t.actions.map(function(e){return _extends({},e,{user:t})})})),this.page_component=React.createElement(UserPage.PageComponent,{user:t}),ReactDOM.render(this.page_component,this.$wrapper.get(0)),t.actions.length?this.renderEntities(__C.ENTITIES.ACTIVITY,this.buildActivities(t.actions)):n.push(this.uploadEntities(__C.ENTITIES.ACTIVITY)),t.favored.length?this.renderEntities(__C.ENTITIES.EVENT,this.buildFavoredEvents(t.favored)):n.push(this.uploadEntities(__C.ENTITIES.EVENT)),n.length?Promise.race(n).then(function(){e.bindScrollEvents()}):this.bindScrollEvents(),this.init()}}],[{key:"bindEvents",value:function(e){bindRippleEffect(e),trimAvatarsCollection(e),__APP.MODALS.bindCallModal(e),bindPageLinks(e)}},{key:"SidebarWrapper",value:function(e){var t=e.user,n=e.title,i=e.noEntitiesText,a=e.entities,r=e.entitiesType,s=e.showAllModalClass;if(a.length){var o=[__C.CLASSES.SIZES.X30];return r===__C.ENTITIES.USER&&o.push(__C.CLASSES.UNIVERSAL_STATES.ROUNDED),React.createElement("div",{className:"user_page_sidebar_wrapper"},React.createElement("span",{className:"sidebar_section_heading"},n),React.createElement(AvatarBlocks,{isLink:!0,entities:a,entity:r,avatarClasses:o}),React.createElement("footer",{className:"user_page_sidebar_footer"},React.createElement(Button,{className:__C.CLASSES.COLORS.NEUTRAL_ACCENT,onClick:function(e){rippleEffectHandler(e),this.modal||(this.modal=new s(t)),this.modal.show()}},"Показать все")))}return React.createElement("div",{className:"user_page_sidebar_wrapper"},React.createElement("span",{className:"sidebar_section_heading"},n),React.createElement("div",{className:"cap"},React.createElement("span",{className:"cap_message"},i)))}},{key:"PageComponent",value:function(e){var n=this,i=e.user,a=t.SidebarWrapper,r=__APP.USER.id!==parseInt(i.id);return React.createElement("div",{className:"user_page_wrapper "+(r?"-another_user":"-this_user")},React.createElement("div",{className:"page user_page_sidebar"},React.createElement("header",{className:"user_page_sidebar_header"},React.createElement(UserTombstones,{users:i,avatarClasses:[__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.UNIVERSAL_STATES.SHADOWED]}),React.createElement("div",{className:"user_page_social_links"},React.createElement(SocialLinks,{links:i.accounts_links,className:__C.CLASSES.UNIVERSAL_STATES.ROUNDED})),!r&&React.createElement(Button,{className:__C.CLASSES.COLORS.NEUTRAL_ACCENT,onClick:function(e){rippleEffectHandler(e),__APP.USER.logout()}},"Выйти")),React.createElement(a,{user:i,title:"Подписан на организаторов",noEntitiesText:"Нет подписок",entities:i.subscriptions,entitiesType:__C.ENTITIES.ORGANIZATION,showAllModalClass:SubscriptionsListModal}),!r&&React.createElement(a,{user:i,title:"Подписан на пользователей",noEntitiesText:"Нет друзей",entities:i.friends,entitiesType:__C.ENTITIES.USER,showAllModalClass:FriendsListModal})),React.createElement("div",{className:"page user_page_content Tabs"},React.createElement("header",{className:"user_page_content_header tabs_header HeaderTabs -color_accent"},React.createElement("span",{className:"tab Tab"},"Активность"),React.createElement("span",{className:"tab Tab -active"},"Избранные события")),React.createElement("div",{className:"tab_bodies_wrap TabsBodyWrapper"},React.createElement("div",{className:"tab_body TabsBody","data-tab_body_type":"activity"}),React.createElement("div",{className:"tab_body TabsBody -active","data-tab_body_type":"event"},React.createElement(EventBlocks,{ref:function(e){return n.favored_events=e},events:i.favored})))))}}]),t}(),OldMyProfilePage=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,__APP.USER.id));return e.favored_fetch_data.fields.push("is_favorite"),e.user=__APP.USER,e.page_title="Мой профиль",e}return _inherits(t,OldUserPage),_createClass(t,[{key:"fetchData",value:function(){return this.user.friends.length?this.fetching_data_defer=Promise.resolve():this.fetching_data_defer=this.user.fetchFriends({fields:new Fields("is_friend"),length:4})}}]),t}();MyTicketsPage=extending(Page,function(){function e(){Page.call(this),this.page_title="Мои билеты",this.tickets=new MyTicketsCollection,this.disable_uploads=!1,this.block_scroll=!1,this.fetch_tickets_fields=TicketsModal.NECESSARY_FIELDS.copy(),this.fetch_tickets_quantity=30}return e.prototype.fetchData=function(){return this.fetching_data_defer=this.tickets.fetchTickets(this.fetch_tickets_fields,this.fetch_tickets_quantity)},e.prototype.fetchAndAppendTickets=function(){var e,t=this;this.disable_uploads||this.block_scroll||(e=__APP.BUILD.loaderBlock(this.$wrapper),this.block_scroll=!0,this.tickets.fetchTickets(this.fetch_tickets_fields,this.fetch_tickets_quantity).then(function(n){var i=ExtendedTicketsCollection.getGreenTickets(n);t.block_scroll=!1,n.length?i.length?t.$wrapper.find(".TicketsWrapper").append(__APP.BUILD.ticketCards(n)):t.fetchAndAppendTickets():t.disable_uploads=!0,e.remove()}))},e.prototype.init=function(){var e=this;bindCallModal(this.$wrapper),isScrollRemain(1e3)&&e.fetchAndAppendTickets(),$(window).on("scroll.uploadTickets",function(){isScrollRemain(1e3)&&e.fetchAndAppendTickets()})},e.prototype.render=function(){var e;if(__APP.USER.isLoggedOut())return __APP.changeState("/",!0,!0),null;(e=ExtendedTicketsCollection.getGreenTickets(this.tickets.__last_pushed)).length||this.fetchAndAppendTickets(),this.$wrapper.html(tmpl("my-tickets-wrapper",{tickets:__APP.BUILD.ticketCards(e)})),this.init()},e}()),AdminEventPage=extending(AdminPage,function(){function e(t){AdminPage.call(this),this.id=t,this.event=new OneEvent(this.id),this.event_fields=e.fields.copy(),this.with_header_tabs=!0}return e.fields=new Fields("organization_short_name","ticketing_locally","registration_locally","registration_approvement_required"),e.prototype.fetchData=function(){return this.fetching_data_defer=this.event.fetchEvent(this.event_fields)},e.prototype.renderHeaderTabs=function(){var e=[];return e.push({title:"Обзор",page:"/admin/event/"+this.id+"/overview"}),this.event.registration_approvement_required&&e.push({title:"Заявки",page:"/admin/event/"+this.id+"/requests"}),(this.event.registration_locally||this.event.ticketing_locally)&&e.push({title:"Продажи",page:"/admin/event/"+this.id+"/sales"},{title:"Заказы",page:"/admin/event/"+this.id+"/orders"},{title:"Контроль входа",page:"/admin/event/"+this.id+"/check_in"}),e.push({title:"Метки UTM",page:"/admin/event/"+this.id+"/utm_stats"},{title:"Редактирование",page:"/admin/event/"+this.id+"/edit"}),e},e}()),AdminEventAuditoryPage=extending(AdminEventPage,function(){function e(e){AdminEventPage.apply(this,arguments)}return e.prototype.render=function(){},e}()),AdminEventCheckInPage=extending(AdminEventPage,function(){function e(n){var i=this;AdminEventPage.call(this,n),this.current_checkin_state=e.STATES.AWAITING,this.tickets_fields=new Fields("user","ticket_type","event_id"),this.tickets=new t(n),this.is_searching_state=!1,this.is_fetching=!1,this.progress_bar=new ProgressBar(this.tickets.length,this.tickets.checked.length,{classes:[AbstractProgressBar.MODIFICATORS.WITH_LABEL,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),this.table_body=$(),Object.defineProperties(this,{page_title_obj:{get:function(){return[{title:"Организации",page:"/admin"},{title:i.event.organization_short_name,page:"/admin/organization/"+i.event.organization_id},i.event.title+" - контроль входа"]}},is_awaiting_state:{get:function(){return i.current_checkin_state===e.STATES.AWAITING}},searching_tickets_fuse:{get:function(){return new Fuse(i.tickets,{shouldSort:!0,threshold:.1,distance:1e3,keys:["number","user.full_name"]})}}})}var t=extending(EventAllTicketsCollection,function(){function e(e){var t=this;EventAllTicketsCollection.call(this,e),Object.defineProperties(this,{awaiting:{get:function(){return t.filter(function(e){return!e.checkout})}},new_awaiting:{get:function(){return t.__last_pushed.filter(function(e){return!e.checkout})}},checked:{get:function(){return t.filter(function(e){return e.checkout})}},new_checked:{get:function(){return t.__last_pushed.filter(function(e){return e.checkout})}}})}return e.fetchTickets=EventAllTicketsCollection.fetchTickets,e}());return e.STATES={AWAITING:"awaiting",CHECKED:"checked"},e.ACTION_TEXTS={AWAITING_NORMAL:"Ожидает подтверждения",AWAITING_HOVER:"Подтвердить вход",CHECKED_NORMAL:"Подтверждён",CHECKED_HOVER:"Отменить подтверждение"},e.prototype.fetchData=function(){return this.fetching_data_defer=AdminEventPage.prototype.fetchData.call(this)},e.prototype.buildTableRows=function(t,n){var i,a=this;return(t=t?t instanceof Array?t:[t]:[]).length?((i=tmpl("event-admin-check-in-row",t.map(function(t){return{ticket_id:t.uuid,number:t.number,full_name:t.user.full_name,avatar_block:__APP.BUILD.avatarBlocks(t.user,{entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),ticket_type:t.ticket_type.name,state_modificator:"-ticket_status_"+(t.checkout?e.STATES.CHECKED:e.STATES.AWAITING),status_text:t.checkout?e.ACTION_TEXTS.CHECKED_NORMAL:e.ACTION_TEXTS.AWAITING_NORMAL,action_text:t.checkout?e.ACTION_TEXTS.CHECKED_HOVER:e.ACTION_TEXTS.AWAITING_HOVER}}))).find(".CheckoutTicket").not(".-Handled_CheckoutTicket").on("click",function(){var t=a.tickets.getByID($(this).closest(".Ticket").data("ticket_uuid"));t.checkout?OneTicket.uncheck(t.event_id,t.uuid).then(function(){a.changeTicketState(t,e.STATES.AWAITING)}):OneTicket.check(t.event_id,t.uuid).then(function(){a.changeTicketState(t,e.STATES.CHECKED)})}).addClass("-Handled_CheckoutTicket"),i):tmpl("event-admin-check-in-row-no-tickets",{text:n||"Нет билетов"})},e.prototype.changeTicketState=function(t,n){var i;this.is_searching_state?((i=this.table_body.find(".Ticket_"+t.uuid)).toggleClass(Object.values(e.STATES).map(function(e){return"-ticket_status_"+e}).join(" ")),i.find(".StatusText").text(e.ACTION_TEXTS[t.checkout?"AWAITING_NORMAL":"CHECKED_NORMAL"]),i.find(".CheckoutTicket").text(e.ACTION_TEXTS[t.checkout?"AWAITING_HOVER":"CHECKED_HOVER"])):t.checkout!==this.is_awaiting_state&&(n===(this.is_awaiting_state?e.STATES.AWAITING:e.STATES.CHECKED)?this.table_body.append(this.buildTableRows(t)):this.table_body.find(".Ticket_"+t.uuid).remove()),(t.checkout&&n===e.STATES.AWAITING||!t.checkout&&n===e.STATES.CHECKED)&&(t.checkout=!t.checkout,this.progress_bar.set(this.tickets.checked.length)),this.is_searching_state||this.tickets[this.current_checkin_state].length||this.table_body.html(this.buildTableRows([]))},e.prototype.initSearch=function(){var e=this;this.is_searching_state=!0,this.$wrapper.find(".RadioGroup").find("input").prop("checked",!1),this.$wrapper.find(".ClearSearch").one("click",function(){e.$wrapper.find(".SearchTickets").val(""),e.deInitSearch()}),$(window).on("keydown.deInitSearch",function(t){27===t.keyCode&&e.deInitSearch()})},e.prototype.deInitSearch=function(){this.is_searching_state=!1,$(window).off("keydown.deInitSearch"),this.$wrapper.find("#event_admin_check_in_type_"+this.current_checkin_state).prop("checked",!0),this.table_body.html(this.buildTableRows(this.tickets[this.current_checkin_state]))},e.prototype.init=function(){var e=this;this.$wrapper.find(".RadioGroup").on("change",function(t){e.current_checkin_state=$(t.target).val(),e.table_body.html(e.buildTableRows(e.tickets[e.current_checkin_state]))}),this.$wrapper.find(".SearchTickets").on("input",function(t){var n=$(t.target).val(),i=new TicketsCollection;e.is_searching_state||e.initSearch(),""===n?e.deInitSearch():(i.setData(e.searching_tickets_fuse.search(n)),i.setData(e.searching_tickets_fuse.search(transl(n))),e.table_body.html(e.buildTableRows(i)))})},e.prototype.render=function(){var t,n=this;this.progress_bar.setMax(this.tickets.length),this.progress_bar.set(this.tickets.checked.length),this.$wrapper.html(tmpl("event-admin-check-in-page",{radio_group:__APP.BUILD.radioGroup({name:"check_in_type",units:[{id:"event_admin_check_in_type_awaiting",label:"Ожидают",attributes:{value:e.STATES.AWAITING,checked:!0}},{id:"event_admin_check_in_type_checked",label:"Проверенные",attributes:{value:e.STATES.CHECKED}}]}),progress_bar:this.progress_bar})),this.$wrapper.find(".CheckInTable").after(t=__APP.BUILD.loaderBlock()),this.table_body=this.$wrapper.find(".CheckInTable").children("tbody"),this.tickets.fetchAllTickets(this.tickets_fields,{order_status_type:"green"},"created_at").then(function(){n.progress_bar.setMax(n.tickets.length),n.progress_bar.set(n.tickets.checked.length),n.table_body.append(n.buildTableRows(n.tickets["new_"+n.current_checkin_state]))}),t.remove(),this.init()},e}()),AdminEventEditPage=extending(EditEventPage,AdminEventPage,function(){return function(e){var t=this;EditEventPage.call(this,e),AdminEventPage.call(this,e),this.event_fields=EventPage.fields.copy().add(AdminEventPage.fields,EditEventPage.fields),Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},{title:t.event.organization_short_name,page:"/admin/organization/"+t.event.organization_id},t.event.title+" - редактирование"]}})}}()),classEscalation(AdminEventEditPage,{renderHeaderTabs:AdminEventPage.prototype.renderHeaderTabs,init:EditEventPage.prototype.init}),AdminEventOrdersPage=extending(AdminEventPage,function(){function e(e){var t=this;AdminEventPage.call(this,e),this.orders=new EventAllOrdersCollection(e),this.orders_fields=new Fields("created_at","payment_type","shop_sum_amount","registration_fields","promocode",{user:{fields:new Fields("email")},tickets:{fields:new Fields("ticket_type")}}),this.event_fields.add("orders_count"),this.$loader=$(),this.ordersTable=null,Object.defineProperties(this,{page_title_obj:{get:function(){return[{title:"Организации",page:"/admin"},{title:t.event.organization_short_name,page:"/admin/organization/"+t.event.organization_id},t.event.title+" - заказы"]}}})}return e.prototype.initOrdersTable=function(){var e=this;this.ordersTable=this.$wrapper.find(".OrdersTable").eq(0).DataTable({paging:!0,select:!0,columns:[{data:"number",render:function(e,t,n){return tmpl("admin-event-orders-page-row-expand-wrapper",{number:e}).outerHTML()}},{data:"status"},{data:"orderer"},{data:"email"},{data:{_:"buy_time.display",sort:"buy_time.timestamp"}}],dom:'t<"data_tables_pagination"p>',language:{url:__LOCALE.DATATABLES_URL}}),this.$wrapper.find(".OrdersTableSearch").on("input",function(){e.ordersTable.search(this.value+"|"+transl(this.value),!0,!1).draw()})},e.prototype.init=function(){bindDropdown(this.$wrapper)},e.prototype.render=function(){var e=this,t=$();t=(t=t.add(new DropDown("export-formats","Выгрузка билетов",{classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.DOWNLOAD,__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.HOOKS.DROPDOWN_BUTTON]},{width:"self",position:{x:"right",y:5}},{xlsx_href:"/api/v1"+ServerExports.ENDPOINT.EVENT_TICKETS.format({event_id:this.event.id})+"?format=xlsx",html_href:"/api/v1"+ServerExports.ENDPOINT.EVENT_TICKETS.format({event_id:this.event.id})+"?format=html"}))).add(new DropDown("export-formats","Выгрузка заказов",{classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.DOWNLOAD,__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.HOOKS.DROPDOWN_BUTTON]},{width:"self",position:{x:"right",y:5}},{xlsx_href:"/api/v1"+ServerExports.ENDPOINT.EVENT_ORDERS.format({event_id:this.event.id})+"?format=xlsx",html_href:"/api/v1"+ServerExports.ENDPOINT.EVENT_ORDERS.format({event_id:this.event.id})+"?format=html"})),this.$wrapper.html(tmpl("admin-event-orders-page",{header_buttons:t,statuses_help:__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.ORDER_STATUSES,"Какие существуют статусы заказов"),loader:this.$loader=__APP.BUILD.overlayLoader()})),this.orders.fetchAllOrders(this.orders_fields).then(function(){e.ordersTable||e.initOrdersTable(),e.ordersTable.rows.add(e.orders.map(function(e){return{uuid:e.uuid,number:formatTicketNumber(e.number),status:__APP.BUILD.orderStatusBlock(e.status_type_code).outerHTML(),orderer:e.user.full_name,email:e.user.email,buy_time:{display:moment.unix(e.created_at).format(__LOCALE.DATE.DATE_TIME_FORMAT),timestamp:e.created_at}}})).draw(),AbstractAppInspector.$wrapper.on("inspector:hide",function(){e.ordersTable.rows().deselect()}),e.ordersTable.on("deselect",function(e,t,n,i){t.rows(i).nodes().to$().removeClass("-selected"),AbstractAppInspector.hideCurrent()}),e.ordersTable.on("select",function(t,n,i,a){var r=n.row(a[0]);new OrderAppInspector(e.orders.getByID(r.data().uuid),e.event).show(),r.nodes().to$().addClass("-selected")}),e.ordersTable.on("user-select",function(e,t,n,i,a){var r=t.row(i[0][0][n]);return $(a.target).hasClass("DataTableRowExpand")||(r.nodes().to$().hasClass("-selected")?r.deselect():(t.rows().deselect(),r.select())),!1}),e.ordersTable.rows().nodes().to$().find(".DataTableRowExpand").on("click.ExpandRow",function(){var t,n,i,a=$(this),r=a.closest("tr"),s=e.ordersTable.row(r);s.child.isShown()||(s.child(tmpl("admin-event-orders-page-table-child-row",{ticket_rows:tmpl("admin-event-orders-page-ticket-row",e.orders.getByID(s.data().uuid).tickets.map(function(e){return $.extend({},e,{number:formatTicketNumber(e.number),ticket_type_name:e.ticket_type.name,price:e.price?e.price:"Бесплатно",used:e.checkout?"Билет использован":""})}))})).show(),r.addClass("-has_child")),n=(t=s.child()).find(".CollapsingWrapper"),i=t.find(".CollapsingContent"),n.height()?n.height(0).removeClass("-opened"):n.height(i.outerHeight()).addClass("-opened"),a.toggleClass([__C.CLASSES.ACTIVE,__C.CLASSES.ICONS.PLUS,__C.CLASSES.ICONS.MINUS].join(" "))}),e.$loader.remove(),e.$wrapper.find(".OrdersTableWrapper").removeClass(__C.CLASSES.STATUS.DISABLED)}),this.init()},e}()),AdminEventOverviewPage=extending(AdminEventPage,function(){function e(e){AdminEventPage.apply(this,arguments),this.graphics_stats=new EventStatistics(this.id),this.scoreboards_stats=new EventStatistics(this.id),this.event_fields.add(new Fields("favored_users_count","is_same_time","dates"))}return e.prototype.render=function(){var e=this;if(this.renderHeaderTabs(),__APP.changeTitle([{title:"Организации",page:"/admin"},{title:this.event.organization_short_name,page:"/admin/organization/"+this.event.organization_id},this.event.title]),!checkRedirect("overview","/admin/event/"+this.event.id+"/overview",!0))return null;this.$wrapper.html(tmpl("eventstat-overview",$.extend(!0,{},this.event,{cover_width:280,dates_block:tmpl("eventstat-overview-datetime",{date:displayDateRange(this.event.first_event_date,this.event.last_event_date),time:this.event.is_same_time?displayTimeRange(this.event.dates[0].start_time,this.event.dates[0].end_time):"Разное время"})}))),this.$wrapper.find(".EventStatAreaCharts").children(".AreaChart").html(tmpl("loader")),this.scoreboards_stats.fetchStatistics(Statistics.SCALES.OVERALL,!1,["notifications_sent","view","fave","view_detail","fave_conversion","open_conversion"],null,function(t){var n={numbers:{}};$.each(t,function(e,t){n.numbers[e]=t[0].value}),e.updateScoreboards(e.$wrapper.find(".EventstatsScoreboards"),n,{fave:"Добавлений в избранное",view:"Просмотров события"},["fave","view"]),e.updateScoreboards(e.$wrapper.find(".EventstatsBigScoreboards"),n,{notifications_sent:"Уведомлений отправлено",view:"Просмотров",view_detail:"Открытий",open_conversion:"Конверсия открытий",fave:"Добавлений",fave_conversion:"Конверсия добавлений"},["notifications_sent","view","view_detail","open_conversion","fave","fave_conversion"],"big")}),this.graphics_stats.fetchStatistics(Statistics.SCALES.DAY,moment(__APP.EVENDATE_BEGIN,"DD-MM-YYYY").format(),["notifications_sent","view","fave","view_detail","fave_conversion","open_conversion"],null,function(t){e.buildAreaCharts(t,{rangeSelector:{selected:1}})}),__APP.MODALS.bindCallModal(e.$wrapper),bindPageLinks(e.$wrapper)},e}()),AdminEventRequestsPage=extending(AdminEventPage,function(){function e(e){var t=this,i={shouldSort:!0,threshold:.1,distance:1e3,keys:["number","user.full_name"]};AdminEventPage.call(this,e),this.event_fields.add("orders_count"),this.requests=new n(e),this.requests_fields=new Fields("created_at","registration_fields",{user:{fields:new Fields("email")}}),this.$loader=$(),this.$new_requests_list=$(),this.$approved_requests_list=$(),this.$rejected_requests_list=$(),this.current_requests_list="new",this.$requests_detail=$(),this.Tabs=$(),Object.defineProperties(this,{page_title_obj:{get:function(){return[{title:"Организации",page:"/admin"},{title:t.event.organization_short_name,page:"/admin/organization/"+t.event.organization_id},t.event.title+" - заявки"]}},new_requests_fuse:{get:function(){return new Fuse(t.requests.new_requests,i)}},approved_requests_fuse:{get:function(){return new Fuse(t.requests.approved_requests,i)}},rejected_requests_fuse:{get:function(){return new Fuse(t.requests.rejected_requests,i)}}})}var t=extending(OneOrder,function(){function e(e,t){OneOrder.call(this,e,t)}return e.fetchRequest=OneOrder.fetchOrder,e.prototype.approveRequest=function(e){return this.changeStatus(OneOrder.ORDER_STATUSES.APPROVED,e)},e.prototype.rejectRequest=function(e){return this.changeStatus(OneOrder.ORDER_STATUSES.REJECTED,e)},e}()),n=extending(EventAllOrdersCollection,function(){function e(e){var t=this;EventAllOrdersCollection.call(this,e),Object.defineProperties(this,{new_requests:{get:function(){return t.filter(function(e){return e.status_type_code===OneOrder.ORDER_STATUSES.IS_PENDING})}},approved_requests:{get:function(){return t.filter(function(e){return e.status_type_code===OneOrder.ORDER_STATUSES.APPROVED})}},rejected_requests:{get:function(){return t.filter(function(e){return e.status_type_code===OneOrder.ORDER_STATUSES.REJECTED})}}})}return e.prototype.collection_of=t,e.fetchOrders=e.fetchRequests=EventAllOrdersCollection.fetchOrders,e.prototype.fetchAllRequests=EventAllOrdersCollection.prototype.fetchAllOrders,e}());return e.prototype.requestItemBuilder=function(e){var t=this,n=e instanceof Array?e:[e],i=tmpl("event-admin-request-item",n.map(function(e){var t=[];return e.status_type_code!==OneOrder.ORDER_STATUSES.IS_PENDING&&e.status_type_code!==OneOrder.ORDER_STATUSES.APPROVED||t.push({title:"Отклонить",classes:[__C.CLASSES.COLORS.MARGINAL,"RejectRequest"]}),e.status_type_code!==OneOrder.ORDER_STATUSES.IS_PENDING&&e.status_type_code!==OneOrder.ORDER_STATUSES.REJECTED||t.push({title:"Принять заявку",classes:[__C.CLASSES.COLORS.ACCENT,"ApproveRequest"]}),{orderer_avatar:__APP.BUILD.avatars(e.user,{classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),order_number:formatTicketNumber(e.number),request_time:e.m_created_at.format(__LOCALE.DATE.TIME_FORMAT),request_date:e.m_created_at.format("D MMMM"),orderer_full_name:e.user.full_name,action_buttons:__APP.BUILD.actionButton(t)}}));return i.length?i.each(function(e){var i=$(this),a=n[e];i.data("request",a),i.on("click.SelectRequestItem",function(e){var n=$(e.target);n.closest(".ApproveRequest").length||n.closest(".RejectRequest").length||t.selectRequestItem(this)}),i.find(".ApproveRequest").on("click.ApproveRequest",function(){t.approveRequest(i)}),i.find(".RejectRequest").on("click.RejectRequest",function(){var e;a.rejectRequest().then(function(){e=t.requestItemBuilder(a),t.$rejected_requests_list.append(e),i.hasClass("-item_selected")&&t.selectRequestItem(e),i.remove()})})}):i=tmpl("event-admin-no-request-items"),i},e.prototype.selectRequestItem=function(e){var t=this,n=e instanceof jQuery?e:$(e),i=n.data("request");t.$wrapper.find(".RequestItem").not(n).removeClass("-item_selected"),n.addClass("-item_selected"),t.$requests_detail.html(tmpl("event-admin-request-detail",{order_number:formatTicketNumber(i.number),orderer_full_name:i.user.full_name,orderer_avatar:__APP.BUILD.avatars(i.user,{classes:[__C.CLASSES.SIZES.X55,__C.CLASSES.UNIVERSAL_STATES.ROUNDED,__C.CLASSES.UNIVERSAL_STATES.BORDERED,__C.CLASSES.UNIVERSAL_STATES.SHADOWED]}),registration_fields:__APP.BUILD.registrationFields(i.registration_fields)}))},e.prototype.approveRequest=function(e){var t,n=this,i=e instanceof jQuery?e:$(e),a=i.data("request");a.approveRequest().then(function(){t=n.requestItemBuilder(a),n.$approved_requests_list.append(t),i.hasClass("-item_selected")&&n.selectRequestItem(t),i.remove()})},e.prototype.init=function(){var e=this;bindTabs(this.$wrapper,!1),this.Tabs=this.$wrapper.find(".Tabs").resolveInstance(),this.$wrapper.find(".RequestsListScrollbar").scrollbar(),this.$wrapper.find(".RequestDetailScrollbar").scrollbar(),this.$wrapper.find(".ApproveAllRequests").on("click.ApproveAllRequests",function(){e.$new_requests_list.find(".RequestItem").each(function(){e.approveRequest(this)})}),function(e){var t=e.$wrapper.find(".RequestsPageHeaderWrapper"),n=e.$wrapper.find(".RequestsPageSearch");n.on("keydown",function(e){27===e.keyCode&&n.val("").blur()}).on("input.Search",function(){var t=e[e.current_requests_list+"_requests_fuse"].search($(this).val());e["$"+e.current_requests_list+"_requests_list"].html(e.requestItemBuilder(t))}).on("blur.CloseSearchBar",function(){""===n.val()&&(t.removeClass("-open_search_bar"),e["$"+e.current_requests_list+"_requests_list"].html(e.requestItemBuilder(e.requests[e.current_requests_list+"_requests"])))}),e.$wrapper.find(".RequestsPageSearchButton").on("click.OpenSearchBar",function(){t.hasClass("-open_search_bar")||t.addClass("-open_search_bar"),n.is(":focus")||n.focus()}),e.Tabs.on("tabs:change",function(){n.val("").blur()})}(this),this.Tabs.on("tabs:change",function(){e.current_requests_list=$(this).find(".Tab").filter("."+__C.CLASSES.ACTIVE).data("requests_list_name")})},e.prototype.render=function(){var e=this;this.$wrapper.html(tmpl("event-admin-requests-page",{loader:this.$loader=__APP.BUILD.loaderBlock(),request_detail:tmpl("event-admin-request-detail-no-select")})),this.$requests_detail=this.$wrapper.find(".RequestDetail"),this.requests.fetchAllRequests(this.requests_fields).then(function(){var t;e.requests.sortBy("created_at"),t=tmpl("event-admin-requests-lists",{new_requests:e.requestItemBuilder(e.requests.new_requests),approved_requests:e.requestItemBuilder(e.requests.approved_requests),rejected_requests:e.requestItemBuilder(e.requests.rejected_requests)}),e.$loader.remove(),e.$wrapper.find(".RequestsLists").html(t),e.$wrapper.find(".OrdersTableWrapper").removeClass(__C.CLASSES.STATUS.DISABLED),e.$new_requests_list=t.find(".NewRequestsList"),e.$approved_requests_list=t.find(".ApprovedRequestsList"),e.$rejected_requests_list=t.find(".RejectedRequestsList"),e.init()})},e}()),AdminEventSalesPage=extending(AdminEventPage,function(){function e(e){AdminEventPage.call(this,e),this.event=new OneEventWithFinances(e),this.event_fields.add("sum_amount","sold_count","checked_out_count","total_income","withdraw_available","processing_commission_value","processing_commission","evendate_commission_value","ticket_dynamics","income_dynamics","dates","orders_count","tickets_count","sold_tickets_count","registration_till","registration_approvement_required","created_at",{ticket_types:{fields:new Fields("sold_count","price","sell_start_date","sell_end_date","amount")},promocodes:{fields:new Fields("use_limit","use_count","total_effort")}}),this.promocodesTable=null,Object.defineProperties(this,{page_title_obj:{get:function(){return[{title:"Организации",page:"/admin"},{title:this.event.organization_short_name,page:"/admin/organization/"+this.event.organization_id},this.event.title+" - продажи"]}},has_promocodes:{get:function(){return 0!==this.event.promocodes.length}}})}return e.prototype.initPromocodesTable=function(){this.promocodesTable=this.$wrapper.find(".PromocodesTable").DataTable({paging:!1,columns:[{data:"code"},{data:function(e,t,n,i){switch(t){case"display":return formatCurrency(e.effort," ",".","",e.is_fixed?"₽":"%")}return e.effort},orderable:!1},{data:function(e,t,n,i){switch(t){case"sort":return e.start_date}return displayDateRange(e.start_date,e.end_date)}},{data:function(e,t,n,i){switch(t){case"display":return e.use_count+(e.use_limit&&1e5!==e.use_limit?" / "+e.use_limit:"")}return e.use_count}},{data:function(e,t,n,i){switch(t){case"display":return formatCurrency(e.total_effort," ",".","","₽")}return e.total_effort}}],dom:"t",language:{url:__LOCALE.DATATABLES_URL},footerCallback:function(e,t,n,i,a){var r=t.reduce(function(e,t){return e+t.total_effort},0);$(this.api().table().footer()).find(".EffortTotalSum").html(formatCurrency(r," ",".","","₽"))}})},e.prototype.render=function(){var e=this,t=moment.unix(this.event.first_event_date).calendar(null,{sameDay:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH,nextDay:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH,nextWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH,lastDay:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH,lastWeek:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH,sameElse:__C.MOMENTJS_CALENDAR.DATE_AND_MONTH}).split(" "),n=formatDates(this.event.dates),i={scale:AbstractStatisticsCollection.SCALES.DAY,since:moment.unix(this.event.created_at).format(__C.DATE_FORMAT),till:moment().format(__C.DATE_FORMAT)},a=new Fields({ticket_dynamics:i}),r={legend:{enabled:!1}},s=$();this.event.ticketing_locally&&(s=tmpl("admin-event-sales-chart",{classes:"TicketsSellingChart"}),a.push({income_dynamics:i})),(s=s.add(tmpl("admin-event-sales-chart",{classes:"RegisteredChart"}))).html(__APP.BUILD.loaderBlock()),this.$wrapper.html(tmpl("admin-event-sales-page",{title:this.event.title,sold_count:this.event.sold_count,sum_amount:this.event.sum_amount,orders_count:this.event.orders_count,checked_out_count:this.event.checked_out_count,total_income:formatCurrency(this.event.total_income," ",".","","₽"),withdraw_available:formatCurrency(this.event.withdraw_available," ",".","","₽"),processing_commission_value:formatCurrency(this.event.processing_commission_value," ",".","","₽"),processing_commission:this.event.processing_commission||4,evendate_commission_value:formatCurrency(this.event.evendate_commission_value," ",".","","₽"),first_event_date_day:t[0],first_event_date_month:t[1].capitalize(),charts:s,promocodes:this.has_promocodes?tmpl("admin-event-sales-promocodes"):"",formatted_dates:n.map(function(e){return e.date+" "+e.time}).join(", "),registration_dates:displayDateRange(this.event.created_at,this.event.registration_till),sales_settings_button:__APP.BUILD.linkButton({title:"Настройки продаж",page:"/admin/event/"+this.event.id+"/edit",classes:[__C.CLASSES.COLORS.NEUTRAL_ACCENT,__C.CLASSES.HOOKS.RIPPLE]}),ticket_types:tmpl("admin-event-sales-ticket-type",this.event.ticket_types.map(function(e){return{name:e.name,dates:displayDateRange(e.sell_start_date,e.sell_end_date),price:e.formatPrice(),stamp:e.sold_count>=e.amount?__APP.BUILD.stamp("Распродано"):null,progress_bar:new ProgressBar(e.amount,e.sold_count,{classes:[AbstractProgressBar.MODIFICATORS.WITH_LABEL,AbstractProgressBar.MODIFICATORS.SIZE.TALL,__C.CLASSES.UNIVERSAL_STATES.SLIGHTLY_ROUNDED]})}})),withdraw_funds_button:__APP.BUILD.linkButton({title:"Финансы организации",page:"/admin/organization/{org_id}/finances".format({org_id:this.event.organization_id}),classes:[__C.CLASSES.COLORS.NEUTRAL_ACCENT]})})),this.has_promocodes&&(this.initPromocodesTable(),this.promocodesTable.rows.add(this.event.promocodes).column(-1).order("desc").draw()),this.event.fetchEvent(a,function(){AdminPage.buildStockChart(s.filter(".TicketsSellingChart"),"Выручка",[{name:"Выручка",data:AdminPage.areaChartSeriesNormalize(e.event.income_dynamics)}],r),AdminPage.buildStockChart(s.filter(".RegisteredChart"),"Динамика заказов",[{name:"Количество заказов",data:AdminPage.areaChartSeriesNormalize(e.event.ticket_dynamics)}],r)})},e}()),AdminEventUTMTagsPage=extending(AdminEventPage,function(){function e(e){AdminEventPage.call(this,e),this.utm_stats=new EventUTMStatsCollection(e),this.utm_stats_promise=Promise,this.utmTable=null,Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},{title:this.event.organization_short_name,page:"/admin/organization/"+this.event.organization_id},this.event.title+" - UTM метки"]}})}return e.prototype.preRender=function(){this.utm_stats_promise=this.utm_stats.fetch()},e.prototype.initUTMTable=function(){this.utmTable=this.$wrapper.find(".UTMTable").DataTable({paging:!1,columns:[{data:"utm_source"},{data:"utm_medium"},{data:"utm_campaign"},{data:"utm_content"},{data:"utm_term"},{data:"open_count"},{data:"tickets_count"},{data:"orders_count"},{data:function(e,t,n,i){switch(t){case"display":return formatCurrency(e.orders_sum," ",".","","₽")}return e.orders_sum}}],dom:"t",language:{url:__LOCALE.DATATABLES_URL}})},e.prototype.render=function(){var e=this;this.$wrapper.html(tmpl("event-admin-utm-page")),this.initUTMTable(),this.utm_stats_promise.then(function(){e.utmTable.rows.add(e.utm_stats).order([5,"desc"]).draw()})},e}()),AdminOrganizationPage=extending(AdminPage,function(){function e(e){AdminPage.apply(this),this.id=e,this.organization=new OneOrganization(this.id),this.with_header_tabs=!0,this.organization_fields=new Fields("privileges")}return e.prototype.fetchData=function(){return this.fetching_data_defer=this.organization.fetchOrganization(this.organization_fields)},e.prototype.renderHeaderTabs=function(){return[{title:"Обзор",page:"/admin/organization/"+this.id+"/overview"},{title:"События",page:"/admin/organization/"+this.id+"/events"},{title:"Финансы",page:"/admin/organization/"+this.id+"/finances"},{title:"CRM",page:"/admin/organization/"+this.id+"/crm"},{title:"Рассылки",page:"/admin/organization/"+this.id+"/dispatches"},{title:"Реквизиты",page:"/admin/organization/"+this.id+"/requisites"},{title:"Настройки",page:"/admin/organization/"+this.id+"/settings"},{title:"Редактирование",page:"/admin/organization/"+this.id+"/edit"}]},e}()),AdminOrganizationCRMPage=extending(AdminOrganizationPage,function(){function e(e){var t=this;AdminOrganizationPage.call(this,e),this.organization_fields=this.organization_fields.add("subscribed_count"),this.subscribers_fields=new Fields("email","accounts_links","interests"),this.organization_subscribers=new OrganizationSubscribersCollection(e),this.CRMTable=null,this.$loader=$(),Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},t.organization.short_name+" - CRM"]}})}return e.TABLE_COLUMNS=["name","email","accounts","gender","country","city","auth_date","subscription_date","unsubscription_date","organization_page_view","event_page_view","notifications_received","notifications_opened","notifications_hidden","registrations","favored","shared_event","average_check","overall_average_check","spent_on_me","overall_spent","friends","loyalty","solvency"],e.prototype.initCRMTable=function(){var e=this;this.CRMTable=this.$wrapper.find(".CRMTable").eq(0).DataTable({paging:!0,select:{style:"single",selector:"td",className:"-selected",info:!1},columnDefs:[{targets:0,width:350},{targets:1,width:550},{targets:2,width:90},{targets:3,width:60},{targets:range(24,4),width:100,visible:!1,searchable:!1}],fixedColumns:!0,scrollX:"100%",scrollCollapse:!0,dom:'t<"data_tables_pagination"p>',language:{url:__LOCALE.DATATABLES_URL}}),this.$wrapper.find(".CRMTableSearch").on("input",function(){e.CRMTable.search(this.value).draw()})},e.prototype.toggleColumn=function(t){var n=this.CRMTable.column(+t===t?t:e.TABLE_COLUMNS.indexOf(t));n.visible(!n.visible()),this.CRMTable.rows().recalcHeight().columns.adjust().fixedColumns().relayout().draw()},e.prototype.init=function(){this.initCRMTable(),bindDropdown(this.$wrapper)},e.prototype.render=function(){var e=this,t=$();t=t.add(new DropDown("export-formats","Выгрузка",{classes:[__C.CLASSES.SIZES.LOW,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.DOWNLOAD,__C.CLASSES.COLORS.MARGINAL_PRIMARY,__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.HOOKS.DROPDOWN_BUTTON]},{width:"self",position:{x:"right",y:5}},{xlsx_href:"/api/v1/statistics/organizations/"+this.organization.id+"/subscribers/export?format=xlsx",html_href:"/api/v1/statistics/organizations/"+this.organization.id+"/subscribers/export?format=html"})),this.$wrapper.html(tmpl("admin-organization-crm-page",{header_buttons:t,loader:this.$loader=__APP.BUILD.overlayLoader()})),this.$wrapper.find(".CRMTableWrapper").addClass(__C.CLASSES.STATUS.DISABLED),this.init(),this.organization_subscribers.fetchAllSubscribers(this.subscribers_fields).then(function(t){var n=tmpl("admin-organization-crm-page-tr",t.map(function(e){return{user_avatar_block:__APP.BUILD.avatarBlocks(e,{entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}),email:e.email,accounts:__APP.BUILD.socialLinks(e.accounts_links),gender:function(t){switch(e.gender){case OneUser.GENDER.MALE:return"М";case OneUser.GENDER.FEMALE:return"Ж";default:case OneUser.GENDER.NEUTRAL:return"—"}}()}}));n.each(function(e){$(this).data("client",t[e])}),e.CRMTable||e.initCRMTable(),e.CRMTable.rows.add(n).draw();try{e.CRMTable.rows().recalcHeight().columns.adjust().fixedColumns().relayout().draw()}catch(e){__APP.reload()}e.CRMTable.on("deselect",function(){$("body").off("keyup.DeselectCurrent"),AbstractAppInspector.hideCurrent()}),e.CRMTable.on("select",function(e,t,n,i){var a,r;"row"===n&&((r=(a=$(t.row(i).node())).data()).inspector&&r.inspector.is_shown?(r.inspector.hide(),$("body").off("keyup.DeselectCurrent")):(r.inspector instanceof ClientAppInspector||(r.inspector=new ClientAppInspector(r.client),a.data(r)),r.inspector.show(),$("body").off("keyup.DeselectCurrent").on("keyup.DeselectCurrent",function(e){isKeyPressed(e,__C.KEY_CODES.ESC)&&t.row(i).deselect()})))}),e.$wrapper.find(".CRMTableWrapper").removeClass(__C.CLASSES.STATUS.DISABLED),e.$loader.remove()})},e}()),AdminOrganizationDispatchesPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.call(this,e),this.dispatches=new OrganizationDispatchesCollection(e),this.dispatches_fields=new Fields("event","notification_time"),Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},this.organization.short_name+" - рассылки"]}})}return e.prototype.dispatchBuilder=function(e){var t=this;return tmpl("admin-dispatch-item",(e instanceof Array?e:[e]).map(function(e){return{name:e.title,done_text:e.done?__APP.BUILD.text({content:"Отправлено",classes:[__C.CLASSES.TEXT_WEIGHT.BOLDER,__C.CLASSES.UNIVERSAL_STATES.UPPERCASE,__C.CLASSES.TEXT_COLORS.MUTED_50]}):"",date:moment(e.notification_time).calendar(null,__LOCALE.DATE.CALENDAR_DATE_TIME),type:e.is_email?"Email-рассылка":(e.is_sms," с СМС сообщениями"),event_link:e instanceof OneEventDispatch?__APP.BUILD.actionLink({title:e.event.title,page:"/event/{id}".format({id:e.event.id}),classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.UNIVERSAL_STATES.NO_UPPERCASE]}):"-",service_action_buttons:__APP.BUILD.actionLink({page:"/admin/organization/{organization_id}/dispatch/{uuid}".format({organization_id:t.organization.id,uuid:e.uuid}),title:e.done?"Подробнее":"Редактировать",classes:[__C.CLASSES.COLORS.ACCENT]})}}))},e.prototype.render=function(){var e,t=this;e=this.dispatches.fetch(this.dispatches_fields,ServerConnection.MAX_ENTITIES_LENGTH,"notification_time"),this.$wrapper.html(tmpl("admin-dispatches-page",{add_dispatch_button:__APP.BUILD.linkButton({page:"/admin/organization/{id}/add/dispatch/".format({id:this.organization.id}),title:"Создать рассылку",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.ICON_CLASS,__C.CLASSES.ICONS.ENVELOPE]})})),e.then(function(){t.$wrapper.find(".DispatchesWrapper").append(t.dispatches.length?t.dispatchBuilder(t.dispatches):__APP.BUILD.cap("Вы пока не создали ни одну рассылку"))})},e}()),AdminOrganizationEditPage=extending(EditOrganizationPage,AdminOrganizationPage,function(){return function(e){var t=this;EditOrganizationPage.call(this,e),AdminOrganizationPage.call(this,e),Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},t.organization.short_name+" - редактирование"]}})}}()),AdminOrganizationEditPage.prototype.renderHeaderTabs=AdminOrganizationPage.prototype.renderHeaderTabs,AdminOrganizationEventsPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.apply(this,arguments),this.block_scroll=!1,this.future_events_data={future:!0,canceled_shown:!0},this.past_events_data={future:!1,canceled_shown:!0,order_by:"-first_event_date"},this.future_events=new EventsWithStatisticsCollection,this.past_events=new EventsWithStatisticsCollection}return e.buildEventRows=function(e,t){var n=tmpl("orgstat-events-row",e.map(function(e){return $.extend({},e,{date:moment.unix(e[t]).format(__LOCALES.ru_RU.DATE.DATE_FORMAT),timestamp:e[t],conversion:Math.round(0==e.view?e.view:100*e.view_detail/e.view)+"%"})}));return bindPageLinks(n),n},e.prototype.render=function(){var t,n,i=this,a=$(window);if(this.organization.role===OneUser.ROLE.USER)return __APP.changeState("/",!0,!0);this.renderHeaderTabs(),__APP.changeTitle([{title:"Организации",page:"/admin"},this.organization.short_name+" - события"]),this.$wrapper.html(tmpl("orgstat-events-page")),this.future_events.fetchOrganizationsEvents(this.organization.id,this.future_events_data,ServerConnection.MAX_ENTITIES_LENGTH,function(){this.length?i.$wrapper.find(".OrgStatFutureEventsWrapper").html(tmpl("orgstat-events-wrapper",{title:"Предстоящие события",rows:e.buildEventRows(i.future_events,"nearest_event_date")})).find("table").tablesort():i.$wrapper.find(".OrgStatFutureEventsWrapper").html(tmpl("orgstat-no-events-wrapper",{title:"Предстоящие события",call_to_action:__APP.BUILD.linkButton({title:"Добавить событие",page:"/add/event/to/"+i.organization.id,classes:[__C.CLASSES.COLORS.ACCENT]})}))}),this.past_events.fetchOrganizationsEvents(this.organization.id,this.past_events_data,30,function(){this.length&&((t=i.$wrapper.find(".OrgStatPastEventsWrapper")).html(tmpl("orgstat-events-wrapper",{title:"Прошедшие события",rows:e.buildEventRows(i.past_events,"first_event_date")})),n=t.find("table").tablesort(),a.on("scroll.uploadEvents",function(){a.height()+a.scrollTop()+200>=$(document).height()&&!i.block_scroll&&(i.block_scroll=!0,i.past_events.fetchOrganizationsEvents(i.organization.id,i.past_events_data,30,function(a){i.block_scroll=!1,a.length?(t.find("tbody").append(e.buildEventRows(a,"first_event_date")),n.refresh()):$(window).off("scroll.uploadEvents")}))}))})},e}()),AdminOrganizationFinancesPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.call(this,e),this.organization_fields.add("created_at",{finance:{fields:new Fields("total_income","withdraw_available","processing_commission","processing_commission_value","evendate_commission_value")}}),this.events_fields=new Fields({finance:{fields:new Fields("total_income","withdraw_available")}}),this.withdraw_fields=new Fields("user","created_at"),this.transactionsTable=null,this.eventsTable=null,this.render_vars={withdraw_funds_button:null,withdraw_funds_help:null,transactions_loader:null,orders_loader:null,events_loader:null},Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},this.organization.short_name+" - финансы"]}})}return e.prototype.appendWithdraw=function(e){return this.transactionsTable.rows.add((e instanceof Array?e:[e]).map(function(e){return{date:{display:moment.unix(e.created_at).format(__LOCALE.DATE.DATE_FORMAT),timestamp:e.created_at},staff_block:__APP.BUILD.avatarBlocks(e.user,{entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X30,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}).outerHTML(),status:e.status_description,comment:e.comment,response:e.response,sum:formatCurrency(e.sum," ",".","","₽")}})).draw()},e.prototype.init=function(){var e=this;this.render_vars.withdraw_funds_button.on("click.ShowAddTransactionModal",function(){new WithdrawModal(e.organization).show()})},e.prototype.preRender=function(){this.render_vars.total_income=formatCurrency(this.organization.finance.total_income," ",".","","₽"),this.render_vars.withdraw_available=formatCurrency(this.organization.finance.withdraw_available," ",".","","₽"),this.render_vars.processing_commission_value=formatCurrency(this.organization.finance.processing_commission_value," ",".","","₽"),this.render_vars.evendate_commission_value=formatCurrency(this.organization.finance.evendate_commission_value," ",".","","₽"),this.render_vars.processing_commission=this.organization.finance.processing_commission||4,this.render_vars.withdraw_funds_button=__APP.BUILD.button({title:"Вывести средства",classes:[__C.CLASSES.HOOKS.RIPPLE,__C.CLASSES.COLORS.NEUTRAL_ACCENT]}),this.render_vars.withdraw_funds_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.FUNDS_WITHDRAW,"Как происходит вывод средств"),this.render_vars.transactions_loader=__APP.BUILD.floatingLoader(),this.render_vars.charts=tmpl("admin-organization-finances-chart",[{classes:"TicketsSellingChart"},{classes:"OrdersChart"}]),this.render_vars.events_loader=__APP.BUILD.floatingLoader()},e.prototype.render=function(){var e,t=this,n={scale:AbstractStatisticsCollection.SCALES.DAY,since:moment.unix(this.organization.created_at).format(__C.DATE_FORMAT),till:moment().format(__C.DATE_FORMAT)},i={paging:!0,dom:'t<"data_tables_pagination"p>',language:{url:__LOCALE.DATATABLES_URL}},a={legend:{enabled:!1}};this.$wrapper.html(tmpl("admin-organization-finances-page",this.render_vars)),(e=this.$wrapper.find(".AreaChart")).append(__APP.BUILD.loaderBlock()),this.transactionsTable=this.$wrapper.find(".TransactionStoryTable").eq(0).DataTable(mergeObjects(i,{columns:[{data:{_:"date.display",sort:"date.timestamp"}},{data:"staff_block"},{data:"status"},{data:"comment",className:"-preformatted_text"},{data:"response",className:"-preformatted_text"},{data:"sum",className:"-align_right"}]})),this.eventsTable=this.$wrapper.find(".EventsFinancesTable").eq(0).DataTable(i),this.organization.finance.withdraws.fetch(this.withdraw_fields).then(function(){t.appendWithdraw(t.organization.finance.withdraws),t.render_vars.transactions_loader.remove()}),this.organization.finance.income_dynamics.fetch(n.scale,n.since,n.till).then(function(){AdminPage.buildStockChart(e.filter(".TicketsSellingChart"),"Выручка",[{name:"Выручка",data:AdminPage.areaChartSeriesNormalize(t.organization.finance.income_dynamics)}],a)}),this.organization.finance.ticket_dynamics.fetch(n.scale,n.since,n.till).then(function(){AdminPage.buildStockChart(e.filter(".OrdersChart"),"Динамика продаж",[{name:"Количество заказов",data:AdminPage.areaChartSeriesNormalize(t.organization.finance.ticket_dynamics)}],a)}),this.organization.events.fetchOrganizationsFeed(this.organization.id,this.events_fields,ServerConnection.MAX_ENTITIES_LENGTH).then(function(){t.eventsTable.rows.add(tmpl("admin-organization-finances-event-row",t.organization.events.map(function(e){return{title:__APP.BUILD.link({title:e.title,page:"/admin/event/{event_id}/sales".format({event_id:e.id})}),sum:formatCurrency(e.finance.total_income," ",".","","₽"),total_sum:formatCurrency(e.finance.withdraw_available," ",".","","₽")}}))).draw(),t.render_vars.events_loader.remove()}),this.init()},e}()),AdminOrganizationOverviewPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.call(this,e),this.graphics_stats=new OrganizationsStatistics(this.id),this.other_stats=new OrganizationsStatistics(this.id),this.organization_fields=new Fields("description","img_medium_url","default_address","staff","privileges",{events:{length:3,filters:"future=true,is_canceled=false,is_delayed=true",fields:new Fields("organization_short_name","public_at"),order_by:"nearest_event_date"}})}return e.buildStaffBlock=function(e,t,n,i){return n.length?tmpl("orgstat-overview-sidebar-wrapper-title",{title:t}).add(__APP.BUILD.staffAvatarBlocks(e,n,{is_link:!0,entity:__C.ENTITIES.USER,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]},i===OneUser.ROLE.ADMIN)):$()},e.prototype.buildAreaCharts=function(){var e=this;AdminPage.prototype.buildAreaCharts.call(e,{subscribe_unsubscribe:e.graphics_stats.subscribe.map(function(t,n){return{time_value:t.time_value,subscribe:t.value,unsubscribe:e.graphics_stats.unsubscribe[n].value}}),view:e.graphics_stats.view,conversion:e.graphics_stats.conversion})},e.prototype.buildPieChart=function(e,t){var n={chart:{type:"pie",height:200,style:{fontFamily:"inherit",fontSize:"inherit"}},colors:[__C.COLORS.FRANKLIN,__C.COLORS.ACCENT,__C.COLORS.MUTED,__C.COLORS.MUTED_80,__C.COLORS.MUTED_50,__C.COLORS.MUTED_30],tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{center:[45,"50%"],allowPointSelect:!0,cursor:"pointer",size:120,dataLabels:{inside:!1,distance:-35,overflow:"none",crop:!1,defer:!1,formatter:function(){return this.percentage>15?Math.round(this.percentage)+"%":null},useHTML:!0,style:{color:"#fff",fontSize:"16px",fontWeight:"300",textShadow:"none",textOutline:"none",textOverflow:"none"},y:-6},showInLegend:!0}},legend:{align:"right",verticalAlign:"top",layout:"vertical",width:100,symbolPadding:15,symbolHeight:0,symbolWidth:0,itemMarginBottom:5,labelFormatter:function(){return'<span style="color: '+this.color+'">'+this.name+"</span>"},useHTML:!0,itemStyle:{cursor:"pointer",fontSize:"14px",fontWeight:"500"},y:12}};e.highcharts($.extend(!0,{},AdminPage.HIGHCHART_DEFAULT_OPTIONS,n,{series:function(e){var t={browser:"Браузер",android:"Аndroid",ios:"iOS",female:"Женщины",male:"Мужчины",other:"Остальные",null:"Не указано"};return[{data:e.map(function(e,n){return{name:e.name?t[e.name]:t[e.gender],y:e.count}})}]}(t)}))},e.prototype.render=function(){function t(e){return $.extend({},e,{is_link:!0,avatar_classes:["-size_40x40","-rounded"]})}var n=this,i={scale:Statistics.SCALES.WEEK,fields:["subscribe","view","fave","conversion"]},a="org_stats_"+this.id+"_data",r="org_stats_"+this.id+"_until",s=moment.unix(sessionStorage.getItem(r)).isAfter(moment());if(!checkRedirect("overview","/admin/organization/"+this.organization.id+"/overview",!0))return null;this.renderHeaderTabs(),__APP.changeTitle([{title:"Организации",page:"/admin"},this.organization.short_name]),this.$wrapper.html(tmpl("orgstat-overview",$.extend(!0,{},this.organization,{avatar_block:__APP.BUILD.avatarBlocks(this.organization,{entity:__C.ENTITIES.ORGANIZATION,block_classes:["-stack"]}),staff_block:e.buildStaffBlock(this.organization.id,"Администраторы",this.organization.admins.map(t),this.organization.role).add(e.buildStaffBlock(this.organization.id,"Модераторы",this.organization.moderators.map(t),this.organization.role)),event_blocks:this.organization.events.length?tmpl("orgstat-overview-sidebar-wrapper",{content:tmpl("orgstat-overview-sidebar-wrapper-title",{title:"Предстоящие события"}).add(tmpl("orgstat-event-block",this.organization.events.map(function(e){var t=[];return e.canceled&&t.push({title:"Отменено"}),e.public_at&&moment.unix(e.public_at).isBefore()&&t.push({title:"Не опубликовано"}),{id:e.id,title:e.title,organization_short_name:e.organization_short_name,day:moment.unix(e.first_event_date).format("D"),month:moment.unix(e.first_event_date).format("MMM"),badges:tmpl("orgstat-event-block-badge",t)}})))}):""}))),s?(this.graphics_stats.setData(JSON.parse(sessionStorage.getItem(a))),this.buildAreaCharts()):(this.$wrapper.find(".OrgStatAreaCharts").children(".AreaChart").append(tmpl("loader")),this.graphics_stats.fetchStatistics(Statistics.SCALES.DAY,moment(__APP.EVENDATE_BEGIN,"DD-MM-YYYY").format(),["view","subscribe","unsubscribe","conversion"],null,function(){sessionStorage.setItem(a,JSON.stringify(n.graphics_stats)),sessionStorage.setItem(r,moment().add(15,"m").unix()),n.buildAreaCharts()})),this.other_stats.fetchStatistics(Statistics.SCALES.OVERALL,!1,["subscribe","view","fave","conversion","audience"],i,function(e){var t={numbers:{},dynamics:{}};$.each(e.dynamics,function(n,i){t.dynamics[n]=i[0].value,t.numbers[n]=e[n][0].value}),n.buildPieChart(n.$wrapper.find(".GenderPieChart"),this.audience.gender),n.buildPieChart(n.$wrapper.find(".DevicePieChart"),this.audience.devices),n.updateScoreboards(n.$wrapper.find(".Scoreboards"),t,{subscribe:"Подписчиков организатора",fave:"Добавлений в избранное",view:"Просмотров организатора",conversion:"Конверсия открытий/подписок"},["subscribe","fave","view","conversion"])}),bindRippleEffect(this.$wrapper),bindPageLinks(this.$wrapper)},e}()),AdminOrganizationPromotionPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.apply(this,arguments)}return e.prototype.render=function(){},e}()),AdminOrganizationRequisitesPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.call(this,e),this.requisites={agent_type:null},Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},this.organization.short_name+" - реквизиты"]}})}return e.prototype.fetchData=function(){var e=this;return this.fetching_data_defer=__APP.SERVER.multipleAjax(this.organization.fetchOrganization(this.organization_fields),OneOrganization.fetchRequisites(this.organization.id).then(function(t){Object.assign(e.requisites,t.agent_info)}))},e.prototype.init=function(){var e=this,t=this.$wrapper.find(".Tabs"),n=this.$wrapper.find(".LegalEntityCompanyNameInput"),i=this.$wrapper.find(".LegalEntityInnInput"),a=this.$wrapper.find(".LegalEntityKppInput"),r=this.$wrapper.find(".LegalEntityOgrnInput"),s=this.$wrapper.find(".LegalEntityAddressInput"),o=this.$wrapper.find(".LegalEntityBankNameInput"),l=this.$wrapper.find(".LegalEntityBikInput"),c=this.$wrapper.find(".LegalEntityCorrespondentAccountInput"),_=this.$wrapper.find(".NaturalPersonBankNameInput"),d=this.$wrapper.find(".NaturalPersonBikInput"),u=this.$wrapper.find(".NaturalPersonCorrespondentAccountInput");bindTabs(this.$wrapper),t.on("tabs:change",function(){var e=$(this).find(".TabsBody");e.not("."+__C.CLASSES.ACTIVE).prop("disabled",!0),e.filter("."+__C.CLASSES.ACTIVE).prop("disabled",!1)}),t.resolveInstance().disconnectMutationObserver(),this.requisites.agent_type&&t.resolveInstance().setToTab(t.find(".Tab").filter('[data-type="'+this.requisites.agent_type+'"]').index()),this.requisites.taxation_type&&this.$wrapper.find(".TaxationTypeSelect").val(this.requisites.taxation_type),this.requisites.company_name?this.$wrapper.find(".CompanyAdditionalInfo").removeClass(__C.CLASSES.HIDDEN):n.on("input.ToggleCompanyInfo",function(){var t=$(this);""!==t.val().trim()&&(e.$wrapper.find(".CompanyAdditionalInfo").removeClass(__C.CLASSES.HIDDEN),t.off("input.ToggleCompanyInfo"))}),n.add(i).suggestions({token:__C.API_TOKENS.DADATA,type:"PARTY",count:5,onSelect:function(e){n.val(e.unrestricted_value).trigger("change"),e.data&&(i.val(e.data.inn).trigger("change"),a.val(e.data.kpp).trigger("change"),r.val(e.data.ogrn).trigger("change"),e.data.address&&s.val(e.data.address.value).trigger("change"))}}),this.requisites.bank_name?this.$wrapper.find(".LegalEntityBankAdditionalInfo").removeClass(__C.CLASSES.HIDDEN):o.on("input.ToggleBankInfo",function(){var t=$(this);""!==t.val().trim()&&(e.$wrapper.find(".LegalEntityBankAdditionalInfo").removeClass(__C.CLASSES.HIDDEN),t.off("input.ToggleBankInfo"))}),o.add(l).suggestions({token:__C.API_TOKENS.DADATA,type:"BANK",count:5,onSelect:function(e){o.val(e.unrestricted_value).trigger("change"),e.data&&(l.val(e.data.bic).trigger("change"),c.val(e.data.correspondent_account).trigger("change"))}}),this.requisites.bank_name?this.$wrapper.find(".NaturalPersonBankAdditionalInfo").removeClass(__C.CLASSES.HIDDEN):_.on("input.ToggleBankInfo",function(){var t=$(this);""!==t.val().trim()&&(e.$wrapper.find(".NaturalPersonBankAdditionalInfo").removeClass(__C.CLASSES.HIDDEN),t.off("input.ToggleBankInfo"))}),_.add(d).suggestions({token:__C.API_TOKENS.DADATA,type:"BANK",count:5,onSelect:function(e){_.val(e.unrestricted_value).trigger("change"),e.data&&(d.val(e.data.bic).trigger("change"),u.val(e.data.correspondent_account).trigger("change"))}}),t.resolveInstance().connectMutationObserver(),this.render_vars.submit_button.on("click.Submit",function(){var t;isFormValid(e.$wrapper.find(".RequisitesForm"))&&(t=__APP.BUILD.overlayLoader(e.$wrapper),e.render_vars.submit_button.attr("disabled",!0),OneOrganization.saveRequisites(e.organization.id,e.gatherSendData()).then(function(){showNotifier({status:!0,text:"Реквизиты успешно сохранены"})}),t.remove(),e.render_vars.submit_button.removeAttr("disabled"))})},e.prototype.gatherSendData=function(){return this.$wrapper.find(".RequisitesForm").serializeForm()},e.prototype.preRender=function(){this.render_vars.radio_group=__APP.BUILD.radioGroup({name:"agent_type",classes:[__C.CLASSES.SIZES.BIG,"HeaderTabs"],units:[{id:"legal_entity_requisites_agent_type_legal",label:"Юридическое лицо",unit_classes:["Tab"],unit_dataset:{type:"legal_entity"},attributes:{value:"legal_entity",checked:!this.requisites.agent_type||"legal_entity"===this.requisites.agent_type}},{id:"legal_entity_requisites_agent_type_individual",label:"Физическое лицо",unit_classes:["Tab"],unit_dataset:{type:"individual"},attributes:{value:"individual",checked:"individual"===this.requisites.agent_type}}]}),this.render_vars.l_company_form_field=__APP.BUILD.formUnit({label:"Название компании",id:"legal_entity_requisites_company_name",name:"company_name",classes:"LegalEntityCompanyNameInput",placeholder:"Начните вводить чтобы появились предложения",helptext:"Полное наименование организации, включая форму предприятия",required:!0,value:escapeHtml(this.requisites.company_name)}),this.render_vars.l_inn_form_field=__APP.BUILD.formUnit({label:"ИНН",id:"legal_entity_requisites_inn",name:"company_inn",classes:"LegalEntityInnInput",placeholder:"Попробуйте найти организацию через ИНН",helptext:"10 или 12 знаков в зависимости от организационной формы",required:!0,attributes:{maxlength:12},value:this.requisites.company_inn}),this.render_vars.l_kpp_form_field=__APP.BUILD.formUnit({label:"КПП",id:"legal_entity_requisites_kpp",name:"company_kpp",classes:"LegalEntityKppInput",helptext:"9 знаков, если у вас нет КПП - поставьте прочерк",required:!0,attributes:{maxlength:9},value:this.requisites.company_kpp}),this.render_vars.l_ogrn_form_field=__APP.BUILD.formUnit({label:"ОГРН",id:"legal_entity_requisites_ogrn",name:"company_ogrn",classes:"LegalEntityOgrnInput",helptext:"Для ИП укажите ОГРНИП",required:!0,value:this.requisites.company_ogrn}),this.render_vars.l_real_address_form_field=__APP.BUILD.formUnit({label:"Юридический адрес",id:"legal_entity_requisites_real_address",name:"company_address",classes:"LegalEntityAddressInput",helptext:"Например: 150000, Россия, Москыв, ул. Ленина, д. 108, корп. 1, кв. 8",required:!0,value:escapeHtml(this.requisites.company_address)}),this.render_vars.l_bank_name_form_field=__APP.BUILD.formUnit({label:"Наименование банка",id:"legal_entity_requisites_bank_name",name:"bank_name",classes:"LegalEntityBankNameInput",placeholder:"Начните вводить чтобы появились предложения",helptext:"Полное наименование банка, включая отделение (если есть)",required:!0,value:escapeHtml(this.requisites.bank_name)}),this.render_vars.l_bic_form_field=__APP.BUILD.formUnit({label:"БИК",id:"legal_entity_requisites_bic",name:"bank_bik",classes:"LegalEntityBikInput",placeholder:"Попробуйте найти банк через БИК",helptext:"9 знаков",required:!0,attributes:{maxlength:9},value:this.requisites.bank_bik}),this.render_vars.l_correspondent_account_form_field=__APP.BUILD.formUnit({label:"Корреспондентский счет",id:"legal_entity_requisites_correspondent_account",name:"bank_correspondent_account",classes:"LegalEntityCorrespondentAccountInput",helptext:"20 знаков",required:!0,attributes:{maxlength:20},inputmask:{},value:this.requisites.bank_correspondent_account}),this.render_vars.l_checking_account_form_field=__APP.BUILD.formUnit({label:"Расчетный счет",id:"legal_entity_requisites_checking_account",name:"bank_payment_account",helptext:"20 знаков",required:!0,attributes:{maxlength:20},value:this.requisites.bank_payment_account}),this.render_vars.l_signer_name_form_field=__APP.BUILD.formUnit({label:"ФИО подписывающего лица",id:"legal_entity_requisites_signer_name",name:"signer_full_name",helptext:"ФИО лица, подписывающего договор (полностью). Например, Иванов Иван Иванович",required:!0,value:escapeHtml(this.requisites.signer_full_name)}),this.render_vars.l_signer_position_form_field=__APP.BUILD.formUnit({label:"Должность подписывающего лица",id:"legal_entity_requisites_signer_position",name:"signer_position",helptext:"Должность директора или ответственного лица, подписывающего договор",required:!0,value:escapeHtml(this.requisites.signer_position)}),this.render_vars.l_self_name_form_field=__APP.BUILD.formUnit({label:"Ваши имя и фамилия",id:"legal_entity_requisites_self_name",name:"contact_full_name",required:!0,value:escapeHtml(this.requisites.contact_full_name||__APP.USER.full_name)}),this.render_vars.l_self_email_form_field=__APP.BUILD.formUnit({label:"Ваш e-mail",id:"legal_entity_requisites_self_email",name:"contact_email",helptext:"На него мы вышлем заполненный договор",required:!0,value:escapeHtml(this.requisites.contact_email||__APP.USER.email)}),this.render_vars.l_self_phone_form_field=__APP.BUILD.formUnit({label:"Контактный телефон",id:"legal_entity_requisites_self_phone",name:"contact_phone_number",helptext:"В формате: +7 (xxx) xxx-xx-xx",required:!0,value:escapeHtml(this.requisites.contact_phone_number)}),this.render_vars.n_self_name_form_field=__APP.BUILD.formUnit({label:"Ваши имя и фамилия",id:"natural_person_requisites_self_name",name:"full_name",required:!0,value:escapeHtml(this.requisites.full_name||__APP.USER.full_name)}),this.render_vars.n_inn_form_field=__APP.BUILD.formUnit({label:"ИНН",id:"natural_person_requisites_inn",name:"inn",placeholder:"ИНН",helptext:"12 знаков. Если у вас нет ИНН, оставьте поле пустым",attributes:{maxlength:12},value:this.requisites.inn}),this.render_vars.n_id_number_field=__APP.BUILD.formUnit({label:"Серия и номер паспорта",name:"passport_number",placeholder:"Серия и номер",helptext:"Например, 1234 123456",required:!0,value:this.requisites.passport_number}),this.render_vars.n_id_when_field=__APP.BUILD.formUnit({label:"Когда выдан паспорт",name:"passport_issue_date",type:"date",required:!0,dataset:{max_date:moment().format(__C.DATE_FORMAT)},value:this.requisites.passport_issue_date}),this.render_vars.n_id_who_field=__APP.BUILD.formUnit({label:"Кем выдан паспорт",name:"passport_issue_by",helptext:"Например, ОВД Алексеевского района города Москвы",required:!0,value:escapeHtml(this.requisites.passport_issue_by)}),this.render_vars.n_register_address_field=__APP.BUILD.formUnit({label:"Адрес регистрации",name:"registration_address",helptext:"Например: 150000, Россия, Москыв, ул. Ленина, д. 108, корп. 1, кв. 8",required:!0,value:escapeHtml(this.requisites.registration_address)}),this.render_vars.n_post_address_field=__APP.BUILD.formUnit({label:"Почтновый адрес",name:"post_address",helptext:"Например: 150000, Россия, Москыв, ул. Ленина, д. 108, корп. 1, кв. 8",required:!0,value:escapeHtml(this.requisites.post_address)}),this.render_vars.n_bank_name_form_field=__APP.BUILD.formUnit({label:"Наименование банка",name:"bank_name",classes:"NaturalPersonBankNameInput",placeholder:"Начните вводить чтобы появились предложения",helptext:"Полное наименование банка, включая отделение (если есть)",required:!0,value:escapeHtml(this.requisites.bank_name)}),this.render_vars.n_bic_form_field=__APP.BUILD.formUnit({label:"БИК",name:"bank_bik",classes:"NaturalPersonBikInput",placeholder:"Попробуйте найти банк через БИК",helptext:"9 знаков",required:!0,attributes:{maxlength:9},value:this.requisites.bank_bik}),this.render_vars.n_correspondent_account_form_field=__APP.BUILD.formUnit({label:"Корреспондентский счет",name:"bank_correspondent_account",classes:"NaturalPersonCorrespondentAccountInput",helptext:"20 знаков",required:!0,attributes:{maxlength:20},inputmask:{},value:this.requisites.bank_correspondent_account}),this.render_vars.n_checking_account_form_field=__APP.BUILD.formUnit({label:"Расчетный счет",name:"bank_payment_account",helptext:"20 знаков",required:!0,attributes:{maxlength:20},value:this.requisites.bank_payment_account}),this.render_vars.n_checking_account_form_field=__APP.BUILD.formUnit({label:"Комментарий для перевода денег",name:"withdraw_comments",type:"textarea",helptext:"Например назначение платежа или номер банковской карты",value:escapeHtml(this.requisites.withdraw_comments)}),this.render_vars.n_self_email_form_field=__APP.BUILD.formUnit({label:"Контактрый e-mail",name:"contact_email",helptext:"В формате john@doe.com",required:!0,value:escapeHtml(this.requisites.contact_email||__APP.USER.email)}),this.render_vars.n_self_phone_form_field=__APP.BUILD.formUnit({label:"Контактный телефон",name:"contact_phone_number",helptext:"В формате: +7 (xxx) xxx-xx-xx",required:!0,value:escapeHtml(this.requisites.contact_phone_number)}),this.render_vars.submit_button=__APP.BUILD.button({title:"Сохранить",classes:[__C.CLASSES.SIZES.HUGE,__C.CLASSES.COLORS.NEUTRAL_ACCENT]})},e.prototype.render=function(){this.$wrapper.html(tmpl("admin-organization-requisites-page",this.render_vars)),this.init()},e}()),AdminOrganizationSettingsPage=extending(AdminOrganizationPage,function(){function e(e){var t=this;AdminOrganizationPage.call(this,e),this.organization_fields=new Fields("city","country","default_address","description","brand_color","brand_color_accent","is_private","email","privileges","staff","site_url",{tariff:{fields:new Fields("till","available_additional_notifications","available_event_publications","available_tickets_selling","available_telegram_bots","available_slack_bots","available_auditory_analytics","available_in_city","price")}}),this.render_vars={id:null,email:null,admin_avatar_blocks:null,moderator_avatar_blocks:null,private_checkbox:null,fb_vk_integration_checkboxes:null,facebook_profile:null,slack_telegram_integration_checkboxes:null,brand_color_field:null,brand_color_accent_field:null,save_colors_button:null,subdomain_radio:null,subdomain:null,other_domain_radio:null,other_domain:null,tariff_button:null,premium_tariff_help:null,tariff_service_info:null},Object.defineProperty(this,"page_title_obj",{get:function(){return[{title:"Организации",page:"/admin"},this.organization.short_name+" - настройки"]}}),Object.defineProperties(this.render_vars,{id:{get:function(){return t.organization.id}},email:{get:function(){return t.organization.email}}})}return e.buildStaffBlock=function(e,t,n,i){return __APP.BUILD.staffAvatarBlocks(e,t,{is_link:!0,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]},i===OneUser.ROLE.ADMIN).add(__APP.BUILD.addUserAvatarBlock(e,n,{avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]}))},e.prototype.updateOrganizationData=function(){return this.organization.updateOrganization(new OrganizationModel(this.organization))},e.prototype.init=function(){var e=this;bindCallModal(this.$wrapper),bindHelpLink(this.$wrapper),bindRippleEffect(this.$wrapper),this.$wrapper.find("#org_admin_settings_is_private").on("change",function(){e.organization.is_private=$(this).prop("checked"),e.updateOrganizationData()}),this.$wrapper.find(".SaveLocal").on("click",function(){e.organization.setData($(this).closest(".SaveLocalWrapper").serializeForm()),e.updateOrganizationData()}),this.$view.on("staff:add",function(t,n,i){var a=e.$wrapper.find(".StaffCollection");e.organization.staff.remove(i.id),e.organization.staff.setData(i),a.find(".User"+i.id).remove(),a.filter(function(e,t){return $(t).data("staff_type")===n}).children("."+__C.CLASSES.HOOKS.ADD_STAFF).before(__APP.BUILD.avatarBlocks(i,{is_link:!0,avatar_classes:[__C.CLASSES.SIZES.X40,__C.CLASSES.UNIVERSAL_STATES.ROUNDED]})),bindPageLinks(a)}),this.$wrapper.find(".ActivatePayment").on("click",function(){Payment.payForTariff(e.organization.id,function(e){Payment.doPayment(e.uuid,e.sum)})}),function(e){function t(e,t){var n={};e?(n[t]=e.toHexString(),__APP.repaint(n)):__APP.setDefaultColors()}var n=e.find(".ColorPicker"),i=n.filter(".BrandColor"),a=n.filter(".BrandAccentColor"),r={allowEmpty:!0,preferredFormat:"hex",showInitial:!0,showInput:!0,showButtons:!1,replacerClassName:"-spectrum_replacer_override",containerClassName:"-spectrum_container_override"};i.on("move.spectrum",function(e,n){i.spectrum("set",n.toHexString()),t(n,"header")}).on("change.spectrum",function(e,n){t(n,"header")}).spectrum(Object.assign({color:i.val()||__C.COLORS.MUTED},r)),a.on("move.spectrum",function(e,n){a.spectrum("set",n.toHexString()),t(n,"accent")}).on("change.spectrum",function(e,n){t(n,"accent")}).spectrum(Object.assign({color:a.val()||__C.COLORS.ACCENT},r))}(this.$wrapper)},e.prototype.preRender=function(){var t=this.organization.tariff.is_full?"Оплачен до {date}":"";this.render_vars.admin_avatar_blocks=e.buildStaffBlock(this.organization.id,this.organization.admins,OneUser.ROLE.ADMIN,this.organization.role),this.render_vars.moderator_avatar_blocks=e.buildStaffBlock(this.organization.id,this.organization.moderators,OneUser.ROLE.MODERATOR,this.organization.role),this.render_vars.private_checkbox=__APP.BUILD.checkbox({id:"org_admin_settings_is_private",name:"is_private",label:"Закрытая организация",attributes:{checked:this.organization.is_private}}),this.render_vars.fb_vk_integration_checkboxes=null,this.render_vars.facebook_profile=null,this.render_vars.slack_telegram_integration_checkboxes=null,this.render_vars.brand_color_field=__APP.BUILD.formUnit({id:"org_admin_settings_brand_color",label:"Основной фирменный цвет",name:"brand_color",classes:["ColorPicker","BrandColor"],value:this.organization.brand_color,placeholder:__C.COLORS.MUTED}),this.render_vars.brand_color_accent_field=__APP.BUILD.formUnit({id:"org_admin_settings_brand_color_accent",label:"Акцентирующий фирменный цвет",name:"brand_color_accent",classes:["ColorPicker","BrandAccentColor"],value:this.organization.brand_color_accent,placeholder:__C.COLORS.ACCENT}),this.render_vars.save_colors_button=__APP.BUILD.button({title:"Сохранить",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.HOOKS.RIPPLE,"SaveLocal"]}),this.render_vars.subdomain_radio=__APP.BUILD.radio({id:"org_admin_settings_subdomain_enabled",name:"domains"}),this.render_vars.subdomain=null,this.render_vars.other_domain_radio=__APP.BUILD.radio({id:"org_admin_settings_other_domain_enabled",name:"domains"}),this.render_vars.other_domain=null,this.render_vars.tariff_button=__APP.BUILD.button({title:"Оплатить",classes:[__C.CLASSES.COLORS.ACCENT,__C.CLASSES.HOOKS.RIPPLE,"ActivatePayment"]}),this.render_vars.premium_tariff_help=__APP.BUILD.helpLink(HelpCenterConnection.ARTICLE.PREMIUM_TARIFF,"Что дает premium подписка"),this.render_vars.tariff_service_info=t.format({date:moment.unix(this.organization.tariff.till).calendar(null,{sameDay:"[Сегодня]",nextDay:"[Завтра]",nextWeek:"D MMMM YYYY",lastWeek:"D MMMM YYYY",sameElse:"D MMMM YYYY"})})},e.prototype.render=function(){this.renderHeaderTabs(),this.$wrapper.html(tmpl("admin-organization-settings-page",this.render_vars)),this.init()},e.prototype.destroy=function(){__APP.IS_REPAINTED&&__APP.setDefaultColors(),this.$view.off("staff:add")},e}()),AdminOrganizationSupportPage=extending(AdminOrganizationPage,function(){function e(e){AdminOrganizationPage.apply(this,arguments)}return e.prototype.render=function(){},e}()),FeedPage=extending(Page,function(){function e(){Page.call(this),this.fields=e.fields.copy(),this.events=new EventsCollection,this.next_events_length=10,this.cities=new CitiesCollection,this.wrapper_tmpl="feed",this.with_header_tabs=!0}return e.fields=new Fields("organization_short_name","organization_logo_small_url","dates","is_same_time","favored_users_count","is_favorite","is_registered","ticketing_locally","ticketing_available","registration_locally","registration_available","registration_required","registration_till","registration_limit_count","is_free","min_price",{favored:{fields:"is_friend",order_by:"-is_friend",length:5}}),e.prototype.bindFeedEvents=function(e){trimAvatarsCollection(e),bindRippleEffect(e),bindDropdown(e),__APP.MODALS.bindCallModal(e),bindPageLinks(e),e.find(".HideEvent").not(".-Handled_HideEvent").each(function(){var e=$(this),t=e.parents(".FeedEvent"),n=e.data("event-id");e.on("click",function(){t.addClass("-cancel"),OneEvent.changeEventStatus(n,OneEvent.STATUS.HIDE).then(function(){t.after(__APP.BUILD.button({classes:[__C.CLASSES.COLORS.NEUTRAL,"ReturnEvent"],title:"Вернуть событие",dataset:{"event-id":n}})),t.siblings(".ReturnEvent").not(".-Handled_ReturnEvent").on("click",function(){var e=$(this);OneEvent.changeEventStatus(n,OneEvent.STATUS.SHOW).then(function(){e.remove(),t.removeClass("-cancel")})}).addClass("-Handled_ReturnEvent")})})}).addClass("-Handled_HideEvent")},e.prototype.addNoEventsBlock=function(){var e=tmpl("feed-no-event",{text:"Как насчет того, чтобы подписаться на организации?",button:__APP.BUILD.link({title:"Перейти к каталогу",classes:["button","-color_neutral_accent","RippleEffect"],page:"/organizations"})},this.$wrapper);bindPageLinks(e),bindRippleEffect(e)},e.prototype.renderHeaderTabs=function(){return __APP.USER.isLoggedOut()?[{title:"Актуальные",page:"/feed/actual"},{title:"По времени",page:"/feed/timeline"}]:[{title:"Актуальные",page:"/feed/actual"},{title:"По времени",page:"/feed/timeline"},{title:"Избранные",page:"/feed/favored"},{title:"Рекомендованные",page:"/feed/recommendations"}]},e.prototype.appendEvents=function(e){var t=this,n=__APP.BUILD.loaderBlock(t.$wrapper);return t.block_scroll=!0,t.events.fetchFeed(this.fields,this.next_events_length,{city_id:__APP.USER.selected_city.id},function(i){var a=__APP.BUILD.eventCards(t.events.__last_pushed);t.block_scroll=!1,a.length?(t.$wrapper.append(a),t.bindFeedEvents(a),isFunction(e)&&e(a)):(t.addNoEventsBlock(),$(window).off("scroll.upload"+t.constructor.name)),n.remove()})},e.prototype.initFeedCalendar=function(){var e=this,t=e.events.date,n=new Calendar(e.$view.find(".FeedCalendar"),{classes:{wrapper_class:"feed_calendar_wrapper",table_class:"feed_calendar_table",thead_class:"feed_calendar_thead",tbody_class:"feed_calendar_tbody",th_class:"feed_calendar_th",td_class:"feed_calendar_td",td_disabled:__C.CLASSES.DISABLED}});n.init(),t&&n.setMonth(t.split("-")[1],t.split("-")[0]).selectDays(t),n.setDaysWithEvents({city_id:__APP.USER.selected_city.id}),n.$calendar.on("change:month",function(){bindPageLinks(n.$calendar),n.setDaysWithEvents({city_id:__APP.USER.selected_city.id})})},e.prototype.initCitySelect=function(){var e=this;e.cities.fetchCities(null,0,"distance,local_name").then(function(){var t=e.$view.find(".FeedCitiesSelect");t.html(tmpl("option",e.cities.map(function(e){return{val:e.id,display_name:e.local_name}}))),initSelect2(t),t.select2("val",__APP.USER.selected_city.id).off("change.SelectCity").on("change.SelectCity",function(){__APP.USER.selected_city=e.cities.getByID($(this).val()),__APP.reload(),e.initFeedCalendar()})})},e.prototype.render=function(){var t=this,n=$(window);if((__APP.IS_PREV_PAGE_REACT||__APP.PREVIOUS_PAGE instanceof e==!1)&&(t.initFeedCalendar(),t.initCitySelect()),__APP.USER.isLoggedOut()&&(t.$view.find(".BecomeOrg").on("click",function(e){return cookies.removeItem("auth_command"),cookies.removeItem("auth_entity_id"),new AuthModal(location.origin+"/add/organization",{note:"Для выполнения этого действия, нужно войти через социальную сеть"}).show(),!1}),"/feed/favored"===window.location.pathname||"/feed/recommendations"===window.location.pathname))return __APP.changeState("/feed/actual",!0,!0),null;n.off("scroll"),t.appendEvents(function(){isScrollRemain(1e3)&&t.appendEvents(),n.on("scroll.upload"+t.constructor.name,function(){isScrollRemain(1e3)&&!t.block_scroll&&t.appendEvents()})})},e}()),ActualEventsPage=extending(FeedPage,function(){return function(){FeedPage.apply(this),this.events=new ActualEventsCollection,this.page_title="Актуальные события"}}()),DayEventsPage=extending(FeedPage,function(){return function(e){if(!e)throw Error("DayEventsCollection must have date parameter");FeedPage.apply(this),this.date=e,this.events=new DayEventsCollection(this.date),this.page_title="События на "+moment(this.date).format("D MMMM YYYY")}}()),FavoredEventsPage=extending(FeedPage,function(){return function(){FeedPage.apply(this),this.events=new FavoredEventsCollection,this.page_title="Избранные события"}}()),FriendsEventsPage=extending(FeedPage,function(){return function(){FeedPage.apply(this),this.events=new FriendsEventsCollection,this.page_title="События друзей"}}()),RecommendedEventsPage=extending(FeedPage,function(){return function(){FeedPage.apply(this),this.events=new RecommendedEventsCollection,this.page_title="Рекомендованные события"}}()),TimelineEventsPage=extending(FeedPage,function(){return function(){FeedPage.apply(this),this.events=new TimelineEventsCollection,this.page_title="События по времени"}}());var AbstractEvendateApplication=function(){function e(){_classCallCheck(this,e),this.SERVER=new ServerConnection,this.POST_MESSAGE=PostMessageConnection(window),this.EVENDATE_BEGIN="15-12-2015",this.AUTH_URLS={},this.USER=new CurrentUser,this.PREVIOUS_PAGE=new Page,this.CURRENT_PAGE=new Page,this.CURRENT_REACT_PAGE=null,this.MODALS=new Modals,this.BUILD=new Builder,this.ROUTING={},this.YA_METRIKA=window.yaCounter32442130||null,this.IS_REPAINTED=!1,this.HISTORY=null,this.IS_WIDGET=!1,this.IS_REACT_PAGE=!0,this.IS_PREV_PAGE_REACT=!0,this.LOADER=$(),this.BASE_PATH="/"}return _createClass(e,[{key:"repaint",value:function(e){this.IS_REPAINTED=!0,e.accent&&function(e){document.getElementById("main_overlay").style.setProperty("--color_accent",e)}(e.accent)}},{key:"setDefaultColors",value:function(){document.getElementById("main_overlay").style.removeProperty("--color_accent")}},{key:"changeTitle",value:function(e){}},{key:"changeState",value:function(e,t,n){var i=void 0;if(History.stateChangeHandled=!0,e){var a=void 0;a={parsed_page_uri:i=parseUri(decodeURIComponent(0===e.indexOf(this.BASE_PATH)?e:0===e.indexOf("/")?this.BASE_PATH.slice(0,-1)+e:this.BASE_PATH+e)),soft_change:t,reload:n},t?this.replaceState(i.path,a):this.pushState(i.path,a)}else console.error("Need to pass page name");return History.stateChangeHandled=!1,!1}},{key:"pushState",value:function(e,t){this.HISTORY?this.HISTORY.push(e,t):History.pushState(t,"",e)}},{key:"replaceState",value:function(e,t){this.HISTORY?this.HISTORY.replace(e,t):History.replaceState(t,"",e)}},{key:"reload",value:function(){return this.changeState(location.pathname,!0,!0)}},{key:"openPage",value:function(e){return $(window).off("scroll"),AbstractAppInspector.hideCurrent(),this.PREVIOUS_PAGE=__APP.CURRENT_PAGE,this.PREVIOUS_PAGE.destroy(),this.CURRENT_PAGE=e,this.CURRENT_PAGE.fetchData(),this.CURRENT_PAGE.show(),this.CURRENT_PAGE}},{key:"routePage",value:function(e){var t,n=[];return(t=decodeURIComponent(e).split("/").reduce(function(e,t){return t?e.hasOwnProperty(t)?e[t]:Object.keys(e).reduce(function(i,a){return!i&&0===a.indexOf("^")&&new RegExp(a).test(t)?(n.push(t),e[a]):i},!1):e},this.ROUTING)).prototype instanceof Page||t.prototype instanceof React.Component||(t=t[""]&&(t[""].prototype instanceof Page||t.prototype instanceof React.Component)?t[""]:NotFoundPage),{PageClass:t,args:n}}},{key:"init",value:function(){var e=this.HISTORY?this.HISTORY.location.state:null,t=window.location.pathname;if(isVoid(e)||!e.soft_change||e.soft_change&&e.reload){var n=this.routePage(t),i=n.PageClass,a=n.args;this.SERVER.abortAllConnections(),this.openPage(new(Function.prototype.bind.apply(i,[null].concat(_toConsumableArray(a)))))}}},{key:"renderReact",value:function(){var e=ReactRouterDOM.BrowserRouter,t=ReactRouter,n=t.Switch,i=t.Route,a=t.Redirect;ReactDOM.render(React.createElement(e,null,React.createElement(n,null,React.createElement(i,{exact:!0,path:"/my/profile",component:MyProfilePage}),React.createElement(a,{from:"/user/"+this.USER.id,to:"/my/profile"}),React.createElement(i,{exact:!0,path:"/user/:user_id",component:UserPage}),React.createElement(i,{path:"/event/:event_id/networking",component:EventNetworkingPage}),React.createElement(i,{component:NoReactPage}))),document.getElementById("app_page_root"))}}]),e}(),EvendateApplication=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.EXPORT=new ServerExports,e.TOP_BAR=new AbstractTopBar,e.SIDEBAR=new AbstractSidebar,e.IS_WIDGET=!1,e.POST_MESSAGE=new AppPostMessageConnection(window),e.ROUTING={admin:{organization:{"^([0-9]+)":{add:{dispatch:AdminAddDispatchPage,event:AddEventPage,"":AddEventPage},dispatches:AdminOrganizationDispatchesPage,dispatch:{"^([0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})":{edit:AdminEditDispatchPage,"":AdminEditDispatchPage},add:AdminAddDispatchPage,"":AdminAddDispatchPage},edit:AdminOrganizationEditPage,overview:AdminOrganizationOverviewPage,events:AdminOrganizationEventsPage,crm:AdminOrganizationCRMPage,requisites:AdminOrganizationRequisitesPage,finances:AdminOrganizationFinancesPage,settings:AdminOrganizationSettingsPage,"":AdminOrganizationOverviewPage}},event:{"^([0-9]+)":{overview:AdminEventOverviewPage,sales:AdminEventSalesPage,orders:AdminEventOrdersPage,requests:AdminEventRequestsPage,check_in:AdminEventCheckInPage,utm_stats:AdminEventUTMTagsPage,edit:AdminEventEditPage,"":AdminEventOverviewPage}},"":AdminOrganizationsPage},add:{event:{to:{"^([0-9]+)":AddEventPage,"":AddEventPage},"":AddEventPage},organization:AddOrganizationPage},my:{orders:MyOrdersPage,tickets:MyTicketsPage,profile:MyProfilePage,"":MyProfilePage},event:{add_to:{"^([0-9]+)":AddEventPage,"":AddEventPage},add:{to:{"^([0-9]+)":AddEventPage,"":AddEventPage},"":AddEventPage},"^([0-9]+)":{order:{"^([0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})":{from_legal_entity:LegalEntityPayment},"":OrderPage},edit:EditEventPage,"":EventPage},"":FeedPage},feed:{actual:ActualEventsPage,timeline:TimelineEventsPage,favored:FavoredEventsPage,recommendations:RecommendedEventsPage,friends:FriendsEventsPage,day:{"^([0-9]{4}-[0-9]{2}-[0-9]{2})":DayEventsPage},"":ActualEventsPage},organizations:{at:{"^([0-9]+)":CatalogPage,"^([^/]+)":{"^([0-9]+)":CatalogPage,"":CatalogPage}},"^([0-9]+)":CatalogPage,"":CatalogPage},organization:{add:AddOrganizationPage,"^([0-9]+)":{feedback:OrganizationFeedbackPage,edit:EditOrganizationPage,"":OrganizationPage},"":CatalogPage},onboarding:OnboardingPage,search:{tag:{"^([^/]+)":SearchByTagPage},"^([^/]+)":SearchPage},friends:MyProfilePage,friend:{"^([0-9]+)":UserPage,"":MyProfilePage},user:{me:MyProfilePage,"^([0-9]+)":UserPage,"":MyProfilePage},ticket:{"^([^/]+)":TicketPage,"":TicketPage},"":ActualEventsPage},e}return _inherits(t,AbstractEvendateApplication),_createClass(t,[{key:"repaint",value:function(e){var t=this;AbstractEvendateApplication.prototype.repaint.call(this,e),e.header&&function(e){var n=t.TOP_BAR.$main_header.get(0).style,i=getContrastColor(e);n.setProperty("--color_primary",e),n.setProperty("color",i)}(e.header)}},{key:"setDefaultColors",value:function(){var e=this.TOP_BAR.$main_header.get(0).style;AbstractEvendateApplication.prototype.setDefaultColors.call(this),e.removeProperty("--color_primary"),e.removeProperty("color")}},{key:"changeTitle",value:function(e){var t;t="string"==typeof e?e:e instanceof Array?"object"===_typeof(e[0])?e.map(function(e){return"object"===(void 0===e?"undefined":_typeof(e))?e.title:e}).join(" > "):e.join(" > "):e instanceof jQuery?e.text():"",this.TOP_BAR.changeTitle(e),$("title").text(t||"Evendate")}},{key:"init",value:function(){AbstractEvendateApplication.prototype.init.call(this),this.SIDEBAR.activateNavItem(window.location.pathname)}}]),t}();__APP=new EvendateApplication,window.paceOptions={ajax:!1,document:!1,eventLag:!1,elements:{},search_is_active:!1,search_query:null,search_xhr:null},__stats=[],askToSubscribe=null,checkRedirect()&&(__APP.POST_MESSAGE.listen(PostMessageConnection.AVAILABLE_COMMANDS.REDIRECT,function(e){return this.location.href=e}),$(document).ajaxStart(function(){Pace.restart()}).ajaxError(function(e,t,n,i){}).ready(function(){var e,t,n;+function(){var e=window.OneSignal||[];e.push(["init",{appId:"7471a586-01f3-4eef-b989-c809700a8658",autoRegister:!1,notifyButton:{enable:!1}}]),e.push(function(){e.isPushNotificationsSupported()&&e.isPushNotificationsEnabled(function(t){t||(window.askToSubscribe=function(){e.push(function(){e.on("subscriptionChange",function(t){t&&e.getUserId(function(e){$.ajax({url:"api/v1/users/me/devices",type:"PUT",data:{device_token:e,client_type:"browser",model:navigator.appVersion?navigator.appVersion:null,os_version:navigator.platform?navigator.platform:null},global:!1})})})}),e.push(["registerForPushNotifications"]),event.preventDefault()})})})}(),void 0!==window.moment&&(moment.locale(language),moment.updateLocale("ru",{monthsShort:__LOCALES.ru_RU.DATE.MONTH_SHORT_NAMES,calendar:{sameDay:"[Сегодня]",nextDay:"[Завтра]",lastDay:"[Вчера]",nextWeek:"D MMMM",lastWeek:"D MMMM",sameElse:"D MMMM"}})),void 0!==window.Highcharts&&Highcharts.setOptions({lang:{shortMonths:__LOCALES.ru_RU.DATE.MONTH_SHORT_NAMES}}),History.Adapter.bind(window,"statechange",function(){History.stateChangeHandled||__APP.init()}),$.trumbowyg.svgPath="/app/src/vendor/trumbowyg/icons.svg",$.trumbowyg.defaultOptions.lang="ru",$.trumbowyg.defaultOptions.autogrow=!0,$.trumbowyg.defaultOptions.autogrowOnEnter=!0,$.trumbowyg.defaultOptions.btns=[["viewHTML"],["undo","redo"],["formatting"],["strong","em"],["link"],["insertImage"],["table"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat","emoji"]],isVoid(window.i18n)||i18n.translator.add(__i18n[language_without_region_code]||__i18n.ru),isNotDesktop()&&($(".DownloadAppBand").addClass("-open_band"),$(".CloseDownloadAppBand").one("click",function(){$(".DownloadAppBand").removeClass("-open_band")})),__APP.LOADER=__APP.BUILD.overlayLoader(),e=__APP.USER.fetchUser(new Fields("email","accounts","accounts_links",{subscriptions:{fields:["img_small_url","subscribed_count","new_events_count","actual_events_count"]}})),t=AsynchronousConnection.dealAjax(AsynchronousConnection.HTTP_METHODS.GET,"/auth.php",{action:"get_urls",mobile:isNotDesktop()}),n=(new CitiesCollection).fetchCities(new Fields("timediff_seconds","distance"),1,"distance"),__APP.SERVER.multipleAjax(e,t,n,function(e,t,n){__APP.USER.selected_city.setData(n[0]),__APP.AUTH_URLS=t,checkRedirect(),__APP.USER.isLoggedOut()?(__APP.TOP_BAR=new TopBarNoAuth,__APP.SIDEBAR=new SidebarNoAuth):(__APP.TOP_BAR=new TopBar,__APP.SIDEBAR=new Sidebar),__APP.TOP_BAR.init(),__APP.SIDEBAR.init(),__APP.renderReact(),bindPageLinks()}),setInterval(function(){if(0!=window.__stats.length){var e=window.__stats;window.__stats=[],$.ajax({url:"/api/v1/statistics/batch",data:JSON.stringify(e),type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",error:function(){window.__stats.concat(e)}})}},5e3)}));